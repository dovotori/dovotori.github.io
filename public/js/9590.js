(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[483,1451,9590],{1753(e,s,t){"use strict";t.d(s,{A:()=>a});var r=t(54705);const a=class{constructor(){(0,r.A)(this,"get",(()=>this)),(0,r.A)(this,"getContext",(()=>this.context)),(0,r.A)(this,"getCanvasFormat",(()=>this.format)),(0,r.A)(this,"getSupport",(()=>this.support)),(0,r.A)(this,"getDevice",(()=>this.device)),(0,r.A)(this,"getCurrentTexture",(()=>this.context.getCurrentTexture())),this.context=null,this.support={webgpu:!1,device:!1},this.device=null,this.format=null}async setup(e){if(!navigator.gpu)return;this.canvas=e,this.context=e.getContext("webgpu"),this.support.webgpu=!0;const s=await navigator.gpu.requestAdapter();s&&(this.support.device=!0,this.device=await s.requestDevice(),this.format=navigator.gpu.getPreferredCanvasFormat(),this.context.configure({device:this.device,format:this.format,alphaMode:"premultiplied"}))}}},4689(e,s,t){"use strict";t.d(s,{FN:()=>i,cy:()=>n,jc:()=>o,jh:()=>c,pu:()=>r,yT:()=>a});const r=e=>Math.PI*e/180,a=(e,s)=>Math.random()*(s-e)+e,n=(e,s,t,r,a)=>{let n=r+(e-s)*(a-r)/(t-s||1);return n<Math.min(r,a)&&(n=Math.min(r,a)),n>Math.max(r,a)&&(n=Math.max(r,a)),n},i=e=>0===e?0:e>0?1:-1,o=e=>e-Math.floor(e),c=(e,s,t)=>e*(1-t)+s*t;Math.PI,Math.PI},54705(e,s,t){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e){var s=function(e,s){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,s||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==r(s)?s:s+""}function n(e,s,t){return(s=a(s))in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}t.d(s,{A:()=>n})},61451(e,s,t){"use strict";t.r(s),t.d(s,{capitalize:()=>n,chunkArray:()=>r,getEnvPath:()=>i,isEqualArray:()=>a});const r=(e,s)=>Array.from({length:Math.ceil(e.length/s)},((t,r)=>e.slice(r*s,r*s+s))),a=(e,s)=>{if(e.length!==s.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==s[t])return!1;return!0},n=e=>e.charAt(0).toUpperCase()+e.slice(1),i=e=>`/public${e}`},69245(e,s,t){var r={"./shaders/camera/albedo":[54817,4817],"./shaders/camera/albedo.js":[54817,4817],"./shaders/camera/albedoPhong":[5215,5215],"./shaders/camera/albedoPhong.js":[5215,5215],"./shaders/camera/background":[42028,2028],"./shaders/camera/background.js":[42028,2028],"./shaders/camera/basicFrag":[62620,2620],"./shaders/camera/basicFrag.js":[62620,2620],"./shaders/camera/basicVertex":[68230,8230],"./shaders/camera/basicVertex.js":[68230,8230],"./shaders/camera/basique3d":[37851,7851],"./shaders/camera/basique3d.js":[37851,7851],"./shaders/camera/bone":[41274,1274],"./shaders/camera/bone.js":[41274,1274],"./shaders/camera/buffers":[14905,4905],"./shaders/camera/buffers.js":[14905,4905],"./shaders/camera/color":[62221,2221],"./shaders/camera/color.js":[62221,2221],"./shaders/camera/deform":[47873,7873],"./shaders/camera/deform.js":[47873,7873],"./shaders/camera/emissive":[56639,6639],"./shaders/camera/emissive.js":[56639,6639],"./shaders/camera/frequency":[66440,4059],"./shaders/camera/frequency.js":[66440,4059],"./shaders/camera/frequencyCircle":[39920,9920],"./shaders/camera/frequencyCircle.js":[39920,9920],"./shaders/camera/frequencyGrid":[43796,3796],"./shaders/camera/frequencyGrid.js":[43796,3796],"./shaders/camera/gltf":[7185,7185],"./shaders/camera/gltf.js":[7185,7185],"./shaders/camera/morph":[41140,1140],"./shaders/camera/morph.js":[41140,1140],"./shaders/camera/movingCircle":[37946,7946],"./shaders/camera/movingCircle.js":[37946,7946],"./shaders/camera/normale":[99800,9800],"./shaders/camera/normale.js":[99800,9800],"./shaders/camera/normaleMatrix":[18401,8401],"./shaders/camera/normaleMatrix.js":[18401,8401],"./shaders/camera/normalmapping":[58741,8741],"./shaders/camera/normalmapping.js":[58741,8741],"./shaders/camera/paysage":[38752,8752],"./shaders/camera/paysage.js":[38752,8752],"./shaders/camera/phong":[78024,8024],"./shaders/camera/phong.js":[78024,8024],"./shaders/camera/road":[64450,4450],"./shaders/camera/road.js":[64450,4450],"./shaders/camera/roadmountain":[24577,4577],"./shaders/camera/roadmountain.js":[24577,4577],"./shaders/camera/selected":[86909,6909],"./shaders/camera/selected.js":[86909,6909],"./shaders/camera/shadow":[96440,6440],"./shaders/camera/shadow.js":[96440,6440],"./shaders/camera/signature":[75740,5740],"./shaders/camera/signature.js":[75740,5740],"./shaders/camera/skin":[26821,6821],"./shaders/camera/skin.js":[26821,6821],"./shaders/camera/skinMat":[7111,7111],"./shaders/camera/skinMat.js":[7111,7111],"./shaders/camera/sprite":[66661,6661],"./shaders/camera/sprite.js":[66661,6661],"./shaders/camera/spritePhong":[58003,8003],"./shaders/camera/spritePhong.js":[58003,8003],"./shaders/camera/texture":[46845,6845],"./shaders/camera/texture.js":[46845,6845],"./shaders/camera/update":[14029,4029],"./shaders/camera/update.js":[14029,4029],"./shaders/camera/vertexColor":[7823,7823],"./shaders/camera/vertexColor.js":[7823,7823],"./shaders/diorama/instancing":[46049,8430],"./shaders/diorama/instancing.js":[46049,8430],"./shaders/diorama/instancingDepth":[19269,9269],"./shaders/diorama/instancingDepth.js":[19269,9269],"./shaders/diorama/shadow":[20466,466],"./shaders/diorama/shadow.js":[20466,466],"./shaders/diorama/terrain":[99305,9305],"./shaders/diorama/terrain.js":[99305,9305],"./shaders/diorama/terrainClip":[18975,8975],"./shaders/diorama/terrainClip.js":[18975,8975],"./shaders/diorama/terrainDepth":[57940,7940],"./shaders/diorama/terrainDepth.js":[57940,7940],"./shaders/diorama/water":[21535,1535],"./shaders/diorama/water.js":[21535,1535],"./shaders/diorama/waterFragment1":[90944,944],"./shaders/diorama/waterFragment1.js":[90944,944],"./shaders/diorama/waterFragment2":[25241,5241],"./shaders/diorama/waterFragment2.js":[25241,5241],"./shaders/particules/pass1":[10833,833],"./shaders/particules/pass1.js":[10833,833],"./shaders/particules/pass1Morph":[40327,327],"./shaders/particules/pass1Morph.js":[40327,327],"./shaders/particules/pass2":[47544,7544],"./shaders/particules/pass2.js":[47544,7544],"./shaders/particules/pass2Camera":[25659,5659],"./shaders/particules/pass2Camera.js":[25659,5659],"./shaders/screen/basicVertex":[68609,8609],"./shaders/screen/basicVertex.js":[68609,8609],"./shaders/screen/bloom":[78742,8742],"./shaders/screen/bloom.js":[78742,8742],"./shaders/screen/blur":[72800,2800],"./shaders/screen/blur.js":[72800,2800],"./shaders/screen/blurDirection":[93339,3339],"./shaders/screen/blurDirection.js":[93339,3339],"./shaders/screen/blurMultiPass":[4046,4046],"./shaders/screen/blurMultiPass.js":[4046,4046],"./shaders/screen/blurOnePass":[46339,6339],"./shaders/screen/blurOnePass.js":[46339,6339],"./shaders/screen/blurRadial":[96015,6015],"./shaders/screen/blurRadial.js":[96015,6015],"./shaders/screen/brightcontrast":[75975,5975],"./shaders/screen/brightcontrast.js":[75975,5975],"./shaders/screen/compose":[20621,621],"./shaders/screen/compose.js":[20621,621],"./shaders/screen/composeShadow":[32493,2493],"./shaders/screen/composeShadow.js":[32493,2493],"./shaders/screen/debug":[70934,934],"./shaders/screen/debug.js":[70934,934],"./shaders/screen/diffuse":[3191,3191],"./shaders/screen/diffuse.js":[3191,3191],"./shaders/screen/dof":[69328,9328],"./shaders/screen/dof.js":[69328,9328],"./shaders/screen/fxaa":[70085,85],"./shaders/screen/fxaa.js":[70085,85],"./shaders/screen/fxaa2":[86055,6055],"./shaders/screen/fxaa2.js":[86055,6055],"./shaders/screen/gamma":[17016,7016],"./shaders/screen/gamma.js":[17016,7016],"./shaders/screen/glitch":[32172,2172],"./shaders/screen/glitch.js":[32172,2172],"./shaders/screen/glitch2":[20316,316],"./shaders/screen/glitch2.js":[20316,316],"./shaders/screen/glitch3":[25251,5251],"./shaders/screen/glitch3.js":[25251,5251],"./shaders/screen/glitch4":[21562,1562],"./shaders/screen/glitch4.js":[21562,1562],"./shaders/screen/kuwahara":[99123,9123],"./shaders/screen/kuwahara.js":[99123,9123],"./shaders/screen/landscape":[59852,9852],"./shaders/screen/landscape.js":[59852,9852],"./shaders/screen/line":[37871,7871],"./shaders/screen/line.js":[37871,7871],"./shaders/screen/mergeBloom":[60422,422],"./shaders/screen/mergeBloom.js":[60422,422],"./shaders/screen/oil":[89349,9349],"./shaders/screen/oil.js":[89349,9349],"./shaders/screen/pixel":[63441,3441],"./shaders/screen/pixel.js":[63441,3441],"./shaders/screen/point":[63331,3331],"./shaders/screen/point.js":[63331,3331],"./shaders/screen/raymarch":[34990,4990],"./shaders/screen/raymarch.js":[34990,4990],"./shaders/screen/rgb":[39182,9182],"./shaders/screen/rgb.js":[39182,9182],"./shaders/screen/screen":[48553,8553],"./shaders/screen/screen.js":[48553,8553],"./shaders/screen/sepia":[7475,7475],"./shaders/screen/sepia.js":[7475,7475],"./shaders/screen/shader":[78664,8664],"./shaders/screen/shader.js":[78664,8664],"./shaders/screen/signature":[33359,3359],"./shaders/screen/signature.js":[33359,3359],"./shaders/screen/sketch":[51789,1789],"./shaders/screen/sketch.js":[51789,1789],"./shaders/screen/sobel":[52008,2008],"./shaders/screen/sobel.js":[52008,2008],"./shaders/screen/specular":[99924,9924],"./shaders/screen/specular.js":[99924,9924],"./shaders/screen/ssao":[52171,2171],"./shaders/screen/ssao-chapman":[85624,3243],"./shaders/screen/ssao-chapman.js":[85624,3243],"./shaders/screen/ssao.js":[52171,2171],"./shaders/screen/tunnelrace":[90434,434],"./shaders/screen/tunnelrace.js":[90434,434],"./shaders/screen/tunnelround":[32643,2643],"./shaders/screen/tunnelround.js":[32643,2643],"./shaders/screen/tunnelsquared":[36182,6182],"./shaders/screen/tunnelsquared.js":[36182,6182],"./shaders/screen/vortex":[75757,5757],"./shaders/screen/vortex.js":[75757,5757],"./shaders/screen/water":[12822,2822],"./shaders/screen/water.js":[12822,2822],"./shaders/screen/watercolor":[62887,2887],"./shaders/screen/watercolor.js":[62887,2887],"./shaders/screen/watercolor2":[13729,3729],"./shaders/screen/watercolor2.js":[13729,3729],"./shaders/screen/watercolor3":[59826,9826],"./shaders/screen/watercolor3.js":[59826,9826],"./shaders/screen/watercolorMoving":[89825,9825],"./shaders/screen/watercolorMoving.js":[89825,9825],"./shaders/screen/wave":[52296,2296],"./shaders/screen/wave.js":[52296,2296],"./shaders/sky/getClouds":[21396,1396],"./shaders/sky/getClouds.js":[21396,1396],"./shaders/sky/getSunSky":[49789,9789],"./shaders/sky/getSunSky.js":[49789,9789],"./shaders/sky/roadSky":[20749,749],"./shaders/sky/roadSky.js":[20749,749],"./shaders/sky/skyWithFloor":[29017,9017],"./shaders/sky/skyWithFloor.js":[29017,9017],"./shaders/sky/sunset":[61890,1890],"./shaders/sky/sunset.js":[61890,1890],"./shaders/sky/tunnel":[39966,9966],"./shaders/sky/tunnel.js":[39966,9966],"./shaders/utils":[69754,9754],"./shaders/utils/":[69754,9754],"./shaders/utils/blur":[90657,657],"./shaders/utils/blur.js":[90657,657],"./shaders/utils/fog":[52142,2142],"./shaders/utils/fog.js":[52142,2142],"./shaders/utils/index":[69754,9754],"./shaders/utils/index.js":[69754,9754],"./shaders/utils/instancing":[97616,7616],"./shaders/utils/instancing.js":[97616,7616],"./shaders/utils/light":[33574,3574],"./shaders/utils/light.js":[33574,3574],"./shaders/utils/noise":[45972,5972],"./shaders/utils/noise.js":[45972,5972],"./shaders/utils/pbr":[81298,1298],"./shaders/utils/pbr.js":[81298,1298],"./shaders/utils/random":[66563,6563],"./shaders/utils/random.js":[66563,6563],"./shaders/utils/roadDistortion":[62089,2089],"./shaders/utils/roadDistortion.js":[62089,2089],"./shaders/utils/shadow":[38680,8680],"./shaders/utils/shadow.js":[38680,8680],"./shaders/utils/shapes":[28382,8382],"./shaders/utils/shapes.js":[28382,8382],"./shaders/utils/terrain":[36907,6907],"./shaders/utils/terrain.js":[36907,6907],"./shaders/utils/toon":[27500,7500],"./shaders/utils/toon.js":[27500,7500],"./shaders/wgsl/bright":[21162,1162],"./shaders/wgsl/bright.js":[21162,1162],"./shaders/wgsl/camera":[62285,2285],"./shaders/wgsl/camera.js":[62285,2285],"./shaders/wgsl/fragment/f_color":[15763,5763],"./shaders/wgsl/fragment/f_color.js":[15763,5763],"./shaders/wgsl/fragment/f_debug_tex":[77141,7141],"./shaders/wgsl/fragment/f_debug_tex.js":[77141,7141],"./shaders/wgsl/fragment/f_fish":[40708,708],"./shaders/wgsl/fragment/f_fish.js":[40708,708],"./shaders/wgsl/fragment/f_gltf":[1059,1059],"./shaders/wgsl/fragment/f_gltf.js":[1059,1059],"./shaders/wgsl/fragment/f_gltf_rig":[19646,9646],"./shaders/wgsl/fragment/f_gltf_rig.js":[19646,9646],"./shaders/wgsl/fragment/f_particule":[22731,2731],"./shaders/wgsl/fragment/f_particule.js":[22731,2731],"./shaders/wgsl/fragment/f_particule_3d":[32889,2889],"./shaders/wgsl/fragment/f_particule_3d.js":[32889,2889],"./shaders/wgsl/fragment/f_picking":[85963,5963],"./shaders/wgsl/fragment/f_picking.js":[85963,5963],"./shaders/wgsl/fragment/f_simple":[39208,9208],"./shaders/wgsl/fragment/f_simple.js":[39208,9208],"./shaders/wgsl/fragment/f_skybox":[71332,1332],"./shaders/wgsl/fragment/f_skybox.js":[71332,1332],"./shaders/wgsl/fragment/f_test":[64626,4626],"./shaders/wgsl/fragment/f_test.js":[64626,4626],"./shaders/wgsl/gaussianBlur":[92264,2264],"./shaders/wgsl/gaussianBlur.js":[92264,2264],"./shaders/wgsl/postprocess":[16367,6367],"./shaders/wgsl/postprocess.js":[16367,6367],"./shaders/wgsl/simple":[18576,8576],"./shaders/wgsl/simple.js":[18576,8576],"./shaders/wgsl/skybox":[79932,9932],"./shaders/wgsl/skybox.js":[79932,9932],"./shaders/wgsl/vertex/v_camera":[67683,7683],"./shaders/wgsl/vertex/v_camera.js":[67683,7683],"./shaders/wgsl/vertex/v_camera2":[61541,1541],"./shaders/wgsl/vertex/v_camera2.js":[61541,1541],"./shaders/wgsl/vertex/v_debug_tex":[19131,9131],"./shaders/wgsl/vertex/v_debug_tex.js":[19131,9131],"./shaders/wgsl/vertex/v_fish":[92522,2522],"./shaders/wgsl/vertex/v_fish.js":[92522,2522],"./shaders/wgsl/vertex/v_gltf":[66257,6257],"./shaders/wgsl/vertex/v_gltf.js":[66257,6257],"./shaders/wgsl/vertex/v_gltf_rig":[85272,5272],"./shaders/wgsl/vertex/v_gltf_rig.js":[85272,5272],"./shaders/wgsl/vertex/v_model_camera":[7001,7001],"./shaders/wgsl/vertex/v_model_camera.js":[7001,7001],"./shaders/wgsl/vertex/v_particule":[8253,8253],"./shaders/wgsl/vertex/v_particule.js":[8253,8253],"./shaders/wgsl/vertex/v_particule_3d":[97351,7351],"./shaders/wgsl/vertex/v_particule_3d.js":[97351,7351],"./shaders/wgsl/vertex/v_picking":[86109,6109],"./shaders/wgsl/vertex/v_picking.js":[86109,6109],"./shaders/wgsl/vertex/v_shadow_depth":[85922,5922],"./shaders/wgsl/vertex/v_shadow_depth.js":[85922,5922],"./shaders/wgsl/vertex/v_simple":[52714,2714],"./shaders/wgsl/vertex/v_simple.js":[52714,2714],"./shaders/wgsl/vertex/v_skybox":[96826,6826],"./shaders/wgsl/vertex/v_skybox.js":[96826,6826],"./shaders/wgsl/vertex/v_test":[39732,9732],"./shaders/wgsl/vertex/v_test.js":[39732,9732]};function a(e){if(!t.o(r,e))return Promise.resolve().then((()=>{var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}));var s=r[e],a=s[0];return t.e(s[1]).then((()=>t(a)))}a.keys=()=>Object.keys(r),a.id=69245,e.exports=a},99590(e,s,t){"use strict";t.d(s,{A:()=>q});var r=t(54705),a=t(61451);const n=class{constructor(e){(0,r.A)(this,"enter",(()=>{this.support&&(this.isFullscreen=!0,this.domItem.requestFullscreen?this.domItem.requestFullscreen():this.domItem.msRequestFullscreen?this.domItem.msRequestFullscreen():this.domItem.mozRequestFullScreen?this.domItem.mozRequestFullScreen():this.domItem.webkitRequestFullscreen&&this.domItem.webkitRequestFullscreen())})),(0,r.A)(this,"exit",(()=>{this.support&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())})),(0,r.A)(this,"listen",(()=>{this.support&&(document.exitFullscreen?document.addEventListener("fullscreenchange",this.onChange,!1):document.msExitFullscreen?document.addEventListener("MSFullscreenChange",this.onChange,!1):document.mozCancelFullScreen?document.addEventListener("mozfullscreenchange",this.onChange,!1):document.webkitExitFullscreen&&document.addEventListener("webkitfullscreenchange",this.onChange,!1))})),(0,r.A)(this,"onChange",(()=>{this.domItem&&(this.isOnFullscreen()?(this.domItem.setAttribute("data-fullscreen",!0),this.isFullscreen=!0):(this.domItem.removeAttribute("data-fullscreen"),this.isFullscreen=!1))})),(0,r.A)(this,"isOnFullscreen",(()=>!!document.fullscreenElement)),(0,r.A)(this,"toggle",(()=>{this.isFullscreen?this.exit():this.enter()})),(0,r.A)(this,"getButton",(()=>this.button)),this.domItem=e,this.isFullscreen=!1,this.support=!!(document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen),this.button=document.createElement("button"),this.button.id="fullscreen-toggle-btn",this.button.innerHTML='\n<svg viewbox="0 0 100 100">\n  <path d="M 0 40 L 0 0 L 40 0 L 40 10 L 10 10 L 10 40 Z"></path>\n  <path d="M 60 100 L 100 100 L 100 60 L 90 60 L 90 90 L 60 90 Z"></path>\n</svg>\n    ',this.button.addEventListener("click",this.toggle,!1),this.listen()}destroy(){this.button&&this.button.removeEventListener("click",this.toggle,!1),this.support&&(document.exitFullscreen?document.removeEventListener("fullscreenchange",this.onExit,!1):document.msExitFullscreen?document.removeEventListener("MSFullscreenChange",this.onExit,!1):document.mozCancelFullScreen?document.removeEventListener("mozfullscreenchange",this.onExit,!1):document.webkitExitFullscreen&&document.removeEventListener("webkitfullscreenchange",this.onExit,!1))}get(){return this.isFullscreen}getSupport(){return this.support}},i=class{constructor(e,s){(0,r.A)(this,"getDomItem",(()=>this.controlsDomItem)),(0,r.A)(this,"getRanges",(()=>this.ranges)),this.controlsDomItem=document.createElement("div"),this.controlsDomItem.id="controls",this.controlsDomItem.style.opacity=0;const{fullscreen:t,ranges:a}=s;a&&(this.ranges=Object.keys(a).reduce(((e,s)=>{const{min:t=0,max:r=100,value:n=0,label:i=null}=a[s],o=document.createElement("div"),c=document.createElement("input");if(c.setAttribute("type","range"),c.setAttribute("id",s),c.setAttribute("min",t),c.setAttribute("max",r),c.setAttribute("value",n),c.setAttribute("name",s),i){const e=document.createElement("label");e.setAttribute("for",s),e.innerHTML=i,o.appendChild(e)}return o.appendChild(c),this.controlsDomItem.appendChild(o),{...e,[s]:{id:s,min:t,max:r,value:n,dom:c}}}),{})),t&&(this.fullscreen=new n(e),this.controlsDomItem.appendChild(this.fullscreen.getButton()))}destroy(){this.fullscreen&&this.fullscreen.destroy()}},o=class{constructor(e){(0,r.A)(this,"onKeyPress",(e=>{void 0!==this.keysPressed[e.keyCode]&&(e.preventDefault(),this.keysPressed[e.keyCode]=!0,this.oneKeysPressed[e.keyCode]=!0)})),(0,r.A)(this,"onKeyUp",(e=>{void 0!==this.keysPressed[e.keyCode]&&(e.preventDefault(),this.keysUp[e.keyCode]=!0)})),this.keys=e,this.oneKeysPressed={},this.keysPressed={},this.keysUp={},this.charges={},Object.keys(this.keys).forEach((e=>{this.keysPressed[this.keys[e]]=!1,this.keysUp[this.keys[e]]=!1,this.oneKeysPressed[this.keys[e]]=!1,this.charges[this.keys[e]]=0})),document.addEventListener("keydown",this.onKeyPress,!1),document.addEventListener("keyup",this.onKeyUp,!1)}cancel(){document.removeEventListener("keydown",this.onKeyPress,!1),document.removeEventListener("keyup",this.onKeyUp,!1)}start(){Object.keys(this.keys).forEach((e=>{this.keysPressed[this.keys[e]]&&(this.charges[this.keys[e]]+=1)}))}end(){Object.keys(this.keys).forEach((e=>{this.keysPressed[this.keys[e]]&&this.keysUp[this.keys[e]]&&(this.charges[this.keys[e]]=0,this.keysPressed[this.keys[e]]=!1,this.keysUp[this.keys[e]]=!1)}))}getCharge(e){return this.charges[e]}resetCharge(e){this.charges[e]=0}isPressed(e){return this.charges[e]>0}isPressedOne(e){return 1===this.charges[e]}isUp(e){return this.keysUp[e]}};var c=t(4689);const h=class{constructor(e,s){let{callbackDrag:t,callbackDown:a,callbackUp:n,callbackMove:i,callbackWheel:o,callbackClick:c}=s;(0,r.A)(this,"onMove",(e=>{const s=this.computeInfos(e);this.oldPos=this.getPos(e),null!==this.callbackMove&&this.callbackMove(s),this.isDragging&&null!==this.callbackDrag&&this.callbackDrag(s)})),(0,r.A)(this,"onDown",(e=>{if(this.isDragging=!0,this.startDraggingMousePos=this.getPos(e),null!==this.callbackDown){const s=this.computeInfos(e);this.callbackDown(s)}this.oldPos=this.getPos(e)})),(0,r.A)(this,"onUp",(e=>{if(this.onMove(e),this.isDragging=!1,null!==this.callbackUp){const s=this.computeInfos(e);this.callbackUp(s)}})),(0,r.A)(this,"onWheel",(e=>{const{deltaY:s}=e;null!==this.callbackWheel&&this.callbackWheel({deltaY:s})})),(0,r.A)(this,"onClick",(e=>{null!==this.callbackClick&&this.callbackClick(this.computeInfos(e))})),this.div=e,this.callbackDrag=t||null,this.callbackDown=a||null,this.callbackUp=n||null,this.callbackMove=i||null,this.callbackWheel=o||null,this.callbackClick=c||null,this.isDragging=!1,this.startDraggingMousePos={x:0,y:0},this.oldPos={x:0,y:0},this.options={capture:!1,passive:!0},this.setup()}setup(){this.div&&(this.callbackClick&&this.div.addEventListener("click",this.onClick,!1),(this.callbackDrag||this.callbackMove)&&(this.div.addEventListener("mousemove",this.onMove,this.options),this.div.addEventListener("touchmove",this.onMove,this.options)),(this.callbackDrag||this.callbackDown||this.callbackUp)&&(window.addEventListener("mouseup",this.onUp,this.options),this.div.addEventListener("mousedown",this.onDown,this.options),this.div.addEventListener("touchstart",this.onDown,this.options),this.div.addEventListener("touchend",this.onUp,this.options)),this.callbackWheel&&this.div.addEventListener("wheel",this.onWheel,this.options))}cancel(){this.div&&(this.callbackClick&&this.div.removeEventListener("click",this.onClick,!1),(this.callbackDrag||this.callbackMove)&&(this.div.removeEventListener("mousemove",this.onMove,this.options),this.div.removeEventListener("touchmove",this.onMove,this.options)),this.callbackDrag&&(window.removeEventListener("mouseup",this.onUp,this.options),this.div.removeEventListener("mousedown",this.onDown,this.options),this.div.removeEventListener("touchstart",this.onDown,this.options),this.div.removeEventListener("touchend",this.onUp,this.options)),this.callbackWheel&&this.div.removeEventListener("wheel",this.onWheel,this.options))}getPos(e){return e.touches?.length>=0?{x:0===e.touches.length?this.oldPos.x:e.touches[0].clientX,y:0===e.touches.length?this.oldPos.y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY}}computeInfos(e){const s=this.getPos(e),t=this.div.getBoundingClientRect(),r=s.x-t.x,a=s.y-t.y,n={x:this.oldPos.x-s.x,y:this.oldPos.y-s.y};return{size:t,pos:{x:r,y:a},rel:{x:(0,c.cy)(r,0,t.width,-1,1),y:(0,c.cy)(a,0,t.height,1,-1)},relScroll:{x:e.pageX-t.left+window.scrollX,y:e.pageY-t.top+window.scrollY},relDown:{x:this.startDraggingMousePos.x-s.x,y:this.startDraggingMousePos.y-s.y},relPrevious:n,speed:Math.max(Math.abs(n.x),Math.abs(n.x))}}get(){return this.infos}};class l{static checkWebGl(e){const s=["webgl","experimental-webgl","webkit-3d","moz-webgl"];let t;for(let r=0;r<s.length;r+=1){try{t=e.getContext(s[r],{preserveDrawingBuffer:!0})}catch(e){}if(t)break}return t}constructor(e){this.gl=l.checkWebGl(e),this.support={webgl:!1,depthTexture:!1},this.gl&&(this.support.webgl=!0,this.gl.enable(this.gl.DEPTH_TEST),this.gl.clearDepth(1),this.gl.depthFunc(this.gl.LESS),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.clearColor(0,0,0,0),this.support.depthTexture=!!this.gl.getExtension("WEBGL_depth_texture"),this.support.instancedArrays=!!this.gl.getExtension("ANGLE_instanced_arrays"),this.support.drawBuffers=!!this.gl.getExtension("WEBGL_draw_buffers")||!!this.gl.getExtension("GL_EXT_draw_buffers")||!!this.gl.getExtension("EXT_draw_buffers")),this.support.pixelRatio=window.devicePixelRatio||1}get(){return this.gl}getSupport(){return this.support}}const d=l;var u=t(1753);const m=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,r.A)(this,"resize",(e=>{this.canvas.setAttribute("width",e.width),this.canvas.setAttribute("height",e.height)})),this.canvas=document.createElement("canvas"),this.isWebGpu=e}async setup(){this.isWebGpu?(this.context=new u.A,await this.context.setup(this.canvas)):this.context=new d(this.canvas)}get(){return this.canvas}getContext(){return this.context.get()}getSupport(){return this.context.getSupport()}},g=class{constructor(){(0,r.A)(this,"start",(()=>{const e=Date.now(),s=e-this.lastFrame;this.callbackNoFps&&this.callbackNoFps(),s>this.fps&&(this.callback(e-this.firstFrame),this.lastFrame=e),this.ref=window.requestAnimationFrame(this.start)})),this.fps=25,this.firstFrame=Date.now(),this.lastFrame=this.firstFrame,this.ref=null}setCallback(e){this.callback=e}setCallbackNoFps(e){this.callbackNoFps=e}setFps(e){this.fps=e}stop(){window.cancelAnimationFrame(this.ref)}},p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=new Uint8Array(256);for(let e=0;e<64;e++)f[p.charCodeAt(e)]=e;const b=e=>{const s=e.split(",")[1];let t=.75*s.length;const r=s.length;let a,n,i,o,c,h=0;"="===s[s.length-1]&&(t--,"="===s[s.length-2]&&t--);const l=new ArrayBuffer(t),d=new Uint8Array(l);for(a=0;a<r;a+=4)n=f[s.charCodeAt(a)],i=f[s.charCodeAt(a+1)],o=f[s.charCodeAt(a+2)],c=f[s.charCodeAt(a+3)],d[h++]=n<<2|i>>4,d[h++]=(15&i)<<4|o>>2,d[h++]=(3&o)<<6|63&c;return l},w=(e,s,t,r,a)=>{const n=new Float32Array(s),i=a||Float32Array.BYTES_PER_ELEMENT*r;let o=0,c=0;for(let s=0;s<t;s++){for(let s=0;s<r;s++){const t=o+s*Float32Array.BYTES_PER_ELEMENT;n[c]=e.getFloat32(t,!0),c++}o+=i}return n},v=(e,s,t,r,a)=>{const n=new Uint16Array(s),i=a||Uint16Array.BYTES_PER_ELEMENT*r;let o=0,c=0;for(let s=0;s<t;s++){for(let s=0;s<r;s++){const t=o+s*Uint16Array.BYTES_PER_ELEMENT;n[c]=e.getUint16(t,!0),c++}o+=i}return n},y=(e,s)=>{const t=new Uint8Array(s);for(let r=0;r<s;r++)t[r]=e.getUint8(r,!0);return t},x=e=>{switch(e){case 5123:return v;case 5126:return w;case 5121:return y;default:return null}},k=e=>{switch(e){case 5123:return Uint16Array;case 5126:return Float32Array;case 5121:return Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;default:return Uint32Array}},j=e=>{switch(e){case"position":return"position";case"normal":return"normale";case"texcoord_0":return"texture";case"baseColorFactor":case"color_0":return"color";case"metallicFactor":return"metal";case"roughnessFactor":return"rough";case"joints_0":return"joint";case"weights_0":return"weight";case"tangent":return"tangent";default:return}},E=e=>{switch(e){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;case"SCALAR":return 1;default:return 0}},A=(e,s,t)=>{const{bufferView:r,componentType:a,count:n,type:i,byteOffset:o=0}=t,{buffer:c,byteLength:h,byteOffset:l=0,byteStride:d}=s[r],u=new DataView(e[c],l+o,h-o),m=E(i),g=m*n,p=x(a);return p?p(u,g,n,m,d):null};const _=(e,s)=>e.map((e=>{const t=s.findIndex((s=>s.id===e)),r=s.splice(t,1)[0];return r?.children&&(r.children=_(r.children,s)),r})),C=e=>{const s=e.slice(),t=[];for(;0!==s.length;){const e=s.shift();e.children&&(e.children=_(e.children,s)),t.push(e)}return t},L=["position","normale","texture","joint","weight","tangent"],M=(e,s)=>e.map((e=>{const{attributes:t,indices:r,material:a,targets:n}=e,i=((e,s,t,r)=>{const a=s[t];let n={indices:{...a,size:E(a.type)}},i=r?.map((e=>Object.keys(e).reduce(((t,r)=>{const a=s[e[r]];return{...t,[r]:{...a,size:E(a.type)}}}),{})));return i&&(i=i.reduce(((e,s,t)=>({...e,...Object.keys(s).reduce(((e,r)=>{const a=j(r.toLowerCase());return{...e,[`target${a}${t}`]:s[r]}}),{})})),{}),n={...i,...n}),Object.keys(e).reduce(((t,r)=>{const a=j(r.toLowerCase());if(-1===L.indexOf(a))return t;const n=e[r],i=s[n];return{...t,[a]:{...i,size:E(i.type)}}}),n)})(t,s,r,n);let o={vbos:i};return void 0!==a&&(o={material:a,...o}),o})),F=(e,s,t)=>e?e.map((e=>{let{bufferView:r,mimeType:a,name:n}=e;const i=t[r],o=((e,s)=>{const{buffer:t,byteOffset:r,byteLength:a}=s,n=new DataView(e[t],r,a);return y(n,a)})(s,i);return{mimeType:a,name:n,data:o}})):null,S=(e,s)=>{const{children:t}=e;if(t){const r=t.map((e=>S(s[e],s)));return{...e,children:r}}return e},P=e=>e.reduce(((e,s)=>{const{name:t,children:r}=s;return e[t]=s,r&&(e[t].children=P(r)),e}),{}),T=class{constructor(e){const s=JSON.parse(e),{animations:t,bufferViews:r,skins:n,nodes:i,meshes:o,materials:c,images:h}=s,{newBuffers:l,newAccessors:d}=(e=>{const{buffers:s,accessors:t,bufferViews:r}=e,a=s?.map((e=>b(e.uri))),n=t?.map((e=>({...e,values:A(a,r,e)})));return{newBuffers:a,newAccessors:n}})(s),u=n?.reduce(((e,s)=>e.concat(s.joints)),[]),m=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.map(((e,t)=>{let r=e.name||`node-${t}`,a="node";return-1!==s.indexOf(t)&&(r=e.name||`joint-${t}`,a="joint"),{...e,name:r,customType:a}}))}(i,u),g=((e,s,t,r)=>{const n={};return e&&e.forEach((e=>{let{channels:i,samplers:o}=e;i.forEach((e=>{let{target:i,sampler:c}=e;const{input:h,output:l,interpolation:d}=o[c],u=t[h],m=t[l],{node:g,path:p}=i,f=s[g];let b=E(m.type);f[p]?b=f[p].length:f.mesh&&r[f.mesh][p]?b=r[f.mesh][p].length:"scale"===p&&(b=3);const w=(0,a.chunkArray)(m.values,b),v={path:p,times:u.values,output:w,interpolation:d};n[g]=n[g]?[...n[g],v]:[v]}))})),n})(t,m,d,o);Object.keys(g).forEach((e=>{m[e].animations=g[e]}));const p=((e,s,t)=>{let r=null;if(e){const n=s.map(((e,s)=>({...e,id:s})));r=e.map((e=>{let{inverseBindMatrices:s,joints:r}=e,i=[];if(void 0!==s){const e=t[s].values;i=(0,a.chunkArray)(e,16)}if(r){const e=r.map(((e,s)=>({...n[e],invMatrix:i[s]})));return{joints:C(e)}}return null})).filter((e=>e))}return r})(n,m,d),f=o.map((e=>{let{primitives:s,weights:t}=e;let r={primitives:M(s,d)};return t&&(r={weights:t,...r}),r})),w=F(h,l,r),v=c?.map((e=>((e,s)=>{let t={};if(e&&(t={...(r=e.pbrMetallicRoughness,Object.keys(r).reduce(((e,s)=>{const t=j(s);return{...e,[t]:r[s]}}),[])),name:e.name},e.normalTexture)){const r=s[e.normalTexture.index];t.normalMap=r||void 0}var r;return Object.keys(t).length>0?t:void 0})(e,w)));let y=(e=>{const s={};return e.forEach((e=>{let{children:t}=e;t&&t.forEach((e=>{s[e]=!0}))})),e.map((s=>S(s,e))).filter(((e,t)=>void 0===s[t]))})(m);y=P(y),this.data={},f&&(this.data.meshes=f),y&&(this.data.nodes=y),p&&(this.data.skins=p),v&&(this.data.materials=v)}get(){return this.data}};var I;class D{constructor(){}static gpuFormatForAccessor(e){const s=e.normalized?"norm":"int",t=E(e.type),r=t>1?`x${t}`:"";switch(e.componentType){case WebGLRenderingContext.BYTE:return`s${s}8${r}`;case WebGLRenderingContext.UNSIGNED_BYTE:return`u${s}8${r}`;case WebGLRenderingContext.SHORT:return`s${s}16${r}`;case WebGLRenderingContext.UNSIGNED_SHORT:return`u${s}16${r}`;case WebGLRenderingContext.UNSIGNED_INT:return`u${s}32${r}`;case WebGLRenderingContext.FLOAT:return`float32${r}`}}static gpuPrimitiveTopologyForMode(e){switch(e){case WebGLRenderingContext.TRIANGLE_STRIP:return"triangle-strip";case WebGLRenderingContext.LINES:return"line-list";case WebGLRenderingContext.LINE_STRIP:return"line-strip";case WebGLRenderingContext.POINTS:return"point-list";default:return"triangle-list"}}static getShaderLocationFromName(e){switch(e){case"position":return 0;case"normale":return 1;case"texture":return 2;case"tangent":return 3;case"joint":return 4;case"weight":return 5;default:return}}static setInterleavedBuffer(e){const{count:s,arrayType:t,primitives:r}=e,a=Object.keys(r).sort(((e,s)=>e-s)),n=[],i=a.reduce(((e,s)=>e+r[s].numElement),0)*t.BYTES_PER_ELEMENT;for(let e=0;e<s;e++)a.forEach((s=>{const t=r[s];for(let s=0;s<t.numElement;s++){const r=e*t.numElement+s;n.push(t.buffer[r])}}));return{buffer:new t(n),arrayStride:i}}static getMaterials(e,s,t,r){const a=new Map,n=new Map;return e?.forEach(((e,i)=>{if(e.pbrMetallicRoughness?.baseColorTexture){const n=e.pbrMetallicRoughness.baseColorTexture.index,i=s[n],o=i?.source,c=i?.sampler,h=r[o],l=t[c];a.set(n,{image:h,sampler:l})}n.set(i,e)})),{newMaterials:n,matTextures:a}}static getSkins(e,s){const t=new Map,r=new Set;return e.skins?.forEach(((n,i)=>{const{joints:o,inverseBindMatrices:c}=n,h=s.get(c),l=h.buffer,d=(0,a.chunkArray)(l,16),u=o.map(((s,t)=>({...e.nodes[s],invMatrix:d[t],id:s})));t.set(i,{hierarchy:o,joints:C(u),inverseMatrixesAccessor:h}),o.forEach((e=>{r.add(e)}))})),{skins:t,jointsIndexes:r}}static async load(e,s){const t=await D.fetchBuffers(e.buffers,s);return await D.parse({...e,buffers:t})}static async fetchBuffers(e,s){return await Promise.all(e.map((e=>e.uri?.endsWith(".bin")?fetch(s+e.uri).then((e=>e.arrayBuffer())):e)))}static async parse(e){const{meshes:s,nodes:t,materials:r,textures:a,samplers:n,images:i}=e,{newMaterials:o,matTextures:c}=D.getMaterials(r,a,n,i),{layoutBuffers:h,textureBuffers:l}=await D.getBuffersDataWebGpu(e,c),d=D.getMeshes(e,h),{skins:u,jointsIndexes:m}=D.getSkins(e,h),g=D.getNodes(t,m),p=D.getAnimationsPerNodes(e,h),f=new Map;return d&&f.set("meshes",d),f.set("nodes",g),f.set("materials",o),f.set("pipeline",D.getPipelines(s)),f.set("animations",p),f.set("textures",l),u.size>0&&f.set("skins",u),f}}I=D,(0,r.A)(D,"getBuffersDataWebGpu",(async(e,s)=>{const{buffers:t,accessors:r,bufferViews:a}=e,n=t?.map((e=>e.uri?.startsWith("data:")?b(e.uri):e.data?e.data:e)),i=new Map;s.forEach((async(e,s)=>{const t=e.image.bufferView,r=a[t],o=((e,s)=>{const{buffer:t,byteLength:r,byteOffset:a=0,byteStride:n}=s,i=new DataView(e[t],a,r),o=r/Uint8Array.BYTES_PER_ELEMENT,c=o/4,h=x(5121);return h?h(i,o,c,4,n):null})(n,r),c=new Blob([o],{type:e.image.mimeType}),h=await createImageBitmap(c);i.set(s,{buffer:o,...e,imageData:h})}));const o=new Map;return r?.forEach(((e,s)=>{const t=e.bufferView,{count:r,componentType:n,type:i}=e,c=a[t],h=E(i),l=h*r;if(o.has(t)){const e=o.get(t);if(e.count!==r)throw new Error("Really weird gltf interleaved with different count on accessors");e.componentType!==n&&(e.mixTypes=!0),e.numElement+=h,e.length+=l,e.accessorsIndexes.push(s)}else{const e={count:r,componentType:n,numElement:h,length:l,accessorsIndexes:[s],...c};o.set(t,e)}})),o.forEach((e=>{if(e.mixTypes){const s=e.accessorsIndexes.map((e=>r[e]));e.buffer=((e,s,t)=>{const r={},a=e[s[t[0].bufferView].buffer],n=t[0].count;let i=0;for(let e=0;e<n;e++)t.forEach((e=>{const{type:s,componentType:t}=e,n=E(s),o=k(t),c=i,h=c+n*o.BYTES_PER_ELEMENT,l=Array.from(new o(a.slice(c,h)));i=h,r[t]?r[t].push(...l):r[t]=l}));return{vertex:new Float32Array(r[5126]),index:new Uint16Array(r[5123])}})(n,a,s)}else e.buffer=((e,s)=>{const{buffer:t,componentType:r,count:a,numElement:n,length:i,byteOffset:o,byteLength:c,byteStride:h}=s,l=new DataView(e[t],o,c),d=x(r);return d?d(l,i,a,n,h):null})(n,e)})),{layoutBuffers:o,textureBuffers:i}})),(0,r.A)(D,"getMeshes",((e,s)=>{const{meshes:t,accessors:r}=e,a=new Map;return t.forEach(((e,t)=>{const n=new Set;e.primitives.forEach((e=>{const{attributes:t,indices:a,material:i}=e,o=t[Object.keys(t)[0]],c=r[o],h=s.get(c.bufferView),l=1===h.accessorsIndexes.length,d=r[a],u=s.get(d.bufferView);let m=0,g=0,p=h.buffer,f=u.buffer,b=h.byteStride;const w=k(h.componentType),v={count:h.count,primitives:{},arrayType:w},y=Object.keys(t).map((e=>{const s=j(e.toLowerCase());return{shaderLocationName:s,shaderLocation:I.getShaderLocationFromName(s),attribName:e}})).filter((e=>void 0!==e.shaderLocation)).sort(((e,s)=>e.shaderLocation-s.shaderLocation)).map((e=>{let{attribName:a,shaderLocationName:n,shaderLocation:i}=e;const o=t[a],c=r[o];let h=I.gpuFormatForAccessor(c);if("joint"===n&&"JOINTS_0"===a&&4===i&&(h="float32x4"),l){const e=s.get(c.bufferView);g+=m,m=e.numElement*w.BYTES_PER_ELEMENT,v.primitives[i]={shaderLocationName:n,buffer:e.buffer,numElement:e.numElement}}else g=c.byteOffset||0;return{shaderLocation:i,format:h,offset:g||0}}));if(l){const e=I.setInterleavedBuffer(v);b=e.arrayStride,p=e.buffer}else h.mixTypes&&(f=h.buffer.index,p=h.buffer.vertex);n.add({arrayStride:b,bufferVertex:p,attributes:y,bufferIndex:f,indexCount:d.count,material:i})})),a.set(t,{primitives:n,name:e.name})})),a})),(0,r.A)(D,"getPipelines",(e=>({topology:I.gpuPrimitiveTopologyForMode(e[0].primitives[0].mode),cullMode:"back"}))),(0,r.A)(D,"getNodes",((e,s)=>{const t=new Map;e.forEach(((e,r)=>{t.set(r,{...e,isJoint:s.has(r)})}));for(const[e,s]of t)s.children?.forEach((s=>{const r=t.get(s);t.set(s,{...r,parent:e})}));for(const[e,s]of t){let r=s.parent;const a=[];for(;void 0!==r;){a.push(r);r=t.get(r).parent}t.set(e,{...s,paths:a})}return t})),(0,r.A)(D,"getAnimationsPerNodes",((e,s)=>{const{animations:t,accessors:r}=e,n=new Map;return t&&t.forEach((e=>{let{channels:t,samplers:i}=e;t.forEach((e=>{let{target:t,sampler:o}=e;const{input:c,output:h,interpolation:l}=i[o],d=r[c],u=r[h],m=s.get(d.bufferView),g=s.get(u.bufferView),{node:p,path:f}=t;if(void 0===p)return;const b=(0,a.chunkArray)(g.buffer,g.numElement),w={path:f,times:m.buffer,output:b,interpolation:l};"STEP"===l&&2===b.length&&(0,a.isEqualArray)(b[0],b[1])||(n.has(p)?n.get(p).push(w):n.set(p,[w]))}))})),n}));const N=D,O=class{constructor(e){this.materials={},this.current="",this.readLines(e)}readLines(e){e.split("\n").forEach((e=>{const s=e.split(" "),t=s[0];switch(t){case"newmtl":this.createMaterial(s.slice(1));break;case"Ns":case"Ka":case"Kd":case"Ks":case"Ke":case"Ni":case"d":case"illum":this.addInfoToMaterial(t,s.slice(1))}}))}createMaterial(e){this.current=e,this.materials[this.current]={}}addInfoToMaterial(e,s){let t="";switch(e){case"Ka":t="ambiant";break;case"Kd":t="diffuse";break;case"Ks":t="specular";break;case"Ke":t="emissive";break;case"Ns":t="specDensity";break;case"d":t="opacity"}""!==t&&(this.materials[this.current][t]=s.map((e=>parseFloat(e,10))))}get(){return this.materials}},R=class{constructor(e){(0,r.A)(this,"addFaceIndex",(e=>{const s=e.split("/");s[0]&&""!==s[0]&&this.obj.v.indices.push(parseInt(s[0],10)-1),s[1]&&""!==s[1]&&this.obj.vt.indices.push(parseInt(s[1],10)-1),s[2]&&""!==s[2]&&this.obj.vn.indices.push(parseInt(s[2],10)-1)})),this.obj={v:{indices:[],points:[]},vt:{indices:[],points:[]},vn:{indices:[],points:[]}},this.mat={},this.faceCount=0,this.readLines(e)}readLines(e){e.split("\n").forEach((e=>{const s=e.split(" "),t=s[0];switch(t){case"f":this.addFace(s.slice(1));break;case"v":case"vn":case"vt":this.addPoints(t,s.slice(1));break;case"usemtl":this.addNewMaterial(s.slice(1)[0])}}))}addFace(e){e.forEach(this.addFaceIndex),this.faceCount+=1}addPoints(e,s){("vt"===e&&3===s.length?s.slice(0,2):s).forEach((s=>{this.obj[e].points.push(parseFloat(s,10))}))}addNewMaterial(e){this.mat[3*this.faceCount]=e}get(){return{...this.obj,mat:this.mat}}};class U{constructor(e){this.assets={textures:{},objets:{},materials:{},levels:{},gltfs:{},sounds:{}},this.isWebgpu=e}static getInfo(e){const s=e.substring(e.lastIndexOf("/")+1,e.length).split(".");return{name:s[0],ext:s[1].toLowerCase()}}static loadMaterial(e,s){return fetch(e).then((e=>e.text())).then((e=>({data:new O(e).get(),info:s})))}static loadImage(e,s){return new Promise(((t,r)=>{const a=new Image;a.onload=()=>t({data:a,info:s}),a.onerror=r,a.src=e}))}static loadSound(e,s){return fetch(e).then((e=>e.arrayBuffer())).then((e=>({data:e,info:s})))}get(e){const s=e.map((e=>{const s=U.getInfo(e);switch(s.ext){case"jpg":case"jpeg":case"png":case"bmp":case"avif":case"webp":return U.loadImage(e,s);case"obj":return U.load3dObj(e,s);case"gltf":case"glb":return this.isWebgpu?U.load3dGltfWebGpu(e,s):U.load3dGltf(e,s);case"mtl":return U.loadMaterial(e,s);case"mp3":return U.loadSound(e,s);default:return null}}));return Promise.all(s).then((e=>(e.forEach((e=>{switch(e.info.ext){case"jpg":case"jpeg":case"png":case"webp":case"avif":this.assets.textures[e.info.name]=e.data;break;case"bmp":this.assets.levels[e.info.name]=e.data;break;case"obj":this.assets.objets[e.info.name]=e.data;break;case"gltf":case"glb":this.assets.gltfs[e.info.name]=e.data;break;case"mtl":this.assets.materials[e.info.name]=e.data;break;case"mp3":this.assets.sounds[e.info.name]=e.data}})),this.assets)))}}(0,r.A)(U,"load3dObj",((e,s)=>fetch(e).then((e=>e.text())).then((e=>({data:new R(e).get(),info:s}))))),(0,r.A)(U,"load3dGltf",((e,s)=>fetch(e).then((e=>e.text())).then((e=>({data:new T(e).get(),info:s}))))),(0,r.A)(U,"load3dGltfWebGpu",((e,s)=>fetch(e).then((e=>"glb"===s.ext?e.arrayBuffer():e.text())).then((async t=>{let r;if("glb"===s.ext){const e=function(e){const s=new DataView(e),t=s.getUint32(0,!0),r=s.getUint32(4,!0),a=s.getUint32(8,!0);if(1179937895!==t)throw new Error("Invalid GLB magic string");let n=12,i=null,o=null;for(;n<a;){const t=s.getUint32(n,!0),r=s.getUint32(n+4,!0);if(n+=8,1313821514===r){const s=new Uint8Array(e,n,t),r=(new TextDecoder).decode(s);i=JSON.parse(r)}else 5130562===r&&(o=e.slice(n,n+t));n+=t}return i&&o&&i.buffers&&i.buffers.length>0&&(i.buffers[0].uri=void 0,i.buffers[0].data=o),{gltf:i,version:r,length:a}}(t);r=e.gltf}else r=JSON.parse(t);return{data:await N.load(r,e.slice(0,e.lastIndexOf("/")+1)),info:s}}))));const B=U;class W{constructor(){this.shaders={}}static getInfos(e){const s=e.substring(e.lastIndexOf("/")+1,e.length).split(".");return{name:s[0],ext:s[1].toLowerCase()}}get(e){const s=e.map((e=>{let s={};const{name:r}=W.getInfos(e);try{s=t(69245)(`./shaders${e}`).then((e=>({name:r,js:e})))}catch(e){}return s}));return Promise.all(s).then((e=>(e.forEach((e=>{let{name:s,js:t}=e;this.shaders[s]=t.default})),this.shaders)))}}const G=W;class z{constructor(){(0,r.A)(this,"resize",(e=>{window.requestAnimationFrame((()=>{if(!Array.isArray(e)||!e.length)return;const s=e[0].target;s&&this.adaptCanvas(s)}))})),(0,r.A)(this,"adaptCanvas",(e=>{const{width:s,height:t}=this.getCurrentSize(e);this.canvas.resize({width:s,height:t}),this.scene.resize({width:s,height:t})})),(0,r.A)(this,"getCurrentSize",(e=>{const s=window.devicePixelRatio||1,t=(e?.offsetWidth||1024)*s;return{width:t,height:t*this.configRatio}})),(0,r.A)(this,"render",(e=>{this.keyboard&&(this.keyboard.start(),this.scene.setKeyboardInteraction(this.keyboard)),this.scene.update(e),this.scene.render(),this.keyboard&&this.keyboard.end()})),this.keyboard=null,this.mouse=null,this.scene=null,this.loop=null,this.configRatio=null,this.resizeObserver=null}async setup(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=document.querySelector(`#${s.slug}`);if(!t)return;this.configRatio=window.innerHeight/document.body.offsetWidth;let r={};if(this.configRatio=s.canvas.height/s.canvas.width,s.assets){const e=new B(s.useWebGpu);r=await e.get(s.assets.map((e=>(0,a.getEnvPath)(e))))}if(s.shaders){const e=new G;r.shaders=await e.get(s.shaders)}this.canvas=new m(s.useWebGpu),await this.canvas.setup();const{width:n,height:c}=this.getCurrentSize(t),l=this.canvas.getSupport(),d={...s,canvas:{...s.canvas,width:n,height:c},support:l},u=!!s.useDrawBuffer&&!l.drawBuffers,p=!(!s.useWebGpu||l.webgpu&&l.device);if(u||p){const e=document.createElement("p");return e.innerHTML=`\n      <b>ご迷惑おかけして申し訳ありません。</b>\n      <br/>Sorry. A support problem occured.\n      <br/>Your browser does not support ${s.useWebGpu?"WebGPU":"WebGL"} or one of the required features.\n      `,e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.textAlign="center",e.style.color="white",e.style.textShadow="1px 1px 1px rgba(0,0,0,0.5)",void t.appendChild(e)}if(this.scene=new e(this.canvas.getContext(),d),await this.scene.setupAssets(r),this.scene.setup&&this.scene.setup(),this.resizeObserver=new ResizeObserver(this.resize),this.resizeObserver.observe(t),s.keyboard&&(this.keyboard=new o(s.keyboard)),s.mouse){const{events:e,domId:r}=s.mouse,n=e.reduce(((e,s)=>({...e,[`callback${(0,a.capitalize)(s)}`]:this.scene[`onMouse${(0,a.capitalize)(s)}`]})),{}),i=r?document.querySelector(`#${r}`):t;this.mouse=new h(i,n)}s.controls&&(this.controls=new i(t,s.controls),t.appendChild(this.controls.getDomItem()),s.controls.ranges&&this.scene.setupControls&&this.scene.setupControls({ranges:this.controls.getRanges()})),z.revealAfterLoaded(t),this.loop=new g,this.loop.setCallback(this.render),this.loop.start(),t.appendChild(this.canvas.get())}stop(){this.loop&&this.loop.stop(),this.mouse&&this.mouse.cancel()}getCanvas(){return this.canvas?.get()}destroy(){this.stop(),this.scene?.destroy&&this.scene.destroy(),this.controls&&this.controls.destroy(),this.resizeObserver&&this.resizeObserver.disconnect()}}(0,r.A)(z,"revealAfterLoaded",(e=>{if(e){e.querySelectorAll("[style]").forEach((e=>{e.removeAttribute("style")}))}}));const q=z}}]);