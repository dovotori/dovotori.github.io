(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[3049,9741],{16853:(t,s,e)=>{"use strict";e.d(s,{A:()=>G});var i=e(54705);const r=class{constructor(){(0,i.A)(this,"start",(()=>{const t=(new Date).getTime(),s=t-this.lastFrame;this.callbackNoFps&&this.callbackNoFps(),s>this.fps&&(this.callback(t-this.firstFrame),this.lastFrame=t),this.ref=window.requestAnimationFrame(this.start)})),this.fps=25,this.firstFrame=(new Date).getTime(),this.lastFrame=this.firstFrame,this.ref=null}setCallback(t){this.callback=t}setCallbackNoFps(t){this.callbackNoFps=t}setFps(t){this.fps=t}stop(){window.cancelAnimationFrame(this.ref)}},h=class{constructor(t){(0,i.A)(this,"addFaceIndex",(t=>{const s=t.split("/");s[0]&&""!==s[0]&&this.obj.v.indices.push(parseInt(s[0],10)-1),s[1]&&""!==s[1]&&this.obj.vt.indices.push(parseInt(s[1],10)-1),s[2]&&""!==s[2]&&this.obj.vn.indices.push(parseInt(s[2],10)-1)})),this.obj={v:{indices:[],points:[]},vt:{indices:[],points:[]},vn:{indices:[],points:[]}},this.mat={},this.faceCount=0,this.readLines(t)}readLines(t){t.split("\n").forEach((t=>{const s=t.split(" "),e=s[0];switch(e){case"f":this.addFace(s.slice(1));break;case"v":case"vn":case"vt":this.addPoints(e,s.slice(1));break;case"usemtl":this.addNewMaterial(s.slice(1)[0])}}))}addFace(t){t.forEach(this.addFaceIndex),this.faceCount+=1}addPoints(t,s){("vt"===t&&3===s.length?s.slice(0,2):s).forEach((s=>this.obj[t].points.push(parseFloat(s,10))))}addNewMaterial(t){this.mat[3*this.faceCount]=t}get(){return{...this.obj,mat:this.mat}}},n=class{constructor(t){this.materials={},this.current="",this.readLines(t)}readLines(t){t.split("\n").forEach((t=>{const s=t.split(" "),e=s[0];switch(e){case"newmtl":this.createMaterial(s.slice(1));break;case"Ns":case"Ka":case"Kd":case"Ks":case"Ke":case"Ni":case"d":case"illum":this.addInfoToMaterial(e,s.slice(1))}}))}createMaterial(t){this.current=t,this.materials[this.current]={}}addInfoToMaterial(t,s){let e="";switch(t){case"Ka":e="ambiant";break;case"Kd":e="diffuse";break;case"Ks":e="specular";break;case"Ke":e="emissive";break;case"Ns":e="specDensity";break;case"d":e="opacity"}""!==e&&(this.materials[this.current][e]=s.map((t=>parseFloat(t,10))))}get(){return this.materials}},a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=new Uint8Array(256);for(let t=0;t<64;t++)o[a.charCodeAt(t)]=t;const l=(t,s,e,i,r)=>{const h=new Float32Array(s),n=r||Float32Array.BYTES_PER_ELEMENT*i;let a=0,o=0;for(let s=0;s<e;s++){for(let s=0;s<i;s++){const e=a+s*Float32Array.BYTES_PER_ELEMENT;h[o]=t.getFloat32(e,!0),o++}a+=n}return h},d=(t,s,e,i,r)=>{const h=new Uint16Array(s),n=r||Uint16Array.BYTES_PER_ELEMENT*i;let a=0,o=0;for(let s=0;s<e;s++){for(let s=0;s<i;s++){const e=a+s*Uint16Array.BYTES_PER_ELEMENT;h[o]=t.getUint16(e,!0),o++}a+=n}return h},c=(t,s)=>{const e=new Uint8Array(s);for(let i=0;i<s;i++)e[i]=t.getUint8(i,!0);return e};var u=e(19741);const g="VEC2",m="VEC3",p="VEC4",f="MAT2",y="MAT3",b="MAT4",v=t=>{switch(t){case g:return 2;case m:return 3;case p:case f:return 4;case y:return 9;case b:return 16;default:return 1}},x=(t,s,e)=>{const{bufferView:i,componentType:r,count:h,type:n,byteOffset:a=0}=e,{buffer:o,byteLength:u,byteOffset:g=0,byteStride:m}=s[i],p=new DataView(t[o],g+a,u-a),f=v(n),y=((t,s)=>v(t)*s)(n,h),b=(t=>{switch(t){case 5123:return d;case 5126:return l;case 5121:return c;default:return null}})(r);return b?b(p,y,h,f,m):null},E=t=>{switch(t){case"normal":return"normale";case"texcoord_0":return"texture";case"baseColorFactor":return"color";case"metallicFactor":return"metal";case"roughnessFactor":return"rough";case"joints_0":return"joint";case"weights_0":return"weight";default:return t}},T=["position","normale","texture","joint","weight","tangent"],w=(t,s)=>t.map((t=>{const{attributes:e,indices:i,material:r,targets:h}=t,n=((t,s,e,i)=>{const r=s[e];let h={indices:{...r,size:v(r.type)}},n=i?.map((t=>Object.keys(t).reduce(((e,i)=>{const r=s[t[i]];return{...e,[i]:{...r,size:v(r.type)}}}),{})));return n&&(n=n.reduce(((t,s,e)=>({...t,...Object.keys(s).reduce(((t,i)=>{const r=E(i.toLowerCase());return{...t,[`target${r}${e}`]:s[i]}}),{})})),{}),h={...n,...h}),Object.keys(t).reduce(((e,i)=>{const r=E(i.toLowerCase());if(-1===T.indexOf(r))return e;const h=t[i],n=s[h];return{...e,[r]:{...n,size:v(n.type)}}}),h)})(e,s,i,h);let a={vbos:n};return void 0!==r&&(a={material:r,...a}),a})),A=(t,s)=>t.map((t=>{const e=s.findIndex((s=>s.id===t)),i=s.splice(e,1)[0];i.children&&(i.children=A(i.children,s));const{id:r,...h}=i;return h})),P=(t,s,e,i)=>t?t.map((t=>{let{bufferView:s,mimeType:r,name:h}=t;const n=i[s],a=((t,s)=>{const{buffer:e,byteOffset:i,byteLength:r}=s,h=new DataView(t[e],i,r);return c(h,r)})(e,n);return{mimeType:r,name:h,data:a}})):null,F=(t,s)=>{const{children:e}=t;if(e){const i=e.map((t=>F(s[t],s)));return{...t,children:i}}return t},M=t=>t.reduce(((t,s)=>{const{name:e,children:i}=s;return t[e]=s,i&&(t[e].children=M(i)),t}),{}),k=class{constructor(t){const s=JSON.parse(t),{animations:e,buffers:i,bufferViews:r,accessors:h,skins:n,nodes:a,meshes:l,materials:d,images:c}=s,g=i?.map((t=>(t=>{const s=t.split(",")[1];let e=.75*s.length;const i=s.length;let r,h,n,a,l,d=0;"="===s[s.length-1]&&(e--,"="===s[s.length-2]&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(r=0;r<i;r+=4)h=o[s.charCodeAt(r)],n=o[s.charCodeAt(r+1)],a=o[s.charCodeAt(r+2)],l=o[s.charCodeAt(r+3)],u[d++]=h<<2|n>>4,u[d++]=(15&n)<<4|a>>2,u[d++]=(3&a)<<6|63&l;return c})(t.uri))),m=h?.map((t=>({...t,values:x(g,r,t)}))),p=n?.reduce(((t,s)=>t.concat(s.joints)),[]),f=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map(((t,e)=>{let i=t.name||`node-${e}`,r="node";return-1!==s.indexOf(e)&&(i=t.name||`joint-${e}`,r="joint"),{...t,name:i,customType:r}}))}(a,p),y=((t,s,e,i)=>{const r={};return t&&t.forEach((t=>{let{channels:h,samplers:n}=t;h.forEach((t=>{let{target:h,sampler:a}=t;const{input:o,output:l,interpolation:d}=n[a],c=e[o],g=e[l],{node:m,path:p}=h,f=s[m];let y=v(g.type);f[p]?y=f[p].length:f.mesh&&i[f.mesh][p]?y=i[f.mesh][p].length:"scale"===p&&(y=3);const b=(0,u.chunkArray)(g.values,y),x={path:p,times:c.values,output:b,interpolation:d};r[m]=r[m]?[...r[m],x]:[x]}))})),r})(e,f,m,l);Object.keys(y).forEach((t=>{f[t].animations=y[t]}));const b=((t,s,e)=>{let i=null;if(t){const r=s.map(((t,s)=>({...t,id:s})));i=t.map((t=>{let{inverseBindMatrices:s,joints:i}=t,h=[];if(s){const t=e[s].values;h=(0,u.chunkArray)(t,16)}if(i){const t=i.map(((t,s)=>({...r[t],invMatrix:h[s]}))).slice(),s=[];for(;0!==t.length;){const e=t.shift();e.children&&(e.children=A(e.children,t));const{id:i,...r}=e;s.push(r)}return{joints:s}}return null})).filter((t=>t))}return i})(n,f,m),T=l.map((t=>{let{primitives:s,weights:e}=t;let i={primitives:w(s,m)};return e&&(i={weights:e,...i}),i})),k=P(c,0,g,r),j=d&&d.map((t=>((t,s)=>{let e={};if(t&&(e={...(i=t.pbrMetallicRoughness,Object.keys(i).reduce(((t,s)=>{const e=E(s);return{...t,[e]:i[s]}}),[])),name:t.name},t.normalTexture)){const i=s[t.normalTexture.index];e.normalMap=i||void 0}var i;return Object.keys(e).length>0?e:void 0})(t,k)));let R=(t=>{const s={};return t.forEach((t=>{let{children:e}=t;return e&&e.forEach((t=>{s[t]=!0}))})),t.map((s=>F(s,t))).filter(((t,e)=>void 0===s[e]))})(f);R=M(R),this.data={},T&&(this.data.meshes=T),R&&(this.data.nodes=R),b&&(this.data.skins=b),j&&(this.data.materials=j)}get(){return this.data}};class j{constructor(){this.assets={textures:{},objets:{},materials:{},levels:{},gltfs:{},sounds:{}}}static getInfo(t){const s=t.substring(t.lastIndexOf("/")+1,t.length).split(".");return{name:s[0],ext:s[1].toLowerCase()}}static loadMaterial(t,s){return fetch(t).then((t=>t.text())).then((t=>({data:new n(t).get(),info:s})))}static loadImage(t,s){return new Promise(((e,i)=>{const r=new Image;r.onload=()=>e({data:r,info:s}),r.onerror=i,r.src=t}))}static loadSound(t,s){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,info:s})))}get(t){const s=t.map((t=>{const s=j.getInfo(t);switch(s.ext){case"jpg":case"jpeg":case"png":case"bmp":return j.loadImage(t,s);case"obj":return j.load3dObj(t,s);case"gltf":return j.load3dGltf(t,s);case"mtl":return j.loadMaterial(t,s);case"mp3":return j.loadSound(t,s);default:return null}}));return Promise.all(s).then((t=>(t.forEach((t=>{switch(t.info.ext){case"jpg":case"jpeg":case"png":this.assets.textures[t.info.name]=t.data;break;case"bmp":this.assets.levels[t.info.name]=t.data;break;case"obj":this.assets.objets[t.info.name]=t.data;break;case"gltf":this.assets.gltfs[t.info.name]=t.data;break;case"mtl":this.assets.materials[t.info.name]=t.data;break;case"mp3":this.assets.sounds[t.info.name]=t.data}})),this.assets)))}}(0,i.A)(j,"load3dObj",((t,s)=>fetch(t).then((t=>t.text())).then((t=>({data:new h(t).get(),info:s}))))),(0,i.A)(j,"load3dGltf",((t,s)=>fetch(t).then((t=>t.text())).then((t=>({data:new k(t).get(),info:s})))));const R=j;class C{constructor(){this.shaders={}}static getInfos(t){const s=t.substring(t.lastIndexOf("/")+1,t.length).split(".");return{name:s[0],ext:s[1].toLowerCase()}}get(t){const s=t.map((t=>{let s={};const{name:i}=C.getInfos(t);try{s=e(77741)(`./shaders${t}`).then((t=>({name:i,js:t})))}catch(t){}return s}));return Promise.all(s).then((t=>(t.forEach((t=>{let{name:s,js:e}=t;this.shaders[s]=e.default})),this.shaders)))}}const _=C;class D{static checkWebGl(t){const s=["webgl","experimental-webgl","webkit-3d","moz-webgl"];let e;for(let i=0;i<s.length;i+=1){try{e=t.getContext(s[i],{preserveDrawingBuffer:!0})}catch(t){}if(e)break}return e}constructor(t){this.gl=D.checkWebGl(t),this.support={webgl:!1,depthTexture:!1},this.gl&&(this.support.webgl=!0,this.gl.enable(this.gl.DEPTH_TEST),this.gl.clearDepth(1),this.gl.depthFunc(this.gl.LESS),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.clearColor(0,0,0,0),this.support.depthTexture=!!this.gl.getExtension("WEBGL_depth_texture"),this.support.instancedArrays=!!this.gl.getExtension("ANGLE_instanced_arrays"),this.support.drawBuffers=!!this.gl.getExtension("WEBGL_draw_buffers")||!!this.gl.getExtension("GL_EXT_draw_buffers")||!!this.gl.getExtension("EXT_draw_buffers")),this.support.pixelRatio=window.devicePixelRatio||1}get(){return this.gl}getSupport(){return this.support}}const z=D,S=class{constructor(){(0,i.A)(this,"resize",(t=>{this.canvas.setAttribute("width",t.width),this.canvas.setAttribute("height",t.height)})),this.canvas=document.createElement("canvas"),this.context=new z(this.canvas)}get(){return this.canvas}getContext(){return this.context.get()}getSupport(){return this.context.getSupport()}},L=class{constructor(t){(0,i.A)(this,"onKeyPress",(t=>{void 0!==this.keysPressed[t.keyCode]&&(t.preventDefault(),this.keysPressed[t.keyCode]=!0,this.oneKeysPressed[t.keyCode]=!0)})),(0,i.A)(this,"onKeyUp",(t=>{void 0!==this.keysPressed[t.keyCode]&&(t.preventDefault(),this.keysUp[t.keyCode]=!0)})),this.keys=t,this.oneKeysPressed={},this.keysPressed={},this.keysUp={},this.charges={},Object.keys(this.keys).forEach((t=>{this.keysPressed[this.keys[t]]=!1,this.keysUp[this.keys[t]]=!1,this.oneKeysPressed[this.keys[t]]=!1,this.charges[this.keys[t]]=0})),document.addEventListener("keydown",this.onKeyPress,!1),document.addEventListener("keyup",this.onKeyUp,!1)}cancel(){document.removeEventListener("keydown",this.onKeyPress,!1),document.removeEventListener("keyup",this.onKeyUp,!1)}start(){Object.keys(this.keys).forEach((t=>{this.keysPressed[this.keys[t]]&&(this.charges[this.keys[t]]+=1)}))}end(){Object.keys(this.keys).forEach((t=>{this.keysPressed[this.keys[t]]&&this.keysUp[this.keys[t]]&&(this.charges[this.keys[t]]=0,this.keysPressed[this.keys[t]]=!1,this.keysUp[this.keys[t]]=!1)}))}getCharge(t){return this.charges[t]}resetCharge(t){this.charges[t]=0}isPressed(t){return this.charges[t]>0}isPressedOne(t){return 1===this.charges[t]}isUp(t){return this.keysUp[t]}};class N{constructor(t){(0,i.A)(this,"enter",(()=>{this.support&&(this.isFullscreen=!0,this.domItem.requestFullscreen?this.domItem.requestFullscreen():this.domItem.msRequestFullscreen?this.domItem.msRequestFullscreen():this.domItem.mozRequestFullScreen?this.domItem.mozRequestFullScreen():this.domItem.webkitRequestFullscreen&&this.domItem.webkitRequestFullscreen())})),(0,i.A)(this,"exit",(()=>{this.support&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())})),(0,i.A)(this,"listen",(()=>{this.support&&(document.exitFullscreen?document.addEventListener("fullscreenchange",this.onChange,!1):document.msExitFullscreen?document.addEventListener("MSFullscreenChange",this.onChange,!1):document.mozCancelFullScreen?document.addEventListener("mozfullscreenchange",this.onChange,!1):document.webkitExitFullscreen&&document.addEventListener("webkitfullscreenchange",this.onChange,!1))})),(0,i.A)(this,"onChange",(()=>{this.domItem&&(N.isOnFullscreen()?(this.domItem.setAttribute("data-fullscreen",!0),this.isFullscreen=!0):(this.domItem.removeAttribute("data-fullscreen"),this.isFullscreen=!1))})),(0,i.A)(this,"toggle",(()=>{this.isFullscreen?this.exit():this.enter()})),(0,i.A)(this,"getButton",(()=>this.button)),this.domItem=t,this.isFullscreen=!1,this.support=!!(document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen),this.button=document.createElement("button"),this.button.id="fullscreen-toggle-btn",this.button.innerHTML='\n<svg viewbox="0 0 100 100">\n  <path d="M 0 40 L 0 0 L 40 0 L 40 10 L 10 10 L 10 40 Z"></path>\n  <path d="M 60 100 L 100 100 L 100 60 L 90 60 L 90 90 L 60 90 Z"></path>\n</svg>\n    ',this.button.addEventListener("click",this.toggle,!1),this.listen()}destroy(){this.button&&this.button.removeEventListener("click",this.toggle,!1),this.support&&(document.exitFullscreen?document.removeEventListener("fullscreenchange",this.onExit,!1):document.msExitFullscreen?document.removeEventListener("MSFullscreenChange",this.onExit,!1):document.mozCancelFullScreen?document.removeEventListener("mozfullscreenchange",this.onExit,!1):document.webkitExitFullscreen&&document.removeEventListener("webkitfullscreenchange",this.onExit,!1))}get(){return this.isFullscreen}getSupport(){return this.support}}(0,i.A)(N,"isOnFullscreen",(()=>!!document.fullscreenElement));const U=N,I=class{constructor(t,s){(0,i.A)(this,"getDomItem",(()=>this.controlsDomItem)),(0,i.A)(this,"getRanges",(()=>this.ranges)),this.controlsDomItem=document.createElement("div"),this.controlsDomItem.id="controls",this.controlsDomItem.style.opacity=0;const{fullscreen:e,ranges:r}=s;r&&(this.ranges=Object.keys(r).reduce(((t,s)=>{const{min:e=0,max:i=100,value:h=0,label:n=null}=r[s],a=document.createElement("div"),o=document.createElement("input");if(o.setAttribute("type","range"),o.setAttribute("id",s),o.setAttribute("min",e),o.setAttribute("max",i),o.setAttribute("value",h),o.setAttribute("name",s),n){const t=document.createElement("label");t.setAttribute("for",s),t.innerHTML=n,a.appendChild(t)}return a.appendChild(o),this.controlsDomItem.appendChild(a),{...t,[s]:{id:s,min:e,max:i,value:h,dom:o}}}),{})),e&&(this.fullscreen=new U(t),this.controlsDomItem.appendChild(this.fullscreen.getButton()))}destroy(){this.fullscreen&&this.fullscreen.destroy()}};var O=e(50583);const B=class{constructor(t,s){let{callbackDrag:e,callbackDown:r,callbackUp:h,callbackMove:n,callbackWheel:a,callbackClick:o}=s;(0,i.A)(this,"onMove",(t=>{const s=this.computeInfos(t);this.oldPos=this.getPos(t),null!==this.callbackMove&&this.callbackMove(s),this.isDragging&&null!==this.callbackDrag&&this.callbackDrag(s)})),(0,i.A)(this,"onDown",(t=>{if(this.isDragging=!0,this.startDraggingMousePos=this.getPos(t),null!==this.callbackDown){const s=this.computeInfos(t);this.callbackDown(s)}this.oldPos=this.getPos(t)})),(0,i.A)(this,"onUp",(t=>{if(this.onMove(t),this.isDragging=!1,null!==this.callbackUp){const s=this.computeInfos(t);this.callbackUp(s)}})),(0,i.A)(this,"onWheel",(t=>{const{deltaY:s}=t;null!==this.callbackWheel&&this.callbackWheel({deltaY:s})})),(0,i.A)(this,"onClick",(t=>{null!==this.callbackClick&&this.callbackClick(this.computeInfos(t))})),this.div=t,this.callbackDrag=e||null,this.callbackDown=r||null,this.callbackUp=h||null,this.callbackMove=n||null,this.callbackWheel=a||null,this.callbackClick=o||null,this.isDragging=!1,this.startDraggingMousePos={x:0,y:0},this.oldPos={x:0,y:0},this.options={capture:!1,passive:!0},this.setup()}setup(){this.div&&(this.callbackClick&&this.div.addEventListener("click",this.onClick,!1),(this.callbackDrag||this.callbackMove)&&(this.div.addEventListener("mousemove",this.onMove,this.options),this.div.addEventListener("touchmove",this.onMove,this.options)),(this.callbackDrag||this.callbackDown||this.callbackUp)&&(window.addEventListener("mouseup",this.onUp,this.options),this.div.addEventListener("mousedown",this.onDown,this.options),this.div.addEventListener("touchstart",this.onDown,this.options),this.div.addEventListener("touchend",this.onUp,this.options)),this.callbackWheel&&this.div.addEventListener("wheel",this.onWheel,this.options))}cancel(){this.div&&(this.callbackClick&&this.div.removeEventListener("click",this.onClick,!1),(this.callbackDrag||this.callbackMove)&&(this.div.removeEventListener("mousemove",this.onMove,this.options),this.div.removeEventListener("touchmove",this.onMove,this.options)),this.callbackDrag&&(window.removeEventListener("mouseup",this.onUp,this.options),this.div.removeEventListener("mousedown",this.onDown,this.options),this.div.removeEventListener("touchstart",this.onDown,this.options),this.div.removeEventListener("touchend",this.onUp,this.options)),this.callbackWheel&&this.div.removeEventListener("wheel",this.onWheel,this.options))}getPos(t){return t.touches?.length>=0?{x:0===t.touches.length?this.oldPos.x:t.touches[0].clientX,y:0===t.touches.length?this.oldPos.y:t.touches[0].clientY}:{x:t.clientX,y:t.clientY}}computeInfos(t){const s=this.getPos(t),e=this.div.getBoundingClientRect(),i=s.x-e.x,r=s.y-e.y,h={x:this.oldPos.x-s.x,y:this.oldPos.y-s.y};return{size:e,pos:{x:i,y:r},rel:{x:(0,O.cy)(i,0,e.width,-1,1),y:(0,O.cy)(r,0,e.height,1,-1)},relScroll:{x:t.pageX-e.left+window.scrollX,y:t.pageY-e.top+window.scrollY},relDown:{x:this.startDraggingMousePos.x-s.x,y:this.startDraggingMousePos.y-s.y},relPrevious:h,speed:Math.max(Math.abs(h.x),Math.abs(h.x))}}get(){return this.infos}};class X{constructor(){(0,i.A)(this,"resize",(t=>{window.requestAnimationFrame((()=>{if(!Array.isArray(t)||!t.length)return;const s=t[0].target;s&&this.adaptCanvas(s)}))})),(0,i.A)(this,"adaptCanvas",(t=>{const{width:s,height:e}=this.getCurrentSize(t);this.canvas.resize({width:s,height:e}),this.scene.resize({width:s,height:e})})),(0,i.A)(this,"getCurrentSize",(t=>{const s=window.devicePixelRatio||1,e=(t?.offsetWidth||1024)*s;return{width:e,height:e*this.configRatio}})),(0,i.A)(this,"render",(t=>{this.keyboard&&(this.keyboard.start(),this.scene.setKeyboardInteraction(this.keyboard)),this.scene.update(t),this.scene.render(),this.keyboard&&this.keyboard.end()})),this.keyboard=null,this.mouse=null,this.scene=null,this.loop=null,this.configRatio=null,this.resizeObserver=null}async setup(t,s){const e=document.querySelector(`#${s.slug}`);if(!e)return;this.configRatio=window.innerHeight/document.body.offsetWidth;let i={};if(s){if(this.configRatio=s.canvas.height/s.canvas.width,s.assets){const t=new R;i=await t.get(s.assets.map((t=>(0,u.getEnvPath)(t))))}if(s.shaders){const t=new _;i.shaders=await t.get(s.shaders)}}this.canvas=new S;const{width:h,height:n}=this.getCurrentSize(e),a=this.canvas.getSupport(),o={...s,canvas:{...s.canvas,width:h,height:n},support:a};if(s.useDrawBuffer&&!a.drawBuffers){const t=document.createElement("p");return t.innerHTML="\n      <b>ご迷惑おかけして申し訳ありません。</b>\n      <br/>Sorry. Webgl draw buffers extension support problem occured.\n      <br/>Please try on a more recent device.\n      ",t.style.textAlign="center",t.style.margin="20px auto",void e.appendChild(t)}if(this.scene=new t(this.canvas.getContext(),o),await this.scene.setupAssets(i),this.scene.setup&&this.scene.setup(),this.resizeObserver=new ResizeObserver(this.resize),this.resizeObserver.observe(e),s){if(s.keyboard&&(this.keyboard=new L(s.keyboard)),s.mouse){const{events:t,domId:i}=s.mouse,r=t.reduce(((t,s)=>({...t,[`callback${(0,u.capitalize)(s)}`]:this.scene[`onMouse${(0,u.capitalize)(s)}`]})),{}),h=i?document.querySelector(`#${i}`):e;this.mouse=new B(h,r)}s.controls&&(this.controls=new I(e,s.controls),e.appendChild(this.controls.getDomItem()),s.controls.ranges&&this.scene.setupControls&&this.scene.setupControls({ranges:this.controls.getRanges()}))}X.revealAfterLoaded(e),this.loop=new r,this.loop.setCallback(this.render),this.loop.start(),e.appendChild(this.canvas.get())}stop(){this.loop&&this.loop.stop(),this.mouse&&this.mouse.cancel()}getCanvas(){return this.canvas&&this.canvas.get()}destroy(){this.stop(),this.scene&&this.scene.destroy&&this.scene.destroy(),this.controls&&this.controls.destroy(),this.controls&&this.resizeObserver.disconnect()}}(0,i.A)(X,"revealAfterLoaded",(t=>{if(t){t.querySelectorAll("[style]").forEach((t=>t.removeAttribute("style")))}}));const G=X},79678:(t,s,e)=>{"use strict";e.d(s,{p:()=>i});const i=1e-6},82669:(t,s,e)=>{"use strict";e.d(s,{A:()=>n});var i=e(32099);const r=class extends i.A{create(){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.size.width,this.size.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)}setFilters(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE)}},h=class extends i.A{create(){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.DEPTH_COMPONENT,this.size.width,this.size.height,0,this.gl.DEPTH_COMPONENT,this.gl.UNSIGNED_INT,null)}setFilters(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE)}},n=class{constructor(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1024,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.gl=t,this.buffer=this.gl.createFramebuffer(),this.buffer.width=s,this.buffer.height=e,this.clearColor=[0,0,0,0],this.useDepth=i,this.setup(r)}setup(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buffer);const s=this.gl.getExtension("WEBGL_draw_buffers")||this.gl.getExtension("GL_EXT_draw_buffers")||this.gl.getExtension("EXT_draw_buffers"),e=null!==s?s.COLOR_ATTACHMENT0_WEBGL+t:this.gl.COLOR_ATTACHMENT0;this.texture=new r(this.gl,this.buffer.width,this.buffer.height),this.texture.setup(),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,e,this.gl.TEXTURE_2D,this.texture.get(),0),this.useDepth&&(this.depthTexture=new h(this.gl,this.buffer.width,this.buffer.height),this.depthTexture.setup(),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.get(),0)),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}resize(t){this.end(),this.texture&&this.texture.delete(),this.depthTexture&&this.depthTexture.delete(),this.destroy(),this.buffer=this.gl.createFramebuffer(),this.buffer.width=t.width,this.buffer.height=t.height,this.setup()}start(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buffer),this.gl.viewport(0,0,this.buffer.width,this.buffer.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}end(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}get(){return this.buffer}getTexture(){return this.texture}getDepthTexture(){return this.depthTexture}setClearColor(t,s,e,i){this.clearColor=[t,s,e,i]}destroy(){this.buffer&&this.gl.deleteFramebuffer(this.buffer)}}},10334:(t,s,e)=>{"use strict";e.d(s,{A:()=>r});var i=e(65525);const r=class extends i.A{constructor(t,s){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=((t,s)=>Object.keys(s).reduce(((e,i)=>{const r=s[i];let h,n,a,o;switch(i){case"color":n="VEC4",a=4,h=t.FLOAT,o=new Float32Array(r);break;case"texture":n="VEC2",a=2,h=t.FLOAT,o=new Float32Array(r);break;case"indices":n="SCALAR",a=1,h=t.UNSIGNED_SHORT,o=new Uint16Array(r);break;case"side":case"index":case"random":n="FLOAT",a=1,h=t.FLOAT,o=new Float32Array(r);break;default:n="VEC3",a=3,h=t.FLOAT,o=new Float32Array(r)}return e[i]={locationKey:i,type:n,values:o,count:r.length/a,componentType:h,size:a},e}),{}))(t,s);super(t,i,e)}}},12911:(t,s,e)=>{"use strict";e.d(s,{A:()=>h});var i=e(10334),r=e(27128);const h=class{constructor(t){this.gl=t,this.objet=new i.A(t,r.A)}render(t){this.gl.disable(this.gl.CULL_FACE),this.objet.render(t),this.gl.enable(this.gl.CULL_FACE)}}},35416:(t,s,e)=>{"use strict";e.d(s,{A:()=>h});var i=e(75112);class r{constructor(){this.d=new Array(9),this.sauvegardePrecedente=[],this.empilement=0,this.init()}init(){for(let t=0;t<9;t+=1)this.d[t]=0;return this.sauvegardePrecedente=[],this.empilement=0,this}get(){return this.d}set(t,s,e,i,r,h,n,a,o){return this.d[0]=t,this.d[1]=s,this.d[2]=e,this.d[3]=i,this.d[4]=r,this.d[5]=h,this.d[6]=n,this.d[7]=a,this.d[8]=o,this}setFromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}setOneValue(t){for(let s=0;s<9;s+=1)this.d[s]=t[s]}multiply(t){const s=new r;for(let e=0;e<3;e+=1)for(let i=0;i<3;i+=1)for(let r=0;r<3;r+=1)s.d[3*i+e]+=this.d[3*i+r]*t.d[3*r+e];for(let t=0;t<9;t+=1)this.d[t]=s.d[t];return this}equal(t){for(let s=0;s<9;s+=1)this.d[s]=t.d[s],this.sauvegardePrecedente[s]=t.sauvegardePrecedente[s];return this}push(){this.empilement+=1;let t=0;for(let s=9*(this.empilement-1);s<9*this.empilement;s+=1)this.sauvegardePrecedente[s]=this.d[t],t+=1;return this}pop(){if(this.empilement>0){let t=0;for(let s=9*(this.empilement-1);s<9*this.empilement;s+=1)this.d[t]=this.sauvegardePrecedente[s],this.sauvegardePrecedente[s]=null,t+=1;this.empilement-=1}return this}identity(){return this.init(),this.d[0]=1,this.d[4]=1,this.d[8]=1,this}transpose(){return this.setFromArray(r.transpose(this.d))}static transpose(t){const s=new Float32Array(9);let e=0;for(let i=0;i<3;i+=1)for(let r=0;r<3;r+=1)s[e]=t[3*r+i],e+=1;return s}inverse(){const t=new Array(9),s=this.getDeterminant();if(0===s)return this.identity(),null;t[0]=this.d[4]*this.d[8]-this.d[5]*this.d[7]/s,t[1]=-(this.d[1]*this.d[8]-this.d[7]*this.d[2])/s,t[2]=this.d[1]*this.d[5]-this.d[4]*this.d[2]/s,t[3]=-(this.d[3]*this.d[8]-this.d[5]*this.d[6])/s,t[4]=this.d[0]*this.d[8]-this.d[6]*this.d[2]/s,t[5]=-(this.d[0]*this.d[5]-this.d[3]*this.d[2])/s,t[6]=this.d[3]*this.d[7]-this.d[6]*this.d[4]/s,t[7]=-(this.d[0]*this.d[7]-this.d[6]*this.d[1])/s,t[8]=this.d[0]*this.d[4]-this.d[1]*this.d[3]/s;for(let s=0;s<9;s+=1)this.d[s]=t[s];return this}getDeterminant(){return this.d[0]*(this.d[4]*this.d[8]-this.d[7]*this.d[5])+this.d[1]*(this.d[5]*this.d[6]-this.d[3]*this.d[8])+this.d[2]*(this.d[3]*this.d[7]-this.d[6]*this.d[4])}rotate(t,s,e,h){const n=new r,a=t*(Math.PI/180),o=new i.A(s,e,h);return o.normalise(),n.d[0]=o.x*o.x*(1-Math.cos(a))+Math.cos(a),n.d[1]=o.x*o.y*(1-Math.cos(a))-o.z*Math.sin(a),n.d[2]=o.x*o.z*(1-Math.cos(a))+o.y*Math.sin(a),n.d[3]=o.x*o.y*(1-Math.cos(a))+o.z*Math.sin(a),n.d[4]=o.y*o.y*(1-Math.cos(a))+Math.cos(a),n.d[5]=o.y*o.z*(1-Math.cos(a))-o.x*Math.sin(a),n.d[6]=o.x*o.z*(1-Math.cos(a))-o.y*Math.sin(a),n.d[7]=o.y*o.z*(1-Math.cos(a))+o.x*Math.sin(a),n.d[8]=o.z*o.z*(1-Math.cos(a))+Math.cos(a),this.multiply(n),this}}const h=r},27853:(t,s,e)=>{"use strict";e.d(s,{A:()=>a});var i=e(79678),r=e(75112),h=e(35416);class n{constructor(){this.d=new Array(16),this.sauvegardePrecedente=[],this.empilement=0,this.init()}init(){return this.reset(),this.sauvegardePrecedente=[],this.empilement=0,this}reset(){for(let t=0;t<16;t+=1)this.d[t]=0;return this}get(){return this.d}setRaw(t){this.d=t}set(t,s,e,i,r,h,n,a,o,l,d,c,u,g,m,p){return this.d[0]=t,this.d[1]=s,this.d[2]=e,this.d[3]=i,this.d[4]=r,this.d[5]=h,this.d[6]=n,this.d[7]=a,this.d[8]=o,this.d[9]=l,this.d[10]=d,this.d[11]=c,this.d[12]=u,this.d[13]=g,this.d[14]=m,this.d[15]=p,this}setFromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}getMatrice3x3(){const t=new h.A;return t.set(this.d[0],this.d[1],this.d[2],this.d[4],this.d[5],this.d[6],this.d[8],this.d[9],this.d[10]),t}multiplyArray(t){const s=new n;return s.setFromArray(t),this.multiply(s)}multiply(t){const s=new n;for(let e=0;e<4;e+=1)for(let i=0;i<4;i+=1)for(let r=0;r<4;r+=1)s.d[4*i+e]+=this.d[4*i+r]*t.d[4*r+e];return this.d=s.d,this}equal(t){for(let s=0;s<16;s+=1)this.d[s]=t.d[s],this.sauvegardePrecedente[s]=t.sauvegardePrecedente[s];return this}push(){this.empilement+=1;let t=0;for(let s=16*(this.empilement-1);s<16*this.empilement;s+=1)this.sauvegardePrecedente[s]=this.d[t],t+=1;return this}pop(){if(this.empilement>0){let t=0;for(let s=16*(this.empilement-1);s<16*this.empilement;s+=1)this.d[t]=this.sauvegardePrecedente[s],this.sauvegardePrecedente[s]=null,t+=1;this.empilement-=1}return this}translate(t,s,e){const i=new n;return i.identity(),i.d[12]=t,i.d[13]=s,i.d[14]=e,this.multiply(i),this}scale(t,s,e){const i=new n;return i.d[0]=t,i.d[5]=void 0===s?t:s,i.d[10]=void 0===e?t:e,i.d[15]=1,this.multiply(i),this}resetScale(){return this.d[0]=1,this.d[5]=1,this.d[10]=1,this}resetTranslate(){return this.d[12]=0,this.d[13]=0,this.d[14]=0,this}rotate(t,s,e,i){const h=new n,a=t*(Math.PI/180),o=new r.A(s,e,i);return o.normalise(),h.d[0]=o.d[0]*o.d[0]*(1-Math.cos(a))+Math.cos(a),h.d[1]=o.d[0]*o.d[1]*(1-Math.cos(a))-o.d[2]*Math.sin(a),h.d[2]=o.d[0]*o.d[2]*(1-Math.cos(a))+o.d[1]*Math.sin(a),h.d[4]=o.d[0]*o.d[1]*(1-Math.cos(a))+o.d[2]*Math.sin(a),h.d[5]=o.d[1]*o.d[1]*(1-Math.cos(a))+Math.cos(a),h.d[6]=o.d[1]*o.d[2]*(1-Math.cos(a))-o.d[0]*Math.sin(a),h.d[8]=o.d[0]*o.d[2]*(1-Math.cos(a))-o.d[1]*Math.sin(a),h.d[9]=o.d[1]*o.d[2]*(1-Math.cos(a))+o.d[0]*Math.sin(a),h.d[10]=o.d[2]*o.d[2]*(1-Math.cos(a))+Math.cos(a),h.d[15]=1,this.multiply(h),this}identity(){return this.init(),this.d[0]=1,this.d[5]=1,this.d[10]=1,this.d[15]=1,this}perspective(t,s,e,i){const r=t*(Math.PI/180),h=1/Math.tan(r/2),n=1/(e-i);return this.set(h/s,0,0,0,0,h,0,0,0,0,(e+i)*n,-1,0,0,e*i*n*2,0),this}ortho(t,s,e,i,r,h){return this.set(2/(s-t),0,0,0,0,2/(i-e),0,0,0,0,-2/(h-r),0,-(s+t)/(s-t),-(i+e)/(i-e),-(h+r)/(h-r),1),this}lookAt(t,s,e,r,h,n,a,o,l){let d,c,u,g,m,p,f,y,b,v;const x=t,E=s,T=e,w=a,A=o,P=l,F=r,M=h,k=n;return Math.abs(x-F)<i.p&&Math.abs(E-M)<i.p&&Math.abs(T-k)<i.p?(this.identity(),this):(f=x-F,y=E-M,b=T-k,v=1/Math.sqrt(f*f+y*y+b*b),f*=v,y*=v,b*=v,d=A*b-P*y,c=P*f-w*b,u=w*y-A*f,v=Math.sqrt(d*d+c*c+u*u),v?(v=1/v,d*=v,c*=v,u*=v):(d=0,c=0,u=0),g=y*u-b*c,m=b*d-f*u,p=f*c-y*d,v=Math.sqrt(g*g+m*m+p*p),v?(v=1/v,g*=v,m*=v,p*=v):(g=0,m=0,p=0),this.set(d,g,f,0,c,m,y,0,u,p,b,0,-(d*x+c*E+u*T),-(g*x+m*E+p*T),-(f*x+y*E+b*T),1),this)}transpose(){return this.setFromArray(n.transpose(this.d))}static transpose(t){const s=new Float32Array(16);let e=0;for(let i=0;i<4;i+=1)for(let r=0;r<4;r+=1)s[e]=t[4*r+i],e+=1;return s}inverse(){const t=n.getCofacteur(this.d[5],this.d[6],this.d[7],this.d[9],this.d[10],this.d[11],this.d[13],this.d[14],this.d[15]),s=n.getCofacteur(this.d[4],this.d[6],this.d[7],this.d[8],this.d[10],this.d[11],this.d[12],this.d[14],this.d[15]),e=n.getCofacteur(this.d[4],this.d[5],this.d[7],this.d[8],this.d[9],this.d[11],this.d[12],this.d[13],this.d[15]),i=n.getCofacteur(this.d[4],this.d[5],this.d[6],this.d[8],this.d[9],this.d[10],this.d[12],this.d[13],this.d[14]),r=this.d[0]*t-this.d[1]*s+this.d[2]*e-this.d[3]*i,h=n.getCofacteur(this.d[1],this.d[2],this.d[3],this.d[9],this.d[10],this.d[11],this.d[13],this.d[14],this.d[15]),a=n.getCofacteur(this.d[0],this.d[2],this.d[3],this.d[8],this.d[10],this.d[11],this.d[12],this.d[14],this.d[15]),o=n.getCofacteur(this.d[0],this.d[1],this.d[3],this.d[8],this.d[9],this.d[11],this.d[12],this.d[13],this.d[15]),l=n.getCofacteur(this.d[0],this.d[1],this.d[2],this.d[8],this.d[9],this.d[10],this.d[12],this.d[13],this.d[14]),d=n.getCofacteur(this.d[1],this.d[2],this.d[3],this.d[5],this.d[6],this.d[7],this.d[13],this.d[14],this.d[15]),c=n.getCofacteur(this.d[0],this.d[2],this.d[3],this.d[4],this.d[6],this.d[7],this.d[12],this.d[14],this.d[15]),u=n.getCofacteur(this.d[0],this.d[1],this.d[3],this.d[4],this.d[5],this.d[7],this.d[12],this.d[13],this.d[15]),g=n.getCofacteur(this.d[0],this.d[1],this.d[2],this.d[4],this.d[5],this.d[6],this.d[12],this.d[13],this.d[14]),m=n.getCofacteur(this.d[1],this.d[2],this.d[3],this.d[5],this.d[6],this.d[7],this.d[9],this.d[10],this.d[11]),p=n.getCofacteur(this.d[0],this.d[2],this.d[3],this.d[4],this.d[6],this.d[7],this.d[8],this.d[10],this.d[11]),f=n.getCofacteur(this.d[0],this.d[1],this.d[3],this.d[4],this.d[5],this.d[7],this.d[8],this.d[9],this.d[11]),y=n.getCofacteur(this.d[0],this.d[1],this.d[2],this.d[4],this.d[5],this.d[6],this.d[8],this.d[9],this.d[10]),b=1/r;return this.d[0]=b*t,this.d[1]=-b*h,this.d[2]=b*d,this.d[3]=-b*m,this.d[4]=-b*s,this.d[5]=b*a,this.d[6]=-b*c,this.d[7]=b*p,this.d[8]=b*e,this.d[9]=-b*o,this.d[10]=b*u,this.d[11]=-b*f,this.d[12]=-b*i,this.d[13]=b*l,this.d[14]=-b*g,this.d[15]=b*y,this}getDeterminant(){return this.d[0]*n.getCofacteur(this.d[5],this.d[6],this.d[7],this.d[9],this.d[10],this.d[11],this.d[13],this.d[14],this.d[15])-this.d[1]*n.getCofacteur(this.d[4],this.d[6],this.d[7],this.d[8],this.d[10],this.d[11],this.d[12],this.d[14],this.d[15])+this.d[2]*n.getCofacteur(this.d[4],this.d[5],this.d[7],this.d[8],this.d[9],this.d[11],this.d[12],this.d[13],this.d[15])-this.d[3]*n.getCofacteur(this.d[4],this.d[5],this.d[6],this.d[8],this.d[9],this.d[10],this.d[12],this.d[13],this.d[14])}static getCofacteur(t,s,e,i,r,h,n,a,o){return t*(r*o-h*a)-s*(i*o-h*n)+e*(i*a-r*n)}}const a=n},2823:(t,s,e)=>{"use strict";e.d(s,{A:()=>a});var i=e(75112),r=e(27853),h=e(79678);class n{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.x=t,this.y=s,this.z=e,this.w=i}set(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}setFromAxeAndAngle(t,s){const[e,i,r]=t;return this.x=e,this.y=i,this.z=r,this.w=s,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}approx(t,s){return Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s&&Math.abs(this.z-t.z)<=s&&Math.abs(this.w-t.w)<=s}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}multiplyArray(t){const s=this.x,e=this.y,i=this.z,r=this.w,h=t[0],n=t[1],a=t[2],o=t[3];return this.x=s*o+r*h+e*a-i*n,this.y=e*o+r*n+i*h-s*a,this.z=i*o+r*a+s*n-e*h,this.w=r*o-s*h-e*n-i*a,this}multiply(t){const s=this.x,e=this.y,i=this.z,r=this.w,h=t.x,n=t.y,a=t.z,o=t.w;return this.x=s*o+r*h+e*a-i*n,this.y=e*o+r*n+i*h-s*a,this.z=i*o+r*a+s*n-e*h,this.w=r*o-s*h-e*n-i*a,this}multiplyVector(t){const s=this.w*t.x+this.y*t.z-this.z*t.y,e=this.w*t.y+this.z*t.x-this.x*t.z,r=this.w*t.z+this.x*t.y-this.y*t.x,h=-this.x*t.x-this.y*t.y-this.z*t.z,n=s*this.w+h*-this.x+e*-this.z-r*-this.y,a=e*this.w+h*-this.y+r*-this.x-s*-this.z,o=r*this.w+h*-this.z+s*-this.y-e*-this.x;return new i.A(n,a,o)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return 0!==t&&1!==t&&(t=1/Math.sqrt(t),this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}rotateX(t){const s=.5*t,e=this.x,i=this.y,r=this.z,h=this.w,n=Math.sin(s),a=Math.cos(s);return this.x=e*a+h*n,this.y=i*a+r*n,this.z=r*a-i*n,this.w=h*a-e*n,this}rotateY(t){const s=.5*t,e=this.x,i=this.y,r=this.z,h=this.w,n=Math.sin(s),a=Math.cos(s);return this.x=e*a-r*n,this.y=i*a+h*n,this.z=r*a+e*n,this.w=h*a-i*n,this}rotateZ(t){const s=.5*t,e=this.x,i=this.y,r=this.z,h=this.w,n=Math.sin(s),a=Math.cos(s);return this.x=e*a+i*n,this.y=i*a-e*n,this.z=r*a+h*n,this.w=h*a-r*n,this}scale(t){let s=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return 0===s?this:1===s?(this.x*=t,this.y*=t,this.z*=t,this.w*=t,this):(s=t/Math.sqrt(s),this.x*=s,this.y*=s,this.z*=s,this.w*=s,this)}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}static slerpArray(t,s,e){const i=new n(t[0],t[1],t[2],t[3]),r=new n(s[0],s[1],s[2],s[3]);return new n(0,0,0,1).slerp(i,r,e)}slerp(t,s,e){const i=t.x,r=t.y,n=t.z,a=t.w;let o,l,d,c,u,g=s.x,m=s.y,p=s.z,f=s.w;return l=i*g+r*m+n*p+a*f,l<0&&(l=-l,g=-g,m=-m,p=-p,f=-f),1-l>h.p?(o=Math.acos(l),d=Math.sin(o),c=Math.sin((1-e)*o)/d,u=Math.sin(e*o)/d):(c=1-e,u=e),this.x=c*i+u*g,this.y=c*r+u*m,this.z=c*n+u*p,this.w=c*a+u*f,this}toMatrix4(){const t=this.w*this.w,s=this.x*this.x,e=this.y*this.y,i=this.z*this.z,h=1/(s+e+i+t),n=(s-e-i+t)*h,a=(-s+e-i+t)*h,o=(-s-e+i+t)*h;let l=this.x*this.y,d=this.z*this.w;const c=2*(l+d)*h,u=2*(l-d)*h;l=this.x*this.z,d=this.y*this.w;const g=2*(l-d)*h,m=2*(l+d)*h;l=this.y*this.z,d=this.x*this.w;const p=2*(l+d)*h,f=2*(l-d)*h;return(new r.A).set(n,c,g,0,u,a,p,0,m,f,o,0,0,0,0,1)}setFromMat3(t){const s=t.get(),e=s[0],i=s[1],r=s[2],h=s[3],n=s[4],a=s[5],o=s[6],l=s[7],d=s[8];return this.w=.5*Math.sqrt(Math.max(0,1+e+n+d)),this.x=.5*Math.sqrt(Math.max(0,1+e-n-d)),this.y=.5*Math.sqrt(Math.max(0,1-e+n-d)),this.z=.5*Math.sqrt(Math.max(0,1-e-n+d)),this.x*=Math.sign(a-l),this.y*=Math.sign(o-r),this.z*=Math.sign(i-h),this}get(){return[this.x,this.y,this.z,this.w]}getX(){return this.x}getY(){return this.y}getZ(){return this.z}getW(){return this.w}}const a=n},75112:(t,s,e)=>{"use strict";e.d(s,{A:()=>h});var i=e(50583);class r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.d=[0,0,0],this.set(t,s,e)}normalise(){const t=this.length();return 0!==t&&(this.d[0]/=t,this.d[1]/=t,this.d[2]/=t),this}get(){return this.d}getX(){return this.d[0]}getY(){return this.d[1]}getZ(){return this.d[2]}set(t,s,e){return null!==t&&(this.d[0]=t),null!==s?this.d[1]=s:null!==t&&(this.d[1]=t),null!==e?this.d[2]=e:null!==t&&(this.d[2]=t),this}setX(t){this.d[0]=t}setY(t){this.d[1]=t}setZ(t){this.d[2]=t}addXYZ(t,s,e){return this.d[0]+=t,this.d[1]+=s,this.d[2]+=e,this}addX(t){return this.d[0]+=t,this}addY(t){return this.d[1]+=t,this}addZ(t){return this.d[2]+=t,this}multiplyX(t){return this.d[0]*=t,this}multiplyY(t){return this.d[1]*=t,this}multiplyZ(t){return this.d[2]*=t,this}limiter(t){const s=this.d[0]*this.d[0]+this.d[1]*this.d[1]+this.d[2]*this.d[2];if(s>t*t&&s>0){const e=t/Math.sqrt(s);this.d[0]*=e,this.d[1]*=e,this.d[2]*=e}return this}cross(t){return new r(this.d[1]*t.d[2]-this.d[2]*t.d[1],this.d[2]*t.d[0]-this.d[0]*t.d[2],this.d[0]*t.d[1]-this.d[1]*t.d[0])}dot(t){return this.d[0]*t.d[0]+this.d[1]*t.d[1]+this.d[2]*t.d[2]}length(){return Math.sqrt(this.d[0]*this.d[0]+this.d[1]*this.d[1]+this.d[2]*this.d[2])}directionVers(t){return this.d[0]=t.d[0]-this.d[0],this.d[1]=t.d[1]-this.d[1],this.d[2]=t.d[2]-this.d[2],this}equal(t){return this.d=[t.d[0],t.d[1],t.d[2]],this}add(t){return this.d[0]+=t.d[0],this.d[1]+=t.d[1],this.d[2]+=t.d[2],this}addNumber(t){return this.d[0]+=t,this.d[1]+=t,this.d[2]+=t,this}minus(t){return this.d[0]-=t.d[0],this.d[1]-=t.d[1],this.d[2]-=t.d[2],this}minusNumber(t){return this.d[0]-=t,this.d[1]-=t,this.d[2]-=t,this}multiplyNumber(t){return this.d[0]*=t,this.d[1]*=t,this.d[2]*=t,this}multiplyMatrix(t){return this.set(t.d[0]*this.d[0]+t.d[1]*this.d[1]+t.d[2]*this.d[2],t.d[3]*this.d[0]+t.d[4]*this.d[1]+t.d[5]*this.d[2],t.d[6]*this.d[0]+t.d[7]*this.d[1]+t.d[8]*this.d[2]),this}multiply(t){return this.d[0]*=t.d[0],this.d[1]*=t.d[1],this.d[2]*=t.d[2],this}divideNumber(t){return this.d[0]/=t,this.d[1]/=t,this.d[2]/=t,this}divide(t){return this.d[0]/=t.d[0],this.d[1]/=t.d[1],this.d[2]/=t.d[2],this}fract(){return this.d[0]=(0,i.jc)(this.d[0]),this.d[1]=(0,i.jc)(this.d[1]),this.d[2]=(0,i.jc)(this.d[2]),this}distance(t){return Math.sqrt((t.d[0]-this.d[0])*(t.d[0]-this.d[0])+(t.d[1]-this.d[1])*(t.d[1]-this.d[1])+(t.d[2]-this.d[2])*(t.d[2]-this.d[2]))}angleDegree(t){const s=this.dot(t)/(this.length()*t.length());return 180*Math.acos(s)/Math.PI*-(0,i.FN)(this.d[0]*t.d[1]+this.d[1]*t.d[0])}computeNormal(t,s,e){const i=new r,h=new r,n=new r;return h.equal(t.minus(this)),n.equal(s.minus(this)),e?i.equal(n.cross(h)):i.equal(h.cross(n)),i.normalise(),i}static getBarycentre(t,s,e,i){const r=(s.d[2]-e.d[2])*(t.d[0]-e.d[0])+(e.d[0]-s.d[0])*(t.d[2]-e.d[2]),h=((s.d[2]-e.d[2])*(i[0]-e.d[0])+(e.d[0]-s.d[0])*(i[1]-e.d[2]))/r,n=((e.d[2]-t.d[2])*(i[0]-e.d[0])+(t.d[0]-e.d[0])*(i[1]-e.d[2]))/r,a=1-h-n;return h*t.d[1]+n*s.d[1]+a*e.d[1]}static lerp(t,s,e){const i=t.d[0],h=t.d[1],n=t.d[2],a=i+e*(s.d[0]-i),o=h+e*(s.d[1]-h),l=n+e*(s.d[2]-n);return new r(a,o,l)}}const h=r},27128:(t,s,e)=>{"use strict";e.d(s,{A:()=>i});const i={position:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],indices:[0,1,2,1,3,2],texture:[0,0,1,0,0,1,1,1]}},60837:(t,s,e)=>{"use strict";e.d(s,{A:()=>X});const i=class{constructor(t,s,e){this.gl=t,this.texture=t.createTexture(),this.filter=e?t[e]:t.NEAREST,this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.filter),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}get(){return this.texture}},r=class{constructor(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.textures={},Object.keys(s).forEach((r=>{this.textures[r]=new i(t,s[r],e[r])}))}get(t){return this.textures[t]}},h={ambiant:[0,0,0],diffuse:[.5,.5,.5],specular:[1,1,1],emissive:[0,0,0],specDensity:[1],opacity:1},n=class{constructor(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.gl=t,this.modeDessin=this.gl.TRIANGLES,this.modeCalcul=this.gl.STATIC_DRAW,this.materialProps={},this.steps=this.getSteps(s,e);const i=this.getPoints(s,e);this.stride=0,Object.entries(this.steps).forEach((t=>{null!==t[1]&&(this.stride+=t[1])})),this.vbo=this.gl.createBuffer(),this.count=i.length/this.stride,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(i),this.modeCalcul),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}enable(t){this.gl.useProgram(t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo);let s=0;Object.entries(this.steps).forEach((e=>{const[i,r]=e;void 0!==t.locations[i]&&-1!==t.locations[i]&&(this.gl.enableVertexAttribArray(t.locations[i]),this.gl.vertexAttribPointer(t.locations[i],r,this.gl.FLOAT,!1,4*this.stride,4*s)),null!==this.steps[i]&&(s+=this.steps[i])}))}render(t){this.enable(t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.drawArrays(this.modeDessin,0,this.count),this.end()}end(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.useProgram(null)}setModeDessin(t){this.modeDessin=t}setModeCalcul(t){this.modeCalcul=t}getSteps(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e={position:3};return t.vt.indices.length>0&&(e.texture=2),t.vn.indices.length>0&&(e.normale=3),s&&t.mat&&Object.keys(t.mat).forEach((e=>{const i=t.mat[e],r=s[i];r&&Object.keys(r).forEach((t=>{void 0===this.materialProps[t]&&(this.materialProps[t]=r[t].length)}))})),{...e,...this.materialProps}}getPoints(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=[];return t.v.indices.forEach(((i,r)=>{const n=3*i;if(e.push(t.v.points[n]),e.push(t.v.points[n+1]),e.push(t.v.points[n+2]),t.vt.indices.length>0){const s=2*t.vt.indices[r];e.push(t.vt.points[s]),e.push(t.vt.points[s+1])}if(t.vn.indices.length>0){const s=3*t.vn.indices[r];e.push(t.vn.points[s]),e.push(t.vn.points[s+1]),e.push(t.vn.points[s+2])}if(s&&t.mat){const i=Object.keys(t.mat).findIndex(((s,e)=>{const i=Object.keys(t.mat)[e+1];return!i||r>=s&&r<i})),n=t.mat[Object.keys(t.mat)[i]];Object.keys(this.materialProps).forEach((t=>{(s[n]&&s[n][t]||h[t]).forEach((t=>e.push(t)))}))}})),e}},a=class{constructor(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.objets={},Object.keys(s).forEach((i=>{this.objets[i]=new n(t,s[i],e&&e[i])}))}get(t){return this.objets[t]}};var o=e(54705);const l=class{constructor(t,s){(0,o.A)(this,"getLocation",(t=>this.program.locations[t]||null)),this.gl=t,this.program=this.gl.createProgram(),this.setup(s)}setup(t){this.creerShader("vertex",t.vertex),this.creerShader("fragment",t.fragment),this.gl.linkProgram(this.program),this.gl.useProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)?(this.createLocations(t),this.gl.useProgram(null)):this.gl.deleteProgram(this.program)}creerShader(t,s){const e=this.gl.createShader("vertex"===t?this.gl.VERTEX_SHADER:this.gl.FRAGMENT_SHADER);this.gl.shaderSource(e,s),this.gl.compileShader(e),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)?(this.gl.attachShader(this.program,e),this.gl.deleteShader(e)):this.gl.deleteShader(e)}createLocations(t){this.program.locations={},t.uniforms.forEach((t=>{this.program.locations[t]=this.gl.getUniformLocation(this.program,t)})),t.attributes.forEach((t=>{this.program.locations[t]=this.gl.getAttribLocation(this.program,t)}))}setProjectionView(t){this.setMatrix("projection",t.getProjection().get()),this.setMatrix("view",t.getView().get())}setMatrix(t,s){const e=this.getLocation(t);null!==e&&(this.gl.useProgram(this.program),16===s.length?this.gl.uniformMatrix4fv(e,!1,s):this.gl.uniformMatrix3fv(e,!1,s),this.gl.useProgram(null))}setInt(t,s){const e=this.getLocation(t);null!==e&&(this.gl.useProgram(this.program),this.gl.uniform1i(e,s),this.gl.useProgram(null))}setTexture(t,s,e){const i=this.getLocation(e);null!==i&&(this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,s),this.gl.uniform1i(i,t),this.gl.useProgram(null))}setFloat(t,s){const e=this.getLocation(t);null!==e&&(this.gl.useProgram(this.program),this.gl.uniform1f(e,s),this.gl.useProgram(null))}setVector(t,s){const e=this.getLocation(t);if(null!==e){switch(this.gl.useProgram(this.program),s.length){case 3:this.gl.uniform3fv(e,s);break;case 4:this.gl.uniform4fv(e,s);break;default:this.gl.uniform2fv(e,s)}this.gl.useProgram(null)}}enable(){this.gl.useProgram(this.program)}disable(){this.gl.useProgram(null)}get(){return this.program}getLocations(){return this.program.locations}};var d=e(7820);const c=class{constructor(){(0,o.A)(this,"updateResolution",((t,s)=>{Object.keys(this.programs).forEach((e=>{this.programs[e].setVector("resolution",[t,s])}))})),(0,o.A)(this,"getAll",(()=>this.programs)),this.programs={}}async setup(t,s,e){performance.now();const i=function*(){const e=Object.keys(s);for(let i=0;i<e.length;i++){const r=e[i],h=s[r];yield{prog:new l(t,h),name:r}}}();for(const t of i)await(0,d.NU)(),this.programs[t.name]=t.prog;this.updateResolution(e.width,e.height)}setCameraMatrix(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(this.programs).forEach((e=>{this.programs[e].setMatrix("view",t.getView().get());const i=s?t.getOrtho():t.getProjection();this.programs[e].setMatrix("projection",i.get())}))}get(t){return this.programs[t]}};var u=e(65525),g=e(55179);const m=class{constructor(t,s){let{vbos:e,material:i={}}=s;(0,o.A)(this,"addInstancing",((t,s)=>{this.vbos.addInstancingVbos(t,s)})),this.material=i,this.vbos=new u.A(t,e),i.normalMap&&(this.normalMap=new g.A(t,i.normalMap.data))}render(t){const{color:s,metal:e,rough:i,ao:r}=this.material;t.setVector("color",s||[1,1,1,1]),t.setFloat("metal",void 0!==e?e:0),t.setFloat("rough",void 0!==i?i:.5),t.setFloat("ao",void 0!==r?r:1),this.vbos.render(t.get())}setModeDessin(t){this.vbos.setModeDessin(t)}setModeCalcul(t){this.vbos.setModeCalcul(t)}};var p=e(2823),f=e(27853);class y{constructor(t,s){(0,o.A)(this,"renderNodesAndChildren",((t,s,e)=>{Object.keys(t).forEach((i=>{const r=t[i];this.renderNodeAndChildren(r,s,e)}))})),(0,o.A)(this,"renderNodeAndChildren",((t,s,e)=>{let i=e;"joint"!==t.customType&&(i=this.setNodeModel(t,s,e),this.renderNode(t,s)),t.children&&this.renderNodesAndChildren(t.children,s,i)})),(0,o.A)(this,"setNodeModel",((t,s,e)=>{const i=this.handleLocalTransform(t);i.multiply(e),s.setMatrix("model",i.get());const r=i.getMatrice3x3();return r.inverse(),r.transpose(),s.setMatrix("normalMatrix",r.get()),i})),(0,o.A)(this,"handleLocalTransform",(t=>{const{translation:s,rotation:e,scale:i,matrix:r}=t,h=new f.A;return h.identity(),i&&h.scale(...i),e&&h.multiply(new p.A(...e).toMatrix4()),s&&h.translate(...s),r&&h.multiplyArray(r),h}));const{nodes:e,meshes:i,materials:r}=s;this.meshes=i.map((s=>{let{primitives:e,name:i="",weights:h}=s;const n=e.map((t=>void 0!==t.material?{...t,material:r[t.material]}:t));return{name:i,primitives:y.formatPrimitives(t,n),weights:h}})),this.nodes=e}addInstancingVbos(t,s){Object.keys(this.nodes).forEach((e=>{const i=this.nodes[e],{mesh:r}=i,{primitives:h}=this.meshes[r];h.forEach((e=>e.addInstancing(t,s)))}))}render(t,s){this.renderNodesAndChildren(this.nodes,t,s)}renderOnly(t,s,e){t.forEach((t=>{const i=this.nodes[t];this.renderNodeAndChildren(i,s,e)}))}renderExcept(t,s,e){Object.keys(this.nodes).forEach((i=>{if(-1===t.indexOf(i)){const t=this.nodes[i];this.renderNodeAndChildren(t,s,e)}}))}renderNode(t,s){if(void 0!==t.mesh){const{mesh:e}=t,{primitives:i}=this.meshes[e];i.forEach((t=>t.render(s)))}}}(0,o.A)(y,"formatPrimitives",((t,s)=>s.map((s=>{const{vbos:e,material:i}=s;return new m(t,{vbos:e,material:i})}))));const b=y,v=class{constructor(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LINEAR",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;(0,o.A)(this,"findIndex",(t=>{let s=0,e=this.timeSteps[s];for(0===e&&(s++,e=this.timeSteps[s]);e&&t>e;)s++,e=this.timeSteps[s];this.index=s})),(0,o.A)(this,"setTimes",(t=>{this.timeSteps=this.times.map((s=>s*t)),this.index=0,this.interpolationValue=0})),this.times=t,this.setTimes(e),this.interpolationType=s}update(t){if(this.findIndex(t),0===this.index)this.interpolationValue=0;else if(this.index===this.times.length)this.interpolationValue=this.timeSteps[this.times.length-1];else{const s=this.timeSteps[this.index],e=this.timeSteps[this.index-1];this.interpolationValue=(t-e)/(s-e)}}setSpeed(t){this.setTimes(t)}getIndex(){return this.index}get(){return this.interpolationValue}},x=(t,s,e)=>(1-t)*s+t*e;var E=e(50583);class T extends b{constructor(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(t,s),(0,o.A)(this,"addAllAnimations",((t,s)=>Object.keys(t).reduce(((e,i)=>{let r=e;const{animations:h,name:n,children:a}=t[i];return h&&(r[n]=this.addAnimations(h,s)),a&&(r={...e,...this.addAllAnimations(a,s)}),r}),{}))),(0,o.A)(this,"addAnimations",((t,s)=>{const e={};return t.forEach((t=>{let{path:i,times:r,output:h,interpolation:n}=t,a=null!==s?h[s]:h[0];"rotation"===i&&(a=new p.A(...a).toMatrix4()),this.animationInterval[1]=Math.max(...r,this.animationInterval[1]),e[i]={output:h,sample:new v(r,n,this.speedAnimation),customStep:s,value:a}})),e})),(0,o.A)(this,"removeNodesAnimations",(t=>Object.keys(t).reduce(((s,e)=>{let i=s;const r=t[e];return i[r.name]=T.removeNodeAnim(r),r.children&&(i={...i,...this.removeNodesAnimations(r.children)}),s}),{}))),(0,o.A)(this,"update",(t=>{const s=t-this.lastFrame;s>this.animationInterval[1]*this.speedAnimation&&(this.lastFrame=t),this.updateAnimations(s)})),(0,o.A)(this,"updateAnimations",(t=>{Object.keys(this.animations).forEach((s=>{const e=this.animations[s];Object.keys(e).forEach((s=>{e[s]="rotation"===s?T.updateQuat(e[s],t):T.updateVector(e[s],t)}))}))})),(0,o.A)(this,"handleLocalTransform",(t=>{const{translation:s,rotation:e,scale:i,matrix:r,name:h}=t,n=this.animations[h],a=n&&n.rotation||null,o=n&&n.translation||null,l=n&&n.scale||null,d=new f.A;return d.identity(),(i||l)&&d.scale(...T.getVector(i,l)),(e||a)&&d.multiply(T.getRotationMat(e,a)),(s||o)&&d.translate(...T.getVector(s,o)),r&&d.multiplyArray(r),d})),(0,o.A)(this,"setAnimationStep",((t,s,e)=>{const i=this.animations[t][s],r=i.output.length,h=(0,E.cy)(e,0,1,0,r-1);i.customStep=Math.round(h)})),(0,o.A)(this,"setAnimationSpeed",((t,s,e)=>{this.animations[t][s].sample.setSpeed(e)}));const{nodes:i}=s;this.speedAnimation=2e3,this.animationInterval=[0,0],this.animations=this.addAllAnimations(i,e),this.nodes=this.removeNodesAnimations(i),this.lastFrame=0}}(0,o.A)(T,"removeNodeAnim",(t=>{const{animations:s,...e}=t;return e})),(0,o.A)(T,"getAnimationInterval",(t=>{let s=0;return t.forEach((t=>{const{animations:e}=t;e&&e.forEach((t=>{const{times:e}=t;s=Math.max(...e,s)}))})),[0,s]})),(0,o.A)(T,"updateVector",((t,s)=>{const e=t,{sample:i,customStep:r,output:h}=e;if(null===r){i.update(s);const t=i.getIndex();if(0===t)[e.value]=h;else if(t>h.length-1)e.value=h[h.length-1];else{const s=h[t-1],r=h[t],n=i.get();e.value=s.map(((t,s)=>x(n,t,r[s])))}}else e.value=h[r];return e})),(0,o.A)(T,"updateQuat",((t,s)=>{const e=t,{sample:i,customStep:r,output:h}=e;if(null===r){i.update(s);const t=i.getIndex();if(0===t)e.value=new p.A(...h[0]).toMatrix4();else if(t>h.length-1)e.value=new p.A(...h[h.length-1]).toMatrix4();else{const s=h[t-1],r=h[t],n=i.get();e.value=p.A.slerpArray(s,r,n).toMatrix4()}}else e.value=new p.A(...h[r]).toMatrix4();return e})),(0,o.A)(T,"getVector",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return s&&s.value?s.value:t})),(0,o.A)(T,"getRotationMat",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,1],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return s&&s.value?s.value:new p.A(...t).toMatrix4()}));const w=T;const A=class extends w{constructor(t,s){var e;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(t,s),e=this,(0,o.A)(this,"removeAnimations",(t=>t.map((t=>{const s=t;return s.children&&(s.children=this.removeAnimations(s.children)),w.removeNodeAnim(s)})))),(0,o.A)(this,"addJointsAnimations",((t,s)=>{t.forEach((t=>{const{animations:e,name:i,children:r}=t;e&&(this.animations[i]=this.addAnimations(e,s)),r&&this.addJointsAnimations(r,s)}))})),(0,o.A)(this,"setProgramSkin",((t,s)=>{if(void 0!==t){const e=new f.A;e.identity();const{joints:i}=this.skins[t];this.setProgramJoints(i,s,e)}})),(0,o.A)(this,"setProgramJoints",(function(t,s,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t.forEach((t=>{const{invMatrix:h,children:n}=t,a=e.handleLocalTransform(t);a.multiply(i);const o=new f.A;o.identity();const l=new f.A;l.setFromArray(h),o.multiply(l),o.multiply(a),s.setMatrix(`jointMat[${r}]`,o.get()),n&&e.setProgramJoints(n,s,a,r+1)}))}));const{skins:r}=s;r&&(r.forEach((t=>{let{joints:s}=t;this.addJointsAnimations(s,i)})),this.skins=r.map((t=>{let{joints:s}=t;return{joints:this.removeAnimations(s)}})))}renderNode(t,s,e){const{skin:i}=t;void 0!==i&&this.setProgramSkin(i,s),super.renderNode(t,s,e)}};class P{constructor(t,s){this.gltfs={},Object.keys(s).forEach((e=>{s[e].skins?this.gltfs[e]=new A(t,s[e]):P.hasAnimation(s[e].nodes)?this.gltfs[e]=new w(t,s[e]):this.gltfs[e]=new b(t,s[e])}))}get(t){return this.gltfs[t]}}(0,o.A)(P,"hasAnimation",(t=>{let s=!1;return Object.keys(t).forEach((e=>{const i=t[e];!s&&i.animations&&(s=!0)})),s}));const F=P;class M{constructor(t){(0,o.A)(this,"saveData",(t=>{this.audioData=t})),(0,o.A)(this,"togglePause",(()=>{this.isPlaying?this.isPause?(this.audioContext.resume(),this.isPause=!1):(this.audioContext.suspend(),this.isPause=!0):(this.play(),this.isPause=!1)})),(0,o.A)(this,"stop",(()=>{this.clearAnalyse(),this.sourceNode&&(this.sourceNode.removeEventListener("ended",this.stop,!1),this.sourceNode.disconnect(),this.sourceNode.stop(0)),this.isPlaying=!1})),(0,o.A)(this,"toggle",(()=>{this.isPlaying?this.stop():this.play()})),(0,o.A)(this,"clearAnalyse",(()=>{this.amplitudeArray.fill(0),this.javascriptNode&&(this.analyserNode.disconnect(),this.javascriptNode.disconnect(),this.javascriptNode.removeEventListener("audioprocess",this.onAnalyse,!1))})),(0,o.A)(this,"onAnalyse",(()=>{this.analyserNode.getByteFrequencyData(this.amplitudeArray)})),(0,o.A)(this,"setPlaybackRate",(t=>{this.playbackRate=t,this.sourceNode&&(this.sourceNode.playbackRate.value=this.playbackRate)})),(0,o.A)(this,"setVolume",(t=>{this.volume=t,this.gainNode&&(this.gainNode.gain.value=this.volume)})),(0,o.A)(this,"getAmplitudes",(()=>this.amplitudeArray)),(0,o.A)(this,"getFrequencyLength",(()=>this.analyserNode.frequencyBinCount)),(0,o.A)(this,"getIsPlaying",(()=>this.isPlaying)),(0,o.A)(this,"getIsPause",(()=>this.isPause));const s=window.AudioContext||window.webkitAudioContext;this.support=!!s;try{this.audioContext=new s}catch(t){this.support=!1}this.audioData=null,this.playbackRate=1,this.playMultiple=!1,this.isPlaying=!1,this.isPause=!0,this.isMute=!0,this.isLoop=!0,this.volume=.5,this.setup(t)}setup(t){this.support&&(this.audioContext.decodeAudioData(t,this.saveData,this.onError),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=this.volume,this.gainNode.connect(this.audioContext.destination),this.sampleSize=2048,this.javascriptNode=this.audioContext.createScriptProcessor(this.sampleSize,1,1),this.analyserNode=this.audioContext.createAnalyser(),this.analyserNode.minDecibels=-90,this.analyserNode.maxDecibels=-30,this.analyserNode.fftSize=this.sampleSize,this.amplitudeArray=new Uint8Array(this.analyserNode.frequencyBinCount))}play(){this.audioData&&(!this.playMultiple&&this.isPlaying&&this.stop(),this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.playbackRate.value=this.playbackRate,this.sourceNode.buffer=this.audioData,this.sourceNode.loop=this.isLoop,this.sourceNode.connect(this.gainNode),this.setupAnalyse(),this.sourceNode.addEventListener("ended",this.stop,!1),this.sourceNode.start(0),this.isPlaying=!0)}setupAnalyse(){this.sourceNode.connect(this.analyserNode),this.analyserNode.connect(this.javascriptNode),this.javascriptNode.connect(this.audioContext.destination),this.javascriptNode.addEventListener("audioprocess",this.onAnalyse,!1)}getSupport(){return this.support}}(0,o.A)(M,"onError",(t=>{}));const k=M,j=class{constructor(t){this.audios={},Object.keys(t).forEach((s=>{this.audios[s]=new k(t[s])}))}get(t){return this.audios[t]}};var R=e(82669);const C=class{constructor(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1024,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.fbos=[],this.currentFbo=0,this.fbos[0]=new R.A(t,s,e,i,0),this.fbos[1]=new R.A(t,s,e,i,1)}start(){this.fbos[this.currentFbo].start()}end(){this.fbos[this.currentFbo].end()}swap(){this.currentFbo=0===this.currentFbo?1:0}resize(t){this.fbos[0].resize(t),this.fbos[1].resize(t)}getTexture(){return this.fbos[this.currentFbo].getTexture()}getDepthTexture(){return this.fbos[this.currentFbo].getDepthTexture()}};var _=e(12911);const D=class{constructor(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.gl=t;const{width:i=1024,height:r=1024,useDepth:h=!1}=s;this.ppb=new C(t,i,r,h),this.screen=new _.A(t),this.passCount=0,this.programs=e,this.viewportSize={width:i,height:r}}start(){this.ppb.start(),this.passCount=0}end(){this.ppb.end()}resize(t){this.ppb.resize(t),this.viewportSize=t}applyTexToProg(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=null===s;this.passCount=e?this.passCount+1:0;const i=this.passCount+1,r=e?this.ppb.getTexture().get():s;return t.setTexture(i,r,"textureMap"),t.setFloat("flipY",-1),t}setBrightContrast(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.applyTexToProg(this.programs.brightcontrast,e);i.setFloat("brightness",t),i.setFloat("contrast",s),this.renderToPingPong(i)}setFxaa(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=this.applyTexToProg(this.programs.fxaa,t);this.renderToPingPong(s)}setFxaa2(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=this.applyTexToProg(this.programs.fxaa2,t);this.renderToPingPong(s)}renderToPingPong(t){this.ppb.swap(),this.ppb.start(),this.screen.render(t.get()),this.ppb.end()}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this.applyTexToProg(this.programs[s?"debug":"screen"],t);this.gl.viewport(0,0,this.viewportSize.width,this.viewportSize.height),this.screen.render(e.get())}renderInverse(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this.applyTexToProg(this.programs[s?"debug":"screen"],t);e.setFloat("flipY",1),this.gl.viewport(0,0,this.viewportSize.width,this.viewportSize.height),this.screen.render(e.get())}getTexture(){return this.ppb.getTexture()}};var z=e(32099);const S=class extends z.A{create(){const t=new ArrayBuffer(this.size.width*this.size.height*4),s=new Uint8Array(t);let e=0;for(let t=0;t<this.size.height;t+=1)for(let t=0;t<this.size.width;t+=1)s[e]=255*Math.random(),s[e+1]=255*Math.random(),s[e+2]=0,s[e+3]=255,e+=4;this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.size.height,this.size.width,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s)}setFilters(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)}},L=class extends D{constructor(t,s){super(t,s,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.textures={},Object.keys(this.programs).forEach((t=>{switch(t){case"watercolor2":case"watercolor3":this.textures[t]=new S(this.gl,512,512)}}))}setDOF(t,s,e,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=this.applyTexToProg(this.programs.dof,r);h.setFloat("focusDistance",e),h.setFloat("blur",s),h.setFloat("ppm",i),h.setVector("range",t),h.setTexture(2,this.ppb.getDepthTexture().get(),"depthMap"),this.renderToPingPong(h)}mergeBloom(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.applyTexToProg(this.programs.mergeBloom,i);r.setFloat("gamma",s),r.setFloat("exposure",e),r.setTexture(3,t.get(),"bloomMap"),this.renderToPingPong(r)}setKuwahara(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=this.applyTexToProg(this.programs.kuwahara,t);this.renderToPingPong(s)}setWatercolor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=this.applyTexToProg(this.programs.watercolor,t);this.renderToPingPong(s)}setWatercolor2(t,s,e,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=this.applyTexToProg(this.programs.watercolor2,r);h.setFloat("gradientStep",t),h.setFloat("advectStep",s),h.setFloat("flipHeightMap",e),h.setFloat("time",i),h.setTexture(2,this.textures.watercolor2.get(),"heightMap"),this.renderToPingPong(h)}setWatercolor3(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=this.applyTexToProg(this.programs.watercolor3,t);s.setTexture(2,this.textures.watercolor3.get(),"noiseMap"),this.renderToPingPong(s)}setWatercolorMoving(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.applyTexToProg(this.programs.watercolorMoving,i);r.setFloat("time",t),r.setVector("mouse",s),r.setFloat("scale",e),this.renderToPingPong(r)}setSobel(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=this.applyTexToProg(this.programs.sobel,t);this.renderToPingPong(s)}setGamma(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this.applyTexToProg(this.programs.gamma,s);e.setFloat("gamma",t),this.renderToPingPong(e)}setRGB(t,s,e,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=this.applyTexToProg(this.programs.rgb,r);h.setVector("center",[e,i]),h.setVector("delta",[t,s]),this.renderToPingPong(h)}setVortex(t,s,e){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.applyTexToProg(this.programs.vortex,i);r.setVector("center",t),r.setFloat("radius",s),r.setFloat("angle",e),this.renderToPingPong(r)}setOil(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this.applyTexToProg(this.programs.oil,s);e.setFloat("radius",t),this.renderToPingPong(e)}setSketch(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this.applyTexToProg(this.programs.sketch,s);e.setFloat("delta",t),this.renderToPingPong(e)}setPixel(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.applyTexToProg(this.programs.pixel,e);i.setVector("delta",[t,s]),this.renderToPingPong(i)}setWave(t,s,e){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.applyTexToProg(this.programs.wave,i);r.setFloat("time",t),r.setFloat("radius",s),r.setVector("center",e),this.renderToPingPong(r)}setSepia(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this.applyTexToProg(this.programs.sepia,s);e.setFloat("delta",t),this.renderToPingPong(e)}setGlitch(t,s,e){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.applyTexToProg(this.programs.glitch,i);r.setFloat("delta",s),r.setFloat("time",t),r.setFloat("speed",e),this.renderToPingPong(r)}setGlitch2(t,s,e){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.applyTexToProg(this.programs.glitch2,i);r.setFloat("delta",s),r.setFloat("time",t),r.setFloat("speed",e),this.renderToPingPong(r)}setGlitch3(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.applyTexToProg(this.programs.glitch3,e);i.setFloat("delta",s),i.setFloat("time",t),this.renderToPingPong(i)}setGlitch4(t,s,e){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.applyTexToProg(this.programs.glitch4,i);r.setFloat("delta",s),r.setFloat("time",t),r.setFloat("rate",e),this.renderToPingPong(r)}setSignature(t,s){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.applyTexToProg(this.programs.signature,e);i.setFloat("delta",s),i.setFloat("time",t),this.renderToPingPong(i)}setCompose(t,s,e){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.applyTexToProg(this.programs.compose,i);r.setTexture(6,t,"ssaoMap"),r.setTexture(7,s,"shadowMap"),r.setTexture(4,e,"depthMap"),this.renderToPingPong(r)}setComposeShadow(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this.applyTexToProg(this.programs.composeShadow,s);e.setTexture(4,t,"shadowMap"),this.renderToPingPong(e)}},N=class extends D{constructor(t,s){super(t,s,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),(0,o.A)(this,"setBlurIntensity",(t=>{this.blurIntensity=t})),(0,o.A)(this,"setBlurSize",(t=>{this.blurSize=t}));const e=s.blur||{};this.blurSize=void 0!==e.size?e.size:.6,this.blurIntensity=void 0!==e.intensity?e.intensity:1}setBlur(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=this.applyTexToProg(this.programs.blurOnePass,t);s.setFloat("size",this.blurSize),s.setFloat("intensity",this.blurIntensity),this.renderToPingPong(s)}},U=class extends N{constructor(t,s){super(t,s,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),(0,o.A)(this,"setNbPass",(t=>{this.blurNbPass=t})),this.scale=void 0!==s.scale?s.scale:1,this.threshold=void 0!==s.threshold?s.threshold:.1}end(){super.end(),this.process()}process(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const s=this.applyTexToProg(this.programs.bloom,t);s.setFloat("scale",this.scale),s.setFloat("threshold",this.threshold),this.renderToPingPong(s),this.setBlur()}};var I=e(75112);const O=class extends N{constructor(t,s){super(t,s,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.near=s.near||1,this.far=s.far||100,this.radius=s.radius||5,this.strength=s.strength||1;const e=this.programs.ssao;e.setFloat("radius",this.radius),e.setFloat("near",this.near),e.setFloat("far",this.far),e.setFloat("strength",this.strength)}generateSsaoSamples(t,s){for(let e=0;e<s;e+=1){let i=e/s;i=x(i*i,.1,1);const r=new I.A((0,E.yT)(-1,1),(0,E.yT)(-1,1),(0,E.yT)(0,1)).normalise().multiplyNumber((0,E.yT)(0,1)).multiplyNumber(i);this.programs[t].setVector(`samples[${e}]`,r.get())}}compute(t){const s=this.applyTexToProg(this.programs.ssao,t);s.setFloat("flipY",-1),this.renderToPingPong(s)}},B=class extends N{constructor(t,s){super(t,s,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),(0,o.A)(this,"getProgram",(()=>this.programs.shadow));const e=this.programs.shadow;e.setFloat("shadowEpsilon",s.epsilon||.01),e.setFloat("lighten",s.lighten||0)}start(t){const s=this.programs.shadow;t.setShadowProgram(s),super.start()}},X=class{constructor(t,s){this.gl=t,this.config=s,this.time=0;const{width:e,height:i}=this.config.canvas;this.containerSize={width:e,height:i}}async setupAssets(t){const{config:s,gl:e}=this,{width:i,height:h}=s.canvas;if(t?.shaders&&(this.mngProg=new c,await this.mngProg.setup(e,t.shaders,s.canvas),s.postprocess)){const t={width:i,height:h,useDepth:this.canUseDepth()},r=this.mngProg.getAll();this.postProcess=new L(e,t,r),s.postprocess.bloom&&(this.bloom=new U(e,{...t,...s.postprocess.bloom},r)),s.postprocess.ssao&&(this.ssao=new O(e,{...t,...s.postprocess.ssao,near:s.camera.near,far:s.camera.far},r)),s.postprocess.shadow&&(this.shadow=new B(e,{...t,...s.postprocess.shadow},r))}t?.textures&&(this.mngTex=new r(e,t.textures,s.textures)),t?.objets&&(this.mngObj=new a(e,t.objets,t.materials)),t?.gltfs&&(this.mngGltf=new F(e,t.gltfs)),t?.sounds&&(this.mngSound=new j(t.sounds)),this.resizeViewport()}canUseDepth(){return this.config.useDepthTexture&&this.config.support.depthTexture||!1}resize(t){this.containerSize=t,this.postProcess&&this.postProcess.resize(t),this.bloom&&this.bloom.resize(t),this.ssao&&this.ssao.resize(t),this.shadow&&this.shadow.resize(t),this.mngProg.updateResolution(this.containerSize.width,this.containerSize.height),this.resizeViewport()}update(t){this.time=t}render(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}resizeViewport(){this.gl.viewport(0,0,this.containerSize.width,this.containerSize.height)}getColorPixel(t,s){const e=new Uint8Array(4);return this.gl.readPixels(t,s,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),e}}},32099:(t,s,e)=>{"use strict";e.d(s,{A:()=>i});const i=class{constructor(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64;this.gl=t,this.size={width:s,height:e},this.texture=t.createTexture(),this.filter=t.NEAREST,this.setup()}setup(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.create(),this.setFilters(),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}create(){const t=new ArrayBuffer(this.size.width*this.size.height),s=new Uint8Array(t);let e=0;for(let t=0;t<this.size.height;t+=1)for(let t=0;t<this.size.width;t+=1)s[e]=255*Math.random(),e+=1;this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.ALPHA,this.size.width,this.size.height,0,this.gl.ALPHA,this.gl.UNSIGNED_BYTE,s)}setFilters(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)}get(){return this.texture}setFiltre(t){this.filter=t}delete(){this.gl.deleteTexture(this.texture)}}},55179:(t,s,e)=>{"use strict";e.d(s,{A:()=>i});const i=class{constructor(t,s){this.gl=t;const e=Math.sqrt(s.length/4);this.size={width:e,height:e},this.texture=t.createTexture(),this.filter=t.NEAREST,this.setup(s)}setup(t){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.size.width,this.size.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.setFilters(),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}setFilters(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)}get(){return this.texture}}},19741:(t,s,e)=>{"use strict";e.r(s),e.d(s,{capitalize:()=>r,chunkArray:()=>i,getEnvPath:()=>h});const i=(t,s)=>Array.from({length:Math.ceil(t.length/s)},((e,i)=>t.slice(i*s,i*s+s))),r=t=>t.charAt(0).toUpperCase()+t.slice(1),h=t=>`/public${t}`},50583:(t,s,e)=>{"use strict";e.d(s,{FN:()=>n,cy:()=>h,jc:()=>a,jh:()=>o,pu:()=>i,yT:()=>r});const i=t=>Math.PI*t/180,r=(t,s)=>Math.random()*(s-t)+t,h=(t,s,e,i,r)=>{let h=i+(t-s)*(r-i)/(e-s||1);return h<Math.min(i,r)&&(h=Math.min(i,r)),h>Math.max(i,r)&&(h=Math.max(i,r)),h},n=t=>0===t?0:t>0?1:-1,a=t=>t-Math.floor(t),o=(t,s,e)=>t*(1-e)+s*e;Math.PI,Math.PI},65525:(t,s,e)=>{"use strict";e.d(s,{A:()=>h});var i=e(54705);const r=class{constructor(t,s){this.gl=t,s&&this.create(s),this.extension=t.getExtension("ANGLE_instanced_arrays")}create(t){const{locationKey:s,type:e,values:i,count:r,componentType:h,size:n,modeCalcul:a,isInstancing:o=!1}=t,l="SCALAR"!==e?this.gl.ARRAY_BUFFER:this.gl.ELEMENT_ARRAY_BUFFER;this.vbo=this.gl.createBuffer(),this.gl.bindBuffer(l,this.vbo),this.gl.bufferData(l,i,a),this.gl.bindBuffer(l,null),this.size=n,this.count=r,this.componentType=h,this.bufferType=l,this.locationKey=s,this.isInstancing=o}enable(t){const{locationKey:s,vbo:e,componentType:i,size:r,bufferType:h,isInstancing:n=!1}=this;if("indices"===s)this.gl.bindBuffer(h,e);else{const a=t.locations[s];void 0!==a&&-1!==a&&(this.gl.bindBuffer(h,e),this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,r,i,!1,0,0),n&&this.extension.vertexAttribDivisorANGLE(a,1))}}start(t){this.gl.useProgram(t)}end(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.useProgram(null)}update(t){this.gl.bindBuffer(this.bufferType,this.vbo),this.gl.bufferSubData(this.bufferType,0,new Float32Array(t)),this.gl.bindBuffer(this.bufferType,null)}render(t,s){"indices"===this.locationKey?this.gl.drawElements(s,this.count,this.componentType,0):this.gl.drawArrays(s,0,this.count)}renderInstancing(t,s,e){"indices"===this.locationKey?this.extension.drawElementsInstancedANGLE(s,this.count,this.gl.UNSIGNED_SHORT,0,e):this.extension.drawArraysInstancedANGLE(s,0,this.count,e)}getCount(){return this.count}},h=class{constructor(t,s){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,i.A)(this,"getActiveVbo",(()=>this.vbos.indices||this.vbos.position||this.vbos.texture||this.vbos.index)),this.gl=t,this.modeDessin=this.gl.TRIANGLES,this.modeCalcul=e?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,this.vbos=Object.keys(s).reduce(((e,i)=>(e[i]=new r(t,{locationKey:i,modeCalcul:this.modeCalcul,...s[i]}),e)),{}),this.instanceCount=-1}addInstancingVbos(t,s){const e=Object.keys(s).reduce(((t,e)=>(t[e]=new r(this.gl,{locationKey:e,modeCalcul:this.modeCalcul,isInstancing:!0,...s[e]}),t)),{});this.vbos={...this.vbos,...e},this.instanceCount=t}enable(t){this.gl.useProgram(t),Object.keys(this.vbos).forEach((s=>{this.vbos[s].enable(t)}))}update(t){Object.keys(t).forEach((s=>{this.vbos[s].update(t[s])}))}render(t){this.enable(t);const s=this.getActiveVbo();-1!==this.instanceCount?s.renderInstancing(t,this.modeDessin,this.instanceCount):s.render(t,this.modeDessin),s.end()}setModeDessin(t){this.modeDessin=t}setModeCalcul(t){this.modeCalcul=t}}},7820:(t,s,e)=>{"use strict";e.d(s,{NU:()=>r,bz:()=>i});const i=(t,s,e)=>{const i=document.querySelector(s);if(!i)return;i.download=`${e}${Date.now()}.svg`;let r=(new XMLSerializer).serializeToString(t);r=`<?xml version="1.0" standalone="no"?>\r\n${r}`;const h=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(r)}`;i.href=h},r=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return new Promise((s=>{setTimeout(s,t)}))}},77741:(t,s,e)=>{var i={"./shaders/camera/albedo":[27240,7240],"./shaders/camera/albedo.js":[27240,7240],"./shaders/camera/albedoPhong":[43456,3456],"./shaders/camera/albedoPhong.js":[43456,3456],"./shaders/camera/background":[12677,2677],"./shaders/camera/background.js":[12677,2677],"./shaders/camera/basicFrag":[72971,2971],"./shaders/camera/basicFrag.js":[72971,2971],"./shaders/camera/basicVertex":[20849,849],"./shaders/camera/basicVertex.js":[20849,849],"./shaders/camera/basique3d":[69368,9368],"./shaders/camera/basique3d.js":[69368,9368],"./shaders/camera/bone":[36203,6203],"./shaders/camera/bone.js":[36203,6203],"./shaders/camera/buffers":[41822,1822],"./shaders/camera/buffers.js":[41822,1822],"./shaders/camera/color":[49134,9134],"./shaders/camera/color.js":[49134,9134],"./shaders/camera/deform":[83332,3332],"./shaders/camera/deform.js":[83332,3332],"./shaders/camera/emissive":[95041,7422],"./shaders/camera/emissive.js":[95041,7422],"./shaders/camera/frequency":[93123,3123],"./shaders/camera/frequency.js":[93123,3123],"./shaders/camera/frequencyCircle":[75135,5135],"./shaders/camera/frequencyCircle.js":[75135,5135],"./shaders/camera/frequencyGrid":[27715,7715],"./shaders/camera/frequencyGrid.js":[27715,7715],"./shaders/camera/gltf":[95664,5664],"./shaders/camera/gltf.js":[95664,5664],"./shaders/camera/morph":[15115,5115],"./shaders/camera/morph.js":[15115,5115],"./shaders/camera/movingCircle":[76323,6323],"./shaders/camera/movingCircle.js":[76323,6323],"./shaders/camera/normale":[84779,4779],"./shaders/camera/normale.js":[84779,4779],"./shaders/camera/normaleMatrix":[29230,9230],"./shaders/camera/normaleMatrix.js":[29230,9230],"./shaders/camera/normalmapping":[59266,9266],"./shaders/camera/normalmapping.js":[59266,9266],"./shaders/camera/paysage":[98259,8259],"./shaders/camera/paysage.js":[98259,8259],"./shaders/camera/phong":[18731,8731],"./shaders/camera/phong.js":[18731,8731],"./shaders/camera/road":[83783,3783],"./shaders/camera/road.js":[83783,3783],"./shaders/camera/roadmountain":[13272,3272],"./shaders/camera/roadmountain.js":[13272,3272],"./shaders/camera/selected":[17096,7096],"./shaders/camera/selected.js":[17096,7096],"./shaders/camera/shadow":[63485,3485],"./shaders/camera/shadow.js":[63485,3485],"./shaders/camera/signature":[34988,2607],"./shaders/camera/signature.js":[34988,2607],"./shaders/camera/skin":[31716,1716],"./shaders/camera/skin.js":[31716,1716],"./shaders/camera/skinMat":[45160,5160],"./shaders/camera/skinMat.js":[45160,5160],"./shaders/camera/sprite":[62112,2112],"./shaders/camera/sprite.js":[62112,2112],"./shaders/camera/spritePhong":[94059,6440],"./shaders/camera/spritePhong.js":[94059,6440],"./shaders/camera/texture":[37166,7166],"./shaders/camera/texture.js":[37166,7166],"./shaders/camera/update":[95064,5064],"./shaders/camera/update.js":[95064,5064],"./shaders/camera/vertexColor":[49340,9340],"./shaders/camera/vertexColor.js":[49340,9340],"./shaders/diorama/instancing":[68505,8505],"./shaders/diorama/instancing.js":[68505,8505],"./shaders/diorama/instancingDepth":[8260,8260],"./shaders/diorama/instancingDepth.js":[8260,8260],"./shaders/diorama/shadow":[35269,5269],"./shaders/diorama/shadow.js":[35269,5269],"./shaders/diorama/terrain":[30648,648],"./shaders/diorama/terrain.js":[30648,648],"./shaders/diorama/terrainClip":[98094,8094],"./shaders/diorama/terrainClip.js":[98094,8094],"./shaders/diorama/terrainDepth":[61987,1987],"./shaders/diorama/terrainDepth.js":[61987,1987],"./shaders/diorama/water":[53886,3886],"./shaders/diorama/water.js":[53886,3886],"./shaders/diorama/waterFragment1":[2347,2347],"./shaders/diorama/waterFragment1.js":[2347,2347],"./shaders/diorama/waterFragment2":[69070,9070],"./shaders/diorama/waterFragment2.js":[69070,9070],"./shaders/particules/pass1":[26118,6118],"./shaders/particules/pass1.js":[26118,6118],"./shaders/particules/pass1Morph":[13886,1505],"./shaders/particules/pass1Morph.js":[13886,1505],"./shaders/particules/pass2":[96291,6291],"./shaders/particules/pass2.js":[96291,6291],"./shaders/particules/pass2Camera":[54736,4736],"./shaders/particules/pass2Camera.js":[54736,4736],"./shaders/screen/basicVertex":[51014,1014],"./shaders/screen/basicVertex.js":[51014,1014],"./shaders/screen/bloom":[34421,4421],"./shaders/screen/bloom.js":[34421,4421],"./shaders/screen/blur":[13985,3985],"./shaders/screen/blur.js":[13985,3985],"./shaders/screen/blurDirection":[65776,5776],"./shaders/screen/blurDirection.js":[65776,5776],"./shaders/screen/blurMultiPass":[93517,3517],"./shaders/screen/blurMultiPass.js":[93517,3517],"./shaders/screen/blurOnePass":[23708,3708],"./shaders/screen/blurOnePass.js":[23708,3708],"./shaders/screen/blurRadial":[74142,4142],"./shaders/screen/blurRadial.js":[74142,4142],"./shaders/screen/brightcontrast":[35058,5058],"./shaders/screen/brightcontrast.js":[35058,5058],"./shaders/screen/compose":[80382,382],"./shaders/screen/compose.js":[80382,382],"./shaders/screen/composeShadow":[76458,6458],"./shaders/screen/composeShadow.js":[76458,6458],"./shaders/screen/debug":[97677,7677],"./shaders/screen/debug.js":[97677,7677],"./shaders/screen/diffuse":[1296,1296],"./shaders/screen/diffuse.js":[1296,1296],"./shaders/screen/dof":[64607,4607],"./shaders/screen/dof.js":[64607,4607],"./shaders/screen/fxaa":[96676,6676],"./shaders/screen/fxaa.js":[96676,6676],"./shaders/screen/fxaa2":[67716,7716],"./shaders/screen/fxaa2.js":[67716,7716],"./shaders/screen/gamma":[74671,4671],"./shaders/screen/gamma.js":[74671,4671],"./shaders/screen/glitch":[26689,6689],"./shaders/screen/glitch.js":[26689,6689],"./shaders/screen/glitch2":[13435,3435],"./shaders/screen/glitch2.js":[13435,3435],"./shaders/screen/glitch3":[65492,5492],"./shaders/screen/glitch3.js":[65492,5492],"./shaders/screen/glitch4":[93089,3089],"./shaders/screen/glitch4.js":[93089,3089],"./shaders/screen/kuwahara":[87598,7598],"./shaders/screen/kuwahara.js":[87598,7598],"./shaders/screen/landscape":[33295,3295],"./shaders/screen/landscape.js":[33295,3295],"./shaders/screen/line":[99778,9778],"./shaders/screen/line.js":[99778,9778],"./shaders/screen/mergeBloom":[84599,4599],"./shaders/screen/mergeBloom.js":[84599,4599],"./shaders/screen/oil":[87530,7530],"./shaders/screen/oil.js":[87530,7530],"./shaders/screen/pixel":[44506,4506],"./shaders/screen/pixel.js":[44506,4506],"./shaders/screen/point":[19560,9560],"./shaders/screen/point.js":[19560,9560],"./shaders/screen/raymarch":[65991,5991],"./shaders/screen/raymarch.js":[65991,5991],"./shaders/screen/rgb":[86917,6917],"./shaders/screen/rgb.js":[86917,6917],"./shaders/screen/screen":[46924,6924],"./shaders/screen/screen.js":[46924,6924],"./shaders/screen/sepia":[51596,1596],"./shaders/screen/sepia.js":[51596,1596],"./shaders/screen/shader":[95073,5073],"./shaders/screen/shader.js":[95073,5073],"./shaders/screen/signature":[99324,9324],"./shaders/screen/signature.js":[99324,9324],"./shaders/screen/sketch":[57112,7112],"./shaders/screen/sketch.js":[57112,7112],"./shaders/screen/sobel":[99979,9979],"./shaders/screen/sobel.js":[99979,9979],"./shaders/screen/specular":[76309,6309],"./shaders/screen/specular.js":[76309,6309],"./shaders/screen/ssao":[4358,4358],"./shaders/screen/ssao-chapman":[24057,4057],"./shaders/screen/ssao-chapman.js":[24057,4057],"./shaders/screen/ssao.js":[4358,4358],"./shaders/screen/tunnelrace":[28295,8295],"./shaders/screen/tunnelrace.js":[28295,8295],"./shaders/screen/tunnelround":[45904,5904],"./shaders/screen/tunnelround.js":[45904,5904],"./shaders/screen/tunnelsquared":[9385,9385],"./shaders/screen/tunnelsquared.js":[9385,9385],"./shaders/screen/vortex":[16112,6112],"./shaders/screen/vortex.js":[16112,6112],"./shaders/screen/water":[92413,2413],"./shaders/screen/water.js":[92413,2413],"./shaders/screen/watercolor":[16302,6302],"./shaders/screen/watercolor.js":[16302,6302],"./shaders/screen/watercolor2":[50630,630],"./shaders/screen/watercolor2.js":[50630,630],"./shaders/screen/watercolor3":[81349,1349],"./shaders/screen/watercolor3.js":[81349,1349],"./shaders/screen/watercolorMoving":[20964,964],"./shaders/screen/watercolorMoving.js":[20964,964],"./shaders/screen/wave":[94517,4517],"./shaders/screen/wave.js":[94517,4517],"./shaders/sky/getClouds":[31097,1097],"./shaders/sky/getClouds.js":[31097,1097],"./shaders/sky/getSunSky":[66908,6908],"./shaders/sky/getSunSky.js":[66908,6908],"./shaders/sky/roadSky":[40040,40],"./shaders/sky/roadSky.js":[40040,40],"./shaders/sky/skyWithFloor":[44734,4734],"./shaders/sky/skyWithFloor.js":[44734,4734],"./shaders/sky/sunset":[47781,7781],"./shaders/sky/sunset.js":[47781,7781],"./shaders/sky/tunnel":[91022,8641],"./shaders/sky/tunnel.js":[91022,8641],"./shaders/utils":[75059,5059],"./shaders/utils/":[75059,5059],"./shaders/utils/blur":[10450,450],"./shaders/utils/blur.js":[10450,450],"./shaders/utils/fog":[54735,4735],"./shaders/utils/fog.js":[54735,4735],"./shaders/utils/index":[75059,5059],"./shaders/utils/index.js":[75059,5059],"./shaders/utils/instancing":[33291,3291],"./shaders/utils/instancing.js":[33291,3291],"./shaders/utils/light":[84251,4251],"./shaders/utils/light.js":[84251,4251],"./shaders/utils/noise":[86629,6629],"./shaders/utils/noise.js":[86629,6629],"./shaders/utils/pbr":[38107,8107],"./shaders/utils/pbr.js":[38107,8107],"./shaders/utils/random":[3380,3380],"./shaders/utils/random.js":[3380,3380],"./shaders/utils/roadDistortion":[75962,5962],"./shaders/utils/roadDistortion.js":[75962,5962],"./shaders/utils/shadow":[94227,4227],"./shaders/utils/shadow.js":[94227,4227],"./shaders/utils/shapes":[73725,3725],"./shaders/utils/shapes.js":[73725,3725],"./shaders/utils/terrain":[44010,4010],"./shaders/utils/terrain.js":[44010,4010],"./shaders/utils/toon":[54587,4587],"./shaders/utils/toon.js":[54587,4587]};function r(t){if(!e.o(i,t))return Promise.resolve().then((()=>{var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}));var s=i[t],r=s[0];return e.e(s[1]).then((()=>e(r)))}r.keys=()=>Object.keys(i),r.id=77741,t.exports=r},54705:(t,s,e)=>{"use strict";function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(t){var s=function(t,s){if("object"!=i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,s||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(t)}(t,"string");return"symbol"==i(s)?s:s+""}function h(t,s,e){return(s=r(s))in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}e.d(s,{A:()=>h})}}]);