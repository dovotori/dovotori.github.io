"use strict";(self.webpackChunkdovotori_portfolio=self.webpackChunkdovotori_portfolio||[]).push([[1387],{11387:(t,e,r)=>{r.r(e),r.d(e,{default:()=>B,destroy:()=>O});var n=r(15861),a=r(87757),s=r.n(a),i=r(35466),o=r(42982),h=r(15671),l=r(43144),u=r(97326),g=r(11752),c=r(60136),f=r(6215),d=r(61120),v=r(4942),p=r(25192),m=r(80602),y=r(21969),b=r(25773),w=r(85693),P=r(68763),Z=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[],n=-1,a=0;a<e;a++){n++;for(var s=0;s<t;s++)r.push(s,0,n);var i=0;n++;for(var o=0;o<t;o++)r.push(i,0,n),0===o&&(i+=.5,r.push(i,0,n)),o===t-2?i+=.5:i++}n++;for(var h=0;h<t;h++)r.push(h,0,n);return r},T=function(t,e){return t*(e+1)+(t+1)*e},E=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[],n=t+t+1,a=0;a<e;a++){for(var s=n*a,i=t-1;i>=0;i--){var o=i+t+s;i===t-1&&r.push(o+1),r.push(i+s),0!==i&&r.push(o)}for(var h=t+1,l=t;l<t+h;l++)if(r.push(l+s),l!==t+h-1){var u=l+h+s;r.push(u)}a!==e-1&&r.push(t+t+s)}return r},x=function(t,e,r){var n=r.thicknessY,a=void 0===n?-1:n,s=[],i=[t-1,2*e-1];s.push(i[0],a,i[1]);for(var o=2*e,h=t-1;h>0;h--)s.push(h,a,o);for(var l=2*e;l>0;l--)s.push(0,a,l);for(var u=0;u<t-1;u++)s.push(u,a,0);for(var g=0;g<2*e-1;g++)s.push(t-1,a,g);return s},M=function(t,e){var r=[],n=T(t,e)-1,a=n-t;r.push(a);var s=n+1;r.push(s);for(var i=s+1,o=n;o>n-t;o--)r.push(o),r.push(i),i++;for(var h=2*e-1;h>0;h--){var l=t*h+Math.floor(h/2);r.push(l),r.push(i),i++}for(var u=0;u<t;u++)r.push(u),r.push(i),i++;for(var g=1;g<2*e-1;g++){var c=t-1+(t*g+Math.ceil(g/2));r.push(c),r.push(i),i++}return r.push(a),r.push(s),r},A=function(t,e,r){for(var n=[],a=0;a<t.length;a+=3){var s=(0,P.Yp)(t[a],0,e-1,-1,1),i=t[a+1],o=(0,P.Yp)(t[a+2],0,2*r-1,-1,1);n.push(s,i,o)}return n};var R=r(93324),k=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=[];if(null===r)for(var a=0;a<e;a++)for(var s=0;s<t;s++)n.push([s+Math.random(),a+Math.random()]);else for(var i=0;i<r;i++)for(var o=0;o<e;o++)for(var h=0;h<t;h++)n.push([h+Math.random(),o+Math.random(),i+Math.random()]);return n},F=function(t,e){return Math.max(0,e.reduce((function(e,r){var n,a,s=(n=t,a=r,Math.sqrt((a[0]-n[0])*(a[0]-n[0])+(a[1]-n[1])*(a[1]-n[1])));return Math.min(e,s)}),1))},D=function(t,e,r){var n=function(t,e){var r=[];if(3===e.length)for(var n=-1;n<=1;n++)for(var a=-1;a<=1;a++)for(var s=-1;s<=1;s++)r.push([t[0]+s,t[1]+a,t[2]+n]);else for(var i=-1;i<=1;i++)for(var o=-1;o<=1;o++)r.push([t[0]+o,t[1]+i]);return r}(t,e);return n.map((function(t){return function(t,e,r){var n=(0,R.Z)(t,3),a=n[0],s=n[1],i=n[2],h=void 0===i?null:i,l=r[0],u=r[1],g=r[2],c=a,f=!1;-1===a?(c=l-1,f=!0):a===l&&(c=0,f=!0);var d=s,v=!1;-1===s?(d=u-1,v=!0):s===u&&(d=0,v=!0);var p=h,m=!1;-1===h?(p=g-1,m=!0):h===g&&(p=0,m=!0);var y=d*u+c;null!==h&&(y+=p*g);var b=(0,o.Z)(e[y]);return f&&(-1===a?b[0]-=l:b[0]+=l),v&&(-1===s?b[1]-=u:b[1]+=u),m&&(-1===h?b[2]-=g:b[2]+=g),b}(t,r,e)}))},X=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;(0,h.Z)(this,t),this.gl=e,this.size={width:r,height:n,depth:a},this.texture=e.createTexture(),this.filter=e.NEAREST,this.setup()}return(0,l.Z)(t,[{key:"setup",value:function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.create(),this.setFilters(),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}},{key:"create",value:function(){for(var t=this.size,e=t.width,r=t.height,n=(t.depth,new ArrayBuffer(32*e*r*32*4)),a=new Uint8Array(n),s=function(t,e,r){for(var n=k(t,e),a=[t,e],s=[],i=[0,0],o=D(i,a,n),h=0;h<e*r;h++)for(var l=0;l<t*r;l++){var u=[l/r,h/r],g=u.map((function(t){return Math.floor(t)}));i[0]===g[0]&&i[1]===g[1]||(o=D(i=g,a,n));var c=F(u,o);s.push(c)}return s}(e,r,32),i=0,o=0;o<s.length;o++){var h=255-255*s[o];a[i]=h,a[i+1]=h,a[i+2]=h,a[i+3]=255,i+=4}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,32*r,32*e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a)}},{key:"setFilters",value:function(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)}},{key:"get",value:function(){return this.texture}}]),t}(),I=r(77505),L=r(2444);function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,d.Z)(t);if(e){var a=(0,d.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,f.Z)(this,r)}}var U=function(t,e){var r=new b.Z(t,e,t).multiplyNumber(.13).fract(),n=new b.Z(r.getY(),r.getZ(),r.getX()).addNumber(3.333);return r.addNumber(r.dot(n)),(0,P.ZI)((r.getX()+r.getY())*r.getZ())},j=function(t,e){var r=Math.floor(t),n=Math.floor(e),a=(0,P.ZI)(t),s=(0,P.ZI)(e),i=U(r,n),o=U(r+1,n),h=U(r,n+1),l=U(r+1,n+1),u=a*a*(3-2*a),g=s*s*(3-2*s);return(0,P.CD)(i,o,u)+(h-i)*g*(1-u)+(l-o)*u*g},V=function(t,e){for(var r=e.lacunarity,n=e.persistance,a=0,s=0,i=0;i<10;i+=1){var o=Math.pow(r,i),h=Math.pow(n,i);a+=j(t[0]*o,t[1]*o)*h,s+=h}return a/s},G=function(t){(0,c.Z)(r,t);var e=_(r);function r(t,n,a){var s;(0,h.Z)(this,r),s=e.call(this,t,n,a),(0,v.Z)((0,u.Z)(s),"renderBasiqueForLampeDepth",(function(){var t=s.getLampe(0);["instancingDepth","basique3d"].forEach((function(e){var r=s.mngProg.get(e);t.setDepthProgram(r)})),t.start(),s.mngGltf.get("three").render(s.mngProg.get("instancingDepth"),s.model),s.renderEntenna(s.mngProg.get("basique3d")),t.end()})),(0,v.Z)((0,u.Z)(s),"onMouseDrag",(function(t){s.targetZ.set(.001*-t.relPrevious.x),s.targetX.set(.001*t.relPrevious.y)})),(0,v.Z)((0,u.Z)(s),"onMouseClick",(function(t){s.targetZ.set(.1*-t.rel.x),s.targetX.set(.1*-t.rel.y)})),s.fbo=new L.Z(s.gl,n.width,n.height,!0),s.fbo2=new L.Z(s.gl,n.width,n.height,!0),s.fbo3=new L.Z(s.gl,n.width,n.height,!0);var i=n.terrain,o=i.width,l=i.height,g=i.colors,c=i.waterLevel;s.targetX=new w.Z(0),s.targetZ=new w.Z(0),s.model=new y.Z,s.vbo=new m.Z(t,function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Z(t,e,r),a=E(t,e);if(r.withThick){var s=n.concat(x(t,e,r));return{position:A(s,t,e),indices:a.concat(M(t,e))}}return{position:n,indices:a}}(o,l,{withThick:!0,thicknessY:-.1})),s.vbo.setModeDessin(s.gl.TRIANGLE_STRIP),s.cloudsTex=new X(t,4,4);var f=s.mngProg.get("terrain"),d=s.mngProg.get("instancing"),p=s.mngProg.get("water"),b=s.mngProg.get("shadow"),P=s.mngProg.get("terrainDepth"),T=s.mngProg.get("instancingDepth");[f,d,b,p,P,T].forEach((function(t){r.setFog(t,n.fog),r.setTerrain(t,n.terrain),t.setVector("gridSize",[o,l]),t.setFloat("waterLevel",c),s.setLampeInfos(t)})),g.forEach((function(t,e){var r=(0,I.oo)(t),n=r.r,a=r.g,s=r.b;f.setVector("colors[".concat(e,"]"),[n,a,s].map((function(t){return t/255})))}));for(var R=400,k=[],F=[],D=[],_=0;_<R;_++)k.push(2*Math.random()-1,0,2*Math.random()-1),F.push(.4,.6,Math.random()),D.push(.05+.06*Math.random());var U={componentType:t.FLOAT,count:R,size:3,type:"VEC3",values:new Float32Array(k)},j={componentType:t.FLOAT,count:R,size:3,type:"VEC3",values:new Float32Array(F)},G={componentType:t.FLOAT,count:R,size:1,type:"FLOAT",values:new Float32Array(D)};s.mngGltf.get("three").addInstancingVbos(R,{offset:U,acolor:j,size:G});var z=[-.6,.8];return s.posAntenna=[z[0],V(z,n.terrain),z[1]],s.isAntennaVisible=!1,s.currentPosAntenna=s.posAntenna,s}return(0,l.Z)(r,[{key:"update",value:function(t){var e=this;(0,g.Z)((0,d.Z)(r.prototype),"update",this).call(this,t),this.model.identity();var n=this.model.getMatrice3x3();n.inverse(),n.transpose(),this.targetX.update(),this.targetZ.update();var a=1e-5*this.time,s=[this.targetX.get(),this.targetZ.get()],i=this.mngProg.get("terrain"),o=this.mngProg.get("instancing"),h=this.mngProg.get("water");[i,o,this.mngProg.get("shadow"),h,this.mngProg.get("terrainDepth"),this.mngProg.get("instancingDepth")].forEach((function(t){t.setMatrix("model",e.model.get()),t.setMatrix("normalMatrix",n.get()),t.setVector("moving",s)})),h.setFloat("time",a),this.mngGltf.get("antenna").update(.1*t),this.currentPosAntenna=[this.posAntenna[0]-this.targetX.get(),this.posAntenna[1],this.posAntenna[2]-this.targetZ.get()],this.isAntennaVisible=Math.abs(this.currentPosAntenna[0])>0&&Math.abs(this.currentPosAntenna[0])<1&&Math.abs(this.currentPosAntenna[2])>0&&Math.abs(this.currentPosAntenna[2])<1}},{key:"waterPasses",value:function(){var t=this.mngProg.get("terrain"),e=this.mngProg.get("instancing");t.setFloat("reflectPass",1),t.setFloat("refractPass",0),t.setMatrix("view",this.camera.getReflectViewMatrix(this.config.terrain.waterLevel).get()),e.setMatrix("view",this.camera.getReflectViewMatrix(this.config.terrain.waterLevel).get()),this.fbo.start(),this.vbo.render(t.get()),this.mngGltf.get("three").render(e,this.model),this.fbo.end(),t.setFloat("reflectPass",0),t.setFloat("refractPass",1),t.setMatrix("view",this.camera.getView().get()),this.fbo2.start(),this.vbo.render(t.get()),this.fbo2.end(),t.setFloat("refractPass",0)}},{key:"shadowPass",value:function(){var t=this.getLampe(0);this.shadow.start(t),this.vbo.render(this.shadow.getProgram().get()),this.mngGltf.get("three").render(this.mngProg.get("instancingDepth"),this.model),this.renderEntenna(this.mngProg.get("basique3d")),this.shadow.end(),this.shadow.setBrightContrast(0,3)}},{key:"renderEntenna",value:function(t){var e;this.isAntennaVisible&&(this.model.push(),this.model.scale(.07),(e=this.model).translate.apply(e,(0,o.Z)(this.currentPosAntenna)),this.mngGltf.get("antenna").render(t,this.model),this.model.pop())}},{key:"render",value:function(){(0,g.Z)((0,d.Z)(r.prototype),"render",this).call(this),this.vbo.render(this.mngProg.get("terrain").get()),this.mngGltf.get("three").render(this.mngProg.get("instancing"),this.model),this.renderEntenna(this.mngProg.get("gltf"))}},{key:"setKeyboardInteraction",value:function(t){var e=this.config.keyboard,r=e.LEFT,n=e.RIGHT,a=e.UP,s=e.DOWN;t.isPressed(r)&&this.targetX.set(-.01),t.isPressed(n)&&this.targetX.set(.01),t.isPressed(a)&&this.targetZ.set(-.01),t.isPressed(s)&&this.targetZ.set(.01)}}],[{key:"setFog",value:function(t,e){var r=e.start,n=e.end,a=e.color;t.setFloat("fogStart",r),t.setFloat("fogEnd",n),t.setVector("fogColor",a)}},{key:"setTerrain",value:function(t,e){var r=e.lacunarity,n=e.persistance;t.setFloat("lacunarity",r),t.setFloat("persistance",n)}}]),r}(p.Z);const z=G;var C=r(88601);const N={slug:"diorama",shaders:["/diorama/terrain.js","/diorama/water.js","/diorama/instancing.js","/diorama/instancingDepth.js","/diorama/shadow.js","/diorama/terrainDepth.js","/screen/screen.js","/screen/blurOnePass.js","/screen/brightcontrast.js","/screen/composeShadow.js","/camera/gltf.js","/camera/basique3d.js"],assets:["/gltf/three.gltf","/gltf/antenna.gltf","/textures/waterN.jpg","/textures/dudv.png"],canvas:{width:1024,height:1024},postprocess:{shadow:{epsilon:.01,lighten:.1,blur:{size:.1,intensity:1}}},useDepthTexture:!0,camera:{position:{x:2,y:2,z:2},target:{x:0,y:0,z:0},near:1,far:200,angle:60},lampes:[{type:0,position:{x:2,y:4,z:2},ambiant:[1,1,1],diffuse:[1,1,1],specular:[1,1,1],brillance:1,strength:1.2,near:1,far:10,ortho:{left:-1.5,right:1.5,bottom:-1.5,top:1.5}}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},terrain:{width:200,height:100,lacunarity:1.6,persistance:.5,waterLevel:.4,colors:["#251a16","#6e6254","#8b6a47","#5d564c","#989b56","#6d753a","#89934c","#8b8f54","#ffffff"]},fog:{color:[0,0,0,0],start:2,end:10},mouse:{events:["drag","click"]},keyboard:{UP:C.UP,DOWN:C.WV,LEFT:C.RL,RIGHT:C.pX}};r(88747),r(89153);var S=null;const B=(0,n.Z)(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return S=new i.Z,t.next=3,S.setup(z,N);case 3:document.querySelector("#".concat(N.slug)).appendChild(S.getCanvas());case 5:case"end":return t.stop()}}),t)})));var O=function(){S&&S.destroy&&S.destroy()}},88601:(t,e,r)=>{r.d(e,{JU:()=>h,K5:()=>g,L_:()=>o,RL:()=>s,UP:()=>n,W:()=>u,WV:()=>a,X:()=>l,pX:()=>i,sC:()=>c});var n=38,a=40,s=37,i=39,o=32,h=16,l=88,u=87,g=13,c=27},85693:(t,e,r)=>{r.d(e,{Z:()=>s});var n=r(15671),a=r(43144),s=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,n.Z)(this,t),this.value=e,this.speed=0,this.sampling=r.sampling||.7}return(0,a.Z)(t,[{key:"update",value:function(){this.value+=this.speed,this.speed*=this.sampling}},{key:"get",value:function(){return this.value}},{key:"set",value:function(t){this.speed+=t}}]),t}()},77505:(t,e,r)=>{r.d(e,{oo:()=>s,ve:()=>a});var n=function(t,e,r){var n=r;return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},a=function(t,e,r){var a,s,i,o=t/360,h=e/100,l=r/100;if(0===h)a=l,s=l,i=l;else{var u=l<.5?l*(1+h):l+h-l*h,g=2*l-u;a=n(g,u,o+1/3),s=n(g,u,o),i=n(g,u,o-1/3)}return{r:Math.round(255*a),g:Math.round(255*s),b:Math.round(255*i)}},s=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}},24981:(t,e,r)=>{r.d(e,{Z:()=>o});var n=r(8081),a=r.n(n),s=r(23645),i=r.n(s)()(a());i.push([t.id,"#controls {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  display: flex;\r\n  align-items: stretch;\r\n  z-index: 10;\r\n  background-color: rgba(34, 34, 34, .8);\r\n  margin: .5em;\r\n  padding: .5em;\r\n}\r\n\r\n#controls div {\r\n  display: flex;\r\n  align-items: stretch;\r\n}\r\n\r\n#controls div input[type=range] {\r\n  width: 100%;\r\n}\r\n\r\n#controls div input[type=checkbox] {\r\n  margin-right: 0.5em;\r\n}\r\n\r\n#controls label {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n#controls label,\r\n#controls a {\r\n  font-size: .8em;\r\n}\r\n\r\n@media (max-width: 570px) {\r\n  #controls.responsive {\r\n    position: relative;\r\n    width: 100%;\r\n    margin: 0;\r\n  }\r\n}",""]);const o=i},76889:(t,e,r)=>{r.d(e,{Z:()=>o});var n=r(8081),a=r.n(n),s=r(23645),i=r.n(s)()(a());i.push([t.id,"#fullscreen-toggle-btn {\r\n  border-radius: 0;\r\n  margin: 0;\r\n  padding: 4px;\r\n  border: solid 2px var(--project-color);\r\n}\r\n\r\n#fullscreen-toggle-btn:hover svg,\r\n#fullscreen-toggle-btn:active svg {\r\n  transform: scale(0.8);\r\n  opacity: 1;\r\n}\r\n\r\n#fullscreen-toggle-btn svg {\r\n  display: block;\r\n  width: 2em;\r\n  fill: #fff;\r\n  opacity: 0.8;\r\n  transform: scale(0.6);\r\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\r\n}\r\n\r\n[data-fullscreen] {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n",""]);const o=i},88747:(t,e,r)=>{var n=r(93379),a=r.n(n),s=r(7795),i=r.n(s),o=r(90569),h=r.n(o),l=r(3565),u=r.n(l),g=r(70609),c=r.n(g),f=r(44589),d=r.n(f),v=r(24981),p={};p.styleTagTransform=d(),p.setAttributes=u(),p.insert=h().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=c();a()(v.Z,p),v.Z&&v.Z.locals&&v.Z.locals},89153:(t,e,r)=>{var n=r(93379),a=r.n(n),s=r(7795),i=r.n(s),o=r(90569),h=r.n(o),l=r(3565),u=r.n(l),g=r(70609),c=r.n(g),f=r(44589),d=r.n(f),v=r(76889),p={};p.styleTagTransform=d(),p.setAttributes=u(),p.insert=h().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=c();a()(v.Z,p),v.Z&&v.Z.locals&&v.Z.locals}}]);