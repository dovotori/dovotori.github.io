"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[1387],{11387:(t,e,s)=>{s.r(e),s.d(e,{default:()=>R,destroy:()=>D});var i=s(35466),n=s(59713),r=s.n(n),o=s(25192),a=s(80602),h=s(21969),l=s(25773),d=s(85693),g=s(68763);const c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const s=[];let i=-1;for(let n=0;n<e;n++){i++;for(let e=0;e<t;e++)s.push(e,0,i);let e=0;i++;for(let n=0;n<t;n++)s.push(e,0,i),0===n&&(e+=.5,s.push(e,0,i)),n===t-2?e+=.5:e++}i++;for(let e=0;e<t;e++)s.push(e,0,i);return s},u=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const s=[],i=t+t+1;for(let n=0;n<e;n++){const r=i*n;for(let e=t-1;e>=0;e--){const i=e+t+r;e===t-1&&s.push(i+1),s.push(e+r),0!==e&&s.push(i)}const o=t+1;for(let e=t;e<t+o;e++)if(s.push(e+r),e!==t+o-1){const t=e+o+r;s.push(t)}n!==e-1&&s.push(t+t+r)}return s},p=(t,e,s)=>{let{thicknessY:i=-1}=s;const n=[],r=[t-1,2*e-1];n.push(r[0],i,r[1]);const o=2*e;for(let e=t-1;e>0;e--)n.push(e,i,o);for(let t=2*e;t>0;t--)n.push(0,i,t);for(let e=0;e<t-1;e++)n.push(e,i,0);for(let s=0;s<2*e-1;s++)n.push(t-1,i,s);return n},m=(t,e)=>{const s=[],i=((t,e)=>t*(e+1)+(t+1)*e)(t,e)-1,n=i-t;s.push(n);const r=i+1;s.push(r);let o=r+1;for(let e=i;e>i-t;e--)s.push(e),s.push(o),o++;for(let i=2*e-1;i>0;i--){const e=t*i+Math.floor(i/2);s.push(e),s.push(o),o++}for(let e=0;e<t;e++)s.push(e),s.push(o),o++;for(let i=1;i<2*e-1;i++){const e=t-1+(t*i+Math.ceil(i/2));s.push(e),s.push(o),o++}return s.push(n),s.push(r),s},f=(t,e,s)=>{const i=[];for(let n=0;n<t.length;n+=3){const r=(0,g.Yp)(t[n],0,e-1,-1,1),o=t[n+1],a=(0,g.Yp)(t[n+2],0,2*s-1,-1,1);i.push(r,o,a)}return i},v=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=[];if(null===s)for(let s=0;s<e;s++)for(let e=0;e<t;e++)i.push([e+Math.random(),s+Math.random()]);else for(let n=0;n<s;n++)for(let s=0;s<e;s++)for(let e=0;e<t;e++)i.push([e+Math.random(),s+Math.random(),n+Math.random()]);return i},w=(t,e)=>Math.max(0,e.reduce(((e,s)=>{const i=(n=t,r=s,Math.sqrt((r[0]-n[0])*(r[0]-n[0])+(r[1]-n[1])*(r[1]-n[1])));var n,r;return Math.min(e,i)}),1)),y=(t,e,s)=>{const i=((t,e)=>{const s=[];if(3===e.length)for(let e=-1;e<=1;e++)for(let i=-1;i<=1;i++)for(let n=-1;n<=1;n++)s.push([t[0]+n,t[1]+i,t[2]+e]);else for(let e=-1;e<=1;e++)for(let i=-1;i<=1;i++)s.push([t[0]+i,t[1]+e]);return s})(t,e);return i.map((t=>((t,e,s)=>{const[i,n,r=null]=t,o=s[0],a=s[1],h=s[2];let l=i,d=!1;-1===i?(l=o-1,d=!0):i===o&&(l=0,d=!0);let g=n,c=!1;-1===n?(g=a-1,c=!0):n===a&&(g=0,c=!0);let u=r,p=!1;-1===r?(u=h-1,p=!0):r===h&&(u=0,p=!0);let m=g*a+l;null!==r&&(m+=u*h);const f=[...e[m]];return d&&(-1===i?f[0]-=o:f[0]+=o),c&&(-1===n?f[1]-=a:f[1]+=a),p&&(-1===r?f[2]-=h:f[2]+=h),f})(t,s,e)))};var b=s(77505),x=s(2444);const P=(t,e)=>{const s=new l.Z(t,e,t).multiplyNumber(.13).fract(),i=new l.Z(s.getY(),s.getZ(),s.getX()).addNumber(3.333);return s.addNumber(s.dot(i)),(0,g.ZI)((s.getX()+s.getY())*s.getZ())},Z=(t,e)=>{const s=Math.floor(t),i=Math.floor(e),n=(0,g.ZI)(t),r=(0,g.ZI)(e),o=P(s,i),a=P(s+1,i),h=P(s,i+1),l=P(s+1,i+1),d=n*n*(3-2*n),c=r*r*(3-2*r);return(0,g.CD)(o,a,d)+(h-o)*c*(1-d)+(l-a)*d*c},T=(t,e)=>{const{lacunarity:s,persistance:i}=e;let n=0,r=0;for(let e=0;e<10;e+=1){const o=s**e,a=i**e;n+=Z(t[0]*o,t[1]*o)*a,r+=a}return n/r};class M extends o.Z{constructor(){super(...arguments),r()(this,"renderBasiqueForLampeDepth",(()=>{const t=this.getLampe(0);["instancingDepth","basique3d"].forEach((e=>{const s=this.mngProg.get(e);t.setDepthProgram(s)})),t.start(),this.mngGltf.get("three").render(this.mngProg.get("instancingDepth"),this.model),this.renderEntenna(this.mngProg.get("basique3d")),t.end()})),r()(this,"onMouseDrag",(t=>{this.targetZ.set(.001*-t.relPrevious.x),this.targetX.set(.001*t.relPrevious.y)})),r()(this,"onMouseClick",(t=>{this.targetZ.set(.1*-t.rel.x),this.targetX.set(.1*-t.rel.y)}))}static setFog(t,e){const{start:s,end:i,color:n}=e;t.setFloat("fogStart",s),t.setFloat("fogEnd",i),t.setVector("fogColor",n)}static setTerrain(t,e){const{lacunarity:s,persistance:i}=e;t.setFloat("lacunarity",s),t.setFloat("persistance",i)}setup(){const{config:t,gl:e}=this;this.fbo=new x.Z(e,t.width,t.height,!0),this.fbo2=new x.Z(e,t.width,t.height,!0),this.fbo3=new x.Z(e,t.width,t.height,!0);const{width:s,height:i,colors:n,waterLevel:r}=t.terrain;this.targetX=new d.Z(0),this.targetZ=new d.Z(0),this.model=new h.Z,this.vbo=new a.Z(e,function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=c(t,e,s),n=u(t,e);if(s.withThick){const r=i.concat(p(t,e,s));return{position:f(r,t,e),indices:n.concat(m(t,e))}}return{position:i,indices:n}}(s,i,{withThick:!0,thicknessY:-.1})),this.vbo.setModeDessin(e.TRIANGLE_STRIP),this.cloudsTex=new class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;this.gl=t,this.size={width:e,height:s,depth:i},this.texture=t.createTexture(),this.filter=t.NEAREST,this.setup()}setup(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.create(),this.setFilters(),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}create(){const{width:t,height:e}=this.size,s=new ArrayBuffer(32*t*e*32*4),i=new Uint8Array(s),n=((t,e,s)=>{const i=v(t,e),n=[t,e],r=[];let o=[0,0],a=y(o,n,i);for(let h=0;h<e*s;h++)for(let e=0;e<t*s;e++){const t=[e/s,h/s],l=t.map((t=>Math.floor(t)));o[0]===l[0]&&o[1]===l[1]||(o=l,a=y(o,n,i));const d=w(t,a);r.push(d)}return r})(t,e,32);let r=0;for(let t=0;t<n.length;t++){const e=255-255*n[t];i[r]=e,i[r+1]=e,i[r+2]=e,i[r+3]=255,r+=4}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,32*e,32*t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i)}setFilters(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)}get(){return this.texture}}(e,4,4);const o=this.mngProg.get("terrain"),l=this.mngProg.get("instancing"),g=this.mngProg.get("water"),P=this.mngProg.get("shadow"),Z=this.mngProg.get("terrainDepth"),E=this.mngProg.get("instancingDepth");[o,l,P,g,Z,E].forEach((e=>{M.setFog(e,t.fog),M.setTerrain(e,t.terrain),e.setVector("gridSize",[s,i]),e.setFloat("waterLevel",r),this.setLampeInfos(e)})),n.forEach(((t,e)=>{const{r:s,g:i,b:n}=(0,b.oo)(t);o.setVector(`colors[${e}]`,[s,i,n].map((t=>t/255)))}));const A=400,X=[],z=[],R=[];for(let t=0;t<A;t++)X.push(2*Math.random()-1,0,2*Math.random()-1),z.push(.4,.6,Math.random()),R.push(.05+.06*Math.random());const D={componentType:e.FLOAT,count:A,size:3,type:"VEC3",values:new Float32Array(X)},F={componentType:e.FLOAT,count:A,size:3,type:"VEC3",values:new Float32Array(z)},I={componentType:e.FLOAT,count:A,size:1,type:"FLOAT",values:new Float32Array(R)};this.mngGltf.get("three").addInstancingVbos(A,{offset:D,acolor:F,size:I});const L=[-.6,.8];this.posAntenna=[L[0],T(L,t.terrain),L[1]],this.isAntennaVisible=!1,this.currentPosAntenna=this.posAntenna}update(t){super.update(t),this.model.identity();const e=this.model.getMatrice3x3();e.inverse(),e.transpose(),this.targetX.update(),this.targetZ.update();const s=1e-5*this.time,i=[this.targetX.get(),this.targetZ.get()],n=this.mngProg.get("terrain"),r=this.mngProg.get("instancing"),o=this.mngProg.get("water");[n,r,this.mngProg.get("shadow"),o,this.mngProg.get("terrainDepth"),this.mngProg.get("instancingDepth")].forEach((t=>{t.setMatrix("model",this.model.get()),t.setMatrix("normalMatrix",e.get()),t.setVector("moving",i)})),o.setFloat("time",s),this.mngGltf.get("antenna").update(.1*t),this.currentPosAntenna=[this.posAntenna[0]-this.targetX.get(),this.posAntenna[1],this.posAntenna[2]-this.targetZ.get()],this.isAntennaVisible=Math.abs(this.currentPosAntenna[0])>0&&Math.abs(this.currentPosAntenna[0])<1&&Math.abs(this.currentPosAntenna[2])>0&&Math.abs(this.currentPosAntenna[2])<1}waterPasses(){const t=this.mngProg.get("terrain"),e=this.mngProg.get("instancing");t.setFloat("reflectPass",1),t.setFloat("refractPass",0),t.setMatrix("view",this.camera.getReflectViewMatrix(this.config.terrain.waterLevel).get()),e.setMatrix("view",this.camera.getReflectViewMatrix(this.config.terrain.waterLevel).get()),this.fbo.start(),this.vbo.render(t.get()),this.mngGltf.get("three").render(e,this.model),this.fbo.end(),t.setFloat("reflectPass",0),t.setFloat("refractPass",1),t.setMatrix("view",this.camera.getView().get()),this.fbo2.start(),this.vbo.render(t.get()),this.fbo2.end(),t.setFloat("refractPass",0)}shadowPass(){const t=this.getLampe(0);this.shadow.start(t),this.vbo.render(this.shadow.getProgram().get()),this.mngGltf.get("three").render(this.mngProg.get("instancingDepth"),this.model),this.renderEntenna(this.mngProg.get("basique3d")),this.shadow.end(),this.shadow.setBrightContrast(0,3)}renderEntenna(t){this.isAntennaVisible&&(this.model.push(),this.model.scale(.07),this.model.translate(...this.currentPosAntenna),this.mngGltf.get("antenna").render(t,this.model),this.model.pop())}render(){super.render(),this.vbo.render(this.mngProg.get("terrain").get()),this.mngGltf.get("three").render(this.mngProg.get("instancing"),this.model),this.renderEntenna(this.mngProg.get("gltf"))}setKeyboardInteraction(t){const{LEFT:e,RIGHT:s,UP:i,DOWN:n}=this.config.keyboard;t.isPressed(e)&&this.targetX.set(-.01),t.isPressed(s)&&this.targetX.set(.01),t.isPressed(i)&&this.targetZ.set(-.01),t.isPressed(n)&&this.targetZ.set(.01)}}const E=M;var A=s(88601);const X={slug:"diorama",shaders:["/diorama/terrain.js","/diorama/water.js","/diorama/instancing.js","/diorama/instancingDepth.js","/diorama/shadow.js","/diorama/terrainDepth.js","/screen/screen.js","/screen/blurOnePass.js","/screen/brightcontrast.js","/screen/composeShadow.js","/camera/gltf.js","/camera/basique3d.js"],assets:["/gltf/three.gltf","/gltf/antenna.gltf","/textures/waterN.jpg","/textures/dudv.png"],canvas:{width:1024,height:1024},postprocess:{shadow:{epsilon:.01,lighten:.1,blur:{size:.1,intensity:1}}},useDepthTexture:!0,useDrawBuffer:!0,camera:{position:{x:2,y:2,z:2},target:{x:0,y:0,z:0},near:1,far:200,angle:60},lampes:[{type:0,position:{x:2,y:4,z:2},ambiant:[1,1,1],diffuse:[1,1,1],specular:[1,1,1],brillance:1,strength:1.2,near:1,far:10,ortho:{left:-1.5,right:1.5,bottom:-1.5,top:1.5}}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},terrain:{width:200,height:100,lacunarity:1.6,persistance:.5,waterLevel:.4,colors:["#251a16","#6e6254","#8b6a47","#5d564c","#989b56","#6d753a","#89934c","#8b8f54","#ffffff"]},fog:{color:[0,0,0,0],start:2,end:10},mouse:{events:["drag","click"]},keyboard:{UP:A.UP,DOWN:A.WV,LEFT:A.RL,RIGHT:A.pX}};s(88747),s(89153);let z=null;const R=async()=>{z=new i.Z,await z.setup(E,X)},D=()=>{z&&z.destroy&&z.destroy()}},88601:(t,e,s)=>{s.d(e,{JU:()=>h,K5:()=>g,L_:()=>a,RL:()=>r,UP:()=>i,W:()=>d,WV:()=>n,X:()=>l,pX:()=>o,sC:()=>c});const i=38,n=40,r=37,o=39,a=32,h=16,l=88,d=87,g=13,c=27},44254:(t,e,s)=>{s.d(e,{Z:()=>r});var i=s(25773),n=s(21969);const r=class{constructor(t){if(this.position=new i.Z(t.position.x,t.position.y,t.position.z),this.target=new i.Z(0,0,0),this.view=new n.Z,t.ortho){const{left:e,right:s,bottom:i,top:r}=t.ortho,{near:o,far:a}=t;this.ortho=new n.Z,this.ortho.ortho(e,s,i,r,o,a)}}lookAt(){this.view.identity().lookAt(this.position.getX(),this.position.getY(),this.position.getZ(),this.target.getX(),this.target.getY(),this.target.getZ(),0,1,0)}getView(){return this.view}getPosition(){return this.position.get()}getPositionVec3(){return this.position}getTarget(){return this.target.get()}getModel(){return this.repere.getModel()}getOrtho(){return this.ortho}addToPosition(t,e,s){this.position.addXYZ(t,e,s),this.lookAt()}setPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=null!==t?t:this.position.getX(),n=null!==e?e:this.position.getY(),r=null!==s?s:this.position.getZ();this.position.set(i,n,r),this.lookAt()}setTarget(t,e,s){this.target.set(t,e,s)}setTargetVec3(t){this.target.equal(t)}}},85693:(t,e,s)=>{s.d(e,{Z:()=>i});const i=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.value=t,this.speed=0,this.sampling=e.sampling||.7}update(){this.value+=this.speed,this.speed*=this.sampling}get(){return this.value}set(t){this.speed+=t}}},47313:(t,e,s)=>{s.d(e,{Z:()=>i});const i=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.04;this.value=t,this.target=t,this.sampling=e,this.threshold=1e-6}update(){Math.abs(this.value-this.target)>this.threshold?this.value+=(this.target-this.value)*this.sampling:this.value=this.target}get(){return this.value}set(t){this.target=t}setDirect(t){this.value=t}}},40487:(t,e,s)=>{s.d(e,{Z:()=>c});var i=s(35551),n=s(25773),r=s(21969),o=s(44254);const a=class extends o.Z{constructor(t){super(t),this.target=new n.Z(t.target.x,t.target.y,t.target.z),this.matIdentity=new r.Z,this.projection=new r.Z,this.projection.identity(),this.near=t.near||1,this.far=t.far||100,this.angle=t.angle||50,this.matIdentity.identity(),this.lookAt()}update(){this.lookAt()}perspective(t,e){this.projection.identity().perspective(this.angle,t/e,this.near,this.far)}move(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.position.set(this.position.getX(),Math.sin(.02*t)*(2+e),this.position.getZ()),this.lookAt()}setNearFar(t,e){this.near=t,this.far=e}setAngle(t){this.angle=t}getProjection(){return this.projection}getIdentity(){return this.matIdentity}getNearFar(){return[this.near,this.far]}getNear(){return this.near}getFar(){return this.far}getAngle(){return this.angle}getReflectViewMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const e=2*(this.position.getY()-t);return(new r.Z).identity().lookAt(this.position.getX(),this.position.getY()-e,this.position.getZ(),this.target.getX(),this.target.getY(),this.target.getZ(),0,1,0)}};const h=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.d=[0,0,0,0],this.set(t,e,s,i)}normalise(){const t=this.length();return 0!==t&&(this.d[0]/=t,this.d[1]/=t,this.d[2]/=t,this.d[3]/=t),this}get(){return this.d}getX(){return this.d[0]}getY(){return this.d[1]}getZ(){return this.d[2]}getW(){return this.d[3]}length(){return Math.sqrt(this.d[0]*this.d[0]+this.d[1]*this.d[1]+this.d[2]*this.d[2]+this.d[3]*this.d[3])}set(t,e,s,i){return null!=t&&(this.d[0]=t),null!=e?this.d[1]=e:null!=t&&(this.d[1]=t),null!=s?this.d[2]=s:null!=t&&(this.d[2]=t),null!=i?this.d[3]=i:null!=t&&(this.d[3]=t),this}equal(t){return this.d=[t.d[0],t.d[1],t.d[2],t.d[3]],this}add(t){return this.d[0]+=t.d[0],this.d[1]+=t.d[1],this.d[2]+=t.d[2],this.d[3]+=t.d[3],this}addNumber(t){return this.d[0]+=t,this.d[1]+=t,this.d[2]+=t,this.d[3]+=t,this}minus(t){return this.d[0]-=t.d[0],this.d[1]-=t.d[1],this.d[2]-=t.d[2],this.d[3]-=t.d[3],this}minusNumber(t){return this.d[0]-=t,this.d[1]-=t,this.d[2]-=t,this.d[3]-=t,this}multiplyNumber(t){return this.d[0]*=t,this.d[1]*=t,this.d[2]*=t,this.d[3]*=t,this}multiplyMatrix(t){const e=this.d[0],s=this.d[1],i=this.d[2],n=this.d[3];return this.d[0]=t.d[0]*e+t.d[4]*s+t.d[8]*i+t.d[12]*n,this.d[1]=t.d[1]*e+t.d[5]*s+t.d[9]*i+t.d[13]*n,this.d[2]=t.d[2]*e+t.d[6]*s+t.d[10]*i+t.d[14]*n,this.d[3]=t.d[3]*e+t.d[7]*s+t.d[11]*i+t.d[15]*n,this}multiply(t){return this.d[0]*=t.d[0],this.d[1]*=t.d[1],this.d[2]*=t.d[2],this.d[3]*=t.d[3],this}divideNumber(t){return this.d[0]/=t,this.d[1]/=t,this.d[2]/=t,this.d[3]/=t,this}divide(t){return this.d[0]/=t.d[0],this.d[1]/=t.d[1],this.d[2]/=t.d[2],this.d[3]/=t.d[3],this}distance(t){return Math.sqrt((t.d[0]-this.d[0])*(t.d[0]-this.d[0])+(t.d[1]-this.d[1])*(t.d[1]-this.d[1])+(t.d[2]-this.d[2])*(t.d[2]-this.d[2])+(t.d[3]-this.d[3])*(t.d[3]-this.d[3]))}},l=class extends a{get2dTexturePoint(t){const e=t.getX(),s=t.getY(),i=t.getZ(),n=new h(e,s,i,1),o=new r.Z;o.equal(this.view).multiply(this.projection),n.multiplyMatrix(o);let a=n.getX()/n.getW(),l=n.getY()/n.getW();return a=.5*(a+1),l=.5*(l+1),[a,l]}get2dScreenPoint(t,e){const s=this.get2dTexturePoint(t);return[s[0]*e.width,s[1]*e.height]}};var d=s(47313);const g=class extends l{constructor(t){super(t),this.options=t,this.rotationX=new d.Z,this.targetX=new d.Z,this.zoomZ=new d.Z(.7,.1)}update(){super.update(),this.rotationX.update(),this.zoomZ.update(),this.targetX.update(),this.position.set(this.options.position.x+this.targetX.get()+Math.sin(this.rotationX.get())*(this.options.position.z*this.zoomZ.get()),this.options.position.y,Math.cos(this.rotationX.get())*(this.options.position.z*this.zoomZ.get())),this.target.set(this.options.target.x,this.options.target.y,this.options.target.z)}setSmoothTarget(t){this.targetX.set(t)}setSmoothRotation(t){this.rotationX.set(t)}setSmoothZoom(t){this.zoomZ.set(t)}getZoom(){return this.zoomZ.get()}followPos2D(t,e){this.options.position.x=t,this.options.position.y=e,this.options.target.x=t,this.options.target.y=e}followPosY(t){this.options.position.y=t,this.options.target.y=t}},c=class extends i.Z{constructor(t,e){super(t,e),this.camera=new g(e.camera),this.camera.perspective(this.containerSize.width,this.containerSize.height)}resize(t){super.resize(t),this.camera.perspective(this.containerSize.width,this.containerSize.height)}update(t){super.update(t),this.camera.update(),this.mngProg.setCameraMatrix(this.camera,!!this.config.camera.ortho)}}},25192:(t,e,s)=>{s.d(e,{Z:()=>g});var i=s(40487),n=s(44254),r=s(2444),o=s(80602),a=s(21969);const h={position:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],texture:[1,1,0,1,0,0,1,0,0,0,1,0,1,1,0,1,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]};var l=s(25773);const d=class extends n.Z{constructor(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1024,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(e),this.gl=t,this.fbo=new r.Z(this.gl,s,i,n),this.sizeRepere=new l.Z(.05,.05,.05),this.repere=new class{constructor(t){this.gl=t,this.objet=new o.Z(this.gl,h),this.model=new a.Z,this.model.identity()}render(t){t.setMatrix("model",this.model.get()),this.objet.render(t.get())}update(t,e){this.model.identity().scale(e.getX(),e.getY(),e.getZ()).translate(t.getX(),t.getY(),t.getZ())}getModel(){return this.model}}(this.gl),this.repere.update(this.position,this.sizeRepere),this.lookAt()}start(){this.fbo.start()}end(){this.fbo.end()}move(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.position.set(Math.cos(.002*t)*(4+e),this.position.getY(),Math.sin(.002*t)*(4+e)),this.lookAt(),this.repere.update(this.position,this.sizeRepere)}renderRepere(t){this.repere.render(t)}getDepthTexture(){return this.fbo.getDepthTexture()}setDepthProgram(t){t.setMatrix("projection",this.getOrtho().get()),t.setMatrix("view",this.getView().get())}setShadowProgram(t){t.setTexture(2,this.getDepthTexture().get(),"shadowMap"),t.setMatrix("shadowView",this.getView().get()),t.setMatrix("shadowProjection",this.getOrtho().get()),t.setVector("posLum",this.getPosition())}resize(t){this.fbo.resize(t)}},g=class extends i.Z{constructor(t,e){super(t,e);const s=this.canUseDepth(),{width:i,height:n}=e.canvas;this.lampes=e.lampes&&e.lampes.map((e=>new d(t,e,i,n,s)))||[]}async setupAssets(t){await super.setupAssets(t);const e=this.mngProg.getAll();Object.keys(e).forEach((t=>{const s=e[t];s.getLocations().numLights&&this.setLampeInfos(s)}))}renderReperes(){this.lampes.forEach((t=>t.renderRepere(this.camera)))}randomLampesPositions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.lampes.forEach(((s,i)=>{(null===e||null!==e&&i===e)&&s.move(this.time*t,i)}))}setLampeInfos(t){t.setVector("posEye",this.camera.getPosition()),t.setInt("numLights",this.lampes.length),this.config.lampes.forEach(((e,s)=>{const{type:i,ambiant:n,diffuse:r,specular:o,brillance:a,radius:h,direction:l,strength:d}=e;t.setInt(`lights[${s}].type`,i),t.setVector(`lights[${s}].position`,this.lampes[s].getPosition()),t.setVector(`lights[${s}].ambiant`,n),t.setVector(`lights[${s}].diffuse`,r),t.setVector(`lights[${s}].specular`,o),a&&t.setFloat(`lights[${s}].brillance`,a),h&&t.setFloat(`lights[${s}].radius`,h),l&&t.setVector(`lights[${s}].direction`,l),t.setFloat(`lights[${s}].strength`,d||1)}))}render(){super.render(),"function"==typeof this.renderBasiqueForLampeDepth&&this.renderBasiqueForLampeDepth(),this.mngProg.setCameraMatrix(this.camera,!!this.config.camera.ortho)}getLampe(t){return this.lampes[t]?this.lampes[t]:null}resize(t){super.resize(t),this.lampes.forEach((e=>e.resize(t)))}}},77505:(t,e,s)=>{s.d(e,{oo:()=>r,ve:()=>n});const i=(t,e,s)=>{let i=s;return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},n=(t,e,s)=>{let n,r,o;const a=t/360,h=e/100,l=s/100;if(0===h)n=l,r=l,o=l;else{const t=l<.5?l*(1+h):l+h-l*h,e=2*l-t;n=i(e,t,a+1/3),r=i(e,t,a),o=i(e,t,a-1/3)}return{r:Math.round(255*n),g:Math.round(255*r),b:Math.round(255*o)}},r=t=>{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}},24981:(t,e,s)=>{s.d(e,{Z:()=>a});var i=s(8081),n=s.n(i),r=s(23645),o=s.n(r)()(n());o.push([t.id,"#controls {\n  position: absolute;\n  top: 0;\n  right: 0;\n  display: flex;\n  align-items: stretch;\n  z-index: 10;\n  background-color: rgba(34, 34, 34, .8);\n  margin: .5em;\n  padding: .5em;\n}\n\n#controls div {\n  display: flex;\n  align-items: stretch;\n}\n\n#controls div input[type=range] {\n  width: 100%;\n}\n\n#controls div input[type=checkbox] {\n  margin-right: 0.5em;\n}\n\n#controls label {\n  display: flex;\n  align-items: center;\n}\n\n#controls label,\n#controls a {\n  font-size: .8em;\n}\n\n@media (max-width: 570px) {\n  #controls.responsive {\n    position: relative;\n    width: 100%;\n    margin: 0;\n  }\n}",""]);const a=o},76889:(t,e,s)=>{s.d(e,{Z:()=>a});var i=s(8081),n=s.n(i),r=s(23645),o=s.n(r)()(n());o.push([t.id,"#fullscreen-toggle-btn {\n  border-radius: 0;\n  margin: 0;\n  padding: 4px;\n  border: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n  transform: scale(0.8);\n  opacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n  display: block;\n  width: 2em;\n  fill: #fff;\n  opacity: 0.8;\n  transform: scale(0.6);\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\n}\n\n[data-fullscreen] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n",""]);const a=o},23645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var s="",i=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),i&&(s+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),s+=t(e),i&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s})).join("")},e.i=function(t,s,i,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(i)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var l=0;l<t.length;l++){var d=[].concat(t[l]);i&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),s&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=s):d[2]=s),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),e.push(d))}},e}},8081:t=>{t.exports=function(t){return t[1]}},88747:(t,e,s)=>{var i=s(93379),n=s.n(i),r=s(7795),o=s.n(r),a=s(90569),h=s.n(a),l=s(3565),d=s.n(l),g=s(70609),c=s.n(g),u=s(44589),p=s.n(u),m=s(24981),f={};f.styleTagTransform=p(),f.setAttributes=d(),f.insert=h().bind(null,"head"),f.domAPI=o(),f.insertStyleElement=c();n()(m.Z,f),m.Z&&m.Z.locals&&m.Z.locals},89153:(t,e,s)=>{var i=s(93379),n=s.n(i),r=s(7795),o=s.n(r),a=s(90569),h=s.n(a),l=s(3565),d=s.n(l),g=s(70609),c=s.n(g),u=s(44589),p=s.n(u),m=s(76889),f={};f.styleTagTransform=p(),f.setAttributes=d(),f.insert=h().bind(null,"head"),f.domAPI=o(),f.insertStyleElement=c();n()(m.Z,f),m.Z&&m.Z.locals&&m.Z.locals},93379:t=>{var e=[];function s(t){for(var s=-1,i=0;i<e.length;i++)if(e[i].identifier===t){s=i;break}return s}function i(t,i){for(var r={},o=[],a=0;a<t.length;a++){var h=t[a],l=i.base?h[0]+i.base:h[0],d=r[l]||0,g="".concat(l," ").concat(d);r[l]=d+1;var c=s(g),u={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==c)e[c].references++,e[c].updater(u);else{var p=n(u,i);i.byIndex=a,e.splice(a,0,{identifier:g,updater:p,references:1})}o.push(g)}return o}function n(t,e){var s=e.domAPI(e);s.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,n){var r=i(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<r.length;o++){var a=s(r[o]);e[a].references--}for(var h=i(t,n),l=0;l<r.length;l++){var d=s(r[l]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}r=h}}},90569:t=>{var e={};t.exports=function(t,s){var i=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},70609:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:(t,e,s)=>{t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var n=void 0!==s.layer;n&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,n&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},44589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}}]);