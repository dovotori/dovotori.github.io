"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[1387],{11387:(t,e,n)=>{n.r(e),n.d(e,{default:()=>tt,destroy:()=>et});var r=n(48926),s=n.n(r),a=n(87757),i=n.n(a),o=n(35466),h=n(319),l=n.n(h),c=n(34575),u=n.n(c),g=n(93913),f=n.n(g),d=n(81506),v=n.n(d),p=n(16525),m=n.n(p),b=n(2205),y=n.n(b),w=n(78585),P=n.n(w),T=n(29754),E=n.n(T),x=n(59713),k=n.n(x),M=n(25192),A=n(80602),Z=n(21969),R=n(25773),D=n(85693),F=n(68763),X=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=-1,s=0;s<e;s++){r++;for(var a=0;a<t;a++)n.push(a,0,r);var i=0;r++;for(var o=0;o<t;o++)n.push(i,0,r),0===o&&(i+=.5,n.push(i,0,r)),o===t-2?i+=.5:i++}r++;for(var h=0;h<t;h++)n.push(h,0,r);return n},I=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=t+t+1,s=0;s<e;s++){for(var a=r*s,i=t-1;i>=0;i--){var o=i+t+a;i===t-1&&n.push(o+1),n.push(i+a),0!==i&&n.push(o)}for(var h=t+1,l=t;l<t+h;l++)if(n.push(l+a),l!==t+h-1){var c=l+h+a;n.push(c)}s!==e-1&&n.push(t+t+a)}return n},L=function(t,e,n){var r=n.thicknessY,s=void 0===r?-1:r,a=[],i=[t-1,2*e-1];a.push(i[0],s,i[1]);for(var o=2*e,h=t-1;h>0;h--)a.push(h,s,o);for(var l=2*e;l>0;l--)a.push(0,s,l);for(var c=0;c<t-1;c++)a.push(c,s,0);for(var u=0;u<2*e-1;u++)a.push(t-1,s,u);return a},j=function(t,e){var n=[],r=function(t,e){return t*(e+1)+(t+1)*e}(t,e)-1,s=r-t;n.push(s);var a=r+1;n.push(a);for(var i=a+1,o=r;o>r-t;o--)n.push(o),n.push(i),i++;for(var h=2*e-1;h>0;h--){var l=t*h+Math.floor(h/2);n.push(l),n.push(i),i++}for(var c=0;c<t;c++)n.push(c),n.push(i),i++;for(var u=1;u<2*e-1;u++){var g=t-1+(t*u+Math.ceil(u/2));n.push(g),n.push(i),i++}return n.push(s),n.push(a),n},U=function(t,e,n){for(var r=[],s=0;s<t.length;s+=3){var a=(0,F.Yp)(t[s],0,e-1,-1,1),i=t[s+1],o=(0,F.Yp)(t[s+2],0,2*n-1,-1,1);r.push(a,i,o)}return r};var _=n(63038),z=n.n(_),V=(n(69100),function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=[];if(null===n)for(var s=0;s<e;s++)for(var a=0;a<t;a++)r.push([a+Math.random(),s+Math.random()]);else for(var i=0;i<n;i++)for(var o=0;o<e;o++)for(var h=0;h<t;h++)r.push([h+Math.random(),o+Math.random(),i+Math.random()]);return r}),G=function(t,e){return Math.max(0,e.reduce((function(e,n){var r,s,a=(r=t,s=n,Math.sqrt((s[0]-r[0])*(s[0]-r[0])+(s[1]-r[1])*(s[1]-r[1])));return Math.min(e,a)}),1))},N=function(t,e,n){var r=function(t,e){var n=[];if(3===e.length)for(var r=-1;r<=1;r++)for(var s=-1;s<=1;s++)for(var a=-1;a<=1;a++)n.push([t[0]+a,t[1]+s,t[2]+r]);else for(var i=-1;i<=1;i++)for(var o=-1;o<=1;o++)n.push([t[0]+o,t[1]+i]);return n}(t,e);return r.map((function(t){return function(t,e,n){var r=z()(t,3),s=r[0],a=r[1],i=r[2],o=void 0===i?null:i,h=n[0],c=n[1],u=n[2],g=s,f=!1;-1===s?(g=h-1,f=!0):s===h&&(g=0,f=!0);var d=a,v=!1;-1===a?(d=c-1,v=!0):a===c&&(d=0,v=!0);var p=o,m=!1;-1===o?(p=u-1,m=!0):o===u&&(p=0,m=!0);var b=d*c+g;null!==o&&(b+=p*u);var y=l()(e[b]);return f&&(-1===s?y[0]-=h:y[0]+=h),v&&(-1===a?y[1]-=c:y[1]+=c),m&&(-1===o?y[2]-=u:y[2]+=u),y}(t,n,e)}))},B=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;u()(this,t),this.gl=e,this.size={width:n,height:r,depth:s},this.texture=e.createTexture(),this.filter=e.NEAREST,this.setup()}return f()(t,[{key:"setup",value:function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.create(),this.setFilters(),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}},{key:"create",value:function(){for(var t=this.size,e=t.width,n=t.height,r=new ArrayBuffer(32*e*n*32*4),s=new Uint8Array(r),a=function(t,e,n){for(var r=V(t,e),s=[t,e],a=[],i=[0,0],o=N(i,s,r),h=0;h<e*n;h++)for(var l=0;l<t*n;l++){var c=[l/n,h/n],u=c.map((function(t){return Math.floor(t)}));i[0]===u[0]&&i[1]===u[1]||(o=N(i=u,s,r));var g=G(c,o);a.push(g)}return a}(e,n,32),i=0,o=0;o<a.length;o++){var h=255-255*a[o];s[i]=h,s[i+1]=h,s[i+2]=h,s[i+3]=255,i+=4}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,32*n,32*e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s)}},{key:"setFilters",value:function(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT)}},{key:"get",value:function(){return this.texture}}]),t}(),C=n(77505),S=n(2444);function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=E()(t);if(e){var s=E()(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return P()(this,n)}}var W=function(t,e){var n=new R.Z(t,e,t).multiplyNumber(.13).fract(),r=new R.Z(n.getY(),n.getZ(),n.getX()).addNumber(3.333);return n.addNumber(n.dot(r)),(0,F.ZI)((n.getX()+n.getY())*n.getZ())},Y=function(t,e){var n=Math.floor(t),r=Math.floor(e),s=(0,F.ZI)(t),a=(0,F.ZI)(e),i=W(n,r),o=W(n+1,r),h=W(n,r+1),l=W(n+1,r+1),c=s*s*(3-2*s),u=a*a*(3-2*a);return(0,F.CD)(i,o,c)+(h-i)*u*(1-c)+(l-o)*c*u},q=function(t,e){for(var n=e.lacunarity,r=e.persistance,s=0,a=0,i=0;i<10;i+=1){var o=Math.pow(n,i),h=Math.pow(r,i);s+=Y(t[0]*o,t[1]*o)*h,a+=h}return s/a},H=function(t){y()(n,t);var e=O(n);function n(){var t;u()(this,n);for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s)),k()(v()(t),"renderBasiqueForLampeDepth",(function(){var e=t.getLampe(0);["instancingDepth","basique3d"].forEach((function(n){var r=t.mngProg.get(n);e.setDepthProgram(r)})),e.start(),t.mngGltf.get("three").render(t.mngProg.get("instancingDepth"),t.model),t.renderEntenna(t.mngProg.get("basique3d")),e.end()})),k()(v()(t),"onMouseDrag",(function(e){t.targetZ.set(.001*-e.relPrevious.x),t.targetX.set(.001*e.relPrevious.y)})),k()(v()(t),"onMouseClick",(function(e){t.targetZ.set(.1*-e.rel.x),t.targetX.set(.1*-e.rel.y)})),t}return f()(n,[{key:"setup",value:function(){var t=this,e=this.config,r=this.gl;this.fbo=new S.Z(r,e.width,e.height,!0),this.fbo2=new S.Z(r,e.width,e.height,!0),this.fbo3=new S.Z(r,e.width,e.height,!0);var s=e.terrain,a=s.width,i=s.height,o=s.colors,h=s.waterLevel;this.targetX=new D.Z(0),this.targetZ=new D.Z(0),this.model=new Z.Z,this.vbo=new A.Z(r,function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=X(t,e,n),s=I(t,e);if(n.withThick){var a=r.concat(L(t,e,n));return{position:U(a,t,e),indices:s.concat(j(t,e))}}return{position:r,indices:s}}(a,i,{withThick:!0,thicknessY:-.1})),this.vbo.setModeDessin(r.TRIANGLE_STRIP),this.cloudsTex=new B(r,4,4);var l=this.mngProg.get("terrain"),c=this.mngProg.get("instancing"),u=this.mngProg.get("water"),g=this.mngProg.get("shadow"),f=this.mngProg.get("terrainDepth"),d=this.mngProg.get("instancingDepth");[l,c,g,u,f,d].forEach((function(r){n.setFog(r,e.fog),n.setTerrain(r,e.terrain),r.setVector("gridSize",[a,i]),r.setFloat("waterLevel",h),t.setLampeInfos(r)})),o.forEach((function(t,e){var n=(0,C.oo)(t),r=n.r,s=n.g,a=n.b;l.setVector("colors[".concat(e,"]"),[r,s,a].map((function(t){return t/255})))}));for(var v=400,p=[],m=[],b=[],y=0;y<v;y++)p.push(2*Math.random()-1,0,2*Math.random()-1),m.push(.4,.6,Math.random()),b.push(.05+.06*Math.random());var w={componentType:r.FLOAT,count:v,size:3,type:"VEC3",values:new Float32Array(p)},P={componentType:r.FLOAT,count:v,size:3,type:"VEC3",values:new Float32Array(m)},T={componentType:r.FLOAT,count:v,size:1,type:"FLOAT",values:new Float32Array(b)};this.mngGltf.get("three").addInstancingVbos(v,{offset:w,acolor:P,size:T});var E=[-.6,.8];this.posAntenna=[E[0],q(E,e.terrain),E[1]],this.isAntennaVisible=!1,this.currentPosAntenna=this.posAntenna}},{key:"update",value:function(t){var e=this;m()(E()(n.prototype),"update",this).call(this,t),this.model.identity();var r=this.model.getMatrice3x3();r.inverse(),r.transpose(),this.targetX.update(),this.targetZ.update();var s=1e-5*this.time,a=[this.targetX.get(),this.targetZ.get()],i=this.mngProg.get("terrain"),o=this.mngProg.get("instancing"),h=this.mngProg.get("water");[i,o,this.mngProg.get("shadow"),h,this.mngProg.get("terrainDepth"),this.mngProg.get("instancingDepth")].forEach((function(t){t.setMatrix("model",e.model.get()),t.setMatrix("normalMatrix",r.get()),t.setVector("moving",a)})),h.setFloat("time",s),this.mngGltf.get("antenna").update(.1*t),this.currentPosAntenna=[this.posAntenna[0]-this.targetX.get(),this.posAntenna[1],this.posAntenna[2]-this.targetZ.get()],this.isAntennaVisible=Math.abs(this.currentPosAntenna[0])>0&&Math.abs(this.currentPosAntenna[0])<1&&Math.abs(this.currentPosAntenna[2])>0&&Math.abs(this.currentPosAntenna[2])<1}},{key:"waterPasses",value:function(){var t=this.mngProg.get("terrain"),e=this.mngProg.get("instancing");t.setFloat("reflectPass",1),t.setFloat("refractPass",0),t.setMatrix("view",this.camera.getReflectViewMatrix(this.config.terrain.waterLevel).get()),e.setMatrix("view",this.camera.getReflectViewMatrix(this.config.terrain.waterLevel).get()),this.fbo.start(),this.vbo.render(t.get()),this.mngGltf.get("three").render(e,this.model),this.fbo.end(),t.setFloat("reflectPass",0),t.setFloat("refractPass",1),t.setMatrix("view",this.camera.getView().get()),this.fbo2.start(),this.vbo.render(t.get()),this.fbo2.end(),t.setFloat("refractPass",0)}},{key:"shadowPass",value:function(){var t=this.getLampe(0);this.shadow.start(t),this.vbo.render(this.shadow.getProgram().get()),this.mngGltf.get("three").render(this.mngProg.get("instancingDepth"),this.model),this.renderEntenna(this.mngProg.get("basique3d")),this.shadow.end(),this.shadow.setBrightContrast(0,3)}},{key:"renderEntenna",value:function(t){var e;this.isAntennaVisible&&(this.model.push(),this.model.scale(.07),(e=this.model).translate.apply(e,l()(this.currentPosAntenna)),this.mngGltf.get("antenna").render(t,this.model),this.model.pop())}},{key:"render",value:function(){m()(E()(n.prototype),"render",this).call(this),this.vbo.render(this.mngProg.get("terrain").get()),this.mngGltf.get("three").render(this.mngProg.get("instancing"),this.model),this.renderEntenna(this.mngProg.get("gltf"))}},{key:"setKeyboardInteraction",value:function(t){var e=this.config.keyboard,n=e.LEFT,r=e.RIGHT,s=e.UP,a=e.DOWN;t.isPressed(n)&&this.targetX.set(-.01),t.isPressed(r)&&this.targetX.set(.01),t.isPressed(s)&&this.targetZ.set(-.01),t.isPressed(a)&&this.targetZ.set(.01)}}],[{key:"setFog",value:function(t,e){var n=e.start,r=e.end,s=e.color;t.setFloat("fogStart",n),t.setFloat("fogEnd",r),t.setVector("fogColor",s)}},{key:"setTerrain",value:function(t,e){var n=e.lacunarity,r=e.persistance;t.setFloat("lacunarity",n),t.setFloat("persistance",r)}}]),n}(M.Z);const K=H;var J=n(88601);const $={slug:"diorama",shaders:["/diorama/terrain.js","/diorama/water.js","/diorama/instancing.js","/diorama/instancingDepth.js","/diorama/shadow.js","/diorama/terrainDepth.js","/screen/screen.js","/screen/blurOnePass.js","/screen/brightcontrast.js","/screen/composeShadow.js","/camera/gltf.js","/camera/basique3d.js"],assets:["/gltf/three.gltf","/gltf/antenna.gltf","/textures/waterN.jpg","/textures/dudv.png"],canvas:{width:1024,height:1024},postprocess:{shadow:{epsilon:.01,lighten:.1,blur:{size:.1,intensity:1}}},useDepthTexture:!0,useDrawBuffer:!0,camera:{position:{x:2,y:2,z:2},target:{x:0,y:0,z:0},near:1,far:200,angle:60},lampes:[{type:0,position:{x:2,y:4,z:2},ambiant:[1,1,1],diffuse:[1,1,1],specular:[1,1,1],brillance:1,strength:1.2,near:1,far:10,ortho:{left:-1.5,right:1.5,bottom:-1.5,top:1.5}}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},terrain:{width:200,height:100,lacunarity:1.6,persistance:.5,waterLevel:.4,colors:["#251a16","#6e6254","#8b6a47","#5d564c","#989b56","#6d753a","#89934c","#8b8f54","#ffffff"]},fog:{color:[0,0,0,0],start:2,end:10},mouse:{events:["drag","click"]},keyboard:{UP:J.UP,DOWN:J.WV,LEFT:J.RL,RIGHT:J.pX}};n(88747),n(89153);var Q=null;const tt=s()(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Q=new o.Z,t.next=3,Q.setup(K,$);case 3:case"end":return t.stop()}}),t)})));var et=function(){Q&&Q.destroy&&Q.destroy()}},88601:(t,e,n)=>{n.d(e,{JU:()=>h,K5:()=>u,L_:()=>o,RL:()=>a,UP:()=>r,W:()=>c,WV:()=>s,X:()=>l,pX:()=>i,sC:()=>g});var r=38,s=40,a=37,i=39,o=32,h=16,l=88,c=87,u=13,g=27},85693:(t,e,n)=>{n.d(e,{Z:()=>o});var r=n(34575),s=n.n(r),a=n(93913),i=n.n(a),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s()(this,t),this.value=e,this.speed=0,this.sampling=n.sampling||.7}return i()(t,[{key:"update",value:function(){this.value+=this.speed,this.speed*=this.sampling}},{key:"get",value:function(){return this.value}},{key:"set",value:function(t){this.speed+=t}}]),t}()},77505:(t,e,n)=>{n.d(e,{oo:()=>a,ve:()=>s});var r=function(t,e,n){var r=n;return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t},s=function(t,e,n){var s,a,i,o=t/360,h=e/100,l=n/100;if(0===h)s=l,a=l,i=l;else{var c=l<.5?l*(1+h):l+h-l*h,u=2*l-c;s=r(u,c,o+1/3),a=r(u,c,o),i=r(u,c,o-1/3)}return{r:Math.round(255*s),g:Math.round(255*a),b:Math.round(255*i)}},a=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}},24981:(t,e,n)=>{n.d(e,{Z:()=>o});var r=n(8081),s=n.n(r),a=n(23645),i=n.n(a)()(s());i.push([t.id,"#controls {\n  position: absolute;\n  top: 0;\n  right: 0;\n  display: flex;\n  align-items: stretch;\n  z-index: 10;\n  background-color: rgba(34, 34, 34, .8);\n  margin: .5em;\n  padding: .5em;\n}\n\n#controls div {\n  display: flex;\n  align-items: stretch;\n}\n\n#controls div input[type=range] {\n  width: 100%;\n}\n\n#controls div input[type=checkbox] {\n  margin-right: 0.5em;\n}\n\n#controls select {\n  background-color: #555;\n  color: var(--project-color);\n  border: none;\n  border-radius: 0.2em;\n  display: inline-block;\n  padding: 0.5em 1em 0.5em 0.2em;\n  margin: 0;\n  box-sizing: border-box;\n}\n\n#controls select:focus {\n  outline: 0;\n}\n\n#controls select option {\n  font-size: 1.2em;\n}\n\n#controls label {\n  display: flex;\n  align-items: center;\n}\n\n#controls label,\n#controls a,\n#controls button,\n#controls select {\n  font-size: .8em;\n}\n\n#controls div label {\n  min-width: 40%;\n  margin-right: 5px;\n}\n\n#controls a,\n#controls button {\n  background: #555;\n  padding: 0.5em;\n  border-radius: 0.2em;\n  color: var(--project-color);\n  transition: background 200ms ease-out;\n}\n\n#controls .primary {\n  background: var(--project-color);\n  color: black;\n}\n\n#controls a:hover,\n#controls button:hover {\n  background: black;\n  color: var(--project-color);\n}\n\n#controls a:active,\n#controls button:active {\n  transform: scale(0.9);\n}\n\n@media (max-width: 570px) {\n  #controls.responsive {\n    position: relative;\n    width: 100%;\n    margin: 0;\n  }\n}",""]);const o=i},76889:(t,e,n)=>{n.d(e,{Z:()=>o});var r=n(8081),s=n.n(r),a=n(23645),i=n.n(a)()(s());i.push([t.id,"#fullscreen-toggle-btn {\n  border-radius: 0;\n  margin: 0;\n  padding: 4px;\n  border: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n  transform: scale(0.8);\n  opacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n  display: block;\n  width: 2em;\n  fill: #fff;\n  opacity: 0.8;\n  transform: scale(0.6);\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\n}\n\n[data-fullscreen] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n",""]);const o=i},88747:(t,e,n)=>{var r=n(93379),s=n.n(r),a=n(7795),i=n.n(a),o=n(90569),h=n.n(o),l=n(3565),c=n.n(l),u=n(70609),g=n.n(u),f=n(44589),d=n.n(f),v=n(24981),p={};p.styleTagTransform=d(),p.setAttributes=c(),p.insert=h().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=g();s()(v.Z,p),v.Z&&v.Z.locals&&v.Z.locals},89153:(t,e,n)=>{var r=n(93379),s=n.n(r),a=n(7795),i=n.n(a),o=n(90569),h=n.n(o),l=n(3565),c=n.n(l),u=n(70609),g=n.n(u),f=n(44589),d=n.n(f),v=n(76889),p={};p.styleTagTransform=d(),p.setAttributes=c(),p.insert=h().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=g();s()(v.Z,p),v.Z&&v.Z.locals&&v.Z.locals}}]);