(self.webpackChunkdovotori_portfolio=self.webpackChunkdovotori_portfolio||[]).push([[9226],{3957:(n,t,e)=>{"use strict";e.r(t),e.d(t,{default:()=>A});var r=e(15861),o=e(87757),i=e.n(o);e(50835);var s=e(43144),c=e(15671),a=e(4942),u=e(33559),l=(0,s.Z)((function n(){var t=this;(0,c.Z)(this,n),(0,a.Z)(this,"on",(function(){var n;return(n=t.socket).on.apply(n,arguments)})),(0,a.Z)(this,"emit",(function(){var n;return(n=t.socket).emit.apply(n,arguments)})),(0,a.Z)(this,"reconnect",(function(){return t.close(),new Promise((function(n,e){t.socket.connect(),console.log("socket connect"),t.socket.on("connect_error",(function(n){t.socket.close(),e(n)})),t.socket.on("connect",(function(){n(t)}))}))})),(0,a.Z)(this,"close",(function(){t.socket.connected&&t.socket.disconnect()})),(0,a.Z)(this,"isConnected",(function(){return t.socket.connected}));return this.socket=null,console.log("constructor"),new Promise((function(n,e){t.socket=(0,u.ZP)("http://localhost:8083"),console.log("socket connect"),t.socket.on("connect_error",(function(n){t.socket.disconnect(),e(n)})),t.socket.on("connect",(function(){n(t)}))}))})),f=e(38853),h=e.n(f),p=function(){function n(){var t=this;(0,c.Z)(this,n),(0,a.Z)(this,"setSignal",(function(n){t.peer.signal(n)})),(0,a.Z)(this,"setAsk",(function(n){t.ask=n})),(0,a.Z)(this,"setStream",(function(n){t.stream=n,t.isCreated&&t.peer.addStream(t.stream)})),(0,a.Z)(this,"setAnswer",(function(n){t.answer=n,t.isInitiator&&t.isCreated&&t.peer.signal(t.answer)})),(0,a.Z)(this,"setOffer",(function(n){t.offer=n,t.tryToCreate()})),(0,a.Z)(this,"setIsInitiator",(function(n){console.log("set initiator",n),t.isInitiator=n,t.tryToCreate()})),this.isInitiator=null,this.isConnected=!1,this.peer=null,this.stream=null,this.answer=null,this.offer=null,this.ask=null,this.isCreated=!1}return(0,s.Z)(n,[{key:"tryToCreate",value:function(){this.isCreated||null===this.isInitiator||(this.isInitiator||!this.isInitiator&&this.offer)&&this.create()}},{key:"create",value:function(){var n=this;this.peer=new(h())({initiator:this.isInitiator,trickle:!1,stream:this.stream}),console.log("create peer",this.isInitiator),this.peer.on("error",(function(n){return console.log(n)})),this.peer.on("signal",(function(t){console.log("peer on signal",t),n.isConnected||(n.isInitiator&&t.type&&"offer"===t.type?n.ask("question offer",t):!n.isInitiator&&t.type&&"answer"===t.type&&n.ask("question answer",t))})),this.peer.on("stream",(function(n){console.log("stream emitter");var t=document.querySelector("#emitter");t.srcObject=n,t.play()})),this.peer.on("connect",(function(){console.log("peer connected"),n.isConnected=!0})),this.isInitiator||this.setSignal(this.offer),this.isCreated=!0}},{key:"getIsInitiator",value:function(){return this.isInitiator}}]),n}(),d=e(93379),m=e.n(d),k=e(7795),g=e.n(k),w=e(90569),v=e.n(w),y=e(3565),Z=e.n(y),I=e(70609),b=e.n(I),C=e(44589),x=e.n(C),T=e(80668),S={};S.styleTagTransform=x(),S.setAttributes=Z(),S.insert=v().bind(null,"head"),S.domAPI=g(),S.insertStyleElement=b();m()(T.Z,S);T.Z&&T.Z.locals&&T.Z.locals;var L=document.querySelector("#btn"),M=function(){var n=(0,r.Z)(i().mark((function n(t){var e,r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(n){return n})).catch((function(n){console.log("".concat(n.name,": ").concat(n.message))}));case 2:(e=n.sent)?(t.setStream(e),(r=document.querySelector("#own")).srcObject=e,r.play()):L.innerHTML="Can't access your webcam. Retry";case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),q=function(){var n=(0,r.Z)(i().mark((function n(t){var e,r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new l;case 2:return e=n.sent,r=function(){return e.emit.apply(e,arguments)},t.setAsk(r),e.on("answer initiator",t.setIsInitiator),e.on("answer offer",t.setOffer),e.on("answer answer",t.setAnswer),e.emit("question initiator"),n.abrupt("return",e);case 10:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();const A=function(){var n=null;L&&L.addEventListener("click",(0,r.Z)(i().mark((function t(){var e;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(L.innerHTML="Loading",t.prev=1,console.log(n),null!==n){t.next=14;break}return L.innerHTML="Please allow webcam access",e=new p,t.next=8,M(e);case 8:return t.next=10,q(e);case 10:n=t.sent,L.innerHTML=e.getIsInitiator()?"Connected (wait for another connection)":"Wait you will join someone",t.next=17;break;case 14:n.close(),n=null,L.innerHTML="Join";case 17:t.next=23;break;case 19:t.prev=19,t.t0=t.catch(1),console.log(t.t0),L.innerHTML="Retry";case 23:case"end":return t.stop()}}),t,null,[[1,19]])}))),!1)}},80668:(n,t,e)=>{"use strict";e.d(t,{Z:()=>c});var r=e(8081),o=e.n(r),i=e(23645),s=e.n(i)()(o());s.push([n.id,"#labo {\r\n  position: relative;\r\n  width: 100%;\r\n  height: auto;\r\n  background-color: #222;\r\n  text-align: center;\r\n}\r\nvideo {\r\n  width: 50%;\r\n}\r\n.flex {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n#status {\r\n  width: 80%;\r\n  color: #fff;\r\n  margin: 0 auto;\r\n  padding: 1em;\r\n}\r\n#btn {\r\n  background: #fff;\r\n  width: 80%;\r\n  margin: 0 auto;\r\n  padding: 1em;\r\n  text-transform: uppercase;\r\n  letter-spacing: 0.2em;\r\n}\r\n",""]);const c=s},58929:()=>{},32439:()=>{}}]);