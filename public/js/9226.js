(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[9226],{3957:(t,n,e)=>{"use strict";e.r(n),e.d(n,{default:()=>A});var i=e(15861),r=e(87757),s=e.n(r);e(50835);var o=e(43144),a=e(15671),c=e(4942),u=e(33559),f=(0,o.Z)((function t(){var n=this;(0,a.Z)(this,t),(0,c.Z)(this,"on",(function(){var t;return(t=n.socket).on.apply(t,arguments)})),(0,c.Z)(this,"emit",(function(){var t;return(t=n.socket).emit.apply(t,arguments)})),(0,c.Z)(this,"reconnect",(function(){return n.close(),new Promise((function(t,e){n.socket.connect(),n.socket.on("connect_error",(function(t){n.socket.close(),e(t)})),n.socket.on("connect",(function(){t(n)}))}))})),(0,c.Z)(this,"close",(function(){n.socket.connected&&n.socket.disconnect()})),(0,c.Z)(this,"isConnected",(function(){return n.socket.connected}));return this.socket=null,new Promise((function(t,e){n.socket=(0,u.ZP)("http://localhost:8083"),n.socket.on("connect_error",(function(t){n.socket.disconnect(),e(t)})),n.socket.on("connect",(function(){t(n)}))}))})),l=e(38853),h=e.n(l),d=function(){function t(){var n=this;(0,a.Z)(this,t),(0,c.Z)(this,"setSignal",(function(t){n.peer.signal(t)})),(0,c.Z)(this,"setAsk",(function(t){n.ask=t})),(0,c.Z)(this,"setStream",(function(t){n.stream=t,n.isCreated&&n.peer.addStream(n.stream)})),(0,c.Z)(this,"setAnswer",(function(t){n.answer=t,n.isInitiator&&n.isCreated&&n.peer.signal(n.answer)})),(0,c.Z)(this,"setOffer",(function(t){n.offer=t,n.tryToCreate()})),(0,c.Z)(this,"setIsInitiator",(function(t){n.isInitiator=t,n.tryToCreate()})),this.isInitiator=null,this.isConnected=!1,this.peer=null,this.stream=null,this.answer=null,this.offer=null,this.ask=null,this.isCreated=!1}return(0,o.Z)(t,[{key:"tryToCreate",value:function(){this.isCreated||null===this.isInitiator||(this.isInitiator||!this.isInitiator&&this.offer)&&this.create()}},{key:"create",value:function(){var t=this;this.peer=new(h())({initiator:this.isInitiator,trickle:!1,stream:this.stream}),this.peer.on("error",(function(t){})),this.peer.on("signal",(function(n){t.isConnected||(t.isInitiator&&n.type&&"offer"===n.type?t.ask("question offer",n):!t.isInitiator&&n.type&&"answer"===n.type&&t.ask("question answer",n))})),this.peer.on("stream",(function(t){var n=document.querySelector("#emitter");n.srcObject=t,n.play()})),this.peer.on("connect",(function(){t.isConnected=!0})),this.isInitiator||this.setSignal(this.offer),this.isCreated=!0}},{key:"getIsInitiator",value:function(){return this.isInitiator}}]),t}(),p=e(93379),k=e.n(p),m=e(7795),w=e.n(m),v=e(90569),y=e.n(v),Z=e(3565),g=e.n(Z),I=e(70609),b=e.n(I),C=e(44589),x=e.n(C),T=e(80668),S={};S.styleTagTransform=x(),S.setAttributes=g(),S.insert=y().bind(null,"head"),S.domAPI=w(),S.insertStyleElement=b();k()(T.Z,S);T.Z&&T.Z.locals&&T.Z.locals;var L=document.querySelector("#btn"),M=function(){var t=(0,i.Z)(s().mark((function t(n){var e,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(t){return t})).catch((function(t){}));case 2:(e=t.sent)?(n.setStream(e),(i=document.querySelector("#own")).srcObject=e,i.play()):L.innerHTML="Can't access your webcam. Retry";case 4:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),q=function(){var t=(0,i.Z)(s().mark((function t(n){var e,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new f;case 2:return e=t.sent,i=function(){return e.emit.apply(e,arguments)},n.setAsk(i),e.on("answer initiator",n.setIsInitiator),e.on("answer offer",n.setOffer),e.on("answer answer",n.setAnswer),e.emit("question initiator"),t.abrupt("return",e);case 10:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}();const A=function(){var t=null;L&&L.addEventListener("click",(0,i.Z)(s().mark((function n(){var e;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(L.innerHTML="Loading",n.prev=1,null!==t){n.next=14;break}return L.innerHTML="Please allow webcam access",e=new d,n.next=8,M(e);case 8:return n.next=10,q(e);case 10:t=n.sent,L.innerHTML=e.getIsInitiator()?"Connected (wait for another connection)":"Wait you will join someone",n.next=17;break;case 14:t.close(),t=null,L.innerHTML="Join";case 17:n.next=23;break;case 19:n.prev=19,n.t0=n.catch(1),L.innerHTML="Retry";case 23:case"end":return n.stop()}}),n,null,[[1,19]])}))),!1)}},80668:(t,n,e)=>{"use strict";e.d(n,{Z:()=>a});var i=e(8081),r=e.n(i),s=e(23645),o=e.n(s)()(r());o.push([t.id,"#labo {\n  position: relative;\n  width: 100%;\n  height: auto;\n  background-color: #222;\n  text-align: center;\n}\nvideo {\n  width: 50%;\n}\n.flex {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n#status {\n  width: 80%;\n  color: #fff;\n  margin: 0 auto;\n  padding: 1em;\n}\n#btn {\n  background: #fff;\n  width: 80%;\n  margin: 0 auto;\n  padding: 1em;\n  text-transform: uppercase;\n  letter-spacing: 0.2em;\n}\n",""]);const a=o},58929:()=>{},32439:()=>{}}]);