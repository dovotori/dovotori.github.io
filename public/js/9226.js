(self.webpackChunkdovotori_portfolio=self.webpackChunkdovotori_portfolio||[]).push([[9226],{3957:(n,t,e)=>{"use strict";e.r(t),e.d(t,{default:()=>Z});var o=e(92137),i=e(87757),r=e.n(i);e(50835);var s=e(6610),c=e(96156),a=e(35615),u=function n(){var t=this;(0,s.Z)(this,n),(0,c.Z)(this,"on",(function(){var n;return(n=t.socket).on.apply(n,arguments)})),(0,c.Z)(this,"emit",(function(){var n;return(n=t.socket).emit.apply(n,arguments)})),(0,c.Z)(this,"reconnect",(function(){return t.close(),new Promise((function(n,e){t.socket.connect(),console.log("socket connect"),t.socket.on("connect_error",(function(n){t.socket.close(),e(n)})),t.socket.on("connect",(function(){n(t)}))}))})),(0,c.Z)(this,"close",(function(){t.socket.connected&&t.socket.disconnect()})),(0,c.Z)(this,"isConnected",(function(){return t.socket.connected}));return this.socket=null,console.log("constructor"),new Promise((function(n,e){t.socket=(0,a.ZP)("http://localhost:8083"),console.log("socket connect"),t.socket.on("connect_error",(function(n){t.socket.disconnect(),e(n)})),t.socket.on("connect",(function(){n(t)}))}))},l=e(5991),f=e(38853),h=e.n(f),p=function(){function n(){var t=this;(0,s.Z)(this,n),(0,c.Z)(this,"setSignal",(function(n){t.peer.signal(n)})),(0,c.Z)(this,"setAsk",(function(n){t.ask=n})),(0,c.Z)(this,"setStream",(function(n){t.stream=n,t.isCreated&&t.peer.addStream(t.stream)})),(0,c.Z)(this,"setAnswer",(function(n){t.answer=n,t.isInitiator&&t.isCreated&&t.peer.signal(t.answer)})),(0,c.Z)(this,"setOffer",(function(n){t.offer=n,t.tryToCreate()})),(0,c.Z)(this,"setIsInitiator",(function(n){console.log("set initiator",n),t.isInitiator=n,t.tryToCreate()})),this.isInitiator=null,this.isConnected=!1,this.peer=null,this.stream=null,this.answer=null,this.offer=null,this.ask=null,this.isCreated=!1}return(0,l.Z)(n,[{key:"tryToCreate",value:function(){this.isCreated||null===this.isInitiator||(this.isInitiator||!this.isInitiator&&this.offer)&&this.create()}},{key:"create",value:function(){var n=this;this.peer=new(h())({initiator:this.isInitiator,trickle:!1,stream:this.stream}),console.log("create peer",this.isInitiator),this.peer.on("error",(function(n){return console.log(n)})),this.peer.on("signal",(function(t){console.log("peer on signal",t),n.isConnected||(n.isInitiator&&t.type&&"offer"===t.type?n.ask("question offer",t):!n.isInitiator&&t.type&&"answer"===t.type&&n.ask("question answer",t))})),this.peer.on("stream",(function(n){console.log("stream emitter");var t=document.querySelector("#emitter");t.srcObject=n,t.play()})),this.peer.on("connect",(function(){console.log("peer connected"),n.isConnected=!0})),this.isInitiator||this.setSignal(this.offer),this.isCreated=!0}},{key:"getIsInitiator",value:function(){return this.isInitiator}}]),n}(),d=e(93379),k=e.n(d),m=e(80668),g={insert:"head",singleton:!1};k()(m.Z,g);m.Z.locals;var w=document.querySelector("#btn"),v=function(){var n=(0,o.Z)(r().mark((function n(t){var e,o;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(n){return n})).catch((function(n){console.log("".concat(n.name,": ").concat(n.message))}));case 2:(e=n.sent)?(t.setStream(e),(o=document.querySelector("#own")).srcObject=e,o.play()):w.innerHTML="Can't access your webcam. Retry";case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),y=function(){var n=(0,o.Z)(r().mark((function n(t){var e,o;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new u;case 2:return e=n.sent,o=function(){return e.emit.apply(e,arguments)},t.setAsk(o),e.on("answer initiator",t.setIsInitiator),e.on("answer offer",t.setOffer),e.on("answer answer",t.setAnswer),e.emit("question initiator"),n.abrupt("return",e);case 10:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();const Z=function(){var n=null;w&&w.addEventListener("click",(0,o.Z)(r().mark((function t(){var e;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(w.innerHTML="Loading",t.prev=1,console.log(n),null!==n){t.next=14;break}return w.innerHTML="Please allow webcam access",e=new p,t.next=8,v(e);case 8:return t.next=10,y(e);case 10:n=t.sent,w.innerHTML=e.getIsInitiator()?"Connected (wait for another connection)":"Wait you will join someone",t.next=17;break;case 14:n.close(),n=null,w.innerHTML="Join";case 17:t.next=23;break;case 19:t.prev=19,t.t0=t.catch(1),console.log(t.t0),w.innerHTML="Retry";case 23:case"end":return t.stop()}}),t,null,[[1,19]])}))),!1)}},80668:(n,t,e)=>{"use strict";e.d(t,{Z:()=>r});var o=e(23645),i=e.n(o)()((function(n){return n[1]}));i.push([n.id,"#labo {\n  position: relative;\n  width: 100%;\n  height: auto;\n  background-color: #222;\n  text-align: center;\n}\nvideo {\n  width: 50%;\n}\n.flex {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n#status {\n  width: 80%;\n  color: #fff;\n  margin: 0 auto;\n  padding: 1em;\n}\n#btn {\n  background: #fff;\n  width: 80%;\n  margin: 0 auto;\n  padding: 1em;\n  text-transform: uppercase;\n  letter-spacing: 0.2em;\n}\n",""]);const r=i},58929:()=>{},32439:()=>{}}]);