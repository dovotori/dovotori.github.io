"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[7455,3909],{83909:(t,e,i)=>{i.r(e),i.d(e,{default:()=>F});var s=i(88601),n=i(4942),r="DASH",o="SLASH",a="JUMP_LOAD";const u={id:"heros",x:4,y:5,z:.1,w:.5,h:1,life:100,displayLife:!0,physics:{run:.1,jump:.6,aircontrol:.05,dash:2,gravity:.05,damping:{x:.8,y:.8},clamp:{x:.4,y:.5}},states:{STAND:"STAND",RUN:"RUN",JUMP_UP:"JUMP_UP",JUMP_DOWN:"JUMP_DOWN",DASH:r,AIM:"AIM",RUN_JUMP_UP:"RUN_JUMP_UP",RUN_JUMP_DOWN:"RUN_JUMP_DOWN",DIE:"DIE",SLASH:o,SLASH_2:"SLASH_2",SLASH_3:"SLASH_3",SLOW_DOWN:"SLOW_DOWN",JUMP_LOAD:a,WALL:"WALL",WALL_UP:"WALL_UP",LAND:"LAND"},lockStates:["AIM",o,r,a],combos:{attack:[{key:s.X,cancel:!1,threshold:1e3,sprite:"up"},{key:s.X,cancel:!1,threshold:1e3,sprite:"down"},{key:s.X,cancel:!1,sprite:"run"}]}};var l,c=u.states,h=c.STAND,f=c.RUN,p=c.JUMP_UP,v=c.JUMP_DOWN,d=c.DASH,y=c.AIM,g=c.RUN_JUMP_UP,x=c.RUN_JUMP_DOWN,m=c.DIE,Z=c.SLASH,k=c.SLASH_2,w=c.SLASH_3,S=c.WALL,b=c.WALL_UP,P=c.LAND,A=c.JUMP_LOAD,B=c.SLOW_DOWN;const R=(l={size:{w:256,h:512},time:100,refSize:57},(0,n.Z)(l,h,{uv:[{x:28,y:239,w:26,h:57,t:1e3},{x:0,y:239,w:28,h:57,t:1e3}]}),(0,n.Z)(l,f,{uv:[{x:39,y:80,w:40,h:47},{x:106,y:34,w:40,h:45},{x:0,y:80,w:39,h:47},{x:79,y:80,w:39,h:47}]}),(0,n.Z)(l,d,{uv:[{x:84,y:0,w:99,h:28,px:90,py:0},{x:146,y:34,w:100,h:46,px:90,py:0}],iteration:1,next:h}),(0,n.Z)(l,A,{uv:[{x:0,y:34,w:50,h:37}]}),(0,n.Z)(l,p,{uv:[{x:199,y:128,w:44,h:55},{x:99,y:183,w:44,h:56}]}),(0,n.Z)(l,v,{uv:[{x:173,y:239,w:33,h:64},{x:206,y:239,w:34,h:64}]}),(0,n.Z)(l,g,{uv:[{x:118,y:128,w:39,h:52},{x:157,y:128,w:42,h:52}]}),(0,n.Z)(l,x,{uv:[{x:186,y:183,w:42,h:56},{x:143,y:183,w:43,h:56}]}),(0,n.Z)(l,B,{uv:[{x:83,y:239,w:61,h:58}]}),(0,n.Z)(l,y,{uv:[{x:83,y:239,w:61,h:58,cx:57,cy:41}]}),(0,n.Z)(l,P,{uv:[{x:183,y:0,w:45,h:34}]}),(0,n.Z)(l,S,{uv:[{x:54,y:239,w:29,h:58}]}),(0,n.Z)(l,b,{uv:[{x:144,y:239,w:29,h:58}]}),(0,n.Z)(l,m,{uv:[{x:50,y:34,w:56,h:40,t:1e3},{x:0,y:0,w:84,h:18,t:1e3}],iteration:1}),(0,n.Z)(l,Z,{uv:[{x:0,y:303,w:57,h:75,t:50,px:24},{x:57,y:303,w:118,h:95,t:50,px:31},{x:0,y:128,w:72,h:48,t:100,px:43}],iteration:1,next:h}),(0,n.Z)(l,k,{uv:[{x:118,y:80,w:78,h:48},{x:0,y:183,w:99,h:55}],iteration:1,next:h}),(0,n.Z)(l,w,{uv:[{x:72,y:128,w:46,h:51},{x:175,y:303,w:79,h:106}],iteration:1,next:h}),l);const O={id:"bullet",x:0,y:0,z:.4,w:.5,h:.5,damage:10,physics:{speed:.5,recoil:.1},states:{BULLET_LOAD:"BULLET_LOAD",BULLET:"BULLET"}};var C,D=O.states,L=D.BULLET,T=D.BULLET_LOAD;const M=(C={size:{w:64,h:256},time:100,refSize:57},(0,n.Z)(C,L,{uv:[{x:0,y:0,w:35,h:17},{x:0,y:17,w:49,h:32}]}),(0,n.Z)(C,T,{uv:[{x:0,y:49,w:54,h:54,px:0,py:27},{x:0,y:103,w:38,h:39,px:0,py:19}]}),C);const j={id:"fx",states:{DUST:"DUST"}};var z=j.states.DUST;const X=(0,n.Z)({size:{w:32,h:64},time:200,refSize:57},z,{uv:[{x:0,y:0,w:26,h:19},{x:0,y:19,w:26,h:14},{x:0,y:33,w:29,h:12}],iteration:1});const E={id:"monster",x:10,y:4,z:.2,w:.5,h:1,life:100,physics:{run:.1,jump:0,gravity:.05,damping:{x:0,y:0},clamp:{x:1,y:1}},states:{STAND:"STAND",RUN:"RUN",JUMP_DOWN:"JUMP_DOWN",DIE:"DIE"}};var U,I=E.states,N=I.STAND,_=I.RUN,W=I.JUMP_DOWN,Y=I.DIE;const H=(U={size:{w:256,h:512},time:100,refSize:57},(0,n.Z)(U,N,{uv:[{x:28,y:239,w:26,h:57,t:1e3},{x:0,y:239,w:28,h:57,t:1e3}]}),(0,n.Z)(U,_,{uv:[{x:39,y:80,w:40,h:47},{x:106,y:34,w:40,h:45},{x:0,y:80,w:39,h:47},{x:79,y:80,w:39,h:47}]}),(0,n.Z)(U,W,{uv:[{x:173,y:239,w:33,h:64},{x:206,y:239,w:34,h:64}]}),(0,n.Z)(U,Y,{uv:[{x:50,y:34,w:56,h:40},{x:0,y:0,w:84,h:18}],iteration:1}),U);var J;const V=(J={size:{w:256,h:256},refSize:64,objTypes:{CUBE:0,FLAT:1},colors:{"000":{pattern:9,objType:1},150150150:{pattern:10,objType:1},"00255":{pattern:10,objType:1,z:-1},25500:{pattern:10,objType:1},"02500":{pattern:10,objType:1},"02550":{pattern:12,objType:1,scale:{x:2,y:2},z:-.4},"02000":{pattern:13,objType:1,z:1},"01500":{pattern:14,objType:1,scale:{x:1.5,y:1.5},z:-.5},"01000":{pattern:15,objType:1},1e4:{pattern:0,scale:{x:2,y:2},objType:1}}},(0,n.Z)(J,0,{uv:[{x:166,y:26,w:52,h:52}]}),(0,n.Z)(J,1,{uv:[{x:57,y:0,w:52,h:26}]}),(0,n.Z)(J,2,{uv:[{x:109,y:0,w:52,h:26}]}),(0,n.Z)(J,3,{uv:[{x:0,y:0,w:57,h:16}]}),(0,n.Z)(J,4,{uv:[{x:0,y:78,w:52,h:52}]}),(0,n.Z)(J,5,{uv:[{x:0,y:26,w:57,h:27}]}),(0,n.Z)(J,6,{uv:[{x:161,y:0,w:52,h:26}]}),(0,n.Z)(J,7,{uv:[{x:52,y:78,w:52,h:52}]}),(0,n.Z)(J,8,{uv:[{x:104,y:78,w:45,h:52}]}),(0,n.Z)(J,9,{uv:[{x:38,y:187,w:64,h:64}]}),(0,n.Z)(J,10,{uv:[{x:102,y:187,w:64,h:64}]}),(0,n.Z)(J,11,{uv:[{x:166,y:187,w:64,h:64}]}),(0,n.Z)(J,12,{uv:[{x:14,y:131,w:40,h:54}]}),(0,n.Z)(J,13,{uv:[{x:91,y:131,w:45,h:54}]}),(0,n.Z)(J,14,{uv:[{x:173,y:131,w:44,h:56}]}),(0,n.Z)(J,15,{uv:[{x:0,y:187,w:38,h:56}]}),(0,n.Z)(J,16,{uv:[{x:136,y:131,w:37,h:54}]}),(0,n.Z)(J,17,{uv:[{x:124,y:26,w:42,h:51}]}),(0,n.Z)(J,18,{uv:[{x:149,y:78,w:28,h:52}]}),(0,n.Z)(J,19,{uv:[{x:84,y:26,w:40,h:50}]}),(0,n.Z)(J,20,{uv:[{x:0,y:131,w:14,h:53}]}),(0,n.Z)(J,21,{uv:[{x:57,y:26,w:27,h:50}]}),(0,n.Z)(J,22,{uv:[{x:54,y:131,w:37,h:54}]}),(0,n.Z)(J,23,{uv:[{x:177,y:78,w:44,h:53}]}),J),F={slug:"game",assets:["/textures/heros.png","/textures/fx.png","/textures/bullet.png","/textures/level1.png","/textures/rocks.png","/textures/ground.png","/textures/clouds.png","/obj/tile.obj","/obj/cube.obj","/obj/cubeTile.obj","/levels/level3.bmp"],shaders:["/camera/color.js","/camera/sprite.js","/camera/spritePhong.js","/camera/albedoPhong.js","/camera/background.js","/screen/fxaa.js","/screen/rgb.js","/screen/wave.js","/screen/blurDirection.js","/screen/pixel.js","/screen/screen.js","/screen/debug.js"],postprocess:!0,camera:{position:{x:10,y:10,z:22},target:{x:10,y:10,z:0},near:1,far:1e3,angle:40},lampes:[{type:0,position:{x:0,y:0,z:0},ambiant:[1,1,1],diffuse:[1,.9,.9],specular:[0,0,0],strength:1,brillance:200}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},keyboard:{UP:s.UP,DOWN:s.WV,LEFT:s.RL,RIGHT:s.pX,SPACE:s.L_,SHIFT:s.JU,X:s.X,W:s.W,ENTER:s.K5,ECHAP:s.sC},useDepthTexture:!1,splashscreen:!1,canvas:{width:1024,height:1024},game:{types:{heros:{constants:u,sprites:R,fxs:{constants:j,sprites:X},bullets:{constants:O,sprites:M}},monster:{constants:E,sprites:H}},levels:[{name:"level 1",tilemap:{texture:"level3",tileSize:{w:1,h:1},viewBox:{w:20,h:10},sprites:V},interactives:{heros:{type:"heros",x:4,y:5,z:.1},"monster-1":{type:"monster",x:10,y:4,z:.2}}}]}}},17455:(t,e,i)=>{i.r(e),i.d(e,{default:()=>Ft,destroy:()=>Gt});var s=i(15861),n=i(64687),r=i.n(n),o=i(35466),a=i(45987),u=i(15671),l=i(43144),c=i(97326),h=i(11752),f=i(60136),p=i(82963),v=i(61120),d=i(4942),y=i(25192),g=i(47313),x=i(42982),m=i(93324),Z=function(){function t(){(0,u.Z)(this,t),this.value=null,this.isMin=!1,this.ownerId=null}return(0,l.Z)(t,[{key:"setup",value:function(t,e){this.isMin=t,this.ownerId=e}},{key:"set",value:function(t){this.value=t}},{key:"get",value:function(){return this.value}},{key:"getID",value:function(){return this.ownerId}},{key:"isMinimum",value:function(){return this.isMin}}]),t}();const k=function(){function t(){(0,u.Z)(this,t),this.listesAxe=Array(3),this.resetPairesAxes()}return(0,l.Z)(t,[{key:"resetPairesAxes",value:function(){for(var t=0;t<this.listesAxe.length;t+=1)this.listesAxe[t]=[]}},{key:"addPaireOnAxe",value:function(t,e){for(var i=!1,s=0;s<this.listesAxe[e].length;s+=1)if(t[0]===this.listesAxe[e][s][0]&&t[1]===this.listesAxe[e][s][1]||t[1]===this.listesAxe[e][s][0]&&t[0]===this.listesAxe[e][s][1]){i=!0;break}i||this.listesAxe[e].push(t)}},{key:"getPaires",value:function(e,i,s){var n=null;e&&(n=(0,m.Z)(this.listesAxe,1)[0],i&&(n=t.compareListes(n,this.listesAxe[1]),s&&(n=t.compareListes(n,this.listesAxe[2]))));return n}}],[{key:"compareListes",value:function(t,e){for(var i=[],s=0;s<t.length;s+=1)for(var n=0;n<e.length;n+=1)(t[s][0]===e[n][0]&&t[s][1]===e[n][1]||t[s][1]===e[n][0]&&t[s][0]===e[n][1])&&i.push([t[s][0],t[s][1]]);return i}}]),t}();const w=function(){function t(){(0,u.Z)(this,t),this.listeAxe=Array(3),this.listeAxe[0]=[],this.listeAxe[1]=[],this.listeAxe[2]=[],this.pm=new k,this.cptEndpointPlace=0,this.endpointAplacer=null,this.activeList=[]}return(0,l.Z)(t,[{key:"setup",value:function(t){this.addBoxes(t)}},{key:"addBoxes",value:function(e){for(var i=[],s=[],n=0;n<e.length;n+=1)i=t.addEndpointDecroissant(i,e[n].getMin(0),e[n].getMax(0)),s=t.addEndpointDecroissant(s,e[n].getMin(1),e[n].getMax(1));var r=0;this.addEndPointsOnListe(r,i),r+=1,this.addEndPointsOnListe(r,s)}},{key:"addEndPointsOnListe",value:function(t,e){var i=new Z;i.set(9999);for(var s=0;s<e.length;s+=1)this.listeAxe[t].push(i);this.cptEndpointPlace=0,this.endpointAplacer=e[this.cptEndpointPlace],this.activeList=[];for(var n=this.listeAxe[t].length-1;n>=0;n-=1)this.loopTri(t,e,n),this.loopCheckCollision(t,n)}},{key:"loopTri",value:function(t,e,i){if(this.cptEndpointPlace<e.length){var s=this.listeAxe[t][i-(e.length-this.cptEndpointPlace)];s?this.endpointAplacer.get()>s.get()?(this.listeAxe[t][i]=this.endpointAplacer,this.cptEndpointPlace+=1,this.endpointAplacer=e[this.cptEndpointPlace]):this.listeAxe[t][i]=s:(this.listeAxe[t][i]=this.endpointAplacer,this.cptEndpointPlace+=1,this.endpointAplacer=e[this.cptEndpointPlace])}}},{key:"loopCheckCollision",value:function(t,e){var i=this.listeAxe[t][e].getID();if(this.listeAxe[t][e].isMinimum()){for(var s=0;s<this.activeList.length;s+=1)if(this.activeList[s]===i){this.activeList.splice(s,1);break}}else{for(var n=0;n<this.activeList.length;n+=1)this.pm.addPaireOnAxe([this.activeList[n],i],t);this.activeList.push(i)}}},{key:"update",value:function(t,e,i){this.pm.resetPairesAxes(),this.activeList=[],t&&this.updateAxe(0),e&&this.updateAxe(1),i&&this.updateAxe(2)}},{key:"updateAxe",value:function(t){this.listeAxe[t].sort((function(t,e){return t.value<e.value?-1:1}));for(var e=this.listeAxe[0].length-1;e>=0;e-=1)this.loopCheckCollision(t,e)}},{key:"getPaires",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.update(t,e,i),this.pm.getPaires(t,e,i)}},{key:"removeBox",value:function(t){this.listeAxe=this.listeAxe.map((function(e){return e.filter((function(e){return e.ownerId!==t}))}))}},{key:"clear",value:function(){this.listeAxe[0]=[],this.listeAxe[1]=[],this.listeAxe[2]=[]}}],[{key:"addEndpointDecroissant",value:function(t,e,i){var s=t,n=new Z;n.set(-9999),t.push(n),t.push(n);for(var r=e,o=0,a=t.length-1;a>=0;a-=1){var u=t[a-(2-o)];if(u?u.get()>r.get()?(s[a]=r,o+=1,r=i):s[a]=u:(s[a]=r,o+=1,r=i),2===o)break}return s}}]),t}();const S=function(){function t(e){var i=this;(0,u.Z)(this,t),(0,d.Z)(this,"addBoxes",(function(t){i.collision.addBoxes(t)})),(0,d.Z)(this,"clear",(function(){i.collision.clear()})),(0,d.Z)(this,"removeBox",(function(t){i.collision.removeBox(t)})),this.collision=new w,this.collision.addBoxes(e)}return(0,l.Z)(t,[{key:"get",value:function(){return this.collision.getPaires().reduce((function(t,e){var i="SIMPLE";e.sort();var s=e[0],n=e[1],r=null,o=-1!==s.indexOf("bullet"),a=-1!==n.indexOf("bullet");if(o&&a)return t;if(o){i="SHOOT",r=s;var u=s.split("-")[0];s=n,n=u}else if(a){i="SHOOT",r=n;var l=n.split("-");n=(0,m.Z)(l,1)[0]}return"SHOOT"===i&&s===n?t:[].concat((0,x.Z)(t),[{type:i,from:n,on:s,bulletId:r}])}),[])}}]),t}();var b=i(21969),P=function(){function t(){(0,u.Z)(this,t),this.model=new b.Z,this.model.identity(),this.selected=!1}return(0,l.Z)(t,[{key:"setProgram",value:function(t){t.setMatrix("model",this.model.get())}},{key:"setProgramSpecifics",value:function(t){t.setInt("selected",this.selected),t.setVector("color",[1,1,1,1])}},{key:"render",value:function(t,e){this.setProgram(e),this.setProgramSpecifics(e),t.enable(e.get()),t.render(e.get())}},{key:"renderColor",value:function(t,e){this.setProgram(e),e.setInt("selected",this.selected),e.setVector("color",[1,1,1,1]),t.enable(e.get()),t.render(e.get())}},{key:"update",value:function(){this.model.identity()}},{key:"setDraggingInfos",value:function(t){this.angle.x.addToSpeed(.1*t.relPrevious.x),this.angle.y.addToSpeed(-.1*t.relPrevious.y)}},{key:"setSelected",value:function(t){this.selected=255===t[0]&&255===t[1]&&255===t[2],this.size.set(this.selected?1.1:1)}},{key:"setLightPos",value:function(t){this.lightPos=t}},{key:"reset",value:function(){this.model.identity()}},{key:"setRotate",value:function(t,e,i,s){this.model.rotate(t,e,i,s)}},{key:"setTranslate",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.model.translate(t,e,i)}},{key:"setScale",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.model.scale(t,e,i)}}]),t}();function A(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var B=function(t){(0,f.Z)(i,t);var e=A(i);function i(){var t;return(0,u.Z)(this,i),(t=e.call(this)).color=[255,255,255,1],t}return(0,l.Z)(i,[{key:"render",value:function(t,e){this.setProgram(e),e.setInt("selected",this.selected),e.setVector("color",[this.color[0]/255,this.color[1]/255,this.color[2]/255,this.color[3]]),t.enable(e.get()),t.render(e.get())}},{key:"setColor",value:function(t,e,i,s){this.color=[t,e,i,s]}}]),i}(P),R=i(68763),O=function(){function t(e,i){(0,u.Z)(this,t),this.screen=new B,this.cpt=0,this.mountains=new Array(4);for(var s=0;s<this.mountains.length;s+=1)this.mountains[s]=new B;this.clouds=new Array(4),this.cloudData=[],this.viewBox=e,this.levelSize=i;for(var n=0;n<this.clouds.length;n+=1)this.clouds[n]=new B,this.cloudData[n]=this.setCloud()}return(0,l.Z)(t,[{key:"update",value:function(t){this.updateMountains(t),this.updateClouds(t)}},{key:"updateScreens",value:function(t){this.screen.update(),this.screen.setScale(20,10,0),this.screen.setTranslate(0,10,t)}},{key:"updateMountains",value:function(t){var e=this;this.mountains.forEach((function(i,s){var n=e.mountains.length-s,r=(0,R.Yp)(s,0,e.mountains.length,4,40),o=(0,R.Yp)(t[0],0,e.levelSize.w,e.viewBox.w+10*n,10*-n),a=10+r/2,u=(0,R.Yp)(s,0,e.mountains.length,255,100),l=(0,R.Yp)(s,0,e.mountains.length,-2,-20);i.update(),i.setScale(r,r,r),i.setRotate(45,0,0,1),i.setTranslate(o,a,l),i.setColor(u,u,u,1)}))}},{key:"updateClouds",value:function(){var t=this;this.clouds.forEach((function(e,i){var s=t.cloudData[i].scale;t.cloudData[i].x<-s?t.cloudData[i]=t.setCloud(t.viewBox.w+s):t.cloudData[i].x-=t.cloudData[i].speed,e.update(),e.setScale(s,s,s),e.setRotate(45,0,0,1),e.setTranslate(t.cloudData[i].x,t.cloudData[i].y,t.cloudData[i].z),e.setColor(255,255,255,.4)}))}},{key:"renderScreen",value:function(t,e,i,s){e.setFloat("offset",i*s),this.screen.render(t,e)}},{key:"renderMountains",value:function(t,e){this.mountains.forEach((function(i){return i.render(t,e)}))}},{key:"renderCloudsFront",value:function(t,e){var i=this;this.clouds.forEach((function(s,n){i.cloudData[n].z>0&&s.render(t,e)}))}},{key:"renderCloudsBack",value:function(t,e){var i=this;this.clouds.forEach((function(s,n){i.cloudData[n].z<0&&s.render(t,e)}))}},{key:"setCloud",value:function(t){return{x:t||10*Math.random(),y:(0,R.Yp)(Math.random(),0,1,0,this.levelSize.h),z:10*(0,R.Yp)(Math.random(),0,1,-4,2),scale:1+2*Math.random(),speed:.1+.1*Math.random()}}}]),t}(),C=function(){function t(e){var i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,u.Z)(this,t),(0,d.Z)(this,"reset",(function(){i.sprite={uv:{x:0,y:0,w:1,h:1},size:{w:1,h:1}},i.step=0})),this.states=e,this.step=0,this.oldStep=this.step,this.nbSteps=1,this.timeout=this.states.time,this.lastFrame=null,this.sprite={uv:{x:0,y:0,w:1,h:1},size:{w:1,h:1}},this.uv=null,this.iteration=null,this.nextState=null,this.currentState=null,this.callbackEndOfAnimation=s,this.scale=1}return(0,l.Z)(t,[{key:"set",value:function(t){void 0!==t&&this.currentState!==t&&(this.currentState=t,this.reload(t))}},{key:"reload",value:function(t){var e=this.states[t];this.uv=e.uv,this.setUV(0),this.nbSteps=this.uv.length,1===this.nbSteps?this.lastFrame=null:(this.step=0,this.timeout=this.uv[this.step].t||this.states.time||100,this.iteration=e.iteration||null,this.nextState=e.next,this.lastFrame=(new Date).getTime())}},{key:"update",value:function(){if(this.oldStep=this.step,null!==this.lastFrame){var t=(new Date).getTime();t-this.lastFrame>this.timeout&&(this.step<this.nbSteps-1?this.nexStep():this.endOfLoop(),this.setUV(this.step),this.lastFrame=t)}}},{key:"nexStep",value:function(){this.step+=1,this.timeout=this.uv[this.step].t||this.states.time||100}},{key:"endOfLoop",value:function(){1===this.iteration?(this.callbackEndOfAnimation&&this.callbackEndOfAnimation(this.currentState,this.nextState),null!==this.nextState||void 0!==this.nextState?this.set(this.nextState):this.lastFrame=null):this.step=0}},{key:"get",value:function(){return{x:this.sprite.uv.x,y:this.sprite.uv.y,texW:this.states.size.w,texH:this.states.size.h,w:this.sprite.uv.w,h:this.sprite.uv.h,px:this.sprite.uv.px||-1,py:this.sprite.uv.py||-1,refSize:this.states.refSize}}},{key:"setUV",value:function(t){this.sprite.uv={x:this.uv[t].x||0,y:this.uv[t].y||0,w:this.uv[t].w||1,h:this.uv[t].h||1,px:this.uv[t].px,py:this.uv[t].py}}},{key:"getStatus",value:function(){return this.currentState}},{key:"getStep",value:function(){return this.step}},{key:"isNewStep",value:function(){return this.step!==this.oldStep}},{key:"getRelSize",value:function(){var t=this.states.refSize,e=this.sprite.uv,i=e.w/t,s=e.h/t,n=void 0!==e.px?-e.px/t:null,r=void 0!==e.py?-e.py/t:null;return{w:i*=this.scale,h:s*=this.scale,px:n=null!==n?n*this.scale:null,py:r=null!==r?r*this.scale:null}}},{key:"setScale",value:function(t){this.scale=t}},{key:"getScale",value:function(){return this.scale}},{key:"getState",value:function(){return this.currentState}}]),t}(),D=i(79475);function L(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var T=function(t){(0,f.Z)(i,t);var e=L(i);function i(){var t;return(0,u.Z)(this,i),(t=e.call(this)).normalMatrix=new D.Z,t}return(0,l.Z)(i,[{key:"setNormalMatrix",value:function(t){this.normalMatrix.equal(this.model.getMatrice3x3()),this.normalMatrix.inverse(),this.normalMatrix.transpose(),t.setMatrix("normalMatrix",this.normalMatrix.get())}}]),i}(P);function M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var j=function(t){(0,f.Z)(i,t);var e=M(i);function i(){var t;return(0,u.Z)(this,i),(t=e.call(this)).sprite={x:0,y:0,texW:1,texH:1,w:1,h:1},t}return(0,l.Z)(i,[{key:"setProgramSpecifics",value:function(t){t.setVector("spriteUV",[this.sprite.x,this.sprite.y]),t.setVector("spriteGrid",[this.sprite.texW,this.sprite.texH]),t.setVector("spriteSize",[this.sprite.w,this.sprite.h]),t.setFloat("spriteRefSize",this.sprite.refSize)}},{key:"setSprite",value:function(t){this.sprite=t}}]),i}(T);function z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var X=function(t){(0,f.Z)(i,t);var e=z(i);function i(t){var s;return(0,u.Z)(this,i),(s=e.call(this)).state=new C(t),s.state.set(t.colors["000"].pattern),s}return(0,l.Z)(i,[{key:"render",value:function(t,e,s){e.setTexture(0,s.get(),"textureMap"),this.setSprite(this.state.get()),(0,h.Z)((0,v.Z)(i.prototype),"render",this).call(this,t,e)}},{key:"setState",value:function(t){this.state.set(t)}},{key:"getState",value:function(){return this.state.get()}}]),i}(j),E=function(){function t(e,i){(0,u.Z)(this,t),this.context=t.setupContext(e),this.levelSize={w:e.width,h:e.height};var s=i.viewBox;this.viewBox={x:0,y:0,w:s.w||20,h:s.h||20},this.scrollBox={w:this.viewBox.w/2,h:this.viewBox.h/2},this.smoothTilePos={x:0,y:0},this.tile=new X(i.sprites),this.sprites=i.sprites,this.tileSize=i.tileSize,this.map=this.getData()}return(0,l.Z)(t,[{key:"getData",value:function(){return this.context.getImageData(this.viewBox.x,this.viewBox.y,this.viewBox.w,this.viewBox.h)}},{key:"update",value:function(t){this.tile.setNormalMatrix(t)}},{key:"render",value:function(t,e,i,s){for(var n=0;n<this.map.height;n+=1)for(var r=0;r<this.map.width;r+=1){var o=n*this.map.width+r,a=this.map.data[4*o],u=this.map.data[4*o+1],l=this.map.data[4*o+2],c="".concat(a).concat(u).concat(l);if(this.tile.reset(),this.sprites.colors[c]){var h={x:r-this.smoothTilePos.x,y:n-this.smoothTilePos.y},f=this.sprites.colors[c],p=f.objType,v=f.pattern,d=f.scale,y=f.z;if(this.tile.setState(v),d){var g=this.tile.getState(),x=g.w,m=g.refSize;this.tile.setScale(d.x,d.y,1);var Z=x/m*d.x;this.tile.setTranslate(h.x-.5*(Z-1),h.y-(1-d.y),y||0)}else this.tile.setTranslate(h.x,h.y,y||0);this.tile.render(0===p?i:s,t,e)}}}},{key:"follow",value:function(t){var e=t[0]-this.scrollBox.w;e<0&&(e=0),e>this.levelSize.w-this.viewBox.w&&(e=this.levelSize.w-this.viewBox.w);var i=t[1]-this.scrollBox.h;i<0&&(i=0),i>this.levelSize.h-this.viewBox.h&&(i=this.levelSize.h-this.viewBox.h),this.viewBox.x===e&&this.viewBox.y===i||(this.viewBox.x=e,this.viewBox.y=i,this.map=this.getData(),this.smoothTilePos.x=e-Math.floor(e),this.smoothTilePos.y=i-Math.floor(i))}},{key:"getViewBox",value:function(){return this.viewBox}},{key:"getLevelSize",value:function(){return this.levelSize}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"get",value:function(){return this.context}},{key:"getSmoothTilePos",value:function(){return this.smoothTilePos}}],[{key:"setupContext",value:function(t){var e=document.createElement("canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i}}]),t}();const U=E;function I(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var N=function(t){(0,f.Z)(i,t);var e=I(i);function i(){var t;return(0,u.Z)(this,i),(t=e.call(this)).sprite={x:0,y:0,texW:1,texH:1,w:1,h:1},t.tint=[1,1,1],t.inverseColor=!1,t}return(0,l.Z)(i,[{key:"setProgramSpecifics",value:function(t){t.setVector("spriteUV",[this.sprite.x,this.sprite.y]),t.setVector("spriteGrid",[this.sprite.texW,this.sprite.texH]),t.setVector("spriteSize",[this.sprite.w,this.sprite.h]),t.setVector("spritePivot",[this.sprite.px,this.sprite.py]),t.setFloat("spriteRefSize",this.sprite.refSize),t.setVector("tint",this.tint),t.setInt("inverseColor",this.inverseColor?1:0)}},{key:"setTint",value:function(t,e,i){this.tint=[t,e,i]}},{key:"setInverseColor",value:function(t){this.inverseColor=t}},{key:"setSprite",value:function(t){this.sprite=t}}]),i}(P),_=i(25773);function W(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var Y=function(t){(0,f.Z)(i,t);var e=W(i);function i(t){var s,n=t.constants,r=t.sprites,o=t.viewBox;return(0,u.Z)(this,i),s=e.call(this),(0,d.Z)((0,c.Z)(s),"updateState",(function(t,e){s.inverseX=e,s.stateSprite.set(t),s.setSprite(s.stateSprite.get())})),(0,d.Z)((0,c.Z)(s),"setEndOfAnimation",(function(t,e){e&&s.behavior.setEndOfAnimation(e),t===s.constants.states.DIE&&s.callbackDeath&&s.callbackDeath()})),s.inverseX=!1,s.stateSprite=new C(r,s.setEndOfAnimation),s.viewBox=o,s.constants=n,s.sprites=r,s.worldPos=new _.Z,s.reset(),s}return(0,l.Z)(i,[{key:"update",value:function(t,e){(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this),this.stateSprite.update(),this.behavior.update(t,e)}},{key:"render",value:function(t,e,s){var n=this.stateSprite.getRelSize(),r=n.w,o=n.h,a=n.px,u=n.py,l=0;null!==a&&(l=this.inverseX?-r-a:r-(r-a)),this.setScale(r,o,1),this.setTranslate(this.behavior.getX()-this.viewBox.x+l,this.behavior.getY()-this.viewBox.y-(1-o)+(u||0),this.behavior.getZ()),t.setTexture(0,e.get(),"textureMap"),t.setInt("inverseX",this.inverseX?1:0),(0,h.Z)((0,v.Z)(i.prototype),"render",this).call(this,s,t),this.setSprite(this.stateSprite.get())}},{key:"addToSpeed",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.behavior.addToSpeed(new _.Z(t,e,i))}},{key:"getX",value:function(){return this.behavior.getPosition().getX()}},{key:"getPosition",value:function(){return this.behavior.getPosition().get()}},{key:"getWorldPosition",value:function(){return this.worldPos.set(this.behavior.getX()-this.viewBox.x,this.behavior.getY()-this.viewBox.y,this.behavior.getZ()).get()}},{key:"getInverseX",value:function(){return this.inverseX}},{key:"getStatus",value:function(){return this.behavior.getStatus()}},{key:"isStatusChanged",value:function(){return this.behavior.isStatusChanged()}},{key:"getConstants",value:function(){return this.constants}},{key:"reset",value:function(){this.stateSprite.reset(),this.stateSprite.set(this.constants.states[Object.keys(this.constants.states)[0]]),this.setSprite(this.stateSprite.get())}}]),i}(N),H=function(){function t(){(0,u.Z)(this,t),this.min=Array(3),this.max=Array(3),this.id=0}return(0,l.Z)(t,[{key:"setup",value:function(t){this.id=t;for(var e=0;e<3;e+=1)this.min[e]=new Z,this.max[e]=new Z,this.min[e].setup(!0,this.id),this.max[e].setup(!1,this.id)}},{key:"update",value:function(t,e,i,s,n){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.setMinMax(t,e,i,t+s,e+n,i+r)}},{key:"setMinMax",value:function(t,e,i,s,n,r){this.min[0].set(t),this.min[1].set(e),this.min[2].set(i),this.max[0].set(s),this.max[1].set(n),this.max[2].set(r)}},{key:"getID",value:function(){return this.id}},{key:"getMinMax",value:function(t,e){return t?this.min[e].get():this.max[e].get()}},{key:"getMin",value:function(t){return this.min[t]}},{key:"getMax",value:function(t){return this.max[t]}}]),t}();function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var V=function(t){(0,f.Z)(i,t);var e=J(i);function i(t){var s,n=t.constants,r=t.sprites,o=t.viewBox;return(0,u.Z)(this,i),(s=e.call(this,{constants:n,sprites:r,viewBox:o})).collisionBox=new H,s.collisionBox.setup(n.id),s.collisionCallback=null,s}return(0,l.Z)(i,[{key:"update",value:function(t,e){var s;(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t,e),(s=this.collisionBox).update.apply(s,(0,x.Z)(this.getCollisionInfos()))}},{key:"getCollisionBox",value:function(){return this.collisionBox}},{key:"getCollisionInfos",value:function(){var t=this.constants,e=t.w,i=t.h;return[].concat((0,x.Z)(this.getPosition()),[e,i])}},{key:"getId",value:function(){return this.constants.id}},{key:"setCallbacks",value:function(t){var e=t.addBoxes,i=t.removeBox;this.collisionCallback={addBoxes:e,removeBox:i}}}]),i}(Y);function F(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var G=function(t){(0,f.Z)(i,t);var e=F(i);function i(t){var s,n=t.constants,r=t.sprites,o=t.viewBox;return(0,u.Z)(this,i),s=e.call(this,{constants:n,sprites:r,viewBox:o}),(0,d.Z)((0,c.Z)(s),"setCallbackDeath",(function(t){s.callbackDeath=t})),(0,d.Z)((0,c.Z)(s),"setLife",(function(t){s.life=t,s.bar.setAttribute("value",s.life)})),(0,d.Z)((0,c.Z)(s),"setDamage",(function(t){s.life-=t,s.targetDamage.setDirect(2),s.bar&&s.bar.setAttribute("value",s.life),s.life<=0&&(s.behavior.setStatus(s.constants.states.DIE),s.stateSprite.set(s.constants.states.DIE),s.collisionCallback.removeBox(s.constants.id))})),(0,d.Z)((0,c.Z)(s),"insert",(function(t){t&&t.appendChild(s.bar)})),s.life=n.life,s.callbackDeath=null,s.targetDamage=new g.Z(0,.1),n.displayLife&&(s.bar=document.createElement("meter"),s.bar.setAttribute("data-id",n.id),s.bar.setAttribute("min",0),s.bar.setAttribute("max",n.life),s.bar.setAttribute("value",s.life),s.insert(document.querySelector("#gameinfos"))),s}return(0,l.Z)(i,[{key:"update",value:function(t,e){var s;(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t,e),(s=this.collisionBox).update.apply(s,(0,x.Z)(this.getCollisionInfos())),this.targetDamage.update()}},{key:"render",value:function(t,e,s){t.setFloat("damage",this.targetDamage.get()),(0,h.Z)((0,v.Z)(i.prototype),"render",this).call(this,t,e,s)}},{key:"getLife",value:function(){return this.life}},{key:"reset",value:function(){(0,h.Z)((0,v.Z)(i.prototype),"reset",this).call(this),this.life=this.constants.life,this.bar&&this.bar.setAttribute("value",this.life)}}]),i}(V);function q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var K=function(t){(0,f.Z)(i,t);var e=q(i);function i(t,s,n,r,o,a){var l;return(0,u.Z)(this,i),(l=e.call(this)).inverseX=!1,l.stateSprite=new C(s,a),l.stateSprite.set(t.states[Object.keys(t.states)[0]]),l.viewBox=n,l.constants=t,l.sprites=s,l.position=new _.Z(r.getX()||t.x||0,r.getY()||t.y||0,r.getZ()||t.z||0),l.stateSprite.reload(o),l}return(0,l.Z)(i,[{key:"update",value:function(t){(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t),this.stateSprite.update()}},{key:"render",value:function(t,e,s){var n=this.stateSprite.getRelSize(),r=n.w,o=n.h,a=n.px,u=n.py,l=0;null!==a&&(l=this.inverseX?-r-a:r-(r-a)),this.setScale(r,o,1),this.setTranslate(this.position.getX()-this.viewBox.x+l,this.position.getY()-this.viewBox.y-(1-o)+(u||0),this.position.getZ()),t.setTexture(0,e.get(),"textureMap"),t.setInt("inverseX",this.inverseX?1:0),(0,h.Z)((0,v.Z)(i.prototype),"render",this).call(this,s,t),this.setSprite(this.stateSprite.get())}},{key:"setInverseX",value:function(t){this.inverseX=t}}]),i}(N),Q=function(){function t(e,i,s){var n=this;(0,u.Z)(this,t),(0,d.Z)(this,"endOfAnimation",(function(t){return function(){delete n.fxs[t]}})),this.fxs={},this.isAiming=!1,this.viewBox=s,this.sprites=i,this.constants=e,this.cpt=0}return(0,l.Z)(t,[{key:"update",value:function(){var t=this;Object.keys(this.fxs).forEach((function(e){t.fxs[e].update()}))}},{key:"createNewOne",value:function(t,e){this.fxs[this.cpt]=new K(this.constants,this.sprites,this.viewBox,t,e,this.endOfAnimation(this.cpt)),this.cpt+=1}},{key:"render",value:function(t,e,i){var s=this;Object.keys(this.fxs).forEach((function(n){s.fxs[n].render(t,e,i)}))}},{key:"getConstants",value:function(){return this.constants}}]),t}();function $(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var tt=function(t){(0,f.Z)(i,t);var e=$(i);function i(t){var s,n=t.constants,r=t.sprites,o=t.viewBox,a=t.fxs;return(0,u.Z)(this,i),s=e.call(this,{constants:n,sprites:r,viewBox:o}),a&&(s.fxs=new Q(a.constants,a.sprites,o)),s}return(0,l.Z)(i,[{key:"update",value:function(t,e){if((0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t,e),this.fxs){this.fxs.update();var s=this.constants.states,n=s.JUMP_UP,r=s.RUN_JUMP_UP,o=this.fxs.getConstants().states.DUST,a=this.getStatus(),u=this.getLastJumpingPosition(),l=this.getLastRunningPosition();!this.isStatusChanged()||a!==n&&a!==r||this.fxs.createNewOne(u,o),null!==l&&this.fxs.createNewOne(l,o)}}},{key:"renderFxs",value:function(t,e,i){this.fxs.render(t,e,i)}},{key:"getLastJumpingPosition",value:function(){return this.behavior.getLastJumpingPosition()}},{key:"getLastRunningPosition",value:function(){return this.behavior.getStatus()!==this.constants.states.RUN||!this.stateSprite.isNewStep()||0!==this.stateSprite.getStep()&&2!==this.stateSprite.getStep()?null:this.behavior.getPosition()}}]),i}(G),et=function(){function t(e,i){var s=this;(0,u.Z)(this,t),(0,d.Z)(this,"shoudContinue",(function(){var t=s.constants.states.DIE;return s.status!==t})),(0,d.Z)(this,"setEndOfAnimation",(function(t){t&&(s.status=t)})),(0,d.Z)(this,"reset",(function(){var t=s.constants,e=t.x,i=t.y,n=t.z,r=t.states;s.position.set(e||0,i||0,n||0),s.status=r[Object.keys(r)[0]],s.speed.set(0,0,0)})),this.constants=e,this.updateState=i,this.position=new _.Z,this.status=null,this.speed=new _.Z,this.size=new _.Z(e.w||1,e.h||1,1),this.inverseSprite=!1,this.statusChanged=!1,this.reset()}return(0,l.Z)(t,[{key:"update",value:function(){var t=this.shoudContinue();if(t){this.statusChanged=!1;var e=this.status;this.defineNextStatus(),this.updateState&&this.updateState(this.status,this.inverseSprite),e!==this.status&&(this.statusChanged=!0)}return t}},{key:"isLock",value:function(){var t=this.constants.lockStates;return t&&-1!==t.indexOf(this.status)}},{key:"defineNextStatus",value:function(){var t=this.constants.states,e=t.JUMP_DOWN,i=t.RUN_JUMP_DOWN;this.isLock()||this.speed.getY()<0&&(this.status=e,Math.abs(this.speed.getX())>0&&(this.status=i))}},{key:"setPosition",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.position.set(t,e,i)}},{key:"setSize",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.size.set(t,e,i)}},{key:"setStatus",value:function(t){this.status=t}},{key:"getPosition",value:function(){return this.position}},{key:"getStatus",value:function(){return this.status}},{key:"getSize",value:function(){return this.size}},{key:"getX",value:function(){return this.position.getX()}},{key:"getY",value:function(){return this.position.getY()}},{key:"getZ",value:function(){return this.position.getZ()}},{key:"getSpeed",value:function(){return this.speed.get()}},{key:"getSpeedX",value:function(){return this.speed.getX()}},{key:"getSpeedY",value:function(){return this.speed.getY()}},{key:"addToSpeed",value:function(t){this.speed.add(t)}},{key:"isStatusChanged",value:function(){return this.statusChanged}}]),t}();function it(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var st=1e-6;const nt=function(t){(0,f.Z)(i,t);var e=it(i);function i(t,s,n){var r;return(0,u.Z)(this,i),(r=e.call(this,t,s)).isCollision={left:!1,right:!1,bottom:!1,top:!1},r.testPoints=r.determineTestPoints(n),r}return(0,l.Z)(i,[{key:"determineTestPoints",value:function(t){var e=this.constants,s=e.w,n=e.h,r=i.determineStep(s,t.w),o=r.value,a=r.step,u=i.determineStep(n,t.h),l=u.value,c=u.step,h=[];h.push({x:st,y:-1e-6});for(var f=1;f<a;f+=1)h.push({x:o*f,y:-1e-6});h.push({x:s-st,y:-1e-6});var p=[];p.push({x:st,y:n+st});for(var v=1;v<a;v+=1)p.push({x:o*v,y:n+st});p.push({x:s-st,y:n+st});var d=[];d.push({x:-1e-6,y:st});for(var y=1;y<c;y+=1)d.push({x:-1e-6,y:l*y});d.push({x:-1e-6,y:n-st});var g=[];g.push({x:s+st,y:st});for(var x=1;x<c;x+=1)g.push({x:s+st,y:l*x});return g.push({x:s+st,y:n-st}),{left:d,right:g,bottom:h,top:p}}},{key:"update",value:function(t,e){var s=(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this);return s&&this.setCollision(t,e),s}},{key:"defineNextStatus",value:function(){(0,h.Z)((0,v.Z)(i.prototype),"defineNextStatus",this).call(this);var t=this.constants.states,e=t.STAND,s=t.RUN;this.isLock()||this.isCollision.bottom&&(this.status=e,Math.abs(this.speed.getX())>0&&(this.status=s))}},{key:"setCollision",value:function(t,e){var i=this;Object.keys(this.isCollision).forEach((function(s){i.setDirectionCollision(t,s,e)})),(this.isCollision.top||this.isCollision.bottom)&&this.speed.setY(0),(this.isCollision.left||this.isCollision.right)&&this.speed.setX(0)}},{key:"setDirectionCollision",value:function(t,e,s){var n=!1,r="left"===e||"right"===e;switch(e){case"bottom":n=this.speed.getY()<0;break;case"top":n=this.speed.getY()>0;break;case"left":n=this.speed.getX()<0;break;case"right":n=this.speed.getX()>0}if(!this.isCollision[e]&&n){for(var o=i.determineStep(r?this.speed.getX():this.speed.getY(),r?s.w:s.h),a=o.value,u=o.step,l=[],c=this.testPoints[e],h=0;h<=u;h+=1)for(var f=0;f<c.length;f+=1){var p=this.position.getX()+c[f].x,v=this.position.getY()+c[f].y;r?p+=a*h:v+=a*h,l.push({x:p,y:v})}var d=i.getNearCollisionPoint(t,l);if(d){var y=this.constants,g=y.w,x=y.h;switch(e){case"bottom":this.position.setY(Math.ceil(d.y));break;case"top":this.position.setY(Math.floor(d.y)-x);break;case"left":this.position.setX(Math.ceil(d.x));break;case"right":this.position.setX(Math.floor(d.x)-g)}this.isCollision[e]=!0}else r?this.position.addX(this.speed.getX()):this.position.addY(this.speed.getY())}else this.isStillCollide(t,e)||(this.isCollision[e]=!1)}},{key:"isStillCollide",value:function(t,e){var s=this,n=this.testPoints[e].map((function(t){return{x:s.position.getX()+t.x,y:s.position.getY()+t.y}}));return null!==i.getNearCollisionPoint(t,n)}},{key:"getCollision",value:function(t){return this.isCollision[t]}},{key:"getCollisionAxeX",value:function(){return this.isCollision.left||this.isCollision.right}}],[{key:"getNearCollisionPoint",value:function(t,e){for(var s=0;s<e.length;s+=1)if(i.isCollisionTile(t,e[s].x,e[s].y))return{x:e[s].x,y:e[s].y};return null}},{key:"isCollisionTile",value:function(t,e,i){var s=t.getImageData(Math.floor(e),Math.floor(i),1,1);return 255!==s.data[0]&&s.data[0]===s.data[1]&&s.data[1]===s.data[2]}},{key:"determineStep",value:function(t,e){for(var i=t,s=1;Math.abs(i)>=e;)i/=2,s+=1;return{value:i,step:s}}}]),i}(et);function rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var ot=function(t){(0,f.Z)(i,t);var e=rt(i);function i(t,s,n,r,o){var a;return(0,u.Z)(this,i),(a=e.call(this,t,s,n)).isAiming=!0,a.goLeft=o,a.position.setX(r.getX()),a.position.setY(r.getY()),a.startPos=r,a}return(0,l.Z)(i,[{key:"update",value:function(t,e){this.isAiming?(this.position.setX(this.startPos.getX()),this.position.setY(this.startPos.getY())):(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t,e)}},{key:"shoot",value:function(){this.isAiming=!1;var t=this.constants.physics.speed;this.speed.setX(this.goLeft?-t:t)}},{key:"setStartPos",value:function(t){this.startPos=t}}]),i}(nt);function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var ut=function(t){(0,f.Z)(i,t);var e=at(i);function i(t){var s,n=t.constants,r=t.sprites,o=t.viewBox,a=t.tileSize,l=t.startPos,c=t.goLeft;return(0,u.Z)(this,i),(s=e.call(this,{constants:n,sprites:r,viewBox:o})).behavior=new ot(n,null,a,l,c),s.inverseX=c,s.startPos=l,s.isShooted=!1,s}return(0,l.Z)(i,[{key:"update",value:function(t,e,s,n){this.isShooted||this.setAimingStrength(n),this.behavior.setStartPos(s),(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t,e)}},{key:"shoot",value:function(t){this.isShooted=!0,this.stateSprite.set(t),this.setAimingStrength(1),this.behavior.shoot()}},{key:"isCollide",value:function(){return this.behavior.getCollisionAxeX()}},{key:"setAimingStrength",value:function(t){this.stateSprite.setScale(t)}}]),i}(V),lt=function(){function t(e,i,s){(0,u.Z)(this,t),this.bullets=[],this.isAiming=!1,this.viewBox=s,this.callbackShoot=null,this.callbackCollide=null,this.sprites=i,this.constants=e,this.recoil=e.physics.recoil,this.numero=0}return(0,l.Z)(t,[{key:"update",value:function(t,e,i,s,n){var r=this;!this.isAiming&&s?this.createNewOne(i,n,e):this.isAiming&&!s&&this.shootOne();var o=[];this.bullets.forEach((function(n,a){n.update(t,e,i,s),n.isCollide()&&(o.push(a),r.callbackCollide&&r.callbackCollide(n.getId()))})),o.length>0&&(this.bullets=this.bullets.filter((function(t,e){return-1===o.indexOf(e)}))),this.isAiming=s}},{key:"createNewOne",value:function(t,e,i){this.bullets.push(new ut({id:"".concat(this.constants.id).concat(this.numero),constants:this.constants,sprites:this.sprites,viewBox:this.viewBox,tileSize:i,startPos:t,goLeft:e})),this.numero+=1}},{key:"shootOne",value:function(){if(this.bullets.length>0){var t=this.bullets[this.bullets.length-1];t.shoot(this.constants.states.BULLET),this.callbackShoot&&this.callbackShoot(t.getId(),t.getCollisionBox(),this.recoil)}}},{key:"removeOne",value:function(t){this.bullets=this.bullets.filter((function(e){return e.getId()!==t}))}},{key:"render",value:function(t,e,i){this.bullets.forEach((function(s){s.render(t,e,i)}))}},{key:"setCallbackShoot",value:function(t){this.callbackShoot=t}},{key:"setCallbackCollide",value:function(t){this.callbackCollide=t}},{key:"get",value:function(){return this.bullets.map((function(t){return t.getPosition()}))}},{key:"getConstants",value:function(){return this.constants}}]),t}();function ct(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function ht(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ct(Object(i),!0).forEach((function(e){(0,d.Z)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ct(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var pt=function(t){(0,f.Z)(i,t);var e=ft(i);function i(t){var s,n=t.constants,r=t.sprites,o=t.viewBox,a=t.fxs,l=t.bullets;if((0,u.Z)(this,i),s=e.call(this,{constants:n,sprites:r,viewBox:o,fxs:a}),(0,d.Z)((0,c.Z)(s),"callbackBulletShoot",(function(t,e,i){s.setRecoil(i),s.collisionCallback.addBoxes([e])})),(0,d.Z)((0,c.Z)(s),"callbackBulletCollide",(function(t){s.collisionCallback.removeBox(t)})),(0,d.Z)((0,c.Z)(s),"setRecoil",(function(t){s.behavior.addToSpeed(new _.Z(s.inverseX?t:-t,0,0))})),(0,d.Z)((0,c.Z)(s),"removeBullet",(function(t){s.bullets.removeOne(t)})),s.offsetAiming=s.getAimingOffsetVector(),s.aimingPos=new _.Z,l){var h="".concat(n.id,"-").concat(l.constants.id);s.bullets=new lt(ht(ht({},l.constants),{},{id:h}),l.sprites,o),s.bullets.setCallbackShoot(s.callbackBulletShoot),s.bullets.setCallbackCollide(s.callbackBulletCollide)}return s}return(0,l.Z)(i,[{key:"update",value:function(t,e){(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t,e),this.aimingPos.equal(this.behavior.getPosition()),this.aimingPos.addX(this.inverseX?this.offsetAiming.invX:this.offsetAiming.x),this.aimingPos.addY(this.offsetAiming.y),this.bullets&&this.bullets.update(t,e,this.aimingPos,this.isAiming(),this.inverseX)}},{key:"renderBullets",value:function(t,e,i){this.bullets.render(t,e,i)}},{key:"getAimingOffsetVector",value:function(){var t=this.sprites.refSize,e=this.sprites[this.constants.states.AIM].uv[0],i=e.w,s=e.cx;return{x:s/t,y:e.cy/t,invX:(i-s)/t}}},{key:"getAimingPos",value:function(){return this.aimingPos}},{key:"getAimingPosition",value:function(){var t=this.stateSprite.getRelSize().h;return new _.Z(this.behavior.getX()-this.viewBox.x+(this.inverseX?this.offsetAiming.invX:this.offsetAiming.x),this.behavior.getY()-this.viewBox.y-t+this.offsetAiming.y,this.behavior.getZ())}},{key:"isAiming",value:function(){return this.behavior.isAiming()}}]),i}(tt);function vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var dt=function(t){(0,f.Z)(i,t);var e=vt(i);function i(){return(0,u.Z)(this,i),e.apply(this,arguments)}return(0,l.Z)(i,[{key:"update",value:function(t,e){var s=(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t,e);return s&&this.updateSpeed(),s}},{key:"updateSpeed",value:function(){this.setDamping(),this.setGravity(),this.setClamping()}},{key:"setGravity",value:function(){var t=this.constants.physics.gravity;this.isCollision.bottom||this.speed.addY(-t)}},{key:"setDamping",value:function(){var t=this.constants.physics.damping;Math.abs(this.speed.getX())>.01?this.speed.multiplyX(t.x):this.speed.setX(0)}},{key:"setClamping",value:function(){var t=this.constants.physics.clamp;this.speed.getX()>t.x&&this.speed.setX(t.x),this.speed.getX()<-t.x&&this.speed.setX(-t.x),this.speed.getY()>t.y&&this.speed.setY(t.y),this.speed.getY()<-t.y&&this.speed.setY(-t.y)}}]),i}(nt);function yt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var gt=function(t){(0,f.Z)(i,t);var e=yt(i);function i(t,s,n){var r;return(0,u.Z)(this,i),(r=e.call(this,t,s,n)).isAnimating=!1,r.aimingStrength=0,r.inverseSprite=!1,r.oldInverseSprite=r.inverseSprite,r.jumpPosition=new _.Z,r}return(0,l.Z)(i,[{key:"defineNextStatus",value:function(){(0,h.Z)((0,v.Z)(i.prototype),"defineNextStatus",this).call(this);var t=this.constants.states,e=t.WALL,s=t.WALL_UP,n=t.JUMP_UP,r=t.RUN_JUMP_UP;this.isLock()||(this.speed.getY()>0&&(this.status=n,Math.abs(this.speed.getX())>0&&(this.status=r)),this.isCollision.bottom?(this.isCollision.left||this.isCollision.right)&&(this.status=e):(this.isCollision.left||this.isCollision.right)&&(this.status=s),this.isCollision.left?this.inverseSprite=!0:this.isCollision.right&&(this.inverseSprite=!1))}},{key:"setInteraction",value:function(t){var e=this.constants,i=e.physics,s=e.states,n=t.keys,r=s.DASH,o=s.AIM,a=s.SLASH,u=s.JUMP_UP,l=s.DIE;if(this.status!==l){this.status===o&&(this.aimingStrength=(0,R.Yp)(t.getCharge(n.W),0,40,.2,1));var c=this.isCollision.bottom?i.run:i.aircontrol;!this.isCollision.right&&t.isPressed(n.RIGHT)&&(this.speed.addX(c),this.inverseSprite=!1),!this.isCollision.left&&t.isPressed(n.LEFT)&&(this.speed.addX(-c),this.inverseSprite=!0),this.isLock()||this.isCollision.bottom&&(t.isPressedOne(n.SPACE)&&(this.jumpPosition.set(this.position.getX(),this.position.getY(),0),this.speed.addY(i.jump),this.status=u,this.isCollision.bottom=!1),t.isPressedOne(n.SHIFT)&&(this.speed.addX(this.inverseSprite?-i.dash:i.dash),this.status=r),t.isPressed(n.W)&&(this.status=o),t.isPressedOne(n.X)&&(this.status=a)),this.resetValues(t)}}},{key:"resetValues",value:function(t){var e=this.constants.states,i=t.keys,s=e.STAND,n=e.AIM;this.status,this.status!==n||t.isPressed(i.W)||(this.aimingStrength=0,this.status=s)}},{key:"getLastJumpingPosition",value:function(){return this.jumpPosition}},{key:"isAiming",value:function(){return this.aimingStrength}},{key:"getDashing",value:function(){var t=this.constants.states.DASH;return this.status===t}}]),i}(dt);function xt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var mt=function(t){(0,f.Z)(i,t);var e=xt(i);function i(t){var s,n=t.constants,r=t.sprites,o=t.viewBox,a=t.tileSize,l=t.bullets,h=t.fxs;return(0,u.Z)(this,i),s=e.call(this,{constants:n,sprites:r,viewBox:o,bullets:l,fxs:h}),(0,d.Z)((0,c.Z)(s),"setInteraction",(function(t){s.behavior.setInteraction(t)})),s.behavior=new gt(n,s.updateState,a),s}return(0,l.Z)(i,[{key:"getDashing",value:function(){return this.behavior.getDashing()}},{key:"reset",value:function(){this.behavior&&this.behavior.reset(),(0,h.Z)((0,v.Z)(i.prototype),"reset",this).call(this)}}]),i}(pt);function Zt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var kt=function(t){(0,f.Z)(i,t);var e=Zt(i);function i(){return(0,u.Z)(this,i),e.apply(this,arguments)}return(0,l.Z)(i,[{key:"updateSpeed",value:function(){(0,h.Z)((0,v.Z)(i.prototype),"updateSpeed",this).call(this),this.isCollision.left?this.inverseSprite=!1:this.isCollision.right&&(this.inverseSprite=!0),this.isCollision.bottom&&this.speed.addX((this.inverseSprite?-1:1)*this.constants.physics.run)}}]),i}(dt);function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var St=function(t){(0,f.Z)(i,t);var e=wt(i);function i(t){var s,n,r=t.constants,o=t.sprites,a=t.viewBox,l=t.tileSize;return(0,u.Z)(this,i),n=e.call(this,{constants:r,sprites:o,viewBox:a}),(0,d.Z)((0,c.Z)(n),"reset",(function(){(0,h.Z)((s=(0,c.Z)(n),(0,v.Z)(i.prototype)),"reset",s).call(s),n.behavior&&n.behavior.reset()})),n.behavior=new kt(r,n.updateState,l),n.setInverseColor(!0),n}return(0,l.Z)(i)}(G);function bt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Pt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(i),!0).forEach((function(e){(0,d.Z)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):bt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function At(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var Bt=function(t){(0,f.Z)(i,t);var e=At(i);function i(t,s){var n;return(0,u.Z)(this,i),n=e.call(this,t,s),(0,d.Z)((0,c.Z)(n),"updateCollisionsInteractions",(function(){var t=n.collisions.get();t.length>0&&t.forEach((function(t){var e=t.type,i=t.on,s=t.from,r=t.bulletId;switch(e){case"SIMPLE":var o=n.interactives[i],a=n.interactives[s];"SLASH"===o.getStatus()?(a.addToSpeed(a.getX()<o.getX()?-1:1),a.setDamage(30)):(o.addToSpeed(a.getX()<o.getX()?1:-1),o.setDamage(10));break;case"SHOOT":var u=n.interactives[i],l=n.interactives[s];u.addToSpeed(l.getX()<u.getX()?1:-1),u.setDamage(10),n.collisions.removeBox(r),l.removeBullet(r)}}))})),(0,d.Z)((0,c.Z)(n),"setPause",(function(t){n.isPause=t})),n.targetRGB=new g.Z(0,.1),n.targetWave=new g.Z(0,.1),n.oldInverse=!1,n.oldAiming=!1,n.isPause=!0,n.interactives={},n.tilemap=null,n}return(0,l.Z)(i,[{key:"setupGameLevel",value:function(t,e,i){var s=this;if(this.config.game){var n=this.config.game.types,r=t.tilemap,o=t.interactives,a=r.tileSize;this.tilemap=new U(e,r);var u=this.tilemap.getViewBox();Object.keys(o).forEach((function(t){var e=o[t],r=e.type,l=e.x,c=e.y;if(n[r]){var h=n[r],f=Pt(Pt({},h.constants),{},{x:l,y:c,id:t}),p=h.sprites;switch(r){case"heros":var v=h.fxs,d=h.bullets;s.interactives[t]=new mt({constants:f,sprites:p,viewBox:u,tileSize:a,bullets:d,fxs:v}),s.interactives[t].setCallbackDeath(i);break;case"monster":s.interactives[t]=new St({constants:f,sprites:p,viewBox:u,tileSize:a})}}}));var l=Object.keys(this.interactives).map((function(t){return s.interactives[t].getCollisionBox()}));this.background=new O(u,this.tilemap.getLevelSize()),this.collisions=new S(l);var c=this.collisions,h=c.addBoxes,f=c.removeBox;Object.keys(this.interactives).forEach((function(t){s.interactives[t].setCallbacks({addBoxes:h,removeBox:f})}))}}},{key:"resetGameLevel",value:function(){var t=this;Object.keys(this.interactives).forEach((function(e){t.interactives[e].reset()})),this.collisions.clear();var e=Object.keys(this.interactives).map((function(e){return t.interactives[e].getCollisionBox()}));this.collisions.addBoxes(e)}},{key:"update",value:function(t){var e=this;(0,h.Z)((0,v.Z)(i.prototype),"update",this).call(this,t);var s=this.interactives.heros,n=s.getWorldPosition(),r=s.getPosition(),o=this.tilemap.get();if(this.camera.followPosY(n[1]),this.tilemap.follow(r),this.tilemap.update(this.mngProg.get("spritePhong")),!this.isPause){var a=this.tilemap.getTileSize();Object.keys(this.interactives).forEach((function(t){e.interactives[t].update(o,a)})),this.updateCollisionsInteractions()}}},{key:"renderPause",value:function(){(0,h.Z)((0,v.Z)(i.prototype),"render",this).call(this),this.renderBackground(),this.renderTilemap()}},{key:"mainRender",value:function(){this.renderBackground(),this.renderTilemap(),this.renderInteractives(),this.renderForeground()}},{key:"renderTilemap",value:function(){this.tilemap.render(this.mngProg.get("spritePhong"),this.mngTex.get("level1"),this.mngObj.get("cubeTile"),this.mngObj.get("tile"))}},{key:"renderInteractives",value:function(){var t=this;Object.keys(this.interactives).forEach((function(e){t.interactives[e].render(t.mngProg.get("sprite"),t.mngTex.get("heros"),t.mngObj.get("tile"))}));var e=this.interactives.heros;e.renderFxs(this.mngProg.get("sprite"),this.mngTex.get("fx"),this.mngObj.get("tile")),e.renderBullets(this.mngProg.get("sprite"),this.mngTex.get("bullet"),this.mngObj.get("tile"))}},{key:"renderBackground",value:function(){var t=this.interactives.heros.getX(),e=this.mngProg.get("background");this.background.renderMountains(this.mngObj.get("tile"),this.mngProg.get("color")),this.background.updateScreens(-.15),e.setTexture(0,this.mngTex.get("clouds").get(),"textureMap"),this.background.renderScreen(this.mngObj.get("tile"),e,t,5e-4),this.background.updateScreens(-.1),e.setTexture(0,this.mngTex.get("rocks").get(),"textureMap"),this.background.renderScreen(this.mngObj.get("tile"),e,t,.001),this.background.updateScreens(-.05),e.setTexture(0,this.mngTex.get("ground").get(),"textureMap"),this.background.renderScreen(this.mngObj.get("tile"),e,t,.005),this.background.renderCloudsBack(this.mngObj.get("tile"),this.mngProg.get("color"))}},{key:"renderForeground",value:function(){this.background.renderCloudsFront(this.mngObj.get("tile"),this.mngProg.get("color"))}},{key:"effects",value:function(){var t=this.interactives.heros,e=t.getAimingPosition(),i=t.getInverseX(),s=t.isAiming();this.targetRGB.update(),this.targetWave.update(),i!==this.oldInverse&&(this.camera.setSmoothRotation(i?.4:-.4),this.camera.setSmoothTarget(i?-4:4),this.oldInverse=i),s!==this.oldAiming&&(this.targetWave.set(s?.01:0),this.camera.setSmoothZoom(s?.8:1),this.oldAiming=s),this.targetRGB.set(t.getDashing()||this.isPause?2:0);var n=this.camera.get2dTexturePoint(e),r=this.targetRGB.get();this.postProcess.setRGB(r,r,e.getX(),e.getY()),this.postProcess.setWave(.01*this.time,this.targetWave.get(),n)}},{key:"render",value:function(){(0,h.Z)((0,v.Z)(i.prototype),"render",this).call(this),this.postProcess.start(),this.mainRender(),this.postProcess.end(),this.effects(),this.postProcess.render()}},{key:"setKeyboardInteraction",value:function(t){this.isPause||this.interactives.heros.setInteraction(t)}}]),i}(y.Z),Rt=function(){function t(){var e=this;(0,u.Z)(this,t),(0,d.Z)(this,"showRestart",(function(){e.instructions&&(e.title.innerHTML="G a m e O v e r",e.instructions.innerHTML="Pressed Enter to restart"),e.show()})),(0,d.Z)(this,"showVictory",(function(){e.instructions&&(e.title.innerHTML="V i c t o r y",e.instructions.innerHTML=""),e.show()})),(0,d.Z)(this,"showReady",(function(){e.instructions&&e.instructions&&(e.instructions.style.display="block")})),this.div=document.querySelector("#splash"),this.instructions=this.div&&this.div.querySelector("#instructions"),this.title=this.div&&this.div.querySelector("#title")}return(0,l.Z)(t,[{key:"show",value:function(){this.div&&(this.div.style.opacity=1)}},{key:"hide",value:function(){this.div&&(this.div.style.opacity=0)}},{key:"showPause",value:function(){this.title&&(this.title.innerHTML="T h e G a m e"),this.show()}}]),t}(),Ot=["levels"];function Ct(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=(0,v.Z)(t);if(e){var n=(0,v.Z)(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return(0,p.Z)(this,i)}}var Dt=function(t){(0,f.Z)(n,t);var e,i=Ct(n);function n(t,e){var s;return(0,u.Z)(this,n),s=i.call(this,t,e),(0,d.Z)((0,c.Z)(s),"callbackDeath",(function(){s.setPause(!0),s.isSplashScreen=!0,s.splash.showRestart(),s.resetGameLevel()})),s.isSplashScreen=!0,s.needReset=!1,s.splash=new Rt,s.splash.showReady(),s.currentLevel=0,s}return(0,l.Z)(n,[{key:"setupAssets",value:(e=(0,s.Z)(r().mark((function t(e){var i,s,o,u,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.levels,s=(0,a.Z)(e,Ot),t.next=3,(0,h.Z)((0,v.Z)(n.prototype),"setupAssets",this).call(this,s);case 3:(o=this.config.game.levels)&&(u=o[this.currentLevel],l=i[u.tilemap.texture],this.setupGameLevel(u,l,this.callbackDeath));case 5:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"setKeyboardInteraction",value:function(t){(0,h.Z)((0,v.Z)(n.prototype),"setKeyboardInteraction",this).call(this,t),this.isSplashScreen&&t.isPressedOne(this.config.keyboard.ENTER)&&(this.setPause(!1),this.splash.hide(),this.isSplashScreen=!1),t.isPressedOne(this.config.keyboard.ECHAP)&&(this.isSplashScreen=!this.isSplashScreen,this.setPause(this.isSplashScreen),this.isSplashScreen?this.splash.showPause():this.splash.hide())}}]),n}(Bt),Lt=i(83909),Tt=i(93379),Mt=i.n(Tt),jt=i(7795),zt=i.n(jt),Xt=i(90569),Et=i.n(Xt),Ut=i(3565),It=i.n(Ut),Nt=i(70609),_t=i.n(Nt),Wt=i(44589),Yt=i.n(Wt),Ht=i(6616),Jt={};Jt.styleTagTransform=Yt(),Jt.setAttributes=It(),Jt.insert=Et().bind(null,"head"),Jt.domAPI=zt(),Jt.insertStyleElement=_t();Mt()(Ht.Z,Jt);Ht.Z&&Ht.Z.locals&&Ht.Z.locals;i(88747),i(89153);var Vt=null;const Ft=(0,s.Z)(r().mark((function t(){var e,i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Vt=new o.Z,t.next=3,Vt.setup(Dt,Lt.default);case 3:e=document.querySelector("#".concat(Lt.default.slug)),(i=Vt.getCanvas())&&e&&e.appendChild(i);case 6:case"end":return t.stop()}}),t)})));var Gt=function(){Vt&&Vt.destroy&&Vt.destroy()}},88601:(t,e,i)=>{i.d(e,{JU:()=>u,K5:()=>h,L_:()=>a,RL:()=>r,UP:()=>s,W:()=>c,WV:()=>n,X:()=>l,pX:()=>o,sC:()=>f});var s=38,n=40,r=37,o=39,a=32,u=16,l=88,c=87,h=13,f=27},6616:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(8081),n=i.n(s),r=i(23645),o=i.n(r)()(n());o.push([t.id,"#game {\n  text-align: center;\n}\n\n#game canvas {\n  display: block;\n  margin: 0 auto;\n  width: auto;\n  height: auto;\n  max-width: 100%;\n}\n\n#gameinfos {\n  position: absolute;\n  top: 0;\n  left: 0;\n  padding: 4px;\n  width: 100%;\n  text-align: left;\n}\n\nmeter {\n  width: 100px;\n  height: 1.2em;\n}\n\n#game[data-fullscreen] canvas {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate3d(-50%, -50%, 0);\n}\n\n#splash {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  color: #fff;\n  transition: opacity 500ms ease-out;\n  z-index: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n#title {\n  font-size: 6em;\n  font-weight: 100;\n  text-shadow: 0.04em 0.04em 0 rgba(0, 0, 0, 0.7);\n  margin: 0;\n}\n\n@media (max-width: 570px) {\n  #title {\n    font-size: 4em;\n  }\n}\n\n#instructions {\n  font-size: 1.6em;\n  display: none;\n  letter-spacing: 0.1em;\n  animation: blink 1s linear infinite;\n  margin: 1em 0;\n}\n\n.commands {\n  letter-spacing: 0.2em;\n  text-transform: uppercase;\n  padding: 1em 0;\n}\n\n.command {\n  position: relative;\n  overflow: hidden;\n  font-size: 0.8em;\n  letter-spacing: 0.1em;\n  margin: 10px 0;\n}\n\n.command .key {\n  border-radius: 4px;\n  margin: 0 4px;\n  text-align: center;\n  width: calc(50% - 8px);\n  background: #444;\n  float: left;\n}\n\n.command .key.twocol {\n  width: calc(25% - 8px);\n}\n\n.command .key svg {\n  width: 8px;\n  stroke: #fff;\n  stroke-width: 2;\n  fill: none;\n}\n\n.command .desc {\n  float: left;\n  width: 50%;\n}\n\n.command .key,\n.command .desc {\n  padding: 0.4em;\n  text-shadow: 1px 1px 0 #000;\n}\n\n@keyframes blink {\n  0% {\n    opacity: 0;\n  }\n\n  50% {\n    opacity: 1;\n  }\n\n  100% {\n    opacity: 0;\n  }\n}",""]);const a=o},24981:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(8081),n=i.n(s),r=i(23645),o=i.n(r)()(n());o.push([t.id,"#controls {\n  position: absolute;\n  top: 0;\n  right: 0;\n  display: flex;\n  align-items: stretch;\n  z-index: 10;\n  background-color: rgba(34, 34, 34, .8);\n  margin: .5em;\n  padding: .5em;\n}\n\n#controls div {\n  display: flex;\n  align-items: stretch;\n}\n\n#controls div input[type=range] {\n  width: 100%;\n}\n\n#controls div input[type=checkbox] {\n  margin-right: 0.5em;\n}\n\n#controls label {\n  display: flex;\n  align-items: center;\n}\n\n#controls label,\n#controls a {\n  font-size: .8em;\n}\n\n@media (max-width: 570px) {\n  #controls.responsive {\n    position: relative;\n    width: 100%;\n    margin: 0;\n  }\n}",""]);const a=o},76889:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(8081),n=i.n(s),r=i(23645),o=i.n(r)()(n());o.push([t.id,"#fullscreen-toggle-btn {\n  border-radius: 0;\n  margin: 0;\n  padding: 4px;\n  border: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n  transform: scale(0.8);\n  opacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n  display: block;\n  width: 2em;\n  fill: #fff;\n  opacity: 0.8;\n  transform: scale(0.6);\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\n}\n\n[data-fullscreen] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n",""]);const a=o},88747:(t,e,i)=>{var s=i(93379),n=i.n(s),r=i(7795),o=i.n(r),a=i(90569),u=i.n(a),l=i(3565),c=i.n(l),h=i(70609),f=i.n(h),p=i(44589),v=i.n(p),d=i(24981),y={};y.styleTagTransform=v(),y.setAttributes=c(),y.insert=u().bind(null,"head"),y.domAPI=o(),y.insertStyleElement=f();n()(d.Z,y),d.Z&&d.Z.locals&&d.Z.locals},89153:(t,e,i)=>{var s=i(93379),n=i.n(s),r=i(7795),o=i.n(r),a=i(90569),u=i.n(a),l=i(3565),c=i.n(l),h=i(70609),f=i.n(h),p=i(44589),v=i.n(p),d=i(76889),y={};y.styleTagTransform=v(),y.setAttributes=c(),y.insert=u().bind(null,"head"),y.domAPI=o(),y.insertStyleElement=f();n()(d.Z,y),d.Z&&d.Z.locals&&d.Z.locals}}]);