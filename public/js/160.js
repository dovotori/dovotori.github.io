(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{351:function(e,t,n){var r=n(99),o=n(352);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var s={insert:"head",singleton:!1};r(o,s);e.exports=o.locals||{}},352:function(e,t,n){"use strict";n.r(t);var r=n(60),o=n.n(r)()(!1);o.push([e.i,"#controls {\n  position: absolute;\n  top: 4px;\n  right: 4px;\n  display: flex;\n  align-items: stretch;\n  z-index: 1;\n}\n",""]),t.default=o},353:function(e,t,n){var r=n(99),o=n(354);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var s={insert:"head",singleton:!1};r(o,s);e.exports=o.locals||{}},354:function(e,t,n){"use strict";n.r(t);var r=n(60),o=n.n(r)()(!1);o.push([e.i,"#fullscreen-toggle-btn {\n  border-radius: 0;\n  margin: 0;\n  padding: 4px;\n  border: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n  transform: scale(0.8);\n  opacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n  display: block;\n  width: 2em;\n  fill: #444;\n  opacity: 0.8;\n  transform: scale(0.6);\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\n}\n\n[data-fullscreen] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n",""]),t.default=o},385:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var r=n(29),o=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.startX,s=void 0===o?-1:o,a=n.endX,i=void 0===a?1:a,c=n.startZ,d=void 0===c?-1:c,u=n.endZ,l=void 0===u?1:u,p=[],g=0;g<t;g++)for(var h=0;h<e;h++){var f=Object(r.b)(h,0,e-1,s,i),m=Object(r.b)(g,0,t-1,d,l);p.push(f),p.push(0),p.push(m)}return p},s=function(e,t){for(var n=[],r=0;r<t-1;r++)for(var o=0;o<e-1;o++){var s=r*e+o;n.push(s),n.push(e+s),n.push(s+1),n.push(e+s),n.push(e+s+1),n.push(s+1)}return n}},545:function(e,t,n){var r=n(99),o=n(546);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var s={insert:"head",singleton:!1};r(o,s);e.exports=o.locals||{}},546:function(e,t,n){"use strict";n.r(t);var r=n(60),o=n.n(r)()(!1);o.push([e.i,"#race {\n  position: relative;\n  width: 100%;\n  height: auto;\n}\n\n#race canvas {\n  margin: 0 auto;\n  width: 100%;\n}\n",""]),t.default=o},746:function(e,t,n){"use strict";n.r(t),n.d(t,"destroy",(function(){return Z}));var r=n(43),o=n.n(r),s=n(61),a=n.n(s),i=n(130),c=n(46),d=n.n(c),u=n(27),l=n.n(u),p=n(1),g=n.n(p),h=n(2),f=n.n(h),m=n(10),v=n.n(m),P=n(22),b=n.n(P),y=n(7),x=n.n(y),S=n(8),w=n.n(S),j=n(3),M=n.n(j),T=n(0),F=n.n(T),X=n(132),k=n(116),V=n(73),D=n(19),L=n(25),q=n(385),I=n(52);n(121);function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=M()(e);if(t){var o=M()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return w()(this,n)}}var _=function(e){return.5*Math.sin(e)+.5},A=function(e){x()(n,e);var t=R(n);function n(e,r,o){var s;g()(this,n),s=t.call(this,e,r,o),F()(v()(s),"getDistPos",(function(e){var t,n,r,o,a,i=s.config,c=i.roadAmplitude,u=i.roadLength,p=i.roadFrequence;return d()(L.a,l()((t=e/u,n=p,r=c,o=s.posTime,a=.02,[Math.cos(t*Math.PI*n[0]+o)*r[0]-Math.cos(a*Math.PI*n[0]+o)*r[0],_(t*Math.PI*n[1]+o)*r[1]-_(a*Math.PI*n[1]+o)*r[1],_(t*Math.PI*n[2]+o)*r[2]-_(a*Math.PI*n[2]+o)*r[2]])))})),F()(v()(s),"updateCamera",(function(){var e=s.config,t=e.roadLength,n=e.camera,r=s.getDistPos(100),o=s.getDistPos(0);s.camera.setTarget(r.getX(),n.position.y+r.getY(),t),s.camera.setPosition(o.getX(),n.position.y+o.getY(),0)})),F()(v()(s),"moveShip",(function(){s.targetPosX.update(),s.targetSpeed.update(),s.posTime+=s.targetSpeed.get();var e=s.getDistPos(s.shipPos.getZ());s.currentShipPos.equal(e).add(s.shipPos).addX(s.targetPosX.get())})),F()(v()(s),"renderMountain",(function(){var e=s.config,t=e.roadAmplitude,n=e.roadLength,r=e.roadWidth,o=e.roadFrequence,a=s.mngProg.get("roadmountain");a.setProjectionView(s.camera),a.setMatrix("model",s.model.get()),a.setFloat("time",s.posTime),a.setVector("frequence",o),a.setVector("amplitude",t),a.setFloat("roadWidth",r),a.setFloat("roadLength",n),s.mountainVbo.render(a.get())})),F()(v()(s),"renderRoad",(function(){var e=s.config,t=e.roadAmplitude,n=e.roadLength,r=e.roadWidth,o=e.roadFrequence,a=s.mngProg.get("road");a.setProjectionView(s.camera),a.setMatrix("model",s.model.get()),a.setFloat("time",s.posTime),a.setVector("frequence",o),a.setVector("amplitude",t),a.setFloat("roadWidth",r),a.setFloat("roadLength",n),s.roadVbo.render(a.get())})),F()(v()(s),"renderShip",(function(){var e,t=s.mngProg.get("gltf"),n=s.mngGltf.get("raceship");s.model.push(),(e=s.model).translate.apply(e,l()(s.currentShipPos.get())),n.render(t,s.model),s.model.pop()})),F()(v()(s),"renderShipTrails",(function(){var e,t=s.mngProg.get("gltf"),n=s.mngGltf.get("raceship");s.model.push(),(e=s.model).translate.apply(e,l()(s.currentShipPos.get())),n.renderNode("trail1",t,s.model),n.renderNode("trail2",t,s.model),s.model.pop()})),F()(v()(s),"interactShip",(function(e){var t=s.config.roadWidth;s.targetSpeed.set(.1),s.targetPosX.set(-e.rel.x*t*.6)})),F()(v()(s),"onMouseDrag",(function(e){s.interactShip(e)})),F()(v()(s),"onMouseDown",(function(e){s.interactShip(e)})),F()(v()(s),"onMouseUp",(function(){s.targetSpeed.set(0)})),s.screen=new k.a(s.gl),s.model=new D.a;var a=r.roadLength,i=r.roadWidth,c=r.shipPosition,u=Object(q.b)(2,a,{startX:-i,endX:i,startZ:0,endZ:a}),p=Object(q.b)(120,a,{startX:-120,endX:120,startZ:0,endZ:a}),h=Object(q.a)(2,a);s.roadVbo=new V.a(e,{position:u,indices:h});var f=Object(q.a)(120,a);return s.mountainVbo=new V.a(e,{position:p,indices:f}),s.shipPos=d()(L.a,l()(c)),s.currentShipPos=new L.a(0),s.targetPosX=new I.a(0,.1),s.targetSpeed=new I.a(0,.1),s.posTime=0,s.setLampeInfos(s.mngProg.get("gltf")),s.mngProg.get("roadSky").setTexture(1,s.mngTex.get("noisergb").get(),"textureMap"),s}return f()(n,[{key:"update",value:function(e){b()(M()(n.prototype),"update",this).call(this,e),this.model.identity(),this.moveShip(),this.updateTrails(),this.updateCamera(),this.mngGltf.get("raceship").update(e)}},{key:"updateTrails",value:function(){var e=this.mngProg.get("gltf"),t=this.mngGltf.get("raceship");e.setProjectionView(this.camera),t.setAnimationStep("trail1","scale",10*this.targetSpeed.get()),t.setAnimationStep("trail2","scale",10*this.targetSpeed.get())}},{key:"renderLandscape",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("roadSky");e.setFloat("flipY",-1),e.setFloat("time",.1*this.time),e.setVector("wind",[.1,.2]),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"render",value:function(){b()(M()(n.prototype),"render",this).call(this),this.postProcess.start(),this.renderMountain(),this.renderRoad(),this.renderShip(),this.postProcess.end(),this.bloom.start(),this.renderShipTrails(),this.bloom.end(),this.bloom.setBloom(1,.1),this.postProcess.mergeBloom(this.bloom.getTexture(),1.5,2.2),this.postProcess.setFxaa2(),this.postProcess.render()}}]),n}(X.a),O={slug:"race",assets:["/textures/noisergb.png","/gltf/raceship.gltf"],shaders:["/camera/road.js","/camera/gltf.js","/camera/roadmountain.js","/camera/basique3d.js","/sky/roadSky.js","/camera/gltf.js","/screen/screen.js","/screen/debug.js","/screen/blurOnePass.js","/screen/bloom.js","/screen/mergeBloom.js","/screen/fxaa.js","/screen/fxaa2.js"],useDepthTexture:!0,postprocess:{bloom:{intensity:1}},textures:{noisergb:"LINEAR"},canvas:{width:1024,height:512},mouse:{events:["down","up","drag"]},camera:{position:{x:0,y:4,z:0},target:{x:0,y:0,z:128},near:1,far:200,angle:90},lampes:[{type:0,position:{x:0,y:3,z:3},ambiant:[1,1,1],diffuse:[.8,.6,.5],specular:[1,.8,.7],brillance:1,strength:40}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},roadFrequence:[2,0,2],roadAmplitude:[10,0,4],roadLength:128,roadWidth:8,shipPosition:[0,2,3]},W=(n(351),n(353),n(545),null),Z=(t.default=a()(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W=new i.a,e.next=3,W.setup(A,O);case 3:document.querySelector("#".concat(O.slug)).appendChild(W.getCanvas());case 5:case"end":return e.stop()}}),e)}))),function(){W&&W.destroy&&W.destroy()})}}]);