"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[5321,7507],{807(t,e,s){var i=s(85072),n=s.n(i),o=s(97825),h=s.n(o),r=s(77659),a=s.n(r),l=s(55056),c=s.n(l),d=s(10540),u=s.n(d),p=s(41113),g=s.n(p),m=s(55420),x={};x.styleTagTransform=g(),x.setAttributes=c(),x.insert=a().bind(null,"head"),x.domAPI=h(),x.insertStyleElement=u();n()(m.A,x),m.A&&m.A.locals&&m.A.locals},3195(t,e,s){s.d(e,{A:()=>i});const i={position:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],texture:[1,1,0,1,0,0,1,0,0,0,1,0,1,1,0,1,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]}},3199(t,e,s){s.d(e,{A:()=>r});var i=s(31601),n=s.n(i),o=s(76314),h=s.n(o)()(n());h.push([t.id,"#game {\n\ttext-align: center;\n}\n\n#game canvas {\n\tdisplay: block;\n\tmargin: 0 auto;\n\twidth: auto;\n\theight: auto;\n\tmax-width: 100%;\n}\n\n#gameinfos {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tpadding: 4px;\n\twidth: 100%;\n\ttext-align: left;\n}\n\nmeter {\n\twidth: 100px;\n\theight: 1.2em;\n}\n\n#game[data-fullscreen] canvas {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate3d(-50%, -50%, 0);\n}\n\n#splash {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tcolor: #fff;\n\ttransition: opacity 500ms ease-out;\n\tz-index: 1;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n#title {\n\tfont-size: 6em;\n\tfont-weight: 100;\n\ttext-shadow: 0.04em 0.04em 0 rgba(0, 0, 0, 0.7);\n\tmargin: 0;\n}\n\n@media (max-width: 570px) {\n\t#title {\n\t\tfont-size: 4em;\n\t}\n}\n\n#instructions {\n\tfont-size: 1.6em;\n\tdisplay: none;\n\tletter-spacing: 0.1em;\n\tanimation: blink 1s linear infinite;\n\tmargin: 1em 0;\n}\n\n.commands {\n\tletter-spacing: 0.2em;\n\ttext-transform: uppercase;\n\tpadding: 1em 0;\n}\n\n.command {\n\tposition: relative;\n\toverflow: hidden;\n\tfont-size: 0.8em;\n\tletter-spacing: 0.1em;\n\tmargin: 10px 0;\n}\n\n.command .key {\n\tborder-radius: 4px;\n\tmargin: 0 4px;\n\ttext-align: center;\n\twidth: calc(50% - 8px);\n\tbackground: #444;\n\tfloat: left;\n}\n\n.command .key.twocol {\n\twidth: calc(25% - 8px);\n}\n\n.command .key svg {\n\twidth: 8px;\n\tstroke: #fff;\n\tstroke-width: 2;\n\tfill: none;\n}\n\n.command .desc {\n\tfloat: left;\n\twidth: 50%;\n}\n\n.command .key,\n.command .desc {\n\tpadding: 0.4em;\n\ttext-shadow: 1px 1px 0 #000;\n}\n\n@keyframes blink {\n\t0% {\n\t\topacity: 0;\n\t}\n\n\t50% {\n\t\topacity: 1;\n\t}\n\n\t100% {\n\t\topacity: 0;\n\t}\n}\n",""]);const r=h},10540(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},19365(t,e,s){s.d(e,{A:()=>i});const i=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.d=[0,0,0,0],this.set(t,e,s,i)}normalise(){const t=this.length();return 0!==t&&(this.d[0]/=t,this.d[1]/=t,this.d[2]/=t,this.d[3]/=t),this}get(){return this.d}getX(){return this.d[0]}getY(){return this.d[1]}getZ(){return this.d[2]}getW(){return this.d[3]}length(){return Math.sqrt(this.d[0]*this.d[0]+this.d[1]*this.d[1]+this.d[2]*this.d[2]+this.d[3]*this.d[3])}set(t,e,s,i){return null!=t&&(this.d[0]=t),null!=e?this.d[1]=e:null!=t&&(this.d[1]=t),null!=s?this.d[2]=s:null!=t&&(this.d[2]=t),null!=i?this.d[3]=i:null!=t&&(this.d[3]=t),this}equal(t){return this.d=[t.d[0],t.d[1],t.d[2],t.d[3]],this}add(t){return this.d[0]+=t.d[0],this.d[1]+=t.d[1],this.d[2]+=t.d[2],this.d[3]+=t.d[3],this}addNumber(t){return this.d[0]+=t,this.d[1]+=t,this.d[2]+=t,this.d[3]+=t,this}minus(t){return this.d[0]-=t.d[0],this.d[1]-=t.d[1],this.d[2]-=t.d[2],this.d[3]-=t.d[3],this}minusNumber(t){return this.d[0]-=t,this.d[1]-=t,this.d[2]-=t,this.d[3]-=t,this}multiplyNumber(t){return this.d[0]*=t,this.d[1]*=t,this.d[2]*=t,this.d[3]*=t,this}multiplyMatrix(t){const e=this.d[0],s=this.d[1],i=this.d[2],n=this.d[3];return this.d[0]=t.d[0]*e+t.d[4]*s+t.d[8]*i+t.d[12]*n,this.d[1]=t.d[1]*e+t.d[5]*s+t.d[9]*i+t.d[13]*n,this.d[2]=t.d[2]*e+t.d[6]*s+t.d[10]*i+t.d[14]*n,this.d[3]=t.d[3]*e+t.d[7]*s+t.d[11]*i+t.d[15]*n,this}multiply(t){return this.d[0]*=t.d[0],this.d[1]*=t.d[1],this.d[2]*=t.d[2],this.d[3]*=t.d[3],this}divideNumber(t){return this.d[0]/=t,this.d[1]/=t,this.d[2]/=t,this.d[3]/=t,this}divide(t){return this.d[0]/=t.d[0],this.d[1]/=t.d[1],this.d[2]/=t.d[2],this.d[3]/=t.d[3],this}distance(t){return Math.sqrt((t.d[0]-this.d[0])*(t.d[0]-this.d[0])+(t.d[1]-this.d[1])*(t.d[1]-this.d[1])+(t.d[2]-this.d[2])*(t.d[2]-this.d[2])+(t.d[3]-this.d[3])*(t.d[3]-this.d[3]))}}},19513(t,e,s){var i=s(85072),n=s.n(i),o=s(97825),h=s.n(o),r=s(77659),a=s.n(r),l=s(55056),c=s.n(l),d=s(10540),u=s.n(d),p=s(41113),g=s.n(p),m=s(77314),x={};x.styleTagTransform=g(),x.setAttributes=c(),x.insert=a().bind(null,"head"),x.domAPI=h(),x.insertStyleElement=u();n()(m.A,x),m.A&&m.A.locals&&m.A.locals},23876(t,e,s){s.d(e,{A:()=>o});var i=s(67269),n=s(54096);const o=class{constructor(t){if(this.position=new n.A(t.position.x,t.position.y,t.position.z),this.target=new n.A(0,0,0),this.view=new i.A,t.ortho){const{left:e,right:s,bottom:n,top:o}=t.ortho,{near:h,far:r}=t;this.ortho=new i.A,this.ortho.ortho(e,s,n,o,h,r)}}lookAt(){this.view.identity().lookAt(this.position.getX(),this.position.getY(),this.position.getZ(),this.target.getX(),this.target.getY(),this.target.getZ(),0,1,0)}getView(){return this.view}getPosition(){return this.position.get()}getPositionVec3(){return this.position}getTarget(){return this.target.get()}getModel(){return this.repere.getModel()}getOrtho(){return this.ortho}addToPosition(t,e,s){this.position.addXYZ(t,e,s),this.lookAt()}setPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=null!==t?t:this.position.getX(),n=null!==e?e:this.position.getY(),o=null!==s?s:this.position.getZ();this.position.set(i,n,o),this.lookAt()}setTarget(t,e,s){this.target.set(t,e,s)}setTargetVec3(t){this.target.equal(t)}}},31601(t){t.exports=function(t){return t[1]}},35321(t,e,s){s.r(e),s.d(e,{default:()=>ut,destroy:()=>pt});var i=s(99590),n=s(67507),o=s(54705);const h=class{constructor(){(0,o.A)(this,"showRestart",(()=>{this.instructions&&(this.title.innerHTML="G a m e O v e r",this.instructions.innerHTML="Pressed Enter to restart"),this.show()})),(0,o.A)(this,"showVictory",(()=>{this.instructions&&(this.title.innerHTML="V i c t o r y",this.instructions.innerHTML=""),this.show()})),(0,o.A)(this,"showReady",(()=>{this.instructions&&this.instructions&&(this.instructions.style.display="block")})),this.div=document.querySelector("#splash"),this.instructions=this.div?.querySelector("#instructions"),this.title=this.div?.querySelector("#title")}show(){this.div&&(this.div.style.opacity=1)}hide(){this.div&&(this.div.style.opacity=0)}showPause(){this.title&&(this.title.innerHTML="T h e G a m e"),this.show()}};var r=s(99594);const a=class{constructor(){this.value=null,this.isMin=!1,this.ownerId=null}setup(t,e){this.isMin=t,this.ownerId=e}set(t){this.value=t}get(){return this.value}getID(){return this.ownerId}isMinimum(){return this.isMin}};class l{static compareListes(t,e){const s=[];for(let i=0;i<t.length;i+=1)for(let n=0;n<e.length;n+=1)(t[i][0]===e[n][0]&&t[i][1]===e[n][1]||t[i][1]===e[n][0]&&t[i][0]===e[n][1])&&s.push([t[i][0],t[i][1]]);return s}constructor(){this.listesAxe=Array(3),this.resetPairesAxes()}resetPairesAxes(){for(let t=0;t<this.listesAxe.length;t+=1)this.listesAxe[t]=[]}addPaireOnAxe(t,e){let s=!1;for(let i=0;i<this.listesAxe[e].length;i+=1)if(t[0]===this.listesAxe[e][i][0]&&t[1]===this.listesAxe[e][i][1]||t[1]===this.listesAxe[e][i][0]&&t[0]===this.listesAxe[e][i][1]){s=!0;break}s||this.listesAxe[e].push(t)}getPaires(t,e,s){let i=null;return t&&([i]=this.listesAxe,e&&(i=l.compareListes(i,this.listesAxe[1]),s&&(i=l.compareListes(i,this.listesAxe[2])))),i}}const c=l;class d{static addEndpointDecroissant(t,e,s){const i=t,n=new a;n.set(-9999),t.push(n),t.push(n);let o=e,h=0;for(let e=t.length-1;e>=0;e-=1){const n=t[e-(2-h)];if(n?n.get()>o.get()?(i[e]=o,h+=1,o=s):i[e]=n:(i[e]=o,h+=1,o=s),2===h)break}return i}constructor(){this.listeAxe=Array(3),this.listeAxe[0]=[],this.listeAxe[1]=[],this.listeAxe[2]=[],this.pm=new c,this.cptEndpointPlace=0,this.endpointAplacer=null,this.activeList=[]}setup(t){this.addBoxes(t)}addBoxes(t){let e=[],s=[];for(let i=0;i<t.length;i+=1)e=d.addEndpointDecroissant(e,t[i].getMin(0),t[i].getMax(0)),s=d.addEndpointDecroissant(s,t[i].getMin(1),t[i].getMax(1));let i=0;this.addEndPointsOnListe(i,e),i+=1,this.addEndPointsOnListe(i,s)}addEndPointsOnListe(t,e){const s=new a;s.set(9999);for(let i=0;i<e.length;i+=1)this.listeAxe[t].push(s);this.cptEndpointPlace=0,this.endpointAplacer=e[this.cptEndpointPlace],this.activeList=[];for(let s=this.listeAxe[t].length-1;s>=0;s-=1)this.loopTri(t,e,s),this.loopCheckCollision(t,s)}loopTri(t,e,s){if(this.cptEndpointPlace<e.length){const i=this.listeAxe[t][s-(e.length-this.cptEndpointPlace)];i?this.endpointAplacer.get()>i.get()?(this.listeAxe[t][s]=this.endpointAplacer,this.cptEndpointPlace+=1,this.endpointAplacer=e[this.cptEndpointPlace]):this.listeAxe[t][s]=i:(this.listeAxe[t][s]=this.endpointAplacer,this.cptEndpointPlace+=1,this.endpointAplacer=e[this.cptEndpointPlace])}}loopCheckCollision(t,e){const s=this.listeAxe[t][e].getID();if(this.listeAxe[t][e].isMinimum()){for(let t=0;t<this.activeList.length;t+=1)if(this.activeList[t]===s){this.activeList.splice(t,1);break}}else{for(let e=0;e<this.activeList.length;e+=1)this.pm.addPaireOnAxe([this.activeList[e],s],t);this.activeList.push(s)}}update(t,e,s){this.pm.resetPairesAxes(),this.activeList=[],t&&this.updateAxe(0),e&&this.updateAxe(1),s&&this.updateAxe(2)}updateAxe(t){this.listeAxe[t].sort(((t,e)=>t.value<e.value?-1:1));for(let e=this.listeAxe[0].length-1;e>=0;e-=1)this.loopCheckCollision(t,e)}getPaires(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.update(t,e,s),this.pm.getPaires(t,e,s)}removeBox(t){this.listeAxe=this.listeAxe.map((e=>e.filter((e=>e.ownerId!==t))))}clear(){this.listeAxe[0]=[],this.listeAxe[1]=[],this.listeAxe[2]=[]}}const u=d;const p=class{constructor(t){(0,o.A)(this,"addBoxes",(t=>{this.collision.addBoxes(t)})),(0,o.A)(this,"clear",(()=>{this.collision.clear()})),(0,o.A)(this,"removeBox",(t=>{this.collision.removeBox(t)})),this.collision=new u,this.collision.addBoxes(t)}get(){return this.collision.getPaires().reduce(((t,e)=>{let s="SIMPLE";e.sort();let i=e[0],n=e[1],o=null;const h=-1!==i.indexOf("bullet"),r=-1!==n.indexOf("bullet");if(h&&r)return t;if(h){s="SHOOT",o=i;const t=i.split("-")[0];i=n,n=t}else r&&(s="SHOOT",o=n,[n]=n.split("-"));return"SHOOT"===s&&i===n?t:[...t,{type:s,from:n,on:i,bulletId:o}]}),[])}};var g=s(66172),m=s(4689),x=s(67269);const v=class{constructor(){this.model=new x.A,this.model.identity(),this.selected=!1}setProgram(t){t.setMatrix("model",this.model.get())}setProgramSpecifics(t){t.setInt("selected",this.selected),t.setVector("color",[1,1,1,1])}render(t,e){this.setProgram(e),this.setProgramSpecifics(e),t.enable(e.get()),t.render(e.get())}renderColor(t,e){this.setProgram(e),e.setInt("selected",this.selected),e.setVector("color",[1,1,1,1]),t.enable(e.get()),t.render(e.get())}update(){this.model.identity()}setDraggingInfos(t){this.angle.x.addToSpeed(.1*t.relPrevious.x),this.angle.y.addToSpeed(-.1*t.relPrevious.y)}setSelected(t){this.selected=255===t[0]&&255===t[1]&&255===t[2],this.size.set(this.selected?1.1:1)}setLightPos(t){this.lightPos=t}reset(){this.model.identity()}setRotate(t,e,s,i){this.model.rotate(t,e,s,i)}setTranslate(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.model.translate(t,e,s)}setScale(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.model.scale(t,e,s)}},f=class extends v{constructor(){super(),this.color=[255,255,255,1]}render(t,e){this.setProgram(e),e.setInt("selected",this.selected),e.setVector("color",[this.color[0]/255,this.color[1]/255,this.color[2]/255,this.color[3]]),t.enable(e.get()),t.render(e.get())}setColor(t,e,s,i){this.color=[t,e,s,i]}},y=class{constructor(t,e){this.screen=new f,this.cpt=0,this.mountains=new Array(4);for(let t=0;t<this.mountains.length;t+=1)this.mountains[t]=new f;this.clouds=new Array(4),this.cloudData=[],this.viewBox=t,this.levelSize=e;for(let t=0;t<this.clouds.length;t+=1)this.clouds[t]=new f,this.cloudData[t]=this.setCloud()}update(t){this.updateMountains(t),this.updateClouds(t)}updateScreens(t){this.screen.update(),this.screen.setScale(20,10,0),this.screen.setTranslate(0,10,t)}updateMountains(t){this.mountains.forEach(((e,s)=>{const i=this.mountains.length-s,n=(0,m.cy)(s,0,this.mountains.length,4,40),o=(0,m.cy)(t[0],0,this.levelSize.w,this.viewBox.w+10*i,10*-i),h=10+n/2,r=(0,m.cy)(s,0,this.mountains.length,255,100),a=(0,m.cy)(s,0,this.mountains.length,-2,-20);e.update(),e.setScale(n,n,n),e.setRotate(45,0,0,1),e.setTranslate(o,h,a),e.setColor(r,r,r,1)}))}updateClouds(){this.clouds.forEach(((t,e)=>{const{scale:s}=this.cloudData[e];this.cloudData[e].x<-s?this.cloudData[e]=this.setCloud(this.viewBox.w+s):this.cloudData[e].x-=this.cloudData[e].speed,t.update(),t.setScale(s,s,s),t.setRotate(45,0,0,1),t.setTranslate(this.cloudData[e].x,this.cloudData[e].y,this.cloudData[e].z),t.setColor(255,255,255,.4)}))}renderScreen(t,e,s,i){e.setFloat("offset",s*i),this.screen.render(t,e)}renderMountains(t,e){this.mountains.forEach((s=>{s.render(t,e)}))}renderCloudsFront(t,e){this.clouds.forEach(((s,i)=>{this.cloudData[i].z>0&&s.render(t,e)}))}renderCloudsBack(t,e){this.clouds.forEach(((s,i)=>{this.cloudData[i].z<0&&s.render(t,e)}))}setCloud(t){return{x:t||10*Math.random(),y:(0,m.cy)(Math.random(),0,1,0,this.levelSize.h),z:10*(0,m.cy)(Math.random(),0,1,-4,2),scale:1+2*Math.random(),speed:.1+.1*Math.random()}}},w=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,o.A)(this,"reset",(()=>{this.sprite={uv:{x:0,y:0,w:1,h:1},size:{w:1,h:1}},this.step=0})),this.states=t,this.step=0,this.oldStep=this.step,this.nbSteps=1,this.timeout=this.states.time,this.lastFrame=null,this.sprite={uv:{x:0,y:0,w:1,h:1},size:{w:1,h:1}},this.uv=null,this.iteration=null,this.nextState=null,this.currentState=null,this.callbackEndOfAnimation=e,this.scale=1}set(t){void 0!==t&&this.currentState!==t&&(this.currentState=t,this.reload(t))}reload(t){const e=this.states[t];this.uv=e.uv,this.setUV(0),this.nbSteps=this.uv.length,1===this.nbSteps?this.lastFrame=null:(this.step=0,this.timeout=this.uv[this.step].t||this.states.time||100,this.iteration=e.iteration||null,this.nextState=e.next,this.lastFrame=Date.now())}update(){if(this.oldStep=this.step,null!==this.lastFrame){const t=Date.now();t-this.lastFrame>this.timeout&&(this.step<this.nbSteps-1?this.nexStep():this.endOfLoop(),this.setUV(this.step),this.lastFrame=t)}}nexStep(){this.step+=1,this.timeout=this.uv[this.step].t||this.states.time||100}endOfLoop(){1===this.iteration?(this.callbackEndOfAnimation&&this.callbackEndOfAnimation(this.currentState,this.nextState),null!==this.nextState||void 0!==this.nextState?this.set(this.nextState):this.lastFrame=null):this.step=0}get(){return{x:this.sprite.uv.x,y:this.sprite.uv.y,texW:this.states.size.w,texH:this.states.size.h,w:this.sprite.uv.w,h:this.sprite.uv.h,px:this.sprite.uv.px||-1,py:this.sprite.uv.py||-1,refSize:this.states.refSize}}setUV(t){this.sprite.uv={x:this.uv[t].x||0,y:this.uv[t].y||0,w:this.uv[t].w||1,h:this.uv[t].h||1,px:this.uv[t].px,py:this.uv[t].py}}getStatus(){return this.currentState}getStep(){return this.step}isNewStep(){return this.step!==this.oldStep}getRelSize(){const{refSize:t}=this.states,{uv:e}=this.sprite;let s=e.w/t,i=e.h/t,n=void 0!==e.px?-e.px/t:null,o=void 0!==e.py?-e.py/t:null;return s*=this.scale,i*=this.scale,n=null!==n?n*this.scale:null,o=null!==o?o*this.scale:null,{w:s,h:i,px:n,py:o}}setScale(t){this.scale=t}getScale(){return this.scale}getState(){return this.currentState}};var S=s(50416);const b=class extends v{constructor(){super(),this.normalMatrix=new S.A}setNormalMatrix(t){this.normalMatrix.equal(this.model.getMatrice3x3()),this.normalMatrix.inverse(),this.normalMatrix.transpose(),t.setMatrix("normalMatrix",this.normalMatrix.get())}},A=class extends b{constructor(){super(),this.sprite={x:0,y:0,texW:1,texH:1,w:1,h:1}}setProgramSpecifics(t){t.setVector("spriteUV",[this.sprite.x,this.sprite.y]),t.setVector("spriteGrid",[this.sprite.texW,this.sprite.texH]),t.setVector("spriteSize",[this.sprite.w,this.sprite.h]),t.setFloat("spriteRefSize",this.sprite.refSize)}setSprite(t){this.sprite=t}},P=class extends A{constructor(t){super(),this.state=new w(t),this.state.set(t.colors["000"].pattern)}render(t,e,s){e.setTexture(0,s.get(),"textureMap"),this.setSprite(this.state.get()),super.render(t,e)}setState(t){this.state.set(t)}getState(){return this.state.get()}};class C{static setupContext(t){const e=document.createElement("canvas"),s=e.getContext("2d");return e.width=t.width,e.height=t.height,s.drawImage(t,0,0),s}constructor(t,e){this.context=C.setupContext(t),this.levelSize={w:t.width,h:t.height};const{viewBox:s}=e;this.viewBox={x:0,y:0,w:s.w||20,h:s.h||20},this.scrollBox={w:this.viewBox.w/2,h:this.viewBox.h/2},this.smoothTilePos={x:0,y:0},this.tile=new P(e.sprites),this.sprites=e.sprites,this.tileSize=e.tileSize,this.map=this.getData()}getData(){return this.context.getImageData(this.viewBox.x,this.viewBox.y,this.viewBox.w,this.viewBox.h)}update(t){this.tile.setNormalMatrix(t)}render(t,e,s,i){for(let n=0;n<this.map.height;n+=1)for(let o=0;o<this.map.width;o+=1){const h=n*this.map.width+o,r=`${this.map.data[4*h]}${this.map.data[4*h+1]}${this.map.data[4*h+2]}`;if(this.tile.reset(),this.sprites.colors[r]){const h={x:o-this.smoothTilePos.x,y:n-this.smoothTilePos.y},{objType:a,pattern:l,scale:c,z:d}=this.sprites.colors[r];if(this.tile.setState(l),c){const{w:t,refSize:e}=this.tile.getState();this.tile.setScale(c.x,c.y,1);const s=t/e*c.x;this.tile.setTranslate(h.x-.5*(s-1),h.y-(1-c.y),d||0)}else this.tile.setTranslate(h.x,h.y,d||0);this.tile.render(0===a?s:i,t,e)}}}follow(t){let e=t[0]-this.scrollBox.w;e<0&&(e=0),e>this.levelSize.w-this.viewBox.w&&(e=this.levelSize.w-this.viewBox.w);let s=t[1]-this.scrollBox.h;s<0&&(s=0),s>this.levelSize.h-this.viewBox.h&&(s=this.levelSize.h-this.viewBox.h),this.viewBox.x===e&&this.viewBox.y===s||(this.viewBox.x=e,this.viewBox.y=s,this.map=this.getData(),this.smoothTilePos.x=e-Math.floor(e),this.smoothTilePos.y=s-Math.floor(s))}getViewBox(){return this.viewBox}getLevelSize(){return this.levelSize}getTileSize(){return this.tileSize}get(){return this.context}getSmoothTilePos(){return this.smoothTilePos}}const M=C;var T=s(54096);const k=class{constructor(t,e){(0,o.A)(this,"shoudContinue",(()=>{const{DIE:t}=this.constants.states;return this.status!==t})),(0,o.A)(this,"setEndOfAnimation",(t=>{t&&(this.status=t)})),(0,o.A)(this,"reset",(()=>{const{x:t,y:e,z:s,states:i}=this.constants;this.position.set(t||0,e||0,s||0),this.status=i[Object.keys(i)[0]],this.speed.set(0,0,0)})),this.constants=t,this.updateState=e,this.position=new T.A,this.status=null,this.speed=new T.A,this.size=new T.A(t.w||1,t.h||1,1),this.inverseSprite=!1,this.statusChanged=!1,this.reset()}update(){const t=this.shoudContinue();if(t){this.statusChanged=!1;const t=this.status;this.defineNextStatus(),this.updateState&&this.updateState(this.status,this.inverseSprite),t!==this.status&&(this.statusChanged=!0)}return t}isLock(){const{lockStates:t}=this.constants;return t&&-1!==t.indexOf(this.status)}defineNextStatus(){const{JUMP_DOWN:t,RUN_JUMP_DOWN:e}=this.constants.states;this.isLock()||this.speed.getY()<0&&(this.status=t,Math.abs(this.speed.getX())>0&&(this.status=e))}setPosition(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.position.set(t,e,s)}setSize(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.size.set(t,e,s)}setStatus(t){this.status=t}getPosition(){return this.position}getStatus(){return this.status}getSize(){return this.size}getX(){return this.position.getX()}getY(){return this.position.getY()}getZ(){return this.position.getZ()}getSpeed(){return this.speed.get()}getSpeedX(){return this.speed.getX()}getSpeedY(){return this.speed.getY()}addToSpeed(t){this.speed.add(t)}isStatusChanged(){return this.statusChanged}},L=1e-6;class D extends k{static getNearCollisionPoint(t,e){for(let s=0;s<e.length;s+=1)if(D.isCollisionTile(t,e[s].x,e[s].y))return{x:e[s].x,y:e[s].y};return null}static isCollisionTile(t,e,s){const i=t.getImageData(Math.floor(e),Math.floor(s),1,1);return 255!==i.data[0]&&i.data[0]===i.data[1]&&i.data[1]===i.data[2]}static determineStep(t,e){let s=t,i=1;for(;Math.abs(s)>=e;)s/=2,i+=1;return{value:s,step:i}}constructor(t,e,s){super(t,e),this.isCollision={left:!1,right:!1,bottom:!1,top:!1},this.testPoints=this.determineTestPoints(s)}determineTestPoints(t){const{w:e,h:s}=this.constants,{value:i,step:n}=D.determineStep(e,t.w),{value:o,step:h}=D.determineStep(s,t.h),r=[];r.push({x:L,y:-1e-6});for(let t=1;t<n;t+=1)r.push({x:i*t,y:-1e-6});r.push({x:e-L,y:-1e-6});const a=[];a.push({x:L,y:s+L});for(let t=1;t<n;t+=1)a.push({x:i*t,y:s+L});a.push({x:e-L,y:s+L});const l=[];l.push({x:-1e-6,y:L});for(let t=1;t<h;t+=1)l.push({x:-1e-6,y:o*t});l.push({x:-1e-6,y:s-L});const c=[];c.push({x:e+L,y:L});for(let t=1;t<h;t+=1)c.push({x:e+L,y:o*t});c.push({x:e+L,y:s-L});return{left:l,right:c,bottom:r,top:a}}update(t,e){const s=super.update();return s&&this.setCollision(t,e),s}defineNextStatus(){super.defineNextStatus();const{STAND:t,RUN:e}=this.constants.states;this.isLock()||this.isCollision.bottom&&(this.status=t,Math.abs(this.speed.getX())>0&&(this.status=e))}setCollision(t,e){Object.keys(this.isCollision).forEach((s=>{this.setDirectionCollision(t,s,e)})),(this.isCollision.top||this.isCollision.bottom)&&this.speed.setY(0),(this.isCollision.left||this.isCollision.right)&&this.speed.setX(0)}setDirectionCollision(t,e,s){let i=!1;const n="left"===e||"right"===e;switch(e){case"bottom":i=this.speed.getY()<0;break;case"top":i=this.speed.getY()>0;break;case"left":i=this.speed.getX()<0;break;case"right":i=this.speed.getX()>0}if(!this.isCollision[e]&&i){const{value:i,step:o}=D.determineStep(n?this.speed.getX():this.speed.getY(),n?s.w:s.h),h=[],r=this.testPoints[e];for(let t=0;t<=o;t+=1)for(let e=0;e<r.length;e+=1){let s=this.position.getX()+r[e].x,o=this.position.getY()+r[e].y;n?s+=i*t:o+=i*t,h.push({x:s,y:o})}const a=D.getNearCollisionPoint(t,h);if(a){const{w:t,h:s}=this.constants;switch(e){case"bottom":this.position.setY(Math.ceil(a.y));break;case"top":this.position.setY(Math.floor(a.y)-s);break;case"left":this.position.setX(Math.ceil(a.x));break;case"right":this.position.setX(Math.floor(a.x)-t)}this.isCollision[e]=!0}else n?this.position.addX(this.speed.getX()):this.position.addY(this.speed.getY())}else this.isStillCollide(t,e)||(this.isCollision[e]=!1)}isStillCollide(t,e){const s=this.testPoints[e].map((t=>({x:this.position.getX()+t.x,y:this.position.getY()+t.y})));return null!==D.getNearCollisionPoint(t,s)}getCollision(t){return this.isCollision[t]}getCollisionAxeX(){return this.isCollision.left||this.isCollision.right}}const B=D,z=class extends B{update(t,e){const s=super.update(t,e);return s&&this.updateSpeed(),s}updateSpeed(){this.setDamping(),this.setGravity(),this.setClamping()}setGravity(){const{gravity:t}=this.constants.physics;this.isCollision.bottom||this.speed.addY(-t)}setDamping(){const{damping:t}=this.constants.physics;Math.abs(this.speed.getX())>.01?this.speed.multiplyX(t.x):this.speed.setX(0)}setClamping(){const{clamp:t}=this.constants.physics;this.speed.getX()>t.x&&this.speed.setX(t.x),this.speed.getX()<-t.x&&this.speed.setX(-t.x),this.speed.getY()>t.y&&this.speed.setY(t.y),this.speed.getY()<-t.y&&this.speed.setY(-t.y)}},X=class extends z{constructor(t,e,s){super(t,e,s),this.isAnimating=!1,this.aimingStrength=0,this.inverseSprite=!1,this.oldInverseSprite=this.inverseSprite,this.jumpPosition=new T.A}defineNextStatus(){super.defineNextStatus();const{WALL:t,WALL_UP:e,JUMP_UP:s,RUN_JUMP_UP:i}=this.constants.states;this.isLock()||(this.speed.getY()>0&&(this.status=s,Math.abs(this.speed.getX())>0&&(this.status=i)),this.isCollision.bottom?(this.isCollision.left||this.isCollision.right)&&(this.status=t):(this.isCollision.left||this.isCollision.right)&&(this.status=e),this.isCollision.left?this.inverseSprite=!0:this.isCollision.right&&(this.inverseSprite=!1))}setInteraction(t){const{physics:e,states:s}=this.constants,{keys:i}=t,{DASH:n,AIM:o,SLASH:h,JUMP_UP:r,DIE:a}=s;if(this.status===a)return;this.status===o&&(this.aimingStrength=(0,m.cy)(t.getCharge(i.W),0,40,.2,1));const l=this.isCollision.bottom?e.run:e.aircontrol;!this.isCollision.right&&t.isPressed(i.RIGHT)&&(this.speed.addX(l),this.inverseSprite=!1),!this.isCollision.left&&t.isPressed(i.LEFT)&&(this.speed.addX(-l),this.inverseSprite=!0),this.isLock()||this.isCollision.bottom&&(t.isPressedOne(i.SPACE)&&(this.jumpPosition.set(this.position.getX(),this.position.getY(),0),this.speed.addY(e.jump),this.status=r,this.isCollision.bottom=!1),t.isPressedOne(i.SHIFT)&&(this.speed.addX(this.inverseSprite?-e.dash:e.dash),this.status=n),t.isPressed(i.W)&&(this.status=o),t.isPressedOne(i.X)&&(this.status=h)),this.resetValues(t)}resetValues(t){const{states:e}=this.constants,{keys:s}=t,{STAND:i,AIM:n}=e;this.status,this.status!==n||t.isPressed(s.W)||(this.aimingStrength=0,this.status=i)}getLastJumpingPosition(){return this.jumpPosition}isAiming(){return this.aimingStrength}getDashing(){const{DASH:t}=this.constants.states;return this.status===t}},O=class extends B{constructor(t,e,s,i,n){super(t,e,s),this.isAiming=!0,this.goLeft=n,this.position.setX(i.getX()),this.position.setY(i.getY()),this.startPos=i}update(t,e){this.isAiming?(this.position.setX(this.startPos.getX()),this.position.setY(this.startPos.getY())):super.update(t,e)}shoot(){this.isAiming=!1;const{speed:t}=this.constants.physics;this.speed.setX(this.goLeft?-t:t)}setStartPos(t){this.startPos=t}},I=class{constructor(){this.min=Array(3),this.max=Array(3),this.id=0}setup(t){this.id=t;for(let t=0;t<3;t+=1)this.min[t]=new a,this.max[t]=new a,this.min[t].setup(!0,this.id),this.max[t].setup(!1,this.id)}update(t,e,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.setMinMax(t,e,s,t+i,e+n,s+o)}setMinMax(t,e,s,i,n,o){this.min[0].set(t),this.min[1].set(e),this.min[2].set(s),this.max[0].set(i),this.max[1].set(n),this.max[2].set(o)}getID(){return this.id}getMinMax(t,e){return t?this.min[e].get():this.max[e].get()}getMin(t){return this.min[t]}getMax(t){return this.max[t]}},j=class extends v{constructor(){super(),this.sprite={x:0,y:0,texW:1,texH:1,w:1,h:1},this.tint=[1,1,1],this.inverseColor=!1}setProgramSpecifics(t){t.setVector("spriteUV",[this.sprite.x,this.sprite.y]),t.setVector("spriteGrid",[this.sprite.texW,this.sprite.texH]),t.setVector("spriteSize",[this.sprite.w,this.sprite.h]),t.setVector("spritePivot",[this.sprite.px,this.sprite.py]),t.setFloat("spriteRefSize",this.sprite.refSize),t.setVector("tint",this.tint),t.setInt("inverseColor",this.inverseColor?1:0)}setTint(t,e,s){this.tint=[t,e,s]}setInverseColor(t){this.inverseColor=t}setSprite(t){this.sprite=t}},E=class extends j{constructor(t){let{constants:e,sprites:s,viewBox:i}=t;super(),(0,o.A)(this,"updateState",((t,e)=>{this.inverseX=e,this.stateSprite.set(t),this.setSprite(this.stateSprite.get())})),(0,o.A)(this,"setEndOfAnimation",((t,e)=>{e&&this.behavior.setEndOfAnimation(e),t===this.constants.states.DIE&&this.callbackDeath&&this.callbackDeath()})),this.inverseX=!1,this.stateSprite=new w(s,this.setEndOfAnimation),this.viewBox=i,this.constants=e,this.sprites=s,this.worldPos=new T.A,this.reset()}update(t,e){super.update(),this.stateSprite.update(),this.behavior.update(t,e)}render(t,e,s){const{w:i,h:n,px:o,py:h}=this.stateSprite.getRelSize();let r=0;null!==o&&(r=this.inverseX?-i-o:i-(i-o)),this.setScale(i,n,1),this.setTranslate(this.behavior.getX()-this.viewBox.x+r,this.behavior.getY()-this.viewBox.y-(1-n)+(h||0),this.behavior.getZ()),t.setTexture(0,e.get(),"textureMap"),t.setInt("inverseX",this.inverseX?1:0),super.render(s,t),this.setSprite(this.stateSprite.get())}addToSpeed(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.behavior.addToSpeed(new T.A(t,e,s))}getX(){return this.behavior.getPosition().getX()}getPosition(){return this.behavior.getPosition().get()}getWorldPosition(){return this.worldPos.set(this.behavior.getX()-this.viewBox.x,this.behavior.getY()-this.viewBox.y,this.behavior.getZ()).get()}getInverseX(){return this.inverseX}getStatus(){return this.behavior.getStatus()}isStatusChanged(){return this.behavior.isStatusChanged()}getConstants(){return this.constants}reset(){this.stateSprite.reset(),this.stateSprite.set(this.constants.states[Object.keys(this.constants.states)[0]]),this.setSprite(this.stateSprite.get())}},U=class extends E{constructor(t){let{constants:e,sprites:s,viewBox:i}=t;super({constants:e,sprites:s,viewBox:i}),this.collisionBox=new I,this.collisionBox.setup(e.id),this.collisionCallback=null}update(t,e){super.update(t,e),this.collisionBox.update(...this.getCollisionInfos())}getCollisionBox(){return this.collisionBox}getCollisionInfos(){const{w:t,h:e}=this.constants;return[...this.getPosition(),t,e]}getId(){return this.constants.id}setCallbacks(t){let{addBoxes:e,removeBox:s}=t;this.collisionCallback={addBoxes:e,removeBox:s}}},N=class extends U{constructor(t){let{constants:e,sprites:s,viewBox:i,tileSize:n,startPos:o,goLeft:h}=t;super({constants:e,sprites:s,viewBox:i}),this.behavior=new O(e,null,n,o,h),this.inverseX=h,this.startPos=o,this.isShooted=!1}update(t,e,s,i){this.isShooted||this.setAimingStrength(i),this.behavior.setStartPos(s),super.update(t,e)}shoot(t){this.isShooted=!0,this.stateSprite.set(t),this.setAimingStrength(1),this.behavior.shoot()}isCollide(){return this.behavior.getCollisionAxeX()}setAimingStrength(t){this.stateSprite.setScale(t)}},R=class{constructor(t,e,s){this.bullets=[],this.isAiming=!1,this.viewBox=s,this.callbackShoot=null,this.callbackCollide=null,this.sprites=e,this.constants=t,this.recoil=t.physics.recoil,this.numero=0}update(t,e,s,i,n){!this.isAiming&&i?this.createNewOne(s,n,e):this.isAiming&&!i&&this.shootOne();const o=[];this.bullets.forEach(((n,h)=>{n.update(t,e,s,i),n.isCollide()&&(o.push(h),this.callbackCollide&&this.callbackCollide(n.getId()))})),o.length>0&&(this.bullets=this.bullets.filter(((t,e)=>-1===o.indexOf(e)))),this.isAiming=i}createNewOne(t,e,s){this.bullets.push(new N({id:`${this.constants.id}${this.numero}`,constants:this.constants,sprites:this.sprites,viewBox:this.viewBox,tileSize:s,startPos:t,goLeft:e})),this.numero+=1}shootOne(){if(this.bullets.length>0){const t=this.bullets[this.bullets.length-1];t.shoot(this.constants.states.BULLET),this.callbackShoot&&this.callbackShoot(t.getId(),t.getCollisionBox(),this.recoil)}}removeOne(t){this.bullets=this.bullets.filter((e=>e.getId()!==t))}render(t,e,s){this.bullets.forEach((i=>{i.render(t,e,s)}))}setCallbackShoot(t){this.callbackShoot=t}setCallbackCollide(t){this.callbackCollide=t}get(){return this.bullets.map((t=>t.getPosition()))}getConstants(){return this.constants}},Y=class extends j{constructor(t,e,s,i,n,o){super(),this.inverseX=!1,this.stateSprite=new w(e,o),this.stateSprite.set(t.states[Object.keys(t.states)[0]]),this.viewBox=s,this.constants=t,this.sprites=e,this.position=new T.A(i.getX()||t.x||0,i.getY()||t.y||0,i.getZ()||t.z||0),this.stateSprite.reload(n)}update(t){super.update(t),this.stateSprite.update()}render(t,e,s){const{w:i,h:n,px:o,py:h}=this.stateSprite.getRelSize();let r=0;null!==o&&(r=this.inverseX?-i-o:i-(i-o)),this.setScale(i,n,1),this.setTranslate(this.position.getX()-this.viewBox.x+r,this.position.getY()-this.viewBox.y-(1-n)+(h||0),this.position.getZ()),t.setTexture(0,e.get(),"textureMap"),t.setInt("inverseX",this.inverseX?1:0),super.render(s,t),this.setSprite(this.stateSprite.get())}setInverseX(t){this.inverseX=t}},_=class{constructor(t,e,s){(0,o.A)(this,"endOfAnimation",(t=>()=>{delete this.fxs[t]})),this.fxs={},this.isAiming=!1,this.viewBox=s,this.sprites=e,this.constants=t,this.cpt=0}update(){Object.keys(this.fxs).forEach((t=>{this.fxs[t].update()}))}createNewOne(t,e){this.fxs[this.cpt]=new Y(this.constants,this.sprites,this.viewBox,t,e,this.endOfAnimation(this.cpt)),this.cpt+=1}render(t,e,s){Object.keys(this.fxs).forEach((i=>{this.fxs[i].render(t,e,s)}))}getConstants(){return this.constants}},W=class extends U{constructor(t){let{constants:e,sprites:s,viewBox:i}=t;super({constants:e,sprites:s,viewBox:i}),(0,o.A)(this,"setCallbackDeath",(t=>{this.callbackDeath=t})),(0,o.A)(this,"setLife",(t=>{this.life=t,this.bar.setAttribute("value",this.life)})),(0,o.A)(this,"setDamage",(t=>{this.life-=t,this.targetDamage.setDirect(2),this.bar&&this.bar.setAttribute("value",this.life),this.life<=0&&(this.behavior.setStatus(this.constants.states.DIE),this.stateSprite.set(this.constants.states.DIE),this.collisionCallback.removeBox(this.constants.id))})),(0,o.A)(this,"insert",(t=>{t&&t.appendChild(this.bar)})),this.life=e.life,this.callbackDeath=null,this.targetDamage=new r.A(0,.1),e.displayLife&&(this.bar=document.createElement("meter"),this.bar.setAttribute("data-id",e.id),this.bar.setAttribute("min",0),this.bar.setAttribute("max",e.life),this.bar.setAttribute("value",this.life),this.insert(document.querySelector("#gameinfos")))}update(t,e){super.update(t,e),this.collisionBox.update(...this.getCollisionInfos()),this.targetDamage.update()}render(t,e,s){t.setFloat("damage",this.targetDamage.get()),super.render(t,e,s)}getLife(){return this.life}reset(){super.reset(),this.life=this.constants.life,this.bar&&this.bar.setAttribute("value",this.life)}};class V extends W{constructor(t){let{constants:e,sprites:s,viewBox:i,fxs:n}=t;super({constants:e,sprites:s,viewBox:i}),n&&(this.fxs=new _(n.constants,n.sprites,i))}update(t,e){if(super.update(t,e),this.fxs){this.fxs.update();const{JUMP_UP:t,RUN_JUMP_UP:e}=this.constants.states,{DUST:s}=this.fxs.getConstants().states,i=this.getStatus(),n=this.getLastJumpingPosition(),o=this.getLastRunningPosition();!this.isStatusChanged()||i!==t&&i!==e||this.fxs.createNewOne(n,s),null!==o&&this.fxs.createNewOne(o,s)}}renderFxs(t,e,s){this.fxs.render(t,e,s)}getLastJumpingPosition(){return this.behavior.getLastJumpingPosition()}getLastRunningPosition(){return this.behavior.getStatus()!==this.constants.states.RUN||!this.stateSprite.isNewStep()||0!==this.stateSprite.getStep()&&2!==this.stateSprite.getStep()?null:this.behavior.getPosition()}}class H extends V{constructor(t){let{constants:e,sprites:s,viewBox:i,fxs:n,bullets:h}=t;if(super({constants:e,sprites:s,viewBox:i,fxs:n}),(0,o.A)(this,"callbackBulletShoot",((t,e,s)=>{this.setRecoil(s),this.collisionCallback.addBoxes([e])})),(0,o.A)(this,"callbackBulletCollide",(t=>{this.collisionCallback.removeBox(t)})),(0,o.A)(this,"setRecoil",(t=>{this.behavior.addToSpeed(new T.A(this.inverseX?t:-t,0,0))})),(0,o.A)(this,"removeBullet",(t=>{this.bullets.removeOne(t)})),this.offsetAiming=this.getAimingOffsetVector(),this.aimingPos=new T.A,h){const t=`${e.id}-${h.constants.id}`;this.bullets=new R({...h.constants,id:t},h.sprites,i),this.bullets.setCallbackShoot(this.callbackBulletShoot),this.bullets.setCallbackCollide(this.callbackBulletCollide)}}update(t,e){super.update(t,e),this.aimingPos.equal(this.behavior.getPosition()),this.aimingPos.addX(this.inverseX?this.offsetAiming.invX:this.offsetAiming.x),this.aimingPos.addY(this.offsetAiming.y),this.bullets&&this.bullets.update(t,e,this.aimingPos,this.isAiming(),this.inverseX)}renderBullets(t,e,s){this.bullets.render(t,e,s)}getAimingOffsetVector(){const{refSize:t}=this.sprites,{w:e,cx:s,cy:i}=this.sprites[this.constants.states.AIM].uv[0];return{x:s/t,y:i/t,invX:(e-s)/t}}getAimingPos(){return this.aimingPos}getAimingPosition(){const{h:t}=this.stateSprite.getRelSize();return new T.A(this.behavior.getX()-this.viewBox.x+(this.inverseX?this.offsetAiming.invX:this.offsetAiming.x),this.behavior.getY()-this.viewBox.y-t+this.offsetAiming.y,this.behavior.getZ())}isAiming(){return this.behavior.isAiming()}}const F=class extends H{constructor(t){let{constants:e,sprites:s,viewBox:i,tileSize:n,bullets:h,fxs:r}=t;super({constants:e,sprites:s,viewBox:i,bullets:h,fxs:r}),(0,o.A)(this,"setInteraction",(t=>{this.behavior.setInteraction(t)})),this.behavior=new X(e,this.updateState,n)}getDashing(){return this.behavior.getDashing()}reset(){this.behavior&&this.behavior.reset(),super.reset()}},J=class extends z{updateSpeed(){super.updateSpeed(),this.isCollision.left?this.inverseSprite=!1:this.isCollision.right&&(this.inverseSprite=!0),this.isCollision.bottom&&this.speed.addX((this.inverseSprite?-1:1)*this.constants.physics.run)}},Z=class extends W{constructor(t){let{constants:e,sprites:s,viewBox:i,tileSize:n}=t;super({constants:e,sprites:s,viewBox:i}),(0,o.A)(this,"reset",(()=>{super.reset(),this.behavior&&this.behavior.reset()})),this.behavior=new J(e,this.updateState,n),this.setInverseColor(!0)}},$=class extends g.A{constructor(t,e){super(t,e),(0,o.A)(this,"updateCollisionsInteractions",(()=>{const t=this.collisions.get();t.length>0&&t.forEach((t=>{let{type:e,on:s,from:i,bulletId:n}=t;switch(e){case"SIMPLE":{const t=this.interactives[s],e=this.interactives[i];"SLASH"===t.getStatus()?(e.addToSpeed(e.getX()<t.getX()?-1:1),e.setDamage(30)):(t.addToSpeed(e.getX()<t.getX()?1:-1),t.setDamage(10));break}case"SHOOT":{const t=this.interactives[s],e=this.interactives[i];t.addToSpeed(e.getX()<t.getX()?1:-1),t.setDamage(10),this.collisions.removeBox(n),e.removeBullet(n);break}}}))})),(0,o.A)(this,"setPause",(t=>{this.isPause=t})),this.targetRGB=new r.A(0,.1),this.targetWave=new r.A(0,.1),this.oldInverse=!1,this.oldAiming=!1,this.isPause=!0,this.interactives={},this.tilemap=null}setupGameLevel(t,e,s){if(this.config.game){const{types:i}=this.config.game,{tilemap:n,interactives:o}=t,{tileSize:h}=n;this.tilemap=new M(e,n);const r=this.tilemap.getViewBox();Object.keys(o).forEach((t=>{const e=o[t],{type:n,x:a,y:l}=e;if(i[n]){const e=i[n],o={...e.constants,x:a,y:l,id:t},{sprites:c}=e;switch(n){case"heros":{const{fxs:i,bullets:n}=e;this.interactives[t]=new F({constants:o,sprites:c,viewBox:r,tileSize:h,bullets:n,fxs:i}),this.interactives[t].setCallbackDeath(s);break}case"monster":this.interactives[t]=new Z({constants:o,sprites:c,viewBox:r,tileSize:h})}}}));const a=Object.keys(this.interactives).map((t=>this.interactives[t].getCollisionBox()));this.background=new y(r,this.tilemap.getLevelSize()),this.collisions=new p(a);const{addBoxes:l,removeBox:c}=this.collisions;Object.keys(this.interactives).forEach((t=>{this.interactives[t].setCallbacks({addBoxes:l,removeBox:c})}))}}resetGameLevel(){Object.keys(this.interactives).forEach((t=>{this.interactives[t].reset()})),this.collisions.clear();const t=Object.keys(this.interactives).map((t=>this.interactives[t].getCollisionBox()));this.collisions.addBoxes(t)}update(t){super.update(t);const{heros:e}=this.interactives,s=e.getWorldPosition(),i=e.getPosition(),n=this.tilemap.get();if(this.camera.followPosY(s[1]),this.tilemap.follow(i),this.tilemap.update(this.mngProg.get("spritePhong")),!this.isPause){const t=this.tilemap.getTileSize();Object.keys(this.interactives).forEach((e=>{this.interactives[e].update(n,t)})),this.updateCollisionsInteractions()}}renderPause(){super.render(),this.renderBackground(),this.renderTilemap()}mainRender(){this.renderBackground(),this.renderTilemap(),this.renderInteractives(),this.renderForeground()}renderTilemap(){this.tilemap.render(this.mngProg.get("spritePhong"),this.mngTex.get("level1"),this.mngObj.get("cubeTile"),this.mngObj.get("tile"))}renderInteractives(){Object.keys(this.interactives).forEach((t=>{this.interactives[t].render(this.mngProg.get("sprite"),this.mngTex.get("heros"),this.mngObj.get("tile"))}));const{heros:t}=this.interactives;t.renderFxs(this.mngProg.get("sprite"),this.mngTex.get("fx"),this.mngObj.get("tile")),t.renderBullets(this.mngProg.get("sprite"),this.mngTex.get("bullet"),this.mngObj.get("tile"))}renderBackground(){const{heros:t}=this.interactives,e=t.getX(),s=this.mngProg.get("background");this.background.renderMountains(this.mngObj.get("tile"),this.mngProg.get("color")),this.background.updateScreens(-.15),s.setTexture(0,this.mngTex.get("clouds").get(),"textureMap"),this.background.renderScreen(this.mngObj.get("tile"),s,e,5e-4),this.background.updateScreens(-.1),s.setTexture(0,this.mngTex.get("rocks").get(),"textureMap"),this.background.renderScreen(this.mngObj.get("tile"),s,e,.001),this.background.updateScreens(-.05),s.setTexture(0,this.mngTex.get("ground").get(),"textureMap"),this.background.renderScreen(this.mngObj.get("tile"),s,e,.005),this.background.renderCloudsBack(this.mngObj.get("tile"),this.mngProg.get("color"))}renderForeground(){this.background.renderCloudsFront(this.mngObj.get("tile"),this.mngProg.get("color"))}effects(){const{heros:t}=this.interactives,e=t.getAimingPosition(),s=t.getInverseX(),i=t.isAiming();this.targetRGB.update(),this.targetWave.update(),s!==this.oldInverse&&(this.camera.setSmoothRotation(s?.4:-.4),this.camera.setSmoothTarget(s?-4:4),this.oldInverse=s),i!==this.oldAiming&&(this.targetWave.set(i?.01:0),this.camera.setSmoothZoom(i?.8:1),this.oldAiming=i),this.targetRGB.set(t.getDashing()||this.isPause?2:0);const n=this.camera.get2dTexturePoint(e),o=this.targetRGB.get();this.postProcess.setRGB(o,o,e.getX(),e.getY()),this.postProcess.setWave(.01*this.time,this.targetWave.get(),n)}render(){super.render(),this.postProcess.start(),this.mainRender(),this.postProcess.end(),this.effects(),this.postProcess.render()}setKeyboardInteraction(t){if(!this.isPause){const{heros:e}=this.interactives;e.setInteraction(t)}}},G=class extends ${constructor(t,e){super(t,e),(0,o.A)(this,"callbackDeath",(()=>{this.setPause(!0),this.isSplashScreen=!0,this.splash.showRestart(),this.resetGameLevel()})),this.isSplashScreen=!0,this.needReset=!1,this.splash=new h,this.splash.showReady(),this.currentLevel=0}async setupAssets(t){const{levels:e,...s}=t;await super.setupAssets(s);const{levels:i}=this.config.game;if(i){const t=i[this.currentLevel],s=e[t.tilemap.texture];this.setupGameLevel(t,s,this.callbackDeath)}}setKeyboardInteraction(t){super.setKeyboardInteraction(t),this.isSplashScreen&&t.isPressedOne(this.config.keyboard.ENTER)&&(this.setPause(!1),this.splash.hide(),this.isSplashScreen=!1),t.isPressedOne(this.config.keyboard.ECHAP)&&(this.isSplashScreen=!this.isSplashScreen,this.setPause(this.isSplashScreen),this.isSplashScreen?this.splash.showPause():this.splash.hide())}};var q=s(85072),K=s.n(q),Q=s(97825),tt=s.n(Q),et=s(77659),st=s.n(et),it=s(55056),nt=s.n(it),ot=s(10540),ht=s.n(ot),rt=s(41113),at=s.n(rt),lt=s(3199),ct={};ct.styleTagTransform=at(),ct.setAttributes=nt(),ct.insert=st().bind(null,"head"),ct.domAPI=tt(),ct.insertStyleElement=ht();K()(lt.A,ct);lt.A&&lt.A.locals&&lt.A.locals;s(19513),s(807);let dt=null;const ut=async()=>{dt=new i.A,await dt.setup(G,n.default);const t=document.querySelector(`#${n.default.slug}`),e=dt.getCanvas();e&&t&&t.appendChild(e)},pt=()=>{dt?.destroy&&dt.destroy()}},41113(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},55056(t,e,s){t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},55420(t,e,s){s.d(e,{A:()=>r});var i=s(31601),n=s.n(i),o=s(76314),h=s.n(o)()(n());h.push([t.id,"#fullscreen-toggle-btn {\n\tborder-radius: 0;\n\tmargin: 0;\n\tpadding: 4px;\n\tborder: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n\ttransform: scale(0.8);\n\topacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n\tdisplay: block;\n\twidth: 2em;\n\tfill: #fff;\n\topacity: 0.8;\n\ttransform: scale(0.6);\n\ttransition:\n\t\topacity 300ms ease-out,\n\t\ttransform 300ms ease-out;\n}\n\n[data-fullscreen] {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n",""]);const r=h},66172(t,e,s){s.d(e,{A:()=>u});var i=s(54096),n=s(23876),o=s(67269),h=s(3195),r=s(10334);const a=class{constructor(t){this.gl=t,this.objet=new r.A(this.gl,h.A),this.model=new o.A,this.model.identity()}render(t){t.setMatrix("model",this.model.get()),this.objet.render(t.get())}update(t,e){this.model.identity().scale(e.getX(),e.getY(),e.getZ()).translate(t.getX(),t.getY(),t.getZ())}getModel(){return this.model}};var l=s(82669);const c=class extends n.A{constructor(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1024,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1024,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(e),this.gl=t,this.fbo=new l.A(this.gl,s,n,o),this.sizeRepere=new i.A(.05,.05,.05),this.repere=new a(this.gl),this.repere.update(this.position,this.sizeRepere),this.lookAt()}start(){this.fbo.start()}end(){this.fbo.end()}move(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.position.set(Math.cos(.002*t)*(4+e),this.position.getY(),Math.sin(.002*t)*(4+e)),this.lookAt(),this.repere.update(this.position,this.sizeRepere)}renderRepere(t){this.repere.render(t)}getDepthTexture(){return this.fbo.getDepthTexture()}setDepthProgram(t){t.setMatrix("projection",this.getOrtho().get()),t.setMatrix("view",this.getView().get())}setShadowProgram(t){t.setTexture(2,this.getDepthTexture().get(),"shadowMap"),t.setMatrix("shadowView",this.getView().get()),t.setMatrix("shadowProjection",this.getOrtho().get()),t.setVector("posLum",this.getPosition())}resize(t){this.fbo.resize(t)}};var d=s(72985);const u=class extends d.A{constructor(t,e){super(t,e);const s=this.canUseDepth(),{width:i,height:n}=e.canvas;this.lampes=e.lampes?.map((e=>new c(t,e,i,n,s)))||[]}async setupAssets(t){await super.setupAssets(t);const e=this.mngProg.getAll();Object.keys(e).forEach((t=>{const s=e[t];s.getLocations().numLights&&this.setLampeInfos(s)}))}renderReperes(){this.lampes.forEach((t=>{t.renderRepere(this.camera)}))}randomLampesPositions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.lampes.forEach(((s,i)=>{(null===e||null!==e&&i===e)&&s.move(this.time*t,i)}))}setLampeInfos(t){t.setVector("posEye",this.camera.getPosition()),t.setInt("numLights",this.lampes.length),this.config.lampes.forEach(((e,s)=>{const{type:i,ambiant:n,diffuse:o,specular:h,brillance:r,radius:a,direction:l,strength:c}=e;t.setInt(`lights[${s}].type`,i),t.setVector(`lights[${s}].position`,this.lampes[s].getPosition()),t.setVector(`lights[${s}].ambiant`,n),t.setVector(`lights[${s}].diffuse`,o),t.setVector(`lights[${s}].specular`,h),r&&t.setFloat(`lights[${s}].brillance`,r),a&&t.setFloat(`lights[${s}].radius`,a),l&&t.setVector(`lights[${s}].direction`,l),t.setFloat(`lights[${s}].strength`,c||1)}))}render(){super.render(),"function"==typeof this.renderBasiqueForLampeDepth&&this.renderBasiqueForLampeDepth(),this.mngProg.setCameraMatrix(this.camera,!!this.config.camera.ortho)}getLampe(t){return this.lampes[t]?this.lampes[t]:null}resize(t){super.resize(t),this.lampes.forEach((e=>{e.resize(t)}))}}},67507(t,e,s){s.r(e),s.d(e,{default:()=>ct});var i=s(84432);const n={id:"bullet",x:0,y:0,z:.4,w:.5,h:.5,damage:10,physics:{speed:.5,recoil:.1},states:{BULLET_LOAD:"BULLET_LOAD",BULLET:"BULLET"}},o={id:"fx",states:{DUST:"DUST"}},h="DASH",r="SLASH",a="JUMP_LOAD",l={id:"heros",x:4,y:5,z:.1,w:.5,h:1,life:100,displayLife:!0,physics:{run:.1,jump:.6,aircontrol:.05,dash:2,gravity:.05,damping:{x:.8,y:.8},clamp:{x:.4,y:.5}},states:{STAND:"STAND",RUN:"RUN",JUMP_UP:"JUMP_UP",JUMP_DOWN:"JUMP_DOWN",DASH:h,AIM:"AIM",RUN_JUMP_UP:"RUN_JUMP_UP",RUN_JUMP_DOWN:"RUN_JUMP_DOWN",DIE:"DIE",SLASH:r,SLASH_2:"SLASH_2",SLASH_3:"SLASH_3",SLOW_DOWN:"SLOW_DOWN",JUMP_LOAD:a,WALL:"WALL",WALL_UP:"WALL_UP",LAND:"LAND"},lockStates:["AIM",r,h,a],combos:{attack:[{key:i.X,cancel:!1,threshold:1e3,sprite:"up"},{key:i.X,cancel:!1,threshold:1e3,sprite:"down"},{key:i.X,cancel:!1,sprite:"run"}]}},c={id:"monster",x:10,y:4,z:.2,w:.5,h:1,life:100,physics:{run:.1,jump:0,gravity:.05,damping:{x:0,y:0},clamp:{x:1,y:1}},states:{STAND:"STAND",RUN:"RUN",JUMP_DOWN:"JUMP_DOWN",DIE:"DIE"}},{BULLET:d,BULLET_LOAD:u}=n.states,p={size:{w:64,h:256},time:100,refSize:57,[d]:{uv:[{x:0,y:0,w:35,h:17},{x:0,y:17,w:49,h:32}]},[u]:{uv:[{x:0,y:49,w:54,h:54,px:0,py:27},{x:0,y:103,w:38,h:39,px:0,py:19}]}},{DUST:g}=o.states,m={size:{w:32,h:64},time:200,refSize:57,[g]:{uv:[{x:0,y:0,w:26,h:19},{x:0,y:19,w:26,h:14},{x:0,y:33,w:29,h:12}],iteration:1}},{STAND:x,RUN:v,JUMP_UP:f,JUMP_DOWN:y,DASH:w,AIM:S,RUN_JUMP_UP:b,RUN_JUMP_DOWN:A,DIE:P,SLASH:C,SLASH_2:M,SLASH_3:T,WALL:k,WALL_UP:L,LAND:D,JUMP_LOAD:B,SLOW_DOWN:z}=l.states,X={size:{w:256,h:512},time:100,refSize:57,[x]:{uv:[{x:28,y:239,w:26,h:57,t:1e3},{x:0,y:239,w:28,h:57,t:1e3}]},[v]:{uv:[{x:39,y:80,w:40,h:47},{x:106,y:34,w:40,h:45},{x:0,y:80,w:39,h:47},{x:79,y:80,w:39,h:47}]},[w]:{uv:[{x:84,y:0,w:99,h:28,px:90,py:0},{x:146,y:34,w:100,h:46,px:90,py:0}],iteration:1,next:x},[B]:{uv:[{x:0,y:34,w:50,h:37}]},[f]:{uv:[{x:199,y:128,w:44,h:55},{x:99,y:183,w:44,h:56}]},[y]:{uv:[{x:173,y:239,w:33,h:64},{x:206,y:239,w:34,h:64}]},[b]:{uv:[{x:118,y:128,w:39,h:52},{x:157,y:128,w:42,h:52}]},[A]:{uv:[{x:186,y:183,w:42,h:56},{x:143,y:183,w:43,h:56}]},[z]:{uv:[{x:83,y:239,w:61,h:58}]},[S]:{uv:[{x:83,y:239,w:61,h:58,cx:57,cy:41}]},[D]:{uv:[{x:183,y:0,w:45,h:34}]},[k]:{uv:[{x:54,y:239,w:29,h:58}]},[L]:{uv:[{x:144,y:239,w:29,h:58}]},[P]:{uv:[{x:50,y:34,w:56,h:40,t:1e3},{x:0,y:0,w:84,h:18,t:1e3}],iteration:1},[C]:{uv:[{x:0,y:303,w:57,h:75,t:50,px:24},{x:57,y:303,w:118,h:95,t:50,px:31},{x:0,y:128,w:72,h:48,t:100,px:43}],iteration:1,next:x},[M]:{uv:[{x:118,y:80,w:78,h:48},{x:0,y:183,w:99,h:55}],iteration:1,next:x},[T]:{uv:[{x:72,y:128,w:46,h:51},{x:175,y:303,w:79,h:106}],iteration:1,next:x}},{STAND:O,RUN:I,JUMP_DOWN:j,DIE:E}=c.states,U={size:{w:256,h:512},time:100,refSize:57,[O]:{uv:[{x:28,y:239,w:26,h:57,t:1e3},{x:0,y:239,w:28,h:57,t:1e3}]},[I]:{uv:[{x:39,y:80,w:40,h:47},{x:106,y:34,w:40,h:45},{x:0,y:80,w:39,h:47},{x:79,y:80,w:39,h:47}]},[j]:{uv:[{x:173,y:239,w:33,h:64},{x:206,y:239,w:34,h:64}]},[E]:{uv:[{x:50,y:34,w:56,h:40},{x:0,y:0,w:84,h:18}],iteration:1}},N=0,R=1,Y=2,_=3,W=4,V=5,H=6,F=7,J=8,Z=9,$=10,G=11,q=12,K=13,Q=14,tt=15,et=16,st=17,it=18,nt=19,ot=20,ht=21,rt=22,at=23,lt={size:{w:256,h:256},refSize:64,objTypes:{CUBE:0,FLAT:1},colors:{"000":{pattern:9,objType:1},150150150:{pattern:10,objType:1},"00255":{pattern:10,objType:1,z:-1},25500:{pattern:10,objType:1},"02500":{pattern:10,objType:1},"02550":{pattern:12,objType:1,scale:{x:2,y:2},z:-.4},"02000":{pattern:13,objType:1,z:1},"01500":{pattern:14,objType:1,scale:{x:1.5,y:1.5},z:-.5},"01000":{pattern:15,objType:1},1e4:{pattern:0,scale:{x:2,y:2},objType:1}},[N]:{uv:[{x:166,y:26,w:52,h:52}]},[R]:{uv:[{x:57,y:0,w:52,h:26}]},[Y]:{uv:[{x:109,y:0,w:52,h:26}]},[_]:{uv:[{x:0,y:0,w:57,h:16}]},[W]:{uv:[{x:0,y:78,w:52,h:52}]},[V]:{uv:[{x:0,y:26,w:57,h:27}]},[H]:{uv:[{x:161,y:0,w:52,h:26}]},[F]:{uv:[{x:52,y:78,w:52,h:52}]},[J]:{uv:[{x:104,y:78,w:45,h:52}]},[Z]:{uv:[{x:38,y:187,w:64,h:64}]},[$]:{uv:[{x:102,y:187,w:64,h:64}]},[G]:{uv:[{x:166,y:187,w:64,h:64}]},[q]:{uv:[{x:14,y:131,w:40,h:54}]},[K]:{uv:[{x:91,y:131,w:45,h:54}]},[Q]:{uv:[{x:173,y:131,w:44,h:56}]},[tt]:{uv:[{x:0,y:187,w:38,h:56}]},[et]:{uv:[{x:136,y:131,w:37,h:54}]},[st]:{uv:[{x:124,y:26,w:42,h:51}]},[it]:{uv:[{x:149,y:78,w:28,h:52}]},[nt]:{uv:[{x:84,y:26,w:40,h:50}]},[ot]:{uv:[{x:0,y:131,w:14,h:53}]},[ht]:{uv:[{x:57,y:26,w:27,h:50}]},[rt]:{uv:[{x:54,y:131,w:37,h:54}]},[at]:{uv:[{x:177,y:78,w:44,h:53}]}},ct={slug:"game",assets:["/textures/heros.avif","/textures/fx.avif","/textures/bullet.avif","/textures/level1.avif","/textures/rocks.avif","/textures/ground.avif","/textures/clouds.avif","/obj/tile.obj","/obj/cube.obj","/obj/cubeTile.obj","/levels/level3.bmp"],shaders:["/camera/color.js","/camera/sprite.js","/camera/spritePhong.js","/camera/albedoPhong.js","/camera/background.js","/screen/fxaa.js","/screen/rgb.js","/screen/wave.js","/screen/blurDirection.js","/screen/pixel.js","/screen/screen.js","/screen/debug.js"],postprocess:!0,camera:{position:{x:10,y:10,z:22},target:{x:10,y:10,z:0},near:1,far:1e3,angle:40},lampes:[{type:0,position:{x:0,y:0,z:0},ambiant:[1,1,1],diffuse:[1,.9,.9],specular:[0,0,0],strength:1,brillance:200}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},keyboard:{UP:i.UP,DOWN:i.PX,LEFT:i.M3,RIGHT:i.NS,SPACE:i.t6,SHIFT:i.FX,X:i.X,W:i.W,ENTER:i.Fm,ECHAP:i.m$},useDepthTexture:!1,splashscreen:!1,canvas:{width:1024,height:1024},game:{types:{heros:{constants:l,sprites:X,fxs:{constants:o,sprites:m},bullets:{constants:n,sprites:p}},monster:{constants:c,sprites:U}},levels:[{name:"level 1",tilemap:{texture:"level3",tileSize:{w:1,h:1},viewBox:{w:20,h:10},sprites:lt},interactives:{heros:{type:"heros",x:4,y:5,z:.1},"monster-1":{type:"monster",x:10,y:4,z:.2}}}]}}},71907(t,e,s){s.d(e,{A:()=>h});var i=s(67269),n=s(54096),o=s(23876);const h=class extends o.A{constructor(t){super(t),this.matIdentity=new i.A,this.projection=new i.A,this.projection.identity(),this.near=t.near??1,this.far=t.far??100,this.angle=t.angle??50,this.matIdentity.identity(),this.lookAt()}update(){this.lookAt()}perspective(t,e){this.projection.identity().perspective(this.angle,t/e,this.near,this.far)}moveAroundCenter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.position.set(Math.cos(t)*e,Math.sin(t)*(2+e),Math.sin(t)*e),this.lookAt()}move(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.position.set(this.position.getX(),Math.sin(.02*t)*(2+e),this.position.getZ()),this.lookAt()}setNearFar(t,e){this.near=t,this.far=e}setAngle(t){this.angle=t}getModeProjection(){return this.ortho??this.projection}getProjection(){return this.projection}getViewProjection(){const t=new i.A;return t.identity(),t.multiply(this.getView()),t.multiply(this.getProjection()),t}getInverseViewProjection(){return this.getViewProjection().inverse()}unproject(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;const i=new n.A(t,e,s),o=this.getInverseViewProjection();return i.multiplyMatrix(o)}getRayFromNDC(t,e){const s=this.getInverseViewProjection(),i=new n.A(t,e,0).multiplyMatrix(s),o=new n.A(t,e,1).multiplyMatrix(s);return{origin:i,dir:new n.A(o.getX(),o.getY(),o.getZ()).minus(i).normalise()}}worldToNDC(t){const e=this.getViewProjection();return new n.A(t.getX(),t.getY(),t.getZ()).multiplyMatrix(e)}worldToRelativeScreen(t,e){const s=this.worldToNDC(t);return{x:(.5*s.getX()+.5)*e.width,y:(1-(.5*s.getY()+.5))*e.height}}getIdentity(){return this.matIdentity}getNearFar(){return[this.near,this.far]}getNear(){return this.near}getFar(){return this.far}getAngle(){return this.angle}getReflectViewMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const e=2*(this.position.getY()-t);return(new i.A).identity().lookAt(this.position.getX(),this.position.getY()-e,this.position.getZ(),this.target.getX(),this.target.getY(),this.target.getZ(),0,1,0)}}},72985(t,e,s){s.d(e,{A:()=>c});var i=s(99594),n=s(67269),o=s(19365),h=s(71907);const r=class extends h.A{get2dTexturePoint(t){const e=t.getX(),s=t.getY(),i=t.getZ(),h=new o.A(e,s,i,1),r=new n.A;r.equal(this.view).multiply(this.projection),h.multiplyMatrix(r);let a=h.getX()/h.getW(),l=h.getY()/h.getW();return a=.5*(a+1),l=.5*(l+1),[a,l]}get2dScreenPoint(t,e){const s=this.get2dTexturePoint(t);return[s[0]*e.width,s[1]*e.height]}},a=class extends r{constructor(t){super(t),this.options=t,this.rotationX=new i.A,this.targetX=new i.A,this.zoomZ=new i.A(.7,.1)}update(){super.update(),this.rotationX.update(),this.zoomZ.update(),this.targetX.update(),this.position.set(this.options.position.x+this.targetX.get()+Math.sin(this.rotationX.get())*(this.options.position.z*this.zoomZ.get()),this.options.position.y,Math.cos(this.rotationX.get())*(this.options.position.z*this.zoomZ.get())),this.target.set(this.options.target.x,this.options.target.y,this.options.target.z)}setSmoothTarget(t){this.targetX.set(t)}setSmoothRotation(t){this.rotationX.set(t)}setSmoothZoom(t){this.zoomZ.set(t)}getZoom(){return this.zoomZ.get()}followPos2D(t,e){this.options.position.x=t,this.options.position.y=e,this.options.target.x=t,this.options.target.y=e}followPosY(t){this.options.position.y=t,this.options.target.y=t}};var l=s(76717);const c=class extends l.A{constructor(t,e){super(t,e),this.camera=new a(e.camera),this.camera.perspective(this.containerSize.width,this.containerSize.height)}resize(t){super.resize(t),this.camera.perspective(this.containerSize.width,this.containerSize.height)}update(t){super.update(t),this.camera.update(),this.mngProg.setCameraMatrix(this.camera,!!this.config.camera.ortho)}}},76314(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var s="",i=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),i&&(s+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),s+=t(e),i&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s})).join("")},e.i=function(t,s,i,n,o){"string"==typeof t&&(t=[[null,t,void 0]]);var h={};if(i)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(h[a]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);i&&h[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),s&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=s):c[2]=s),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),e.push(c))}},e}},77314(t,e,s){s.d(e,{A:()=>r});var i=s(31601),n=s.n(i),o=s(76314),h=s.n(o)()(n());h.push([t.id,'#controls {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\tdisplay: flex;\n\talign-items: stretch;\n\tz-index: 10;\n\tbackground-color: rgba(34, 34, 34, 0.8);\n\tmargin: 0.5em;\n\tpadding: 0.5em;\n}\n\n#controls div {\n\tdisplay: flex;\n\talign-items: stretch;\n}\n\n#controls div input[type="range"] {\n\twidth: 100%;\n}\n\n#controls div input[type="checkbox"] {\n\tmargin-right: 0.5em;\n}\n\n#controls label {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n#controls label,\n#controls a {\n\tfont-size: 0.8em;\n}\n\n@media (max-width: 570px) {\n\t#controls.responsive {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t\tmargin: 0;\n\t}\n}\n',""]);const r=h},77659(t){var e={};t.exports=function(t,s){var i=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},84432(t,e,s){s.d(e,{FX:()=>a,Fm:()=>d,M3:()=>o,NS:()=>h,PX:()=>n,UP:()=>i,W:()=>c,X:()=>l,m$:()=>u,t6:()=>r});const i=38,n=40,o=37,h=39,r=32,a=16,l=88,c=87,d=13,u=27},85072(t){var e=[];function s(t){for(var s=-1,i=0;i<e.length;i++)if(e[i].identifier===t){s=i;break}return s}function i(t,i){for(var o={},h=[],r=0;r<t.length;r++){var a=t[r],l=i.base?a[0]+i.base:a[0],c=o[l]||0,d="".concat(l," ").concat(c);o[l]=c+1;var u=s(d),p={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==u)e[u].references++,e[u].updater(p);else{var g=n(p,i);i.byIndex=r,e.splice(r,0,{identifier:d,updater:g,references:1})}h.push(d)}return h}function n(t,e){var s=e.domAPI(e);s.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,n){var o=i(t=t||[],n=n||{});return function(t){t=t||[];for(var h=0;h<o.length;h++){var r=s(o[h]);e[r].references--}for(var a=i(t,n),l=0;l<o.length;l++){var c=s(o[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}o=a}}},97825(t){t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var n=void 0!==s.layer;n&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,n&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var o=s.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},99594(t,e,s){s.d(e,{A:()=>i});const i=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.04;this.value=t,this.target=t,this.sampling=e,this.threshold=1e-6}update(){Math.abs(this.value-this.target)>this.threshold?this.value+=(this.target-this.value)*this.sampling:this.value=this.target}get(){return this.value}set(t){this.target=t}setDirect(t){this.value=t}}}}]);