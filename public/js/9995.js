"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[9995],{807(e,t,n){var r=n(85072),s=n.n(r),a=n(97825),o=n.n(a),i=n(77659),c=n.n(i),u=n(55056),l=n.n(u),f=n(10540),d=n.n(f),p=n(41113),m=n.n(p),h=n(55420),g={};g.styleTagTransform=m(),g.setAttributes=l(),g.insert=c().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=d();s()(h.A,g),h.A&&h.A.locals&&h.A.locals},10540(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},19513(e,t,n){var r=n(85072),s=n.n(r),a=n(97825),o=n.n(a),i=n(77659),c=n.n(i),u=n(55056),l=n.n(u),f=n(10540),d=n.n(f),p=n(41113),m=n.n(p),h=n(77314),g={};g.styleTagTransform=m(),g.setAttributes=l(),g.insert=c().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=d();s()(h.A,g),h.A&&h.A.locals&&h.A.locals},20446(e,t,n){n.d(t,{A:()=>s});var r=n(29794);class s{constructor(e,t){this.context=e,this.config=t,this.time=0}async setupAssets(e){const t=this.context.getDevice();return{programs:Object.keys(e.shaders).reduce(((n,s)=>{const a=new r.A;return a.setup(t,s,e.shaders[s]),n[s]=a,n}),{})}}destroy(){}resize(){}update(){this.time++}render(){}}},29794(e,t,n){n.d(t,{A:()=>s});var r=n(54705);const s=class{constructor(){(0,r.A)(this,"get",(()=>this.program)),this.program=null}setup(e,t,n){this.program=e.createShaderModule({label:t,code:n})}}},31601(e){e.exports=function(e){return e[1]}},41113(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},55056(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},55420(e,t,n){n.d(t,{A:()=>i});var r=n(31601),s=n.n(r),a=n(76314),o=n.n(a)()(s());o.push([e.id,"#fullscreen-toggle-btn {\n\tborder-radius: 0;\n\tmargin: 0;\n\tpadding: 4px;\n\tborder: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n\ttransform: scale(0.8);\n\topacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n\tdisplay: block;\n\twidth: 2em;\n\tfill: #fff;\n\topacity: 0.8;\n\ttransform: scale(0.6);\n\ttransition:\n\t\topacity 300ms ease-out,\n\t\ttransform 300ms ease-out;\n}\n\n[data-fullscreen] {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n",""]);const i=o},69995(e,t,n){n.r(t),n.d(t,{default:()=>u,destroy:()=>l});var r=n(99590);const s={slug:"particule",shaders:["/wgsl/fragment/f_particule.js","/wgsl/vertex/v_particule.js"],canvas:{width:1024,height:1024},useWebGpu:!0,controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}}};var a=n(20446);const o=64e3;class i extends a.A{constructor(e,t){super(e,t);const{width:n,height:r}=t.canvas;this.canvasSize={width:n,height:r}}async setupAssets(e){const{programs:t}=await super.setupAssets(e),n=this.context.getDevice(),r=4*Float32Array.BYTES_PER_ELEMENT;this.positionBuffer=n.createBuffer({size:r*o,label:"particules position buffer",usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE});const s=new Float32Array(256e3);for(let e=0;e<s.length;e+=4)s[e]=2*Math.random()-1,s[e+1]=2*Math.random()-1,s[e+2]=2*Math.random()-1,s[e+3]=1;n.queue.writeBuffer(this.positionBuffer,0,s);const a=4*Float32Array.BYTES_PER_ELEMENT;this.velocityBuffer=n.createBuffer({size:a*o,label:"particules velocity buffer",usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE});const i=new Float32Array(256e3);for(let e=0;e<i.length;e+=4)i[e]=.002*Math.random()-.001,i[e+1]=.002*Math.random()-.001,i[e+2]=.002*Math.random()-.001,i[e+3]=0;n.queue.writeBuffer(this.velocityBuffer,0,i);const c=n.createShaderModule({code:"struct Mass {\n    position1: vec4f,\n    position2: vec4f,\n    position3: vec4f,\n    factor1: f32,\n    factor2: f32,\n    factor3: f32\n};\n\n@group(0) @binding(0) var<storage, read_write> positions: array<vec4f>;\n@group(0) @binding(1) var<storage, read_write> velocities: array<vec4f>; \n@group(0) @binding(2) var<uniform> mass: Mass;\n\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) global_id: vec3u) {\n    let index = global_id.x;\n    let position = positions[index].xyz;\n    var velocity = velocities[index].xyz;\n\n    var massVec = mass.position1.xyz - position;\n    var massDist2 = max(0.01, dot(massVec, massVec));\n    var acceleration = mass.factor1 * normalize(massVec) / massDist2;\n\n    massVec = mass.position2.xyz - position;\n    massDist2 = max(0.01, dot(massVec, massVec));\n    acceleration += mass.factor2 * normalize(massVec) / massDist2;\n\n    massVec = mass.position3.xyz - position;\n    massDist2 = max(0.01, dot(massVec, massVec));\n    acceleration += mass.factor3 * normalize(massVec) / massDist2;\n\n    velocity += acceleration;\n    velocity *= 0.9999;\n\n    positions[index] = vec4f(position + velocity, 1);\n    velocities[index] = vec4f(velocity, 0);\n}",label:"Compute Shader"});this.computePipeline=n.createComputePipeline({layout:"auto",label:"Compute Pipeline",compute:{module:c,entryPoint:"main"}});const u=new Float32Array([2*Math.random()-1,2*Math.random()-1,0,1,2*Math.random()-1,2*Math.random()-1,0,1,2*Math.random()-1,2*Math.random()-1,0,1,Math.random()/3e4,Math.random()/3e4,Math.random()/3e4,0]),l=n.createBuffer({size:u.byteLength,label:"attractors compute uniform buffer",usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});n.queue.writeBuffer(l,0,u),this.computeBindGroup=n.createBindGroup({layout:this.computePipeline.getBindGroupLayout(0),label:"Compute Bind Group",entries:[{binding:0,resource:{buffer:this.positionBuffer}},{binding:1,resource:{buffer:this.velocityBuffer}},{binding:2,resource:{buffer:l}}]}),this.computePassDescription={label:"Compute Pass description"},this.screenPointCount=4,this.vertexBuffer=n.createBuffer({size:Float32Array.BYTES_PER_ELEMENT*this.screenPointCount*2,label:"screen quad vertex buffer",usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),n.queue.writeBuffer(this.vertexBuffer,0,new Float32Array([-1,-1,1,-1,-1,1,1,1]));const f=4*Uint8Array.BYTES_PER_ELEMENT;this.colorBuffer=n.createBuffer({size:f*o,label:"particules color buffer",usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});const d=new Uint8Array(256e3);for(let e=0;e<d.length;e+=4)d[e]=Math.floor(256*Math.random()),d[e+1]=Math.floor(256*Math.random()),d[e+2]=Math.floor(256*Math.random()),d[e+3]=128;n.queue.writeBuffer(this.colorBuffer,0,d),this.renderPipeline=await n.createRenderPipelineAsync({layout:"auto",vertex:{module:t.v_particule.get(),entryPoint:"v_main",buffers:[{arrayStride:8,attributes:[{shaderLocation:0,format:"float32x2",offset:0}]},{arrayStride:f,stepMode:"instance",attributes:[{shaderLocation:1,format:"unorm8x4",offset:0}]},{arrayStride:r,stepMode:"instance",attributes:[{shaderLocation:2,format:"float32x4",offset:0}]}]},fragment:{module:t.f_particule.get(),entryPoint:"f_main",targets:[{format:this.context.getCanvasFormat(),blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},multisample:{count:4},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32"}}),this.vertexUniformBuffer=n.createBuffer({size:16,label:"vertex uniform buffer",usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.vertexUniformBindGroup=n.createBindGroup({layout:this.renderPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.vertexUniformBuffer}}]}),this.resize(this.canvasSize)}resize(e){this.canvasSize=e;const t=this.context.getDevice();t.queue.writeBuffer(this.vertexUniformBuffer,0,new Float32Array([this.canvasSize.width,this.canvasSize.height,2])),this.msaaTexture&&this.msaaTexture.destroy(),this.msaaTexture=t.createTexture({label:"msaa texture",size:[this.canvasSize.width,this.canvasSize.height],format:this.context.getCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:4}),this.renderPassDescription={colorAttachments:[{view:this.msaaTexture.createView(),resolveTarget:this.context.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store",clearValue:[0,0,0,0]}]}}update(){super.update()}render(){super.render();const e=this.context.getDevice(),t=e.createCommandEncoder(),n=t.beginComputePass(this.computePassDescription);n.setPipeline(this.computePipeline),n.setBindGroup(0,this.computeBindGroup),n.dispatchWorkgroups(1e3),n.end(),this.renderPassDescription.colorAttachments[0].resolveTarget=this.context.getCurrentTexture().createView();const r=t.beginRenderPass(this.renderPassDescription);r.setPipeline(this.renderPipeline),r.setVertexBuffer(0,this.vertexBuffer),r.setVertexBuffer(1,this.colorBuffer),r.setVertexBuffer(2,this.positionBuffer),r.setBindGroup(0,this.vertexUniformBindGroup),r.draw(this.screenPointCount,o),r.end(),e.queue.submit([t.finish()])}destroy(){super.destroy()}}n(19513),n(807);let c=null;const u=async()=>{c=new r.A,await c.setup(i,s);const e=document.querySelector(`#${s.slug}`),t=c.getCanvas();t&&e&&e.appendChild(t)},l=()=>{c&&c.destroy&&c.destroy()}},76314(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,s,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var i=0;i<this.length;i++){var c=this[i][0];null!=c&&(o[c]=!0)}for(var u=0;u<e.length;u++){var l=[].concat(e[u]);r&&o[l[0]]||(void 0!==a&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=a),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),s&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=s):l[4]="".concat(s)),t.push(l))}},t}},77314(e,t,n){n.d(t,{A:()=>i});var r=n(31601),s=n.n(r),a=n(76314),o=n.n(a)()(s());o.push([e.id,'#controls {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\tdisplay: flex;\n\talign-items: stretch;\n\tz-index: 10;\n\tbackground-color: rgba(34, 34, 34, 0.8);\n\tmargin: 0.5em;\n\tpadding: 0.5em;\n}\n\n#controls div {\n\tdisplay: flex;\n\talign-items: stretch;\n}\n\n#controls div input[type="range"] {\n\twidth: 100%;\n}\n\n#controls div input[type="checkbox"] {\n\tmargin-right: 0.5em;\n}\n\n#controls label {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n#controls label,\n#controls a {\n\tfont-size: 0.8em;\n}\n\n@media (max-width: 570px) {\n\t#controls.responsive {\n\t\tposition: relative;\n\t\twidth: 100%;\n\t\tmargin: 0;\n\t}\n}\n',""]);const i=o},77659(e){var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},85072(e){var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var a={},o=[],i=0;i<e.length;i++){var c=e[i],u=r.base?c[0]+r.base:c[0],l=a[u]||0,f="".concat(u," ").concat(l);a[u]=l+1;var d=n(f),p={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var m=s(p,r);r.byIndex=i,t.splice(i,0,{identifier:f,updater:m,references:1})}o.push(f)}return o}function s(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var a=r(e=e||[],s=s||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var i=n(a[o]);t[i].references--}for(var c=r(e,s),u=0;u<a.length;u++){var l=n(a[u]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}a=c}}},97825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,s&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}}]);