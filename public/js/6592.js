(self.webpackChunkdovotori_portfolio=self.webpackChunkdovotori_portfolio||[]).push([[6592],{94281:(e,t,n)=>{"use strict";n.d(t,{Eu:()=>s,H$:()=>o});var r=n(68763),s=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=n.startX,o=void 0===s?-1:s,a=n.endX,i=void 0===a?1:a,c=n.startZ,l=void 0===c?-1:c,d=n.endZ,u=void 0===d?1:d,g=[],p=0;p<t;p++)for(var h=(0,r.Yp)(p,0,t-1,l,u),f=0;f<e;f++){var m=(0,r.Yp)(f,0,e-1,o,i);g.push(m),g.push(0),g.push(h)}return g},o=function(e,t){for(var n=[],r=0;r<t-1;r++)for(var s=0;s<e-1;s++){var o=r*e+s;n.push(o),n.push(e+o),n.push(o+1),n.push(e+o),n.push(e+o+1),n.push(o+1)}return n}},56592:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>D,destroy:()=>L});var r=n(92137),s=n(87757),o=n.n(s),a=n(35466),i=n(13894),c=n(87329),l=n(6610),d=n(5991),u=n(63349),g=n(66213),p=n(10379),h=n(86089),f=n(77608),m=n(96156),Z=n(25192),v=n(21200),P=n(80602),y=n(21969),b=n(25773),S=n(94281),T=n(47313);function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,f.Z)(e);if(t){var s=(0,f.Z)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return(0,h.Z)(this,n)}}var w=function(e){return.5*Math.sin(e)+.5},j=function(e){(0,p.Z)(n,e);var t=x(n);function n(e,r,s){var o;(0,l.Z)(this,n),o=t.call(this,e,r,s),(0,m.Z)((0,u.Z)(o),"getDistPos",(function(e){var t,n,r,s,a,l=o.config,d=l.roadAmplitude,u=l.roadLength,g=l.roadFrequence;return(0,i.Z)(b.Z,(0,c.Z)((t=e/u,n=g,r=d,s=o.posTime,a=.02,[Math.cos(t*Math.PI*n[0]+s)*r[0]-Math.cos(a*Math.PI*n[0]+s)*r[0],w(t*Math.PI*n[1]+s)*r[1]-w(a*Math.PI*n[1]+s)*r[1],w(t*Math.PI*n[2]+s)*r[2]-w(a*Math.PI*n[2]+s)*r[2]])))})),(0,m.Z)((0,u.Z)(o),"updateCamera",(function(){var e=o.config,t=e.roadLength,n=e.camera,r=o.getDistPos(100),s=o.getDistPos(0);o.camera.setTarget(r.getX(),n.position.y+r.getY(),t),o.camera.setPosition(s.getX(),n.position.y+s.getY(),0)})),(0,m.Z)((0,u.Z)(o),"moveShip",(function(){o.targetPosX.update(),o.targetSpeed.update(),o.posTime+=o.targetSpeed.get();var e=o.getDistPos(o.shipPos.getZ());o.currentShipPos.equal(e).add(o.shipPos).addX(o.targetPosX.get())})),(0,m.Z)((0,u.Z)(o),"renderMountain",(function(){var e=o.config,t=e.roadAmplitude,n=e.roadLength,r=e.roadWidth,s=e.roadFrequence,a=o.mngProg.get("roadmountain");a.setProjectionView(o.camera),a.setMatrix("model",o.model.get()),a.setFloat("time",o.posTime),a.setVector("frequence",s),a.setVector("amplitude",t),a.setFloat("roadWidth",r),a.setFloat("roadLength",n),o.mountainVbo.render(a.get())})),(0,m.Z)((0,u.Z)(o),"renderRoad",(function(){var e=o.config,t=e.roadAmplitude,n=e.roadLength,r=e.roadWidth,s=e.roadFrequence,a=o.mngProg.get("road");a.setProjectionView(o.camera),a.setMatrix("model",o.model.get()),a.setFloat("time",o.posTime),a.setVector("frequence",s),a.setVector("amplitude",t),a.setFloat("roadWidth",r),a.setFloat("roadLength",n),o.roadVbo.render(a.get())})),(0,m.Z)((0,u.Z)(o),"renderShip",(function(){var e,t=o.mngProg.get("gltf"),n=o.mngGltf.get("raceship");o.model.push(),(e=o.model).translate.apply(e,(0,c.Z)(o.currentShipPos.get())),n.renderExcept(["trail1","trail2"],t,o.model),o.model.pop()})),(0,m.Z)((0,u.Z)(o),"renderShipTrails",(function(){var e,t=o.mngProg.get("gltf"),n=o.mngGltf.get("raceship");o.model.push(),(e=o.model).translate.apply(e,(0,c.Z)(o.currentShipPos.get())),n.renderOnly(["trail1","trail2"],t,o.model),o.model.pop()})),(0,m.Z)((0,u.Z)(o),"interactShip",(function(e){var t=o.config.roadWidth;o.targetSpeed.set(.1),o.targetPosX.set(-e.rel.x*t*.6)})),(0,m.Z)((0,u.Z)(o),"onMouseDrag",(function(e){o.interactShip(e)})),(0,m.Z)((0,u.Z)(o),"onMouseDown",(function(e){o.interactShip(e)})),(0,m.Z)((0,u.Z)(o),"onMouseUp",(function(){o.targetSpeed.set(0)})),o.screen=new v.Z(o.gl),o.model=new y.Z;var a=r.roadLength,d=r.roadWidth,g=r.shipPosition,p=(0,S.Eu)(2,a,{startX:-d,endX:d,startZ:0,endZ:a}),h=(0,S.Eu)(120,a,{startX:-120,endX:120,startZ:0,endZ:a}),f=(0,S.H$)(2,a);o.roadVbo=new P.Z(e,{position:p,indices:f});var Z=(0,S.H$)(120,a);return o.mountainVbo=new P.Z(e,{position:h,indices:Z}),o.shipPos=(0,i.Z)(b.Z,(0,c.Z)(g)),o.currentShipPos=new b.Z(0),o.targetPosX=new T.Z(0,.1),o.targetSpeed=new T.Z(0,.1),o.posTime=0,o.setLampeInfos(o.mngProg.get("gltf")),o.mngProg.get("roadSky").setTexture(1,o.mngTex.get("noisergb").get(),"textureMap"),o}return(0,d.Z)(n,[{key:"update",value:function(e){(0,g.Z)((0,f.Z)(n.prototype),"update",this).call(this,e),this.model.identity(),this.moveShip(),this.updateTrails(),this.updateCamera(),this.mngGltf.get("raceship").update(e)}},{key:"updateTrails",value:function(){var e=this.mngProg.get("gltf"),t=this.mngGltf.get("raceship");e.setProjectionView(this.camera),t.setAnimationStep("trail1","scale",10*this.targetSpeed.get()),t.setAnimationStep("trail2","scale",10*this.targetSpeed.get())}},{key:"renderLandscape",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("roadSky");e.setFloat("flipY",-1),e.setFloat("time",.1*this.time),e.setVector("wind",[.1,.2]),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"renderTunnel",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("tunnelrace");e.setFloat("flipY",-1),e.setFloat("time",.001*this.time),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"render",value:function(){(0,g.Z)((0,f.Z)(n.prototype),"render",this).call(this),this.postProcess.start(),this.renderTunnel(),this.renderMountain(),this.renderRoad(),this.renderShip(),this.postProcess.end(),this.bloom.start(),this.renderShipTrails(),this.bloom.end(),this.postProcess.mergeBloom(this.bloom.getTexture(),1.5,2.2);var e=100*this.targetSpeed.get();this.postProcess.setRGB(e,e,.5,.5),this.postProcess.setFxaa2(),this.postProcess.render()}}]),n}(Z.Z);const M={slug:"race",assets:["/textures/noisergb.png","/gltf/raceship.gltf"],shaders:["/camera/road.js","/camera/gltf.js","/camera/roadmountain.js","/camera/basique3d.js","/sky/roadSky.js","/camera/gltf.js","/screen/screen.js","/screen/debug.js","/screen/blurOnePass.js","/screen/bloom.js","/screen/mergeBloom.js","/screen/fxaa.js","/screen/fxaa2.js","/screen/tunnelrace.js","/screen/rgb.js"],useDepthTexture:!0,postprocess:{bloom:{intensity:1}},textures:{noisergb:"LINEAR"},canvas:{width:1024,height:512},mouse:{events:["down","up","drag"]},camera:{position:{x:0,y:4,z:0},target:{x:0,y:0,z:128},near:1,far:200,angle:90},lampes:[{type:0,position:{x:0,y:3,z:3},ambiant:[1,1,1],diffuse:[.8,.6,.5],specular:[1,.8,.7],brillance:1,strength:40}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},roadFrequence:[2,0,2],roadAmplitude:[10,0,4],roadLength:128,roadWidth:8,shipPosition:[0,2,3]};n(88747),n(89153);var k=n(93379),F=n.n(k),E=n(83965),X={insert:"head",singleton:!1};F()(E.Z,X);E.Z.locals;var V=null;const D=(0,r.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V=new a.Z,e.next=3,V.setup(j,M);case 3:document.querySelector("#".concat(M.slug)).appendChild(V.getCanvas());case 5:case"end":return e.stop()}}),e)})));var L=function(){V&&V.destroy&&V.destroy()}},83965:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(23645),s=n.n(r)()((function(e){return e[1]}));s.push([e.id,"#race {\n  position: relative;\n  width: 100%;\n  height: auto;\n}\n\n#race canvas {\n  margin: 0 auto;\n  width: 100%;\n}\n",""]);const o=s},24981:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(23645),s=n.n(r)()((function(e){return e[1]}));s.push([e.id,"#controls {\n  position: absolute;\n  top: 4px;\n  right: 4px;\n  display: flex;\n  align-items: stretch;\n  z-index: 1;\n}\n",""]);const o=s},76889:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(23645),s=n.n(r)()((function(e){return e[1]}));s.push([e.id,"#fullscreen-toggle-btn {\n  border-radius: 0;\n  margin: 0;\n  padding: 4px;\n  border: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n  transform: scale(0.8);\n  opacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n  display: block;\n  width: 2em;\n  fill: #fff;\n  opacity: 0.8;\n  transform: scale(0.6);\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\n}\n\n[data-fullscreen] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n",""]);const o=s},88747:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n(93379),s=n.n(r),o=n(24981),a={insert:"head",singleton:!1};s()(o.Z,a);const i=o.Z.locals||{}},89153:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n(93379),s=n.n(r),o=n(76889),a={insert:"head",singleton:!1};s()(o.Z,a);const i=o.Z.locals||{}}}]);