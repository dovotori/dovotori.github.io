"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[1036],{13939(e,t,r){r.d(t,{A:()=>P});var n=r(11078),i=r(62703),o=r(66514),s=r(6933),a=r(70915),l=r(82922),d=r(70136),c=r(41401),h=r(40808),g=r(13663),u=r(6782),p=r(9703),f=r(4087),x=r(73608),T=r(27607),y=r(40190),m=r(91110),R=r(32963),_=r(14969),S=r(40186),C=r(96769);function v(e,t,r){if(!(r in e))return e[r]=new Set([t]),!0;const n=e[r],i=n.has(t);return i||n.add(t),!i}function I(e,t,r){const n=e[r];return!!n&&n.delete(t)}function A(e,t){const r=e.layerStatesArray[e.layerIndex];r.extent&&(t=(0,a._N)(t,(0,l.SD)(r.extent,e.viewState.projection)));const n=r.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(e.viewState.projection).getExtent();r&&(t=(0,a._N)(t,r))}return t}class w extends C.A{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=(0,a.S5)(),this.tempTileRange_=new m.A(0,0,0,0),this.tempTileCoord_=(0,S.N)(0,0,0);const r=void 0!==t.cacheSize?t.cacheSize:512;this.tileCache_=new _.A(r),this.sourceTileCache_=null,this.maxStaleKeys=.5*r}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new _.A(512)),this.sourceTileCache_}getOrCreateTile(e,t,r,n){const i=this.tileCache_,o=this.getLayer().getSource(),s=(0,S.et)(o,o.getKey(),e,t,r);let a;if(i.containsKey(s))a=i.get(s);else{const d=n.viewState.projection,c=o.getProjection();if(a=o.getTile(e,t,r,n.pixelRatio,d,!c||(0,l.tI)(c,d)?void 0:this.getSourceTileCache()),!a)return null;i.set(s,a)}return a}getTile(e,t,r,n){const i=this.getOrCreateTile(e,t,r,n);return i||null}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),i=(0,p.Bb)(t.pixelToCoordinateTransform,e.slice()),o=r.getExtent();if(o&&!(0,a.Ym)(o,i))return null;const s=t.viewState,l=r.getRenderSource(),d=l.getTileGridForProjection(s.projection),c=l.getTilePixelRatio(t.pixelRatio);for(let e=d.getZForResolution(s.resolution);e>=d.getMinZoom();--e){const r=d.getTileCoordForCoordAndZ(i,e),o=this.getTile(e,r[1],r[2],t);if(!o||o.getState()!==n.A.LOADED)continue;const a=d.getOrigin(e),h=(0,u.xq)(d.getTileSize(e)),g=d.getResolution(e);let p;if(o instanceof y.A||o instanceof R.A)p=o.getImage();else{if(!(o instanceof T.Ay))continue;if(p=(0,T.xo)(o.getData()),!p)continue}const f=Math.floor(c*((i[0]-a[0])/g-r[1]*h[0])),x=Math.floor(c*((a[1]-i[1])/g-r[2]*h[1])),m=Math.round(c*l.getGutterForProjection(s.projection));return this.getImageData(p,f+m,x+m)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const r=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==r&&(this.renderedSourceRevision_=r,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=r,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,r,i,o){const s=e.viewState,l=this.getLayer(),d=l.getRenderSource(),c=d.getTileGridForProjection(s.projection),h=(0,f.v6)(d);h in e.wantedTiles||(e.wantedTiles[h]={});const g=e.wantedTiles[h],u=l.getMapInternal(),p=Math.max(r-o,c.getMinZoom(),c.getZForResolution(Math.min(l.getMaxResolution(),u?u.getView().getResolutionForZoom(Math.max(l.getMinZoom(),0)):c.getResolution(0)),d.zDirection)),x=s.rotation,T=x?(0,a.Yw)(s.center,s.resolution,x,e.size):void 0;for(let o=r;o>=p;--o){const r=c.getTileRangeForExtentAndZ(t,o,this.tempTileRange_),s=c.getResolution(o);for(let t=r.minX;t<=r.maxX;++t)for(let a=r.minY;a<=r.maxY;++a){if(x&&!c.tileCoordIntersectsViewport([o,t,a],T))continue;const r=this.getTile(o,t,a,e);if(!r)continue;if(!v(i,r,o))continue;const l=r.getKey();if(g[l]=!0,r.getState()===n.A.IDLE&&!e.tileQueue.isKeyQueued(l)){const n=(0,S.N)(o,t,a,this.tempTileCoord_);e.tileQueue.enqueue([r,h,c.getTileCoordCenter(n),s])}}}}findStaleTile_(e,t){const r=this.tileCache_,i=e[0],o=e[1],s=e[2],a=this.getStaleKeys();for(let e=0;e<a.length;++e){const l=(0,S.et)(this.getLayer().getSource(),a[e],i,o,s);if(r.containsKey(l)){const e=r.peek(l);if(e.getState()===n.A.LOADED)return e.endTransition((0,f.v6)(this)),v(t,e,i),!0}}return!1}findAltTiles_(e,t,r,i){const o=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!o)return!1;let s=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),d=l.getKey();for(let e=o.minX;e<=o.maxX;++e)for(let t=o.minY;t<=o.maxY;++t){const o=(0,S.et)(l,d,r,e,t);let c=!1;if(a.containsKey(o)){const e=a.peek(o);e.getState()===n.A.LOADED&&(v(i,e,r),c=!0)}c||(s=!1)}return s}renderFrame(e,t){this.renderComplete=!0;const r=e.layerStatesArray[e.layerIndex],i=e.viewState,s=i.projection,d=i.resolution,c=i.center,h=e.pixelRatio,g=this.getLayer(),u=g.getSource(),x=u.getTileGridForProjection(s),T=x.getZForResolution(d,u.zDirection),y=x.getResolution(T),m=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==m&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=m):this.renderedSourceKey_=m;let R=e.extent;const _=u.getTilePixelRatio(h);this.prepareContainer(e,t);const S=this.context.canvas.width,C=this.context.canvas.height,v=r.extent&&(0,l.SD)(r.extent,s);v&&(R=(0,a._N)(R,(0,l.SD)(r.extent,s)));const w=y*S/2/_,E=y*C/2/_,D=[c[0]-w,c[1]-E,c[0]+w,c[1]+E],F={};this.renderedTiles.length=0;const P=g.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const t=x.getZForResolution(i.nextResolution,u.zDirection),r=A(e,e.nextExtent);this.enqueueTiles(e,r,t,F,P)}const L=A(e,R);if(this.enqueueTiles(e,L,T,F,0),P>0&&setTimeout((()=>{this.enqueueTiles(e,L,T-1,F,P-1)}),0),!(T in F))return this.container;const G=(0,f.v6)(this),b=e.time;for(const t of F[T]){const r=t.getState();if(r===n.A.EMPTY)continue;const i=t.tileCoord;if(r===n.A.LOADED){if(1===t.getAlpha(G,b)){t.endTransition(G);continue}}r!==n.A.ERROR&&(this.renderComplete=!1);if(this.findStaleTile_(i,F)){I(F,t,T),e.animate=!0;continue}if(this.findAltTiles_(x,i,T+1,F))continue;const o=x.getMinZoom();for(let e=T-1;e>=o;--e){if(this.findAltTiles_(x,i,e,F))break}}const j=y/d*h/_,M=this.getRenderContext(e);(0,p.Zz)(this.tempTransform,S/2,C/2,j,j,0,-S/2,-C/2),r.extent&&this.clipUnrotated(M,e,v),u.getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,e);const O=Object.keys(F).map(Number);let N;O.sort(o.V_);const Z=[],B=[];for(let t=O.length-1;t>=0;--t){const r=O[t],i=u.getTilePixelSize(r,h,s),o=x.getResolution(r)/y,l=i[0]*o*j,d=i[1]*o*j,c=x.getTileCoordForCoordAndZ((0,a.Py)(D),r),g=x.getTileCoordExtent(c),f=(0,p.Bb)(this.tempTransform,[_*(g[0]-D[0])/y,_*(D[3]-g[3])/y]),T=_*u.getGutterForProjection(s);for(const t of F[r]){if(t.getState()!==n.A.LOADED)continue;const i=t.tileCoord,o=c[1]-i[1],s=Math.round(f[0]-(o-1)*l),h=c[2]-i[2],g=Math.round(f[1]-(h-1)*d),p=Math.round(f[0]-o*l),x=Math.round(f[1]-h*d),y=s-p,m=g-x,R=1===O.length;let _=!1;N=[p,x,p+y,x,p+y,x+m,p,x+m];for(let e=0,t=Z.length;e<t;++e)if(!R&&r<B[e]){const t=Z[e];(0,a.HY)([p,x,p+y,x+m],[t[0],t[3],t[4],t[7]])&&(_||(M.save(),_=!0),M.beginPath(),M.moveTo(N[0],N[1]),M.lineTo(N[2],N[3]),M.lineTo(N[4],N[5]),M.lineTo(N[6],N[7]),M.moveTo(t[6],t[7]),M.lineTo(t[4],t[5]),M.lineTo(t[2],t[3]),M.lineTo(t[0],t[1]),M.clip())}Z.push(N),B.push(r),this.drawTile(t,e,p,x,y,m,T,R),_&&M.restore(),this.renderedTiles.unshift(t),this.updateUsedTiles(e.usedTiles,u,t)}}if(this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!(0,a.aI)(this.renderedExtent_,D),this.renderedExtent_=D,this.renderedPixelRatio=h,this.postRender(this.context,e),r.extent&&M.restore(),M.imageSmoothingEnabled=!0,this.renderComplete){const t=(e,t)=>{const r=(0,f.v6)(u),n=t.wantedTiles[r],i=n?Object.keys(n).length:0;this.updateCacheSize(i),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};e.postRenderFunctions.push(t)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,2*e)}drawTile(e,t,r,n,i,o,s,a){let l;if(e instanceof T.Ay){if(l=(0,T.xo)(e.getData()),!l)throw new Error("Rendering array data is not yet supported")}else l=this.getTileImage(e);if(!l)return;const d=this.getRenderContext(t),c=(0,f.v6)(this),h=t.layerStatesArray[t.layerIndex],g=h.opacity*(a?e.getAlpha(c,t.time):1),u=g!==d.globalAlpha;u&&(d.save(),d.globalAlpha=g),d.drawImage(l,s,s,l.width-2*s,l.height-2*s,r,n,i,o),u&&d.restore(),g!==h.opacity?t.animate=!0:a&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,r){const n=(0,f.v6)(t);n in e||(e[n]={}),e[n][r.getKey()]=!0}}const E=w,D={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},F={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};const P=class extends E{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=(0,p.vt)(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return"vector"!==this.getLayer().getRenderMode()}drawTile(e,t,r,n,i,o,s,a){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,n,i,o,s,a)}getTile(e,t,r,n){const o=this.getOrCreateTile(e,t,r,n);if(!o)return null;const s=n.viewState,a=s.resolution,l=n.viewHints,d=this.getLayer().getSource(),c=d.getTileGridForProjection(s.projection),h=!(l[i.A.ANIMATING]||l[i.A.INTERACTING]),g=c.getZForResolution(a,d.zDirection)===e;return h&&g?o.wantedResolution=a:o.wantedResolution||(o.wantedResolution=c.getResolution(e)),o}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const i=this.getLayer(),o=i.getRevision(),s=i.getRenderOrder()||null,h=e.wantedResolution,g=e.getReplayState(i);if(!g.dirty&&g.renderedResolution===h&&g.renderedRevision==o&&g.renderedRenderOrder==s)return;const u=i.getSource(),p=!!i.getDeclutter(),T=u.getTileGrid(),y=u.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),m=u.getSourceTiles(t,r,e),R=(0,f.v6)(i);delete e.hitDetectionImageData[R],e.executorGroups[R]=[],g.dirty=!1;for(let o=0,f=m.length;o<f;++o){const f=m[o];if(f.getState()!=n.A.LOADED)continue;const _=u.getProjection(),S=f.tileCoord;let C=T.getTileCoordExtent(S);r&&_&&!(0,l.tI)(r,_)&&(C=(0,l.DI)(C,_,r,32));const v=(0,a._N)(y,C),I=(0,a.r)(v,i.getRenderBuffer()*h,this.tempExtent),A=(0,a.aI)(C,v)?null:I,w=new d.A(0,v,h,t),E=(0,x.j)(h,t),D=function(e,t){let r;const n=e.getStyleFunction()||i.getStyleFunction();if(n&&(r=n(e,h)),r){const n=this.renderFeature(e,E,r,w,p,t);g.dirty=g.dirty||n}},F=f.getFeatures();s&&s!==g.renderedRenderOrder&&F.sort(s);for(let e=0,t=F.length;e<t;++e){let t=F[e];r&&f.projection&&!(0,l.tI)(r,f.projection)&&(t=t.clone(),t.getGeometry().applyTransform((0,l.RG)(f.projection,r))),A&&!(0,a.HY)(A,t.getGeometry().getExtent())||D.call(this,t,e)}const P=w.finish(),L="vector"!==i.getRenderMode()&&p&&1===m.length?null:v,G=new c.Ay(L,h,t,u.getOverlaps(),P,i.getRenderBuffer(),!0);e.executorGroups[R].push(G)}g.renderedRevision=o,g.renderedRenderOrder=s,g.renderedResolution=h}forEachFeatureAtCoordinate(e,t,r,n,i){const o=t.viewState.resolution,s=t.viewState.rotation;r=null==r?0:r;const l=this.getLayer(),d=l.getSource().getTileGridForProjection(t.viewState.projection),c=(0,a.Tr)([e]);(0,a.r)(c,o*r,c);const h={},g=function(e,t,r){let o=e.getId();void 0===o&&(o=(0,f.v6)(e));const s=h[o];if(s){if(!0!==s&&r<s.distanceSq){if(0===r)return h[o]=!0,i.splice(i.lastIndexOf(s),1),n(e,l,t);s.geometry=t,s.distanceSq=r}}else{if(0===r)return h[o]=!0,n(e,l,t);i.push(h[o]={feature:e,layer:l,geometry:t,distanceSq:r,callback:n})}},u=this.renderedTiles,p=(0,f.v6)(l),x=l.getDeclutter(),T=x?t.declutter?.[x]?.all().map((e=>e.value)):null;let y;e:for(let t=0,n=u.length;t<n;++t){const n=u[t],i=d.getTileCoordExtent(n.wrappedTileCoord);if(!(0,a.HY)(i,c))continue;const l=n.executorGroups[p];for(let t=0,n=l.length;t<n;++t)if(y=l[t].forEachFeatureAtCoordinate(e,o,s,r,g,T),y)break e}return y}getFeatures(e){return 0===this.renderedTiles.length?Promise.resolve([]):new Promise(((t,r)=>{const i=this.getLayer(),o=i.getSource(),l=this.renderedProjection,d=l.getExtent(),c=this.renderedResolution,h=o.getTileGridForProjection(l),x=(0,p.Bb)(this.renderedPixelToCoordinateTransform_,e.slice()),T=h.getTileCoordForCoordAndResolution(x,c).toString(),y=this.renderedTiles.find((e=>e.tileCoord.toString()===T&&e.getState()===n.A.LOADED));if(!y||y.loadingSourceTiles>0)return void t([]);o.getWrapX()&&l.canWrapX()&&!(0,a.ms)(d,h.getTileCoordExtent(y.tileCoord))&&(0,s.Li)(x,l);const m=(0,f.v6)(i),R=h.getTileCoordExtent(y.wrappedTileCoord),_=(0,a.Py)(R),S=[(x[0]-_[0])/c,(_[1]-x[1])/c],C=y.getSourceTiles().reduce(((e,t)=>e.concat(t.getFeatures())),[]);let v=y.hitDetectionImageData[m];if(!v){const e=(0,u.xq)(h.getTileSize(h.getZForResolution(c,o.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(h.getTileCoordCenter(y.wrappedTileCoord),c,0,g.tF,e[0]*g.tF,e[1]*g.tF,0)];v=(0,g._7)(e,r,C,i.getStyleFunction(),h.getTileCoordExtent(y.wrappedTileCoord),y.getReplayState(i).renderedResolution,t),y.hitDetectionImageData[m]=v}t((0,g.F8)(S,C,v))}))}getFeaturesInExtent(e){const t=[],r=this.getTileCache();if(0===r.getCount())return t;const i=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),o=i.getZForResolution(this.renderedResolution),s={};return r.forEach((r=>{if(r.tileCoord[0]!==o||r.getState()!==n.A.LOADED)return;const l=r.getSourceTiles();for(let r=0,n=l.length;r<n;++r){const n=l[r],o=n.getKey();if(o in s)continue;s[o]=!0;const d=n.tileCoord;if((0,a.HY)(e,i.getTileCoordExtent(d))){const r=n.getFeatures();if(r)for(let n=0,i=r.length;n<i;++n){const i=r[n],o=i.getGeometry();(0,a.HY)(e,o.getExtent())&&t.push(i)}}}})),t}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const r=this.context,n=r.globalAlpha;r.globalAlpha=t.opacity;const o=e.viewHints,s=!(o[i.A.ANIMATING]||o[i.A.INTERACTING]),a=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),d=l?e.declutter?.[l]:void 0,h=(0,f.v6)(this.getLayer()),g=this.renderedTiles;for(let t=0,r=g.length;t<r;++t){const r=g[t],n=r.executorGroups[h];if(n)for(let t=n.length-1;t>=0;--t)n[t].execute(this.context,a,this.getTileRenderTransform(r,e),e.viewState.rotation,s,c.$i,d)}r.globalAlpha=n}renderDeferredInternal(e){const t=this.renderedTiles,r=(0,f.v6)(this.getLayer()),n=t.reduce(((e,t,n)=>(t.executorGroups[r].forEach((t=>e.push({executorGroup:t,index:n}))),e)),[]),i=n.map((({executorGroup:e})=>e.getDeferredZIndexContexts())),s={};for(let e=0,t=n.length;e<t;++e){const t=n[e].executorGroup.getDeferredZIndexContexts();for(const e in t)s[e]=!0}Object.keys(s).map(Number).sort(o.V_).forEach((e=>{i.forEach(((t,r)=>{t[e]&&(t[e].forEach((e=>{const{executorGroup:t,index:i}=n[r],o=t.getRenderedContext(),s=o.globalAlpha;o.globalAlpha=this.renderedOpacity_;const a=this.tileClipContexts_[i];a&&a.draw(o),e.draw(o),a&&o.restore(),o.globalAlpha=s,e.clear()})),t[e].length=0)}))}))}getTileRenderTransform(e,t){const r=t.pixelRatio,n=t.viewState,i=n.center,o=n.resolution,s=n.rotation,a=t.size,l=Math.round(a[0]*r),d=Math.round(a[1]*r),c=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),h=e.tileCoord,g=c.getTileCoordExtent(e.wrappedTileCoord),u=c.getTileCoordExtent(h,this.tempExtent)[0]-g[0];return(0,p.lw)((0,p.hs)(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(i,o,s,r,l,d,u))}postRender(e,t){const r=t.viewHints,n=!(r[i.A.ANIMATING]||r[i.A.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const o=this.getLayer(),s=o.getRenderMode(),l=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const d=o.getDeclutter(),g=d?F[s].filter((e=>!c.$i.includes(e))):F[s],u=t.viewState,p=u.rotation,x=o.getSource(),T=x.getTileGridForProjection(u.projection).getZForResolution(u.resolution,x.zDirection),y=this.renderedTiles,m=[],R=[],_=[],S=(0,f.v6)(o);let C=!0;for(let r=y.length-1;r>=0;--r){const i=y[r];C=C&&!i.getReplayState(o).dirty;const s=i.executorGroups[S].filter((e=>e.hasExecutors(g)));if(0===s.length)continue;const l=this.getTileRenderTransform(i,t),c=i.tileCoord[0];let u=!1;const f=s[0].getClipCoords(l);let x,v=e;if(f){x=new h.A,v=x.getContext();for(let e=0,t=m.length;e<t;++e)if(T!==c&&c<R[e]){const t=m[e];(0,a.HY)([f[0],f[3],f[4],f[7]],[t[0],t[3],t[4],t[7]])&&(u||(v.save(),u=!0),v.beginPath(),v.moveTo(f[0],f[1]),v.lineTo(f[2],f[3]),v.lineTo(f[4],f[5]),v.lineTo(f[6],f[7]),v.moveTo(t[6],t[7]),v.lineTo(t[4],t[5]),v.lineTo(t[2],t[3]),v.lineTo(t[0],t[1]),v.clip())}m.push(f),R.push(c)}for(let r=0,i=s.length;r<i;++r){s[r].execute(e,[e.canvas.width,e.canvas.height],l,p,n,g,t.declutter?.[d])}u&&(v===e?v.restore():_[r]=x)}e.globalAlpha=l,this.ready=C,this.tileClipContexts_=_,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,n,i,o){if(!r)return!1;let s=!1;if(Array.isArray(r))for(let a=0,l=r.length;a<l;++a)s=(0,x.nl)(n,e,r[a],t,this.boundHandleStyleImageChange_,void 0,i,o)||s;else s=(0,x.nl)(n,e,r,t,this.boundHandleStyleImageChange_,void 0,i,o);return s}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const r=e.getReplayState(t),n=t.getRevision(),i=e.wantedResolution;return r.renderedTileResolution!==i||r.renderedTileRevision!==n}renderTileImage_(e,t){const r=this.getLayer(),n=e.getReplayState(r),i=r.getRevision(),o=e.executorGroups[(0,f.v6)(r)];n.renderedTileRevision=i;const s=e.wrappedTileCoord,a=s[0],l=r.getSource();let d=t.pixelRatio;const c=t.viewState.projection,h=l.getTileGridForProjection(c),g=h.getResolution(e.tileCoord[0]),u=t.pixelRatio/e.wantedResolution*g,x=h.getResolution(a),T=e.getContext();d=Math.round(Math.max(d,u/d));const y=l.getTilePixelSize(a,d,c);T.canvas.width=y[0],T.canvas.height=y[1];const m=d/u;if(1!==m){const e=(0,p.cL)(this.tmpTransform_);(0,p.hs)(e,m,m),T.setTransform.apply(T,e)}const R=h.getTileCoordExtent(s,this.tempExtent),_=u/x,S=(0,p.cL)(this.tmpTransform_);(0,p.hs)(S,_,-_),(0,p.Tl)(S,-R[0],-R[3]);for(let e=0,t=o.length;e<t;++e){o[e].execute(T,[T.canvas.width*m,T.canvas.height*m],S,0,!0,D[r.getRenderMode()],null)}n.renderedTileResolution=e.wantedResolution}}},32348(e,t,r){r.d(t,{A:()=>T});var n=r(62703),i=r(66514),o=r(6933),s=r(68711),a=r(70915),l=r(82922),d=r(83984),c=r(70136),h=r(41401),g=r(13663),u=r(4087),p=r(73608),f=r(96769);class x extends f.A{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,a.S5)(),this.wrappedRenderedExtent_=(0,a.S5)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,r){const i=t.extent,o=t.viewState,s=o.center,l=o.resolution,d=o.projection,c=o.rotation,g=d.getExtent(),u=this.getLayer().getSource(),p=this.getLayer().getDeclutter(),f=t.pixelRatio,x=t.viewHints,T=!(x[n.A.ANIMATING]||x[n.A.INTERACTING]),y=this.context,m=Math.round((0,a.RG)(i)/l*f),R=Math.round((0,a.Oq)(i)/l*f),_=u.getWrapX()&&d.canWrapX(),S=_?(0,a.RG)(g):null,C=_?Math.ceil((i[2]-g[2])/S)+1:1;let v=_?Math.floor((i[0]-g[0])/S):0;do{let n=this.getRenderTransform(s,l,0,f,m,R,v*S);t.declutter&&(n=n.slice(0)),e.execute(y,[y.canvas.width,y.canvas.height],n,c,T,void 0===r?h.y2:r?h.$i:h.x$,r?p&&t.declutter[p]:void 0)}while(++v<C)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=(0,s.Y)(this.context.canvas.width,this.context.canvas.height,f.B))}resetDrawContext_(){if(1!==this.opacity_&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,(0,s.Yg)(this.context),f.B.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){this.replayGroup_&&this.getLayer().getDeclutter()&&this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex];this.opacity_=r.opacity;const n=e.viewState;this.prepareContainer(e,t);const i=this.context,o=this.replayGroup_;let s=o&&!o.isEmpty();if(!s){if(!(this.getLayer().hasListener(d.A.PRERENDER)||this.getLayer().hasListener(d.A.POSTRENDER)))return this.container}this.setDrawContext_(),this.preRender(i,e);const c=n.projection;if(this.clipped_=!1,s&&r.extent&&this.clipping){const t=(0,l.SD)(r.extent,c);s=(0,a.HY)(t,e.extent),this.clipped_=s&&!(0,a.ms)(t,e.extent),this.clipped_&&this.clipUnrotated(i,e,t)}return s&&this.renderWorlds(o,e,!this.getLayer().getDeclutter()&&void 0),!e.declutter&&this.clipped_&&i.restore(),this.postRender(i,e),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise((t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const e=this.frameState.size.slice(),t=this.renderedCenter_,r=this.renderedResolution_,n=this.renderedRotation_,i=this.renderedProjection_,o=this.wrappedRenderedExtent_,s=this.getLayer(),d=[],c=e[0]*g.tF,h=e[1]*g.tF;d.push(this.getRenderTransform(t,r,n,g.tF,c,h,0).slice());const u=s.getSource(),f=i.getExtent();if(u.getWrapX()&&i.canWrapX()&&!(0,a.ms)(f,o)){let e=o[0];const i=(0,a.RG)(f);let s,l=0;for(;e<f[0];)--l,s=i*l,d.push(this.getRenderTransform(t,r,n,g.tF,c,h,s).slice()),e+=i;for(l=0,e=o[2];e>f[2];)++l,s=i*l,d.push(this.getRenderTransform(t,r,n,g.tF,c,h,s).slice()),e-=i}const x=(0,l.Tf)();this.hitDetectionImageData_=(0,g._7)(e,d,this.renderedFeatures_,s.getStyleFunction(),o,r,n,(0,p.j)(r,this.renderedPixelRatio_),x?i:null)}t((0,g.F8)(e,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(e,t,r,n,i){if(!this.replayGroup_)return;const o=t.viewState.resolution,s=t.viewState.rotation,a=this.getLayer(),l={},d=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,o,s,r,(function(e,t,r){const o=(0,u.v6)(e),s=l[o];if(s){if(!0!==s&&r<s.distanceSq){if(0===r)return l[o]=!0,i.splice(i.lastIndexOf(s),1),n(e,a,t);s.geometry=t,s.distanceSq=r}}else{if(0===r)return l[o]=!0,n(e,a,t);i.push(l[o]={feature:e,layer:a,geometry:t,distanceSq:r,callback:n})}}),d?t.declutter?.[d]?.all().map((e=>e.value)):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),r=t.getSource();if(!r)return!1;const s=e.viewHints[n.A.ANIMATING],d=e.viewHints[n.A.INTERACTING],g=t.getUpdateWhileAnimating(),u=t.getUpdateWhileInteracting();if(this.ready&&!g&&s||!u&&d)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const f=e.extent,x=e.viewState,T=x.projection,y=x.resolution,m=e.pixelRatio,R=t.getRevision(),_=t.getRenderBuffer();let S=t.getRenderOrder();void 0===S&&(S=p.Eo);const C=x.center.slice(),v=(0,a.r)(f,_*y),I=v.slice(),A=[v.slice()],w=T.getExtent();if(r.getWrapX()&&T.canWrapX()&&!(0,a.ms)(w,e.extent)){const e=(0,a.RG)(w),t=Math.max((0,a.RG)(v)/2,e);v[0]=w[0]-t,v[2]=w[2]+t,(0,o.Li)(C,T);const r=(0,a.Li)(A[0],T);r[0]<w[0]&&r[2]<w[2]?A.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>w[0]&&r[2]>w[2]&&A.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==y&&this.renderedRevision_==R&&this.renderedRenderOrder_==S&&this.renderedFrameDeclutter_===!!e.declutter&&(0,a.ms)(this.wrappedRenderedExtent_,v))return(0,i.aI)(this.renderedExtent_,I)||(this.hitDetectionImageData_=null,this.renderedExtent_=I),this.renderedCenter_=C,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const E=new c.A((0,p.gY)(y,m),v,y,m),D=(0,l.Tf)();let F;if(D){for(let e=0,t=A.length;e<t;++e){const t=A[e],n=(0,l.JR)(t,T);r.loadFeatures(n,(0,l.vN)(y,T),D)}F=(0,l.FO)(D,T)}else for(let e=0,t=A.length;e<t;++e)r.loadFeatures(A[e],y,T);const P=(0,p.j)(y,m);let L=!0;const G=(e,r)=>{let n;const i=e.getStyleFunction()||t.getStyleFunction();if(i&&(n=i(e,y)),n){const t=this.renderFeature(e,P,n,E,F,this.getLayer().getDeclutter(),r);L=L&&!t}},b=(0,l.JR)(v,T),j=r.getFeaturesInExtent(b);S&&j.sort(S);for(let e=0,t=j.length;e<t;++e)G(j[e],e);this.renderedFeatures_=j,this.ready=L;const M=E.finish(),O=new h.Ay(v,y,m,r.getOverlaps(),M,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=y,this.renderedRevision_=R,this.renderedRenderOrder_=S,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=I,this.wrappedRenderedExtent_=v,this.renderedCenter_=C,this.renderedProjection_=T,this.renderedPixelRatio_=m,this.replayGroup_=O,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,n,i,o,s){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let l=0,d=r.length;l<d;++l)a=(0,p.nl)(n,e,r[l],t,this.boundHandleStyleImageChange_,i,o,s)||a;else a=(0,p.nl)(n,e,r,t,this.boundHandleStyleImageChange_,i,o,s);return a}}const T=x},49917(e,t,r){r.d(t,{A:()=>u});var n=r(90025),i=r(6933),o=r(70915),s=r(74238),a=r(60764),l=r(82241),d=r(9703),c=r(4087);class h extends n.A{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){(0,c.b0)()}calculateMatrices2D(e){const t=e.viewState,r=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;(0,d.Zz)(r,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),(0,d.T9)(n,r)}forEachFeatureAtCoordinate(e,t,r,n,s,l,d,c){let h;const g=t.viewState;function u(e,t,r,n){return s.call(l,t,e?r:null,n)}const p=g.projection,f=(0,i.Li)(e.slice(),p),x=[[0,0]];if(p.canWrapX()&&n){const e=p.getExtent(),t=(0,o.RG)(e);x.push([-t,0],[t,0])}const T=t.layerStatesArray,y=T.length,m=[],R=[];for(let n=0;n<x.length;n++)for(let i=y-1;i>=0;--i){const o=T[i],s=o.layer;if(s.hasRenderer()&&(0,a.l)(o,g)&&d.call(c,s)){const i=s.getRenderer(),a=s.getSource();if(i&&a){const s=a.getWrapX()?f:e,l=u.bind(null,o.managed);R[0]=s[0]+x[n][0],R[1]=s[1]+x[n][1],h=i.forEachFeatureAtCoordinate(R,t,r,l,m)}if(h)return h}}if(0===m.length)return;const _=1/m.length;return m.forEach(((e,t)=>e.distanceSq+=t*_)),m.sort(((e,t)=>e.distanceSq-t.distanceSq)),m.some((e=>h=e.callback(e.feature,e.layer,e.geometry))),h}hasFeatureAtCoordinate(e,t,r,n,i,o){return void 0!==this.forEachFeatureAtCoordinate(e,t,r,n,s.rT,this,i,o)}getMap(){return this.map_}renderFrame(e){(0,c.b0)()}scheduleExpireIconCache(e){l.ue.canExpireCache()&&e.postRenderFunctions.push(g)}}function g(e,t){l.ue.expire()}const u=h},73608(e,t,r){r.d(t,{Eo:()=>s,gY:()=>l,j:()=>a,nl:()=>d});var n=r(6141),i=r(4087);const o={Point:function(e,t,r,i,o,s){const a=r.getImage(),l=r.getText(),d=l&&l.getText(),c=s&&a&&d?{}:void 0;if(a){if(a.getImageState()!=n.A.LOADED)return;const s=e.getBuilder(r.getZIndex(),"Image");s.setImageStyle(a,c),s.drawPoint(t,i,o)}if(d){const n=e.getBuilder(r.getZIndex(),"Text");n.setTextStyle(l,c),n.drawText(t,i,o)}},LineString:function(e,t,r,n,i){const o=r.getStroke();if(o){const s=e.getBuilder(r.getZIndex(),"LineString");s.setFillStrokeStyle(null,o),s.drawLineString(t,n,i)}const s=r.getText();if(s&&s.getText()){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(s),o.drawText(t,n,i)}},Polygon:function(e,t,r,n,i){const o=r.getFill(),s=r.getStroke();if(o||s){const a=e.getBuilder(r.getZIndex(),"Polygon");a.setFillStrokeStyle(o,s),a.drawPolygon(t,n,i)}const a=r.getText();if(a&&a.getText()){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,n,i)}},MultiPoint:function(e,t,r,i,o,s){const a=r.getImage(),l=a&&0!==a.getOpacity(),d=r.getText(),c=d&&d.getText(),h=s&&l&&c?{}:void 0;if(l){if(a.getImageState()!=n.A.LOADED)return;const s=e.getBuilder(r.getZIndex(),"Image");s.setImageStyle(a,h),s.drawMultiPoint(t,i,o)}if(c){const n=e.getBuilder(r.getZIndex(),"Text");n.setTextStyle(d,h),n.drawText(t,i,o)}},MultiLineString:function(e,t,r,n,i){const o=r.getStroke();if(o){const s=e.getBuilder(r.getZIndex(),"LineString");s.setFillStrokeStyle(null,o),s.drawMultiLineString(t,n,i)}const s=r.getText();if(s&&s.getText()){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(s),o.drawText(t,n,i)}},MultiPolygon:function(e,t,r,n,i){const o=r.getFill(),s=r.getStroke();if(s||o){const a=e.getBuilder(r.getZIndex(),"Polygon");a.setFillStrokeStyle(o,s),a.drawMultiPolygon(t,n,i)}const a=r.getText();if(a&&a.getText()){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,n,i)}},GeometryCollection:function(e,t,r,n,i,s){const a=t.getGeometriesArray();let l,d;for(l=0,d=a.length;l<d;++l){(0,o[a[l].getType()])(e,a[l],r,n,i,s)}},Circle:function(e,t,r,n,i){const o=r.getFill(),s=r.getStroke();if(o||s){const a=e.getBuilder(r.getZIndex(),"Circle");a.setFillStrokeStyle(o,s),a.drawCircle(t,n,i)}const a=r.getText();if(a&&a.getText()){const i=e.getBuilder(r.getZIndex(),"Text");i.setTextStyle(a),i.drawText(t,n)}}};function s(e,t){return parseInt((0,i.v6)(e),10)-parseInt((0,i.v6)(t),10)}function a(e,t){const r=l(e,t);return r*r}function l(e,t){return.5*e/t}function d(e,t,r,i,s,a,l,d){const h=[],g=r.getImage();if(g){let e=!0;const t=g.getImageState();t==n.A.LOADED||t==n.A.ERROR?e=!1:t==n.A.IDLE&&g.load(),e&&h.push(g.ready())}const u=r.getFill();u&&u.loading()&&h.push(u.ready());const p=h.length>0;return p&&Promise.all(h).then((()=>s(null))),function(e,t,r,n,i,s,a){const l=r.getGeometryFunction()(t);if(!l)return;const d=l.simplifyTransformed(n,i),h=r.getRenderer();if(h)c(e,d,r,t,a);else{(0,o[d.getType()])(e,d,r,t,a,s)}}(e,t,r,i,a,l,d),p}function c(e,t,r,n,i){if("GeometryCollection"==t.getType()){const o=t.getGeometries();for(let t=0,s=o.length;t<s;++t)c(e,o[t],r,n,i);return}e.getBuilder(r.getZIndex(),"Default").drawCustom(t,n,r.getRenderer(),r.getHitDetectionRenderer(),i)}},96769(e,t,r){r.d(t,{A:()=>x,B:()=>u});var n=r(66514),i=r(89352),o=r(68711),s=r(70915),a=r(7771),l=r(9960),d=r(83984),c=r(40808),h=r(9703),g=r(5986);const u=[];let p=null;class f extends g.A{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=(0,h.vt)(),this.pixelTransform=(0,h.vt)(),this.inversePixelTransform=(0,h.vt)(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,r){let n;p||(p=(0,o.Y)(1,1,void 0,{willReadFrequently:!0})),p.clearRect(0,0,1,1);try{p.drawImage(e,t,r,1,1,0,0,1,1),n=p.getImageData(0,0,1,1).data}catch{return p=null,null}return n}getBackground(e){let t=this.getLayer().getBackground();return"function"==typeof t&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,r){const s=this.getLayer().getClassName();let l,d;if(e&&e.className===s&&(!r||e&&e.style.backgroundColor&&(0,n.aI)((0,i._j)(e.style.backgroundColor),(0,i._j)(r)))){const t=e.firstElementChild;(0,o.rB)(t)&&(d=t.getContext("2d"))}if(d&&(0,h.tI)(d.canvas.style.transform,t)?(this.container=e,this.context=d,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){l=a.Wl?(0,o.mH)():document.createElement("div"),l.className=s;let e=l.style;e.position="absolute",e.width="100%",e.height="100%",d=(0,o.Y)();const t=d.canvas;l.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=l,this.context=d}this.containerReused||!r||this.container.style.backgroundColor||(this.container.style.backgroundColor=r)}clipUnrotated(e,t,r){const n=(0,s.Py)(r),i=(0,s.WU)(r),o=(0,s.k_)(r),a=(0,s.R)(r);(0,h.Bb)(t.coordinateToPixelTransform,n),(0,h.Bb)(t.coordinateToPixelTransform,i),(0,h.Bb)(t.coordinateToPixelTransform,o),(0,h.Bb)(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;(0,h.Bb)(l,n),(0,h.Bb)(l,i),(0,h.Bb)(l,o),(0,h.Bb)(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const r=e.extent,n=e.viewState.resolution,i=e.viewState.rotation,o=e.pixelRatio,a=Math.round((0,s.RG)(r)/n*o),l=Math.round((0,s.Oq)(r)/n*o);(0,h.Zz)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,i,-a/2,-l/2),(0,h.T9)(this.inversePixelTransform,this.pixelTransform);const d=(0,h.dI)(this.pixelTransform);if(this.useContainer(t,d,this.getBackground(e)),!this.containerReused){const e=this.context.canvas;e.width!=a||e.height!=l?(e.width=a,e.height=l):this.context.clearRect(0,0,a,l),d!==e.style.transform&&(e.style.transform=d)}}dispatchRenderEvent_(e,t,r){const n=this.getLayer();if(n.hasListener(e)){const i=new l.A(e,this.inversePixelTransform,r,t);n.dispatchEvent(i)}}preRender(e,t){this.frameState=t,t.declutter||this.dispatchRenderEvent_(d.A.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(d.A.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new c.A),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(d.A.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(d.A.POSTRENDER,this.context,e))}getRenderTransform(e,t,r,n,i,o,s){const a=i/2,l=o/2,d=n/t,c=-d,g=-e[0]+s,u=-e[1];return(0,h.Zz)(this.tempTransform,a,l,d,c,-r,g,u)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const x=f}}]);