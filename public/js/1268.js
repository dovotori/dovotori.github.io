"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[1268,4937],{44937:(t,e,i)=>{i.r(e),i.d(e,{IndexedDb:()=>s});class s{constructor(t){this.db=null,this.dbName=t,this.objectStoreAlreadyExist={}}deleteDb(){return new Promise(((t,e)=>{const i=window.indexedDB.deleteDatabase(this.dbName);i.onerror=t=>{e(t)},i.onsuccess=e=>{t(e.result)}}))}setup(t){return new Promise(((e,i)=>{const s=window.indexedDB.open(this.dbName);s.onerror=t=>{i(t)},s.onupgradeneeded=e=>{this.db=e.target.result,t.forEach((t=>{this.db.createObjectStore(t.name,{keyPath:t.keyPath}).createIndex(t.keyPath,t.keyPath,{unique:t.unique})}))},s.onsuccess=i=>{this.db=i.target.result,t.forEach((t=>{this.db.objectStoreNames.contains(t.name)&&(this.objectStoreAlreadyExist[t.name]=!0)})),e()}}))}upsertData(t,e){return new Promise(((i,s)=>{this.db||s("db is not yet defined.");const n=this.db.transaction([t],"readwrite");n.oncomplete=t=>{i(t)},n.onerror=t=>{s(t)};const r=n.objectStore(t);e.forEach((t=>{const e=r.put(t);e.onsuccess=()=>{},e.onerror=t=>{s(t)}}))}))}getData(t,e){return new Promise(((i,s)=>{const n=this.db.transaction([t]).objectStore(t).get(e);n.onerror=t=>{s(t)},n.onsuccess=()=>{i(n.result)}}))}isStoreExist(t){return this.objectStoreAlreadyExist[t]??!1}}},57381:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(27853),n=i(50730);const r=class extends n.A{constructor(t){super(t),this.matIdentity=new s.A,this.projection=new s.A,this.projection.identity(),this.near=t.near??1,this.far=t.far??100,this.angle=t.angle??50,this.matIdentity.identity(),this.lookAt()}update(){this.lookAt()}perspective(t,e){this.projection.identity().perspective(this.angle,t/e,this.near,this.far)}move(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.position.set(this.position.getX(),Math.sin(.02*t)*(2+e),this.position.getZ()),this.lookAt()}setNearFar(t,e){this.near=t,this.far=e}setAngle(t){this.angle=t}getModeProjection(){return this.ortho??this.projection}getProjection(){return this.projection}getIdentity(){return this.matIdentity}getNearFar(){return[this.near,this.far]}getNear(){return this.near}getFar(){return this.far}getAngle(){return this.angle}getReflectViewMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const e=2*(this.position.getY()-t);return(new s.A).identity().lookAt(this.position.getX(),this.position.getY()-e,this.position.getZ(),this.target.getX(),this.target.getY(),this.target.getZ(),0,1,0)}}},50730:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(75112),n=i(27853);const r=class{constructor(t){if(this.position=new s.A(t.position.x,t.position.y,t.position.z),this.target=new s.A(0,0,0),this.view=new n.A,t.ortho){const{left:e,right:i,bottom:s,top:r}=t.ortho,{near:d,far:h}=t;this.ortho=new n.A,this.ortho.ortho(e,i,s,r,d,h)}}lookAt(){this.view.identity().lookAt(this.position.getX(),this.position.getY(),this.position.getZ(),this.target.getX(),this.target.getY(),this.target.getZ(),0,1,0)}getView(){return this.view}getPosition(){return this.position.get()}getPositionVec3(){return this.position}getTarget(){return this.target.get()}getModel(){return this.repere.getModel()}getOrtho(){return this.ortho}addToPosition(t,e,i){this.position.addXYZ(t,e,i),this.lookAt()}setPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=null!==t?t:this.position.getX(),n=null!==e?e:this.position.getY(),r=null!==i?i:this.position.getZ();this.position.set(s,n,r),this.lookAt()}setTarget(t,e,i){this.target.set(t,e,i)}setTargetVec3(t){this.target.equal(t)}}},20769:(t,e,i)=>{i.d(e,{A:()=>d});var s=i(79678),n=i(2823),r=i(27853);const d=class{constructor(){this.d=new Float32Array(8),this.identity()}identity(){return this.d[0]=0,this.d[1]=0,this.d[2]=0,this.d[3]=1,this.d[4]=0,this.d[5]=0,this.d[6]=0,this.d[7]=0,this}set(t,e,i,s,n,r,d,h){return this.d[0]=t,this.d[1]=e,this.d[2]=i,this.d[3]=s,this.d[4]=n,this.d[5]=r,this.d[6]=d,this.d[7]=h,this}add(t){return this.d[0]+=t.d[0],this.d[1]+=t.d[1],this.d[2]+=t.d[2],this.d[3]+=t.d[3],this.d[4]+=t.d[4],this.d[5]+=t.d[5],this.d[6]+=t.d[6],this.d[7]+=t.d[7],this}translate(t){const e=this.d[0],i=this.d[1],s=this.d[2],n=this.d[3],r=.5*t[0],d=.5*t[1],h=.5*t[2],o=this.d[4],a=this.d[5],u=this.d[6],l=this.d[7];return this.d[0]=e,this.d[1]=i,this.d[2]=s,this.d[3]=n,this.d[4]=n*r+i*h-s*d+o,this.d[5]=n*d+s*r-e*h+a,this.d[6]=n*h+e*d-i*r+u,this.d[7]=-e*r-i*d-s*h+l,this}multiply(t){const e=this.d[0],i=this.d[1],s=this.d[2],n=this.d[3],r=t.d[4],d=t.d[5],h=t.d[6],o=t.d[7],a=this.d[4],u=this.d[5],l=this.d[6],c=this.d[7],g=t.d[0],p=t.d[1],f=t.d[2],m=t.d[3];return this.d[0]=e*m+n*g+i*f-s*p,this.d[1]=i*m+n*p+s*g-e*f,this.d[2]=s*m+n*f+e*p-i*g,this.d[3]=n*m-e*g-i*p-s*f,this.d[4]=e*o+n*r+i*h-s*d+a*m+c*g+u*f-l*p,this.d[5]=i*o+n*d+s*r-e*h+u*m+c*p+l*g-a*f,this.d[6]=s*o+n*h+e*d-i*r+l*m+c*f+a*p-u*g,this.d[7]=n*o-e*r-i*d-s*h+c*m-a*g-u*p-l*f,this}scale(t){return this.d[0]*=t,this.d[1]*=t,this.d[2]*=t,this.d[3]*=t,this.d[4]*=t,this.d[5]*=t,this.d[6]*=t,this.d[7]*=t,this}rotateX(t){let e=-this.d[0],i=-this.d[1],s=-this.d[2],r=this.d[3];const d=this.d[4],h=this.d[5],o=this.d[6],a=this.d[7],u=d*r+a*e+h*s-o*i,l=h*r+a*i+o*e-d*s,c=o*r+a*s+d*i-h*e,g=a*r-d*e-h*i-o*s,p=new n.A(this.d[0],this.d[1],this.d[2],this.d[3]);return p.rotateX(t),this.d[0]=p.getX(),this.d[1]=p.getY(),this.d[2]=p.getZ(),this.d[3]=p.getW(),e=p.getX(),i=p.getY(),s=p.getZ(),r=p.getW(),this.d[4]=u*r+g*e+l*s-c*i,this.d[5]=l*r+g*i+c*e-u*s,this.d[6]=c*r+g*s+u*i-l*e,this.d[7]=g*r-u*e-l*i-c*s,this}rotateY(t){let e=-this.d[0],i=-this.d[1],s=-this.d[2],r=this.d[3];const d=this.d[4],h=this.d[5],o=this.d[6],a=this.d[7],u=d*r+a*e+h*s-o*i,l=h*r+a*i+o*e-d*s,c=o*r+a*s+d*i-h*e,g=a*r-d*e-h*i-o*s,p=new n.A(this.d[0],this.d[1],this.d[2],this.d[3]);return p.rotateY(t),this.d[0]=p.getX(),this.d[1]=p.getY(),this.d[2]=p.getZ(),this.d[3]=p.getW(),e=p.getX(),i=p.getY(),s=p.getZ(),r=p.getW(),this.d[4]=u*r+g*e+l*s-c*i,this.d[5]=l*r+g*i+c*e-u*s,this.d[6]=c*r+g*s+u*i-l*e,this.d[7]=g*r-u*e-l*i-c*s,this}rotateZ(t){let e=-this.d[0],i=-this.d[1],s=-this.d[2],r=this.d[3];const d=this.d[4],h=this.d[5],o=this.d[6],a=this.d[7],u=d*r+a*e+h*s-o*i,l=h*r+a*i+o*e-d*s,c=o*r+a*s+d*i-h*e,g=a*r-d*e-h*i-o*s,p=new n.A(this.d[0],this.d[1],this.d[2],this.d[3]);return p.rotateZ(t),this.d[0]=p.getX(),this.d[1]=p.getY(),this.d[2]=p.getZ(),this.d[3]=p.getW(),e=p.getX(),i=p.getY(),s=p.getZ(),r=p.getW(),this.d[4]=u*r+g*e+l*s-c*i,this.d[5]=l*r+g*i+c*e-u*s,this.d[6]=c*r+g*s+u*i-l*e,this.d[7]=g*r-u*e-l*i-c*s,this}rotateAroundAxis(t,e){if(Math.abs(e)<s.p)return this;const i=Math.hypot(t[0],t[1],t[2]),n=.5*e,r=Math.sin(n),d=r*t[0]/i,h=r*t[1]/i,o=r*t[2]/i,a=Math.cos(n),u=this.d[0],l=this.d[1],c=this.d[2],g=this.d[3];this.d[0]=u*a+g*d+l*o-c*h,this.d[1]=l*a+g*h+c*d-u*o,this.d[2]=c*a+g*o+u*h-l*d,this.d[3]=g*a-u*d-l*h-c*o;const p=this.d[4],f=this.d[5],m=this.d[6],b=this.d[7];return this.d[4]=p*a+b*d+f*o-m*h,this.d[5]=f*a+b*h+m*d-p*o,this.d[6]=m*a+b*o+p*h-f*d,this.d[7]=b*a-p*d-f*h-m*o,this}getTranslation(){const t=this.d[4],e=this.d[5],i=this.d[6],s=this.d[7],n=-this.d[0],r=-this.d[1],d=-this.d[2],h=this.d[3],o=[3];return o[0]=2*(t*h+s*n+e*d-i*r),o[1]=2*(e*h+s*r+i*n-t*d),o[2]=2*(i*h+s*d+t*r-e*n),o}toMatrix4(){const t=[16];t[0]=1-2*this.d[1]*this.d[1]-2*this.d[2]*this.d[2],t[1]=2*this.d[0]*this.d[1]+2*this.d[3]*this.d[2],t[2]=2*this.d[0]*this.d[2]-2*this.d[3]*this.d[1],t[3]=0,t[4]=2*this.d[0]*this.d[1]-2*this.d[3]*this.d[2],t[5]=1-2*this.d[0]*this.d[0]-2*this.d[2]*this.d[2],t[6]=2*this.d[1]*this.d[2]+2*this.d[3]*this.d[0],t[7]=0,t[8]=2*this.d[0]*this.d[2]+2*this.d[3]*this.d[1],t[9]=2*this.d[1]*this.d[2]-2*this.d[3]*this.d[0],t[10]=1-2*this.d[0]*this.d[0]-2*this.d[1]*this.d[1],t[11]=0,t[12]=2*(-this.d[7]*this.d[0]+this.d[4]*this.d[3]-this.d[5]*this.d[2]+this.d[6]*this.d[1]),t[13]=2*(-this.d[7]*this.d[1]+this.d[4]*this.d[2]+this.d[5]*this.d[3]-this.d[6]*this.d[0]),t[14]=2*(-this.d[7]*this.d[2]-this.d[4]*this.d[1]+this.d[5]*this.d[0]+this.d[6]*this.d[3]),t[15]=1;return(new r.A).setFromArray(t)}get(){return this.d}}},55325:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.d=[0,0,0,0],this.set(t,e,i,s)}normalise(){const t=this.length();return 0!==t&&(this.d[0]/=t,this.d[1]/=t,this.d[2]/=t,this.d[3]/=t),this}get(){return this.d}getX(){return this.d[0]}getY(){return this.d[1]}getZ(){return this.d[2]}getW(){return this.d[3]}length(){return Math.sqrt(this.d[0]*this.d[0]+this.d[1]*this.d[1]+this.d[2]*this.d[2]+this.d[3]*this.d[3])}set(t,e,i,s){return null!=t&&(this.d[0]=t),null!=e?this.d[1]=e:null!=t&&(this.d[1]=t),null!=i?this.d[2]=i:null!=t&&(this.d[2]=t),null!=s?this.d[3]=s:null!=t&&(this.d[3]=t),this}equal(t){return this.d=[t.d[0],t.d[1],t.d[2],t.d[3]],this}add(t){return this.d[0]+=t.d[0],this.d[1]+=t.d[1],this.d[2]+=t.d[2],this.d[3]+=t.d[3],this}addNumber(t){return this.d[0]+=t,this.d[1]+=t,this.d[2]+=t,this.d[3]+=t,this}minus(t){return this.d[0]-=t.d[0],this.d[1]-=t.d[1],this.d[2]-=t.d[2],this.d[3]-=t.d[3],this}minusNumber(t){return this.d[0]-=t,this.d[1]-=t,this.d[2]-=t,this.d[3]-=t,this}multiplyNumber(t){return this.d[0]*=t,this.d[1]*=t,this.d[2]*=t,this.d[3]*=t,this}multiplyMatrix(t){const e=this.d[0],i=this.d[1],s=this.d[2],n=this.d[3];return this.d[0]=t.d[0]*e+t.d[4]*i+t.d[8]*s+t.d[12]*n,this.d[1]=t.d[1]*e+t.d[5]*i+t.d[9]*s+t.d[13]*n,this.d[2]=t.d[2]*e+t.d[6]*i+t.d[10]*s+t.d[14]*n,this.d[3]=t.d[3]*e+t.d[7]*i+t.d[11]*s+t.d[15]*n,this}multiply(t){return this.d[0]*=t.d[0],this.d[1]*=t.d[1],this.d[2]*=t.d[2],this.d[3]*=t.d[3],this}divideNumber(t){return this.d[0]/=t,this.d[1]/=t,this.d[2]/=t,this.d[3]/=t,this}divide(t){return this.d[0]/=t.d[0],this.d[1]/=t.d[1],this.d[2]/=t.d[2],this.d[3]/=t.d[3],this}distance(t){return Math.sqrt((t.d[0]-this.d[0])*(t.d[0]-this.d[0])+(t.d[1]-this.d[1])*(t.d[1]-this.d[1])+(t.d[2]-this.d[2])*(t.d[2]-this.d[2])+(t.d[3]-this.d[3])*(t.d[3]-this.d[3]))}}},21268:(t,e,i)=>{i.r(e),i.d(e,{default:()=>w,destroy:()=>y});var s=i(83886);const n={slug:"webgpu",shaders:["/wgsl/vertex/v_gltf.js","/wgsl/fragment/f_gltf.js","/wgsl/vertex/v_picking.js","/wgsl/fragment/f_picking.js","/wgsl/vertex/v_debug_tex.js","/wgsl/vertex/v_shadow_depth.js","/wgsl/fragment/f_debug_tex.js","/wgsl/vertex/v_model_camera.js","/wgsl/fragment/f_simple.js"],assets:["/gltf/paysage9-testTex.gltf"],canvas:{width:1024,height:1024},camera:{position:{x:0,y:4,z:30},target:{x:0,y:0,z:0},near:1,far:60,angle:60},lampes:[{type:0,position:{x:-20,y:20,z:-2},target:{x:0,y:0,z:0},ambiant:[1,1,.2],diffuse:[1,1,1],specular:[1,1,1],strength:2,brillance:1,near:1,far:40,ortho:{left:-15,right:15,bottom:-15,top:15}},{type:0,position:{x:-10,y:20,z:10},ambiant:[1,.2,.3],strength:1}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},useWebGpu:!0,mouse:{events:["click"]}};var r=i(54705),d=i(57381),h=i(50730),o=i(20769),a=i(27853),u=i(75112),l=i(55325);var c=i(84909),g=i(44937);class p{constructor(){this.dbName="gltf",this.db=new g.IndexedDb(this.dbName)}async setup(){await this.db.setup([{name:"faces",keyPath:"meshIdIndex",unique:!0},{name:"matrices",keyPath:"meshId",unique:!0}])}async addFacesData(t){await this.db.upsertData("faces",t)}async addNodeMatricesData(t){await this.db.upsertData("matrices",t)}async getMeshFaceData(t){return this.db.getData("faces",t)}async getMeshMatrixData(t){return this.db.getData("matrices",t)}isStoreFacesExist(){return this.db.isStoreExist("faces")}isStoreNodeMatricesExist(){return this.db.isStoreExist("matrices")}}const f=!0;const m=class{constructor(t,e){(0,r.A)(this,"onMouseClick",(async t=>{this.updateCameraUniforms(this.pickingUniformCamera.buffer),await this.picking.pick(t.pos,this.pickingUniformCamera.bindGroup,this.gltfPipeline.getDrawNodes(),this.gltfPipeline.getAnimations());const e=await this.picking.pick(t.pos,this.pickingUniformCamera.bindGroup,this.gltfPipeline.getDrawNodes(),this.gltfPipeline.getAnimations()),{node:i,positions:s,matrix:n}=await this.gltfPipeline.getByPickColor(e),r={x:t.pos.x/t.size.width*2-1,y:t.pos.y/t.size.height*2-1},d=this.camera.getProjection(),h=this.camera.getView(),o=(new a.A).setFromArray(d.get()).inverse(),c=(new a.A).setFromArray(h.get()).inverse(),g=new l.A(r.x,r.y,-1,1).multiplyMatrix(o);g.set(g.getX(),g.getY(),-1,0);const p=g.multiplyMatrix(c).normalise();if(s&&n){s[0];const t=new u.A(s[1][0],s[1][1],s[1][2]),e=new u.A(s[2][0],s[2][1],s[2][2]),i=new u.A(s[0][0],s[0][1],s[0][2]).computeNormal(t,e);(function(t,e,i,s){const n=s.dot(e);if(0===n)return null;const r=i.clone().minus(t).dot(s)/n;r<0||e.clone().multiplyNumber(r).add(t)})(this.camera.getPositionVec3(),new u.A(p.getX(),p.getY(),p.getZ()),t,i)}})),this.context=t,this.config=e,this.time=0;const{width:i,height:s}=this.config.canvas;this.camera=new d.A(e.camera),this.camera.perspective(i,s),this.canvasSize={width:i,height:s},this.model=new a.A,this.model.identity(),this.gltfPipeline=new c.GltfPipeline(t,e),this.picking=new c.Picking(t),this.shadow=new c.Shadow(t),this.debug=new c.DebugTexture(t),this.lampe=new h.A(e.lampes[0]),this.lampe.lookAt()}setup(){}setupCamera(t,e){const i=this.context.getDevice(),s=i.createBuffer({size:52*Float32Array.BYTES_PER_ELEMENT,usage:window.GPUBufferUsage.UNIFORM|window.GPUBufferUsage.COPY_DST}),n=[{binding:0,resource:{buffer:s}}];let r;e&&(r=i.createBuffer({label:"LightProjBuffer",size:16*Float32Array.BYTES_PER_ELEMENT,usage:window.GPUBufferUsage.UNIFORM|window.GPUBufferUsage.COPY_DST}),n.push({binding:1,resource:{buffer:r}}));return{buffer:s,bindGroup:i.createBindGroup({label:"CameraUniforms",layout:t,entries:n}),bufferLightProj:r}}setupLights(t){const e=this.context.getDevice(),i=8*Float32Array.BYTES_PER_ELEMENT*this.config.lampes.length,s=e.createBuffer({label:"Light Storage Buffer",size:i,usage:window.GPUBufferUsage.STORAGE|window.GPUBufferUsage.COPY_DST}),n=[];this.config.lampes.forEach((t=>{const e=[t.position.x,t.position.y,t.position.z,0,...t.ambiant,t.strength];n.push(...e)}));const r=new Float32Array(n);e.queue.writeBuffer(s,0,r.buffer,r.byteOffset,r.byteLength);return{buffer:s,bindGroup:e.createBindGroup({label:"LightsUniforms",layout:t,entries:[{binding:0,resource:{buffer:s}}]})}}async setupAssets(t){const e=this.context.getDevice(),i=Object.keys(t.shaders).reduce(((i,s)=>{const n=new c.Program;return n.setup(e,s,t.shaders[s]),i[s]=n,i}),{}),s=Object.keys(t.gltfs)[0],n=t.gltfs[s],r={vertex:i.v_gltf.get(),fragment:i.f_gltf.get()};await this.shadow.setup({vertex:i.v_shadow_depth.get()},[this.gltfPipeline.getFirstBufferLayout()]),await this.gltfPipeline.setupDb(new p("gltf")),await this.gltfPipeline.setup(n,r,this.canvasSize,this.shadow.getShadowMapBindGroupEntries(e,this.lampe.getPosition()),f),this.uniformCamera=this.setupCamera(this.gltfPipeline.getBindGroupLayout(c.GltfBindGroups.CAMERA),!0),this.uniformLights=this.setupLights(this.gltfPipeline.getBindGroupLayout(c.GltfBindGroups.LIGHT)),await this.picking.setup({vertex:i.v_picking.get(),fragment:i.f_picking.get()},this.canvasSize,[this.gltfPipeline.getFirstBufferLayout()]),this.pickingUniformCamera=this.setupCamera(this.picking.getBindGroupLayout(c.GltfBindGroups.CAMERA)),this.picking.setTransformBindGroups(this.gltfPipeline.buildTransformBindGroups(this.picking.getBindGroupLayout(c.GltfBindGroups.TRANSFORM))),this.shadowUniformCamera=this.setupCamera(this.shadow.getBindGroupLayout(c.GltfBindGroups.CAMERA)),this.shadow.setTransformBindGroups(this.gltfPipeline.buildTransformBindGroups(this.shadow.getBindGroupLayout(c.GltfBindGroups.TRANSFORM))),this.debug.setup({vertex:i.v_debug_tex.get(),fragment:i.f_debug_tex.get()},this.shadow.getSize()),this.debug.setTexture(this.shadow.getDepthTexture())}update(t){this.model.identity();const e=new o.A;e.rotateY(1e-4*t),this.model.multiply(e.toMatrix4()),this.gltfPipeline.updateAnimations(t)}updateCameraUniforms(t,e){const i=this.context.getDevice(),s=this.camera.getModeProjection().get(),n=this.camera.getView().get(),r=new Float32Array(51);if(r.set(s,0),r.set(n,16),r.set(this.model.get(),32),r.set(this.camera.getPosition(),48),i.queue.writeBuffer(t,0,r.buffer,r.byteOffset,r.byteLength),e){const t=(new a.A).setFromArray(this.lampe.getView().get()),s=new Float32Array(16);s.set(t.multiply(this.lampe.getOrtho()).get(),0),i.queue.writeBuffer(e,0,s.buffer,s.byteOffset,s.byteLength)}}updateCameraUniformsWithLight(t){const e=this.context.getDevice(),i=this.lampe.getOrtho().get(),s=this.lampe.getView().get(),n=new Float32Array(i.concat(s,this.model.get(),this.lampe.getPosition()));e.queue.writeBuffer(t,0,n.buffer,n.byteOffset,n.byteLength)}render(){const t=this.context.getDevice();this.gltfPipeline.update(),this.renderShadowDepthPass(),this.updateCameraUniforms(this.uniformCamera.buffer,this.uniformCamera.bufferLightProj);const e=t.createCommandEncoder({label:"GltfCommandEncoder"}),i=e.beginRenderPass(this.gltfPipeline.getRenderPassDescriptor());i.setPipeline(this.gltfPipeline.get()),i.setBindGroup(c.GltfBindGroups.CAMERA,this.uniformCamera.bindGroup),i.setBindGroup(c.GltfBindGroups.LIGHT,this.uniformLights.bindGroup),this.gltfPipeline.drawModel(t,i,f),i.end(),t.queue.submit([e.finish()])}renderShadowDepthPass(){this.updateCameraUniformsWithLight(this.shadowUniformCamera.buffer),this.shadow.render(this.shadowUniformCamera.bindGroup,this.gltfPipeline.getDrawNodes(),this.gltfPipeline.getAnimations())}resize(t){this.canvasSize=t,this.gltfPipeline.resize(t),this.picking.resize(t)}};i(19513),i(807);let b=null;const w=async()=>{b=new s.A,await b.setup(m,n)},y=()=>{b&&b.destroy&&b.destroy()}},77314:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(31601),n=i.n(s),r=i(76314),d=i.n(r)()(n());d.push([t.id,"#controls {\n  position: absolute;\n  top: 0;\n  right: 0;\n  display: flex;\n  align-items: stretch;\n  z-index: 10;\n  background-color: rgba(34, 34, 34, .8);\n  margin: .5em;\n  padding: .5em;\n}\n\n#controls div {\n  display: flex;\n  align-items: stretch;\n}\n\n#controls div input[type=range] {\n  width: 100%;\n}\n\n#controls div input[type=checkbox] {\n  margin-right: 0.5em;\n}\n\n#controls label {\n  display: flex;\n  align-items: center;\n}\n\n#controls label,\n#controls a {\n  font-size: .8em;\n}\n\n@media (max-width: 570px) {\n  #controls.responsive {\n    position: relative;\n    width: 100%;\n    margin: 0;\n  }\n}",""]);const h=d},55420:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(31601),n=i.n(s),r=i(76314),d=i.n(r)()(n());d.push([t.id,"#fullscreen-toggle-btn {\n  border-radius: 0;\n  margin: 0;\n  padding: 4px;\n  border: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n  transform: scale(0.8);\n  opacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n  display: block;\n  width: 2em;\n  fill: #fff;\n  opacity: 0.8;\n  transform: scale(0.6);\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\n}\n\n[data-fullscreen] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n",""]);const h=d},76314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var d={};if(s)for(var h=0;h<this.length;h++){var o=this[h][0];null!=o&&(d[o]=!0)}for(var a=0;a<t.length;a++){var u=[].concat(t[a]);s&&d[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),n&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=n):u[4]="".concat(n)),e.push(u))}},e}},31601:t=>{t.exports=function(t){return t[1]}},19513:(t,e,i)=>{var s=i(85072),n=i.n(s),r=i(97825),d=i.n(r),h=i(77659),o=i.n(h),a=i(55056),u=i.n(a),l=i(10540),c=i.n(l),g=i(41113),p=i.n(g),f=i(77314),m={};m.styleTagTransform=p(),m.setAttributes=u(),m.insert=o().bind(null,"head"),m.domAPI=d(),m.insertStyleElement=c();n()(f.A,m),f.A&&f.A.locals&&f.A.locals},807:(t,e,i)=>{var s=i(85072),n=i.n(s),r=i(97825),d=i.n(r),h=i(77659),o=i.n(h),a=i(55056),u=i.n(a),l=i(10540),c=i.n(l),g=i(41113),p=i.n(g),f=i(55420),m={};m.styleTagTransform=p(),m.setAttributes=u(),m.insert=o().bind(null,"head"),m.domAPI=d(),m.insertStyleElement=c();n()(f.A,m),f.A&&f.A.locals&&f.A.locals},85072:t=>{var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var r={},d=[],h=0;h<t.length;h++){var o=t[h],a=s.base?o[0]+s.base:o[0],u=r[a]||0,l="".concat(a," ").concat(u);r[a]=u+1;var c=i(l),g={css:o[1],media:o[2],sourceMap:o[3],supports:o[4],layer:o[5]};if(-1!==c)e[c].references++,e[c].updater(g);else{var p=n(g,s);s.byIndex=h,e.splice(h,0,{identifier:l,updater:p,references:1})}d.push(l)}return d}function n(t,e){var i=e.domAPI(e);i.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var r=s(t=t||[],n=n||{});return function(t){t=t||[];for(var d=0;d<r.length;d++){var h=i(r[d]);e[h].references--}for(var o=s(t,n),a=0;a<r.length;a++){var u=i(r[a]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}r=o}}},77659:t=>{var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},10540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},55056:(t,e,i)=>{t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},97825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,n&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var r=i.sourceMap;r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},41113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}}]);