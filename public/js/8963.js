"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[8963],{94281:(e,t,r)=>{r.d(t,{Eu:()=>s,H$:()=>o});var n=r(68763),s=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=r.startX,o=void 0===s?-1:s,a=r.endX,i=void 0===a?1:a,l=r.startZ,c=void 0===l?-1:l,d=r.endZ,u=void 0===d?1:d,g=[],p=0;p<t;p++)for(var h=(0,n.Yp)(p,0,t-1,c,u),m=0;m<e;m++){var f=(0,n.Yp)(m,0,e-1,o,i);g.push(f),g.push(0),g.push(h)}return g},o=function(e,t){for(var r=[],n=0;n<t-1;n++)for(var s=0;s<e-1;s++){var o=n*e+s;r.push(o),r.push(e+o),r.push(o+1),r.push(e+o),r.push(e+o+1),r.push(o+1)}return r}},58963:(e,t,r)=>{r.r(t),r.d(t,{default:()=>E,destroy:()=>F});var n=r(15861),s=r(87757),o=r.n(s),a=r(35466),i=r(92826),l=r(42982),c=r(15671),d=r(43144),u=r(97326),g=r(11752),p=r(60136),h=r(6215),m=r(61120),f=r(4942),Z=r(25192),v=r(21200),y=r(80602),P=r(21969),b=r(25773),S=r(94281),T=r(47313);function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.Z)(e);if(t){var s=(0,m.Z)(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return(0,h.Z)(this,r)}}var w=function(e){return.5*Math.sin(e)+.5},j=function(e){(0,p.Z)(r,e);var t=x(r);function r(e,n,s){var o;(0,c.Z)(this,r),o=t.call(this,e,n,s),(0,f.Z)((0,u.Z)(o),"getDistPos",(function(e){var t,r,n,s,a,c=o.config,d=c.roadAmplitude,u=c.roadLength,g=c.roadFrequence;return(0,i.Z)(b.Z,(0,l.Z)((t=e/u,r=g,n=d,s=o.posTime,a=.02,[Math.cos(t*Math.PI*r[0]+s)*n[0]-Math.cos(a*Math.PI*r[0]+s)*n[0],w(t*Math.PI*r[1]+s)*n[1]-w(a*Math.PI*r[1]+s)*n[1],w(t*Math.PI*r[2]+s)*n[2]-w(a*Math.PI*r[2]+s)*n[2]])))})),(0,f.Z)((0,u.Z)(o),"updateCamera",(function(){var e=o.config,t=e.roadLength,r=e.camera,n=o.getDistPos(100),s=o.getDistPos(0);o.camera.setTarget(n.getX(),r.position.y+n.getY(),t),o.camera.setPosition(s.getX(),r.position.y+s.getY(),0)})),(0,f.Z)((0,u.Z)(o),"moveShip",(function(){o.targetPosX.update(),o.targetSpeed.update(),o.posTime+=o.targetSpeed.get();var e=o.getDistPos(o.shipPos.getZ());o.currentShipPos.equal(e).add(o.shipPos).addX(o.targetPosX.get())})),(0,f.Z)((0,u.Z)(o),"renderMountain",(function(){var e=o.config,t=e.roadAmplitude,r=e.roadLength,n=e.roadWidth,s=e.roadFrequence,a=o.mngProg.get("roadmountain");a.setProjectionView(o.camera),a.setMatrix("model",o.model.get()),a.setFloat("time",o.posTime),a.setVector("frequence",s),a.setVector("amplitude",t),a.setFloat("roadWidth",n),a.setFloat("roadLength",r),o.mountainVbo.render(a.get())})),(0,f.Z)((0,u.Z)(o),"renderRoad",(function(){var e=o.config,t=e.roadAmplitude,r=e.roadLength,n=e.roadWidth,s=e.roadFrequence,a=o.mngProg.get("road");a.setProjectionView(o.camera),a.setMatrix("model",o.model.get()),a.setFloat("time",o.posTime),a.setVector("frequence",s),a.setVector("amplitude",t),a.setFloat("roadWidth",n),a.setFloat("roadLength",r),o.roadVbo.render(a.get())})),(0,f.Z)((0,u.Z)(o),"renderShip",(function(){var e,t=o.mngProg.get("gltf"),r=o.mngGltf.get("raceship");o.model.push(),(e=o.model).translate.apply(e,(0,l.Z)(o.currentShipPos.get())),r.renderExcept(["trail1","trail2"],t,o.model),o.model.pop()})),(0,f.Z)((0,u.Z)(o),"renderShipTrails",(function(){var e,t=o.mngProg.get("gltf"),r=o.mngGltf.get("raceship");o.model.push(),(e=o.model).translate.apply(e,(0,l.Z)(o.currentShipPos.get())),r.renderOnly(["trail1","trail2"],t,o.model),o.model.pop()})),(0,f.Z)((0,u.Z)(o),"interactShip",(function(e){var t=o.config.roadWidth;o.targetSpeed.set(.1),o.targetPosX.set(-e.rel.x*t*.6)})),(0,f.Z)((0,u.Z)(o),"onMouseDrag",(function(e){o.interactShip(e)})),(0,f.Z)((0,u.Z)(o),"onMouseDown",(function(e){o.interactShip(e)})),(0,f.Z)((0,u.Z)(o),"onMouseUp",(function(){o.targetSpeed.set(0)})),o.screen=new v.Z(o.gl),o.model=new P.Z;var a=n.roadLength,d=n.roadWidth,g=n.shipPosition,p=(0,S.Eu)(2,a,{startX:-d,endX:d,startZ:0,endZ:a}),h=(0,S.Eu)(120,a,{startX:-120,endX:120,startZ:0,endZ:a}),m=(0,S.H$)(2,a);o.roadVbo=new y.Z(e,{position:p,indices:m});var Z=(0,S.H$)(120,a);return o.mountainVbo=new y.Z(e,{position:h,indices:Z}),o.shipPos=(0,i.Z)(b.Z,(0,l.Z)(g)),o.currentShipPos=new b.Z(0),o.targetPosX=new T.Z(0,.1),o.targetSpeed=new T.Z(0,.1),o.posTime=0,o.setLampeInfos(o.mngProg.get("gltf")),o.mngProg.get("roadSky").setTexture(1,o.mngTex.get("noisergb").get(),"textureMap"),o}return(0,d.Z)(r,[{key:"update",value:function(e){(0,g.Z)((0,m.Z)(r.prototype),"update",this).call(this,e),this.model.identity(),this.moveShip(),this.updateTrails(),this.updateCamera(),this.mngGltf.get("raceship").update(e)}},{key:"updateTrails",value:function(){var e=this.mngProg.get("gltf"),t=this.mngGltf.get("raceship");e.setProjectionView(this.camera),t.setAnimationStep("trail1","scale",10*this.targetSpeed.get()),t.setAnimationStep("trail2","scale",10*this.targetSpeed.get())}},{key:"renderLandscape",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("roadSky");e.setFloat("flipY",-1),e.setFloat("time",.1*this.time),e.setVector("wind",[.1,.2]),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"renderTunnel",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("tunnelrace");e.setFloat("flipY",-1),e.setFloat("time",.001*this.time),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"render",value:function(){(0,g.Z)((0,m.Z)(r.prototype),"render",this).call(this),this.postProcess.start(),this.renderTunnel(),this.renderMountain(),this.renderRoad(),this.renderShip(),this.postProcess.end(),this.bloom.start(),this.renderShipTrails(),this.bloom.end(),this.postProcess.mergeBloom(this.bloom.getTexture(),1.5,2.2);var e=100*this.targetSpeed.get();this.postProcess.setRGB(e,e,.5,.5),this.postProcess.setFxaa2(),this.postProcess.render()}}]),r}(Z.Z);const k={slug:"race",assets:["/textures/noisergb.png","/gltf/raceship.gltf"],shaders:["/camera/road.js","/camera/gltf.js","/camera/roadmountain.js","/camera/basique3d.js","/sky/roadSky.js","/camera/gltf.js","/screen/screen.js","/screen/debug.js","/screen/blurOnePass.js","/screen/bloom.js","/screen/mergeBloom.js","/screen/fxaa.js","/screen/fxaa2.js","/screen/tunnelrace.js","/screen/rgb.js"],useDepthTexture:!0,postprocess:{bloom:{intensity:1}},textures:{noisergb:"LINEAR"},canvas:{width:1024,height:512},mouse:{events:["down","up","drag"]},camera:{position:{x:0,y:4,z:0},target:{x:0,y:0,z:128},near:1,far:200,angle:90},lampes:[{type:0,position:{x:0,y:3,z:3},ambiant:[1,1,1],diffuse:[.8,.6,.5],specular:[1,.8,.7],brillance:1,strength:40}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},roadFrequence:[2,0,2],roadAmplitude:[10,0,4],roadLength:128,roadWidth:8,shipPosition:[0,2,3]};r(88747),r(89153);var M=null;const E=(0,n.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M=new a.Z,e.next=3,M.setup(j,k);case 3:(t=document.querySelector("#".concat(k.slug))).parentNode&&(t.parentNode.style.display="flex",t.parentNode.style.alignItems="center"),t.appendChild(M.getCanvas());case 6:case"end":return e.stop()}}),e)})));var F=function(){M&&M.destroy&&M.destroy()}},24981:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(8081),s=r.n(n),o=r(23645),a=r.n(o)()(s());a.push([e.id,"#controls {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  display: flex;\r\n  align-items: stretch;\r\n  z-index: 10;\r\n  background-color: rgba(34, 34, 34, .8);\r\n  margin: .5em;\r\n  padding: .5em;\r\n}\r\n\r\n#controls div {\r\n  display: flex;\r\n  align-items: stretch;\r\n}\r\n\r\n#controls div input[type=range] {\r\n  width: 100%;\r\n}\r\n\r\n#controls div input[type=checkbox] {\r\n  margin-right: 0.5em;\r\n}\r\n\r\n#controls label {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n#controls label,\r\n#controls a {\r\n  font-size: .8em;\r\n}\r\n\r\n@media (max-width: 570px) {\r\n  #controls.responsive {\r\n    position: relative;\r\n    width: 100%;\r\n    margin: 0;\r\n  }\r\n}",""]);const i=a},76889:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(8081),s=r.n(n),o=r(23645),a=r.n(o)()(s());a.push([e.id,"#fullscreen-toggle-btn {\r\n  border-radius: 0;\r\n  margin: 0;\r\n  padding: 4px;\r\n  border: solid 2px var(--project-color);\r\n}\r\n\r\n#fullscreen-toggle-btn:hover svg,\r\n#fullscreen-toggle-btn:active svg {\r\n  transform: scale(0.8);\r\n  opacity: 1;\r\n}\r\n\r\n#fullscreen-toggle-btn svg {\r\n  display: block;\r\n  width: 2em;\r\n  fill: #fff;\r\n  opacity: 0.8;\r\n  transform: scale(0.6);\r\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\r\n}\r\n\r\n[data-fullscreen] {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n",""]);const i=a},88747:(e,t,r)=>{var n=r(93379),s=r.n(n),o=r(7795),a=r.n(o),i=r(90569),l=r.n(i),c=r(3565),d=r.n(c),u=r(70609),g=r.n(u),p=r(44589),h=r.n(p),m=r(24981),f={};f.styleTagTransform=h(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=g();s()(m.Z,f),m.Z&&m.Z.locals&&m.Z.locals},89153:(e,t,r)=>{var n=r(93379),s=r.n(n),o=r(7795),a=r.n(o),i=r(90569),l=r.n(i),c=r(3565),d=r.n(c),u=r(70609),g=r.n(u),p=r(44589),h=r.n(p),m=r(76889),f={};f.styleTagTransform=h(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=g();s()(m.Z,f),m.Z&&m.Z.locals&&m.Z.locals}}]);