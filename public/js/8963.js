"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[8963],{94281:(e,t,n)=>{n.d(t,{Eu:()=>s,H$:()=>o});var r=n(68763),s=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=n.startX,o=void 0===s?-1:s,a=n.endX,i=void 0===a?1:a,l=n.startZ,c=void 0===l?-1:l,d=n.endZ,u=void 0===d?1:d,g=[],p=0;p<t;p++)for(var h=(0,r.Yp)(p,0,t-1,c,u),m=0;m<e;m++){var f=(0,r.Yp)(m,0,e-1,o,i);g.push(f),g.push(0),g.push(h)}return g},o=function(e,t){for(var n=[],r=0;r<t-1;r++)for(var s=0;s<e-1;s++){var o=r*e+s;n.push(o),n.push(e+o),n.push(o+1),n.push(e+o),n.push(e+o+1),n.push(o+1)}return n}},58963:(e,t,n)=>{n.r(t),n.d(t,{default:()=>F,destroy:()=>X});var r=n(15861),s=n(64687),o=n.n(s),a=n(35466),i=n(92826),l=n(42982),c=n(15671),d=n(43144),u=n(97326),g=n(11752),p=n(60136),h=n(82963),m=n(61120),f=n(4942),v=n(25192),Z=n(21200),y=n(80602),P=n(21969),b=n(25773),S=n(94281),T=n(47313);function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var s=(0,m.Z)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return(0,h.Z)(this,n)}}var w=function(e){return.5*Math.sin(e)+.5},j=function(e,t,n,r){var s=.02;return[Math.cos(e*Math.PI*t[0]+r)*n[0]-Math.cos(s*Math.PI*t[0]+r)*n[0],w(e*Math.PI*t[1]+r)*n[1]-w(s*Math.PI*t[1]+r)*n[1],w(e*Math.PI*t[2]+r)*n[2]-w(s*Math.PI*t[2]+r)*n[2]]},k=function(e){(0,p.Z)(n,e);var t=x(n);function n(){var e;(0,c.Z)(this,n);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return e=t.call.apply(t,[this].concat(s)),(0,f.Z)((0,u.Z)(e),"getDistPos",(function(t){var n=e.config,r=n.roadAmplitude,s=n.roadLength,o=n.roadFrequence;return(0,i.Z)(b.Z,(0,l.Z)(j(t/s,o,r,e.posTime)))})),(0,f.Z)((0,u.Z)(e),"updateCamera",(function(){var t=e.config,n=t.roadLength,r=t.camera,s=e.getDistPos(100),o=e.getDistPos(0);e.camera.setTarget(s.getX(),r.position.y+s.getY(),n),e.camera.setPosition(o.getX(),r.position.y+o.getY(),0)})),(0,f.Z)((0,u.Z)(e),"moveShip",(function(){e.targetPosX.update(),e.targetSpeed.update(),e.posTime+=e.targetSpeed.get();var t=e.getDistPos(e.shipPos.getZ());e.currentShipPos.equal(t).add(e.shipPos).addX(e.targetPosX.get())})),(0,f.Z)((0,u.Z)(e),"renderMountain",(function(){var t=e.config,n=t.roadAmplitude,r=t.roadLength,s=t.roadWidth,o=t.roadFrequence,a=e.mngProg.get("roadmountain");a.setProjectionView(e.camera),a.setMatrix("model",e.model.get()),a.setFloat("time",e.posTime),a.setVector("frequence",o),a.setVector("amplitude",n),a.setFloat("roadWidth",s),a.setFloat("roadLength",r),e.mountainVbo.render(a.get())})),(0,f.Z)((0,u.Z)(e),"renderRoad",(function(){var t=e.config,n=t.roadAmplitude,r=t.roadLength,s=t.roadWidth,o=t.roadFrequence,a=e.mngProg.get("road");a.setProjectionView(e.camera),a.setMatrix("model",e.model.get()),a.setFloat("time",e.posTime),a.setVector("frequence",o),a.setVector("amplitude",n),a.setFloat("roadWidth",s),a.setFloat("roadLength",r),e.roadVbo.render(a.get())})),(0,f.Z)((0,u.Z)(e),"renderShip",(function(){var t,n=e.mngProg.get("gltf"),r=e.mngGltf.get("raceship");e.model.push(),(t=e.model).translate.apply(t,(0,l.Z)(e.currentShipPos.get())),r.renderExcept(["trail1","trail2"],n,e.model),e.model.pop()})),(0,f.Z)((0,u.Z)(e),"renderShipTrails",(function(){var t,n=e.mngProg.get("gltf"),r=e.mngGltf.get("raceship");e.model.push(),(t=e.model).translate.apply(t,(0,l.Z)(e.currentShipPos.get())),r.renderOnly(["trail1","trail2"],n,e.model),e.model.pop()})),(0,f.Z)((0,u.Z)(e),"interactShip",(function(t){var n=e.config.roadWidth;e.targetSpeed.set(.1),e.targetPosX.set(-t.rel.x*n*.6)})),(0,f.Z)((0,u.Z)(e),"onMouseDrag",(function(t){e.interactShip(t)})),(0,f.Z)((0,u.Z)(e),"onMouseDown",(function(t){e.interactShip(t)})),(0,f.Z)((0,u.Z)(e),"onMouseUp",(function(){e.targetSpeed.set(0)})),e}return(0,d.Z)(n,[{key:"setup",value:function(){var e=this.gl;this.screen=new Z.Z(e),this.model=new P.Z;var t=this.config,n=t.roadLength,r=t.roadWidth,s=t.shipPosition,o=(0,S.Eu)(2,n,{startX:-r,endX:r,startZ:0,endZ:n}),a=(0,S.Eu)(120,n,{startX:-120,endX:120,startZ:0,endZ:n}),c=(0,S.H$)(2,n);this.roadVbo=new y.Z(e,{position:o,indices:c});var d=(0,S.H$)(120,n);this.mountainVbo=new y.Z(e,{position:a,indices:d}),this.shipPos=(0,i.Z)(b.Z,(0,l.Z)(s)),this.currentShipPos=new b.Z(0),this.targetPosX=new T.Z(0,.1),this.targetSpeed=new T.Z(0,.1),this.posTime=0,this.setLampeInfos(this.mngProg.get("gltf")),this.mngProg.get("roadSky").setTexture(1,this.mngTex.get("noisergb").get(),"textureMap")}},{key:"update",value:function(e){(0,g.Z)((0,m.Z)(n.prototype),"update",this).call(this,e),this.model.identity(),this.moveShip(),this.updateTrails(),this.updateCamera(),this.mngGltf.get("raceship").update(e)}},{key:"updateTrails",value:function(){var e=this.mngProg.get("gltf"),t=this.mngGltf.get("raceship");e.setProjectionView(this.camera),t.setAnimationStep("trail1","scale",10*this.targetSpeed.get()),t.setAnimationStep("trail2","scale",10*this.targetSpeed.get())}},{key:"renderLandscape",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("roadSky");e.setFloat("flipY",-1),e.setFloat("time",.1*this.time),e.setVector("wind",[.1,.2]),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"renderTunnel",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("tunnelrace");e.setFloat("flipY",-1),e.setFloat("time",.001*this.time),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"render",value:function(){(0,g.Z)((0,m.Z)(n.prototype),"render",this).call(this),this.postProcess.start(),this.renderTunnel(),this.renderMountain(),this.renderRoad(),this.renderShip(),this.postProcess.end(),this.bloom.start(),this.renderShipTrails(),this.bloom.end(),this.postProcess.mergeBloom(this.bloom.getTexture(),1.5,2.2);var e=100*this.targetSpeed.get();this.postProcess.setRGB(e,e,.5,.5),this.postProcess.setFxaa2(),this.postProcess.render()}}]),n}(v.Z);const M={slug:"race",assets:["/textures/noisergb.png","/gltf/raceship.gltf"],shaders:["/camera/road.js","/camera/gltf.js","/camera/roadmountain.js","/camera/basique3d.js","/sky/roadSky.js","/camera/gltf.js","/screen/screen.js","/screen/debug.js","/screen/blurOnePass.js","/screen/bloom.js","/screen/mergeBloom.js","/screen/fxaa.js","/screen/fxaa2.js","/screen/tunnelrace.js","/screen/rgb.js"],useDepthTexture:!0,postprocess:{bloom:{intensity:1}},textures:{noisergb:"LINEAR"},canvas:{width:1024,height:512},mouse:{events:["down","up","drag"]},camera:{position:{x:0,y:4,z:0},target:{x:0,y:0,z:128},near:1,far:200,angle:90},lampes:[{type:0,position:{x:0,y:3,z:3},ambiant:[1,1,1],diffuse:[.8,.6,.5],specular:[1,.8,.7],brillance:1,strength:40}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},roadFrequence:[2,0,2],roadAmplitude:[10,0,4],roadLength:128,roadWidth:8,shipPosition:[0,2,3]};n(88747),n(89153);var E=null;const F=(0,r.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E=new a.Z,e.next=3,E.setup(k,M);case 3:(t=document.querySelector("#".concat(M.slug))).parentNode&&(t.parentNode.style.display="flex",t.parentNode.style.alignItems="center"),(n=E.getCanvas())&&t&&t.appendChild(n);case 7:case"end":return e.stop()}}),e)})));var X=function(){E&&E.destroy&&E.destroy()}},24981:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(8081),s=n.n(r),o=n(23645),a=n.n(o)()(s());a.push([e.id,"#controls {\n  position: absolute;\n  top: 0;\n  right: 0;\n  display: flex;\n  align-items: stretch;\n  z-index: 10;\n  background-color: rgba(34, 34, 34, .8);\n  margin: .5em;\n  padding: .5em;\n}\n\n#controls div {\n  display: flex;\n  align-items: stretch;\n}\n\n#controls div input[type=range] {\n  width: 100%;\n}\n\n#controls div input[type=checkbox] {\n  margin-right: 0.5em;\n}\n\n#controls label {\n  display: flex;\n  align-items: center;\n}\n\n#controls label,\n#controls a {\n  font-size: .8em;\n}\n\n@media (max-width: 570px) {\n  #controls.responsive {\n    position: relative;\n    width: 100%;\n    margin: 0;\n  }\n}",""]);const i=a},76889:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(8081),s=n.n(r),o=n(23645),a=n.n(o)()(s());a.push([e.id,"#fullscreen-toggle-btn {\n  border-radius: 0;\n  margin: 0;\n  padding: 4px;\n  border: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n  transform: scale(0.8);\n  opacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n  display: block;\n  width: 2em;\n  fill: #fff;\n  opacity: 0.8;\n  transform: scale(0.6);\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\n}\n\n[data-fullscreen] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n",""]);const i=a},88747:(e,t,n)=>{var r=n(93379),s=n.n(r),o=n(7795),a=n.n(o),i=n(90569),l=n.n(i),c=n(3565),d=n.n(c),u=n(70609),g=n.n(u),p=n(44589),h=n.n(p),m=n(24981),f={};f.styleTagTransform=h(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=g();s()(m.Z,f),m.Z&&m.Z.locals&&m.Z.locals},89153:(e,t,n)=>{var r=n(93379),s=n.n(r),o=n(7795),a=n.n(o),i=n(90569),l=n.n(i),c=n(3565),d=n.n(c),u=n(70609),g=n.n(u),p=n(44589),h=n.n(p),m=n(76889),f={};f.styleTagTransform=h(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=g();s()(m.Z,f),m.Z&&m.Z.locals&&m.Z.locals}}]);