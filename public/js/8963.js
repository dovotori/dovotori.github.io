"use strict";(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[8963],{94281:(e,t,n)=>{n.d(t,{Eu:()=>s,H$:()=>o});var r=n(68763),s=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=n.startX,o=void 0===s?-1:s,a=n.endX,i=void 0===a?1:a,l=n.startZ,c=void 0===l?-1:l,d=n.endZ,u=void 0===d?1:d,g=[],h=0;h<t;h++)for(var p=(0,r.Yp)(h,0,t-1,c,u),m=0;m<e;m++){var f=(0,r.Yp)(m,0,e-1,o,i);g.push(f),g.push(0),g.push(p)}return g},o=function(e,t){for(var n=[],r=0;r<t-1;r++)for(var s=0;s<e-1;s++){var o=r*e+s;n.push(o),n.push(e+o),n.push(o+1),n.push(e+o),n.push(e+o+1),n.push(o+1)}return n}},58963:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y,destroy:()=>z});var r=n(48926),s=n.n(r),o=n(87757),a=n.n(o),i=n(35466),l=n(69100),c=n.n(l),d=n(319),u=n.n(d),g=n(34575),h=n.n(g),p=n(93913),m=n.n(p),f=n(81506),v=n.n(f),P=n(16525),y=n.n(P),b=n(2205),S=n.n(b),T=n(78585),x=n.n(T),Z=n(29754),w=n.n(Z),j=n(59713),k=n.n(j),M=n(25192),E=n(21200),F=n(80602),X=n(21969),A=n(25773),V=n(94281),D=n(47313);function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var s=w()(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return x()(this,n)}}var L=function(e){return.5*Math.sin(e)+.5},R=function(e,t,n,r){var s=.02;return[Math.cos(e*Math.PI*t[0]+r)*n[0]-Math.cos(s*Math.PI*t[0]+r)*n[0],L(e*Math.PI*t[1]+r)*n[1]-L(s*Math.PI*t[1]+r)*n[1],L(e*Math.PI*t[2]+r)*n[2]-L(s*Math.PI*t[2]+r)*n[2]]},q=function(e){S()(n,e);var t=I(n);function n(){var e;h()(this,n);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return e=t.call.apply(t,[this].concat(s)),k()(v()(e),"getDistPos",(function(t){var n=e.config,r=n.roadAmplitude,s=n.roadLength,o=n.roadFrequence;return c()(A.Z,u()(R(t/s,o,r,e.posTime)))})),k()(v()(e),"updateCamera",(function(){var t=e.config,n=t.roadLength,r=t.camera,s=e.getDistPos(100),o=e.getDistPos(0);e.camera.setTarget(s.getX(),r.position.y+s.getY(),n),e.camera.setPosition(o.getX(),r.position.y+o.getY(),0)})),k()(v()(e),"moveShip",(function(){e.targetPosX.update(),e.targetSpeed.update(),e.posTime+=e.targetSpeed.get();var t=e.getDistPos(e.shipPos.getZ());e.currentShipPos.equal(t).add(e.shipPos).addX(e.targetPosX.get())})),k()(v()(e),"renderMountain",(function(){var t=e.config,n=t.roadAmplitude,r=t.roadLength,s=t.roadWidth,o=t.roadFrequence,a=e.mngProg.get("roadmountain");a.setProjectionView(e.camera),a.setMatrix("model",e.model.get()),a.setFloat("time",e.posTime),a.setVector("frequence",o),a.setVector("amplitude",n),a.setFloat("roadWidth",s),a.setFloat("roadLength",r),e.mountainVbo.render(a.get())})),k()(v()(e),"renderRoad",(function(){var t=e.config,n=t.roadAmplitude,r=t.roadLength,s=t.roadWidth,o=t.roadFrequence,a=e.mngProg.get("road");a.setProjectionView(e.camera),a.setMatrix("model",e.model.get()),a.setFloat("time",e.posTime),a.setVector("frequence",o),a.setVector("amplitude",n),a.setFloat("roadWidth",s),a.setFloat("roadLength",r),e.roadVbo.render(a.get())})),k()(v()(e),"renderShip",(function(){var t,n=e.mngProg.get("gltf"),r=e.mngGltf.get("raceship");e.model.push(),(t=e.model).translate.apply(t,u()(e.currentShipPos.get())),r.renderExcept(["trail1","trail2"],n,e.model),e.model.pop()})),k()(v()(e),"renderShipTrails",(function(){var t,n=e.mngProg.get("gltf"),r=e.mngGltf.get("raceship");e.model.push(),(t=e.model).translate.apply(t,u()(e.currentShipPos.get())),r.renderOnly(["trail1","trail2"],n,e.model),e.model.pop()})),k()(v()(e),"interactShip",(function(t){var n=e.config.roadWidth;e.targetSpeed.set(.1),e.targetPosX.set(-t.rel.x*n*.6)})),k()(v()(e),"onMouseDrag",(function(t){e.interactShip(t)})),k()(v()(e),"onMouseDown",(function(t){e.interactShip(t)})),k()(v()(e),"onMouseUp",(function(){e.targetSpeed.set(0)})),e}return m()(n,[{key:"setup",value:function(){var e=this.gl;this.screen=new E.Z(e),this.model=new X.Z;var t=this.config,n=t.roadLength,r=t.roadWidth,s=t.shipPosition,o=(0,V.Eu)(2,n,{startX:-r,endX:r,startZ:0,endZ:n}),a=(0,V.Eu)(120,n,{startX:-120,endX:120,startZ:0,endZ:n}),i=(0,V.H$)(2,n);this.roadVbo=new F.Z(e,{position:o,indices:i});var l=(0,V.H$)(120,n);this.mountainVbo=new F.Z(e,{position:a,indices:l}),this.shipPos=c()(A.Z,u()(s)),this.currentShipPos=new A.Z(0),this.targetPosX=new D.Z(0,.1),this.targetSpeed=new D.Z(0,.1),this.posTime=0,this.setLampeInfos(this.mngProg.get("gltf")),this.mngProg.get("roadSky").setTexture(1,this.mngTex.get("noisergb").get(),"textureMap")}},{key:"update",value:function(e){y()(w()(n.prototype),"update",this).call(this,e),this.model.identity(),this.moveShip(),this.updateTrails(),this.updateCamera(),this.mngGltf.get("raceship").update(e)}},{key:"updateTrails",value:function(){var e=this.mngProg.get("gltf"),t=this.mngGltf.get("raceship");e.setProjectionView(this.camera),t.setAnimationStep("trail1","scale",10*this.targetSpeed.get()),t.setAnimationStep("trail2","scale",10*this.targetSpeed.get())}},{key:"renderLandscape",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("roadSky");e.setFloat("flipY",-1),e.setFloat("time",.1*this.time),e.setVector("wind",[.1,.2]),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"renderTunnel",value:function(){this.gl.disable(this.gl.DEPTH_TEST);var e=this.mngProg.get("tunnelrace");e.setFloat("flipY",-1),e.setFloat("time",.001*this.time),this.screen.render(e.get()),this.gl.enable(this.gl.DEPTH_TEST)}},{key:"render",value:function(){y()(w()(n.prototype),"render",this).call(this),this.postProcess.start(),this.renderTunnel(),this.renderMountain(),this.renderRoad(),this.renderShip(),this.postProcess.end(),this.bloom.start(),this.renderShipTrails(),this.bloom.end(),this.postProcess.mergeBloom(this.bloom.getTexture(),1.5,2.2);var e=100*this.targetSpeed.get();this.postProcess.setRGB(e,e,.5,.5),this.postProcess.setFxaa2(),this.postProcess.render()}}]),n}(M.Z);const H={slug:"race",assets:["/textures/noisergb.png","/gltf/raceship.gltf"],shaders:["/camera/road.js","/camera/gltf.js","/camera/roadmountain.js","/camera/basique3d.js","/sky/roadSky.js","/camera/gltf.js","/screen/screen.js","/screen/debug.js","/screen/blurOnePass.js","/screen/bloom.js","/screen/mergeBloom.js","/screen/fxaa.js","/screen/fxaa2.js","/screen/tunnelrace.js","/screen/rgb.js"],useDepthTexture:!0,postprocess:{bloom:{intensity:1}},textures:{noisergb:"LINEAR"},canvas:{width:1024,height:512},mouse:{events:["down","up","drag"]},camera:{position:{x:0,y:4,z:0},target:{x:0,y:0,z:128},near:1,far:200,angle:90},lampes:[{type:0,position:{x:0,y:3,z:3},ambiant:[1,1,1],diffuse:[.8,.6,.5],specular:[1,.8,.7],brillance:1,strength:40}],controls:{fullscreen:{buttonId:"fullscreen-toggle-btn"}},roadFrequence:[2,0,2],roadAmplitude:[10,0,4],roadLength:128,roadWidth:8,shipPosition:[0,2,3]};n(88747),n(89153);var W=null;const Y=s()(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W=new i.Z,e.next=3,W.setup(q,H);case 3:case"end":return e.stop()}}),e)})));var z=function(){W&&W.destroy&&W.destroy()}},24981:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(8081),s=n.n(r),o=n(23645),a=n.n(o)()(s());a.push([e.id,"#controls {\n  position: absolute;\n  top: 0;\n  right: 0;\n  display: flex;\n  align-items: stretch;\n  z-index: 10;\n  background-color: rgba(34, 34, 34, .8);\n  margin: .5em;\n  padding: .5em;\n}\n\n#controls div {\n  display: flex;\n  align-items: stretch;\n}\n\n#controls div input[type=range] {\n  width: 100%;\n}\n\n#controls div input[type=checkbox] {\n  margin-right: 0.5em;\n}\n\n#controls label {\n  display: flex;\n  align-items: center;\n}\n\n#controls label,\n#controls a {\n  font-size: .8em;\n}\n\n@media (max-width: 570px) {\n  #controls.responsive {\n    position: relative;\n    width: 100%;\n    margin: 0;\n  }\n}",""]);const i=a},76889:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(8081),s=n.n(r),o=n(23645),a=n.n(o)()(s());a.push([e.id,"#fullscreen-toggle-btn {\n  border-radius: 0;\n  margin: 0;\n  padding: 4px;\n  border: solid 2px var(--project-color);\n}\n\n#fullscreen-toggle-btn:hover svg,\n#fullscreen-toggle-btn:active svg {\n  transform: scale(0.8);\n  opacity: 1;\n}\n\n#fullscreen-toggle-btn svg {\n  display: block;\n  width: 2em;\n  fill: #fff;\n  opacity: 0.8;\n  transform: scale(0.6);\n  transition: opacity 300ms ease-out, transform 300ms ease-out;\n}\n\n[data-fullscreen] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n",""]);const i=a},88747:(e,t,n)=>{var r=n(93379),s=n.n(r),o=n(7795),a=n.n(o),i=n(90569),l=n.n(i),c=n(3565),d=n.n(c),u=n(70609),g=n.n(u),h=n(44589),p=n.n(h),m=n(24981),f={};f.styleTagTransform=p(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=g();s()(m.Z,f),m.Z&&m.Z.locals&&m.Z.locals},89153:(e,t,n)=>{var r=n(93379),s=n.n(r),o=n(7795),a=n.n(o),i=n(90569),l=n.n(i),c=n(3565),d=n.n(c),u=n(70609),g=n.n(u),h=n(44589),p=n.n(h),m=n(76889),f={};f.styleTagTransform=p(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=g();s()(m.Z,f),m.Z&&m.Z.locals&&m.Z.locals}}]);