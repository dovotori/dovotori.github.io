(self.webpackChunkdovotori=self.webpackChunkdovotori||[]).push([[2956],{63364:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>T});s(9978);var n=s(54705),i=s(66725);const r=class{constructor(){var t=this;(0,n.A)(this,"on",(function(){return t.socket.on(...arguments)})),(0,n.A)(this,"emit",(function(){return t.socket.emit(...arguments)})),(0,n.A)(this,"reconnect",(()=>(this.close(),new Promise(((t,e)=>{this.socket.connect(),this.socket.on("connect_error",(t=>{this.socket.close(),e(t)})),this.socket.on("connect",(()=>{t(this)}))}))))),(0,n.A)(this,"close",(()=>{this.socket.connected&&this.socket.disconnect()})),(0,n.A)(this,"isConnected",(()=>this.socket.connected));return this.socket=null,new Promise(((t,e)=>{this.socket=(0,i.Ay)("http://localhost:8083"),this.socket.on("connect_error",(t=>{this.socket.disconnect(),e(t)})),this.socket.on("connect",(()=>{t(this)}))}))}};var o=s(41770),a=s.n(o);const c=class{constructor(){(0,n.A)(this,"setSignal",(t=>{this.peer.signal(t)})),(0,n.A)(this,"setAsk",(t=>{this.ask=t})),(0,n.A)(this,"setStream",(t=>{this.stream=t,this.isCreated&&this.peer.addStream(this.stream)})),(0,n.A)(this,"setAnswer",(t=>{this.answer=t,this.isInitiator&&this.isCreated&&this.peer.signal(this.answer)})),(0,n.A)(this,"setOffer",(t=>{this.offer=t,this.tryToCreate()})),(0,n.A)(this,"setIsInitiator",(t=>{this.isInitiator=t,this.tryToCreate()})),this.isInitiator=null,this.isConnected=!1,this.peer=null,this.stream=null,this.answer=null,this.offer=null,this.ask=null,this.isCreated=!1}tryToCreate(){this.isCreated||null===this.isInitiator||(this.isInitiator||!this.isInitiator&&this.offer)&&this.create()}create(){this.peer=new(a())({initiator:this.isInitiator,trickle:!1,stream:this.stream}),this.peer.on("error",(t=>{})),this.peer.on("signal",(t=>{this.isConnected||(this.isInitiator&&t.type&&"offer"===t.type?this.ask("question offer",t):!this.isInitiator&&t.type&&"answer"===t.type&&this.ask("question answer",t))})),this.peer.on("stream",(t=>{const e=document.querySelector("#emitter");e.srcObject=t,e.play()})),this.peer.on("connect",(()=>{this.isConnected=!0})),this.isInitiator||this.setSignal(this.offer),this.isCreated=!0}getIsInitiator(){return this.isInitiator}};var h=s(85072),l=s.n(h),u=s(97825),d=s.n(u),f=s(77659),m=s.n(f),w=s(55056),k=s.n(w),p=s(10540),y=s.n(p),A=s(41113),g=s.n(A),I=s(69646),C={};C.styleTagTransform=g(),C.setAttributes=k(),C.insert=m().bind(null,"head"),C.domAPI=d(),C.insertStyleElement=y();l()(I.A,C);I.A&&I.A.locals&&I.A.locals;const b=document.querySelector("#btn"),v=async t=>{const e=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((t=>t)).catch((t=>{}));if(e){t.setStream(e);const s=document.querySelector("#own");s.srcObject=e,s.play()}else b.innerHTML="Can't access your webcam. Retry"},T=()=>{let t=null;b&&b.addEventListener("click",(async()=>{b.innerHTML="Loading";try{if(null===t){b.innerHTML="Please allow webcam access";const e=new c;await v(e),t=await(async t=>{const e=await new r;return t.setAsk((function(){return e.emit(...arguments)})),e.on("answer initiator",t.setIsInitiator),e.on("answer offer",t.setOffer),e.on("answer answer",t.setAnswer),e.emit("question initiator"),e})(e),b.innerHTML=e.getIsInitiator()?"Connected (wait for another connection)":"Wait you will join someone"}else t.close(),t=null,b.innerHTML="Join"}catch(t){b.innerHTML="Retry"}}),!1)}},69646:(t,e,s)=>{"use strict";s.d(e,{A:()=>a});var n=s(31601),i=s.n(n),r=s(76314),o=s.n(r)()(i());o.push([t.id,"#labo {\n  position: relative;\n  width: 100%;\n  height: auto;\n  background-color: #222;\n  text-align: center;\n}\nvideo {\n  width: 50%;\n}\n.flex {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n#status {\n  width: 80%;\n  color: #fff;\n  margin: 0 auto;\n  padding: 1em;\n}\n#btn {\n  background: #fff;\n  width: 80%;\n  margin: 0 auto;\n  padding: 1em;\n  text-transform: uppercase;\n  letter-spacing: 0.2em;\n}\n",""]);const a=o},15340:()=>{},79838:()=>{}}]);